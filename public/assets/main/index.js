System.register("chunks:///_virtual/AStar.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,i,r;return{setters:[function(t){e=t.createClass},function(t){i=t.cclegacy,r=t._decorator}],execute:function(){var s;i._RF.push({},"0344fD+r89L+qVmbWRmMzxg","AStar",void 0);var o=r.ccclass;r.property,t("AStar",o("AStar")(s=function(){function t(){this._open=void 0,this._closed=void 0,this._grid=void 0,this._endNode=void 0,this._startNode=void 0,this._path=void 0,this._heuristic=this.manhattan,this._straightCost=10,this._diagCost=14,this._startCalculateTime=void 0,this.costTotTime=void 0,this._size=0}var i=t.prototype;return i.isOpen=function(t){return this._open.indexOf(t)>-1},i.isClosed=function(t){return this._closed.indexOf(t)>-1},i.findPath=function(t,e){var i=this;return i._grid=t,i._open=[],i._closed=[],i._startNode=i._grid.startNode,i._endNode=i._grid.endNode,i._startNode.g=0,i._startNode.h=i._heuristic(i._startNode),i._startNode.f=i._startNode.g+i._startNode.h,i._startCalculateTime=i.getTime(),i._size=e,i.search()},i.search=function(){for(var t=this,e=t._startNode;e!=t._endNode;){for(var i=Math.max(0,e.x-1),r=Math.min(t._grid.numCols-1,e.x+1),s=Math.max(0,e.y-1),o=Math.min(t._grid.numRows-1,e.y+1),a=i;a<=r;a++)for(var n=s;n<=o;n++){var _=t._grid.getNode(a,n);if(_!=e&&_.walkable&&t._grid.getNode(e.x,_.y).walkable&&t._grid.getNode(_.x,e.y).walkable&&t.isNeighborOffsetAvailable(_)){var d=t._straightCost;e.x!=_.x&&e.y!=_.y&&(d=t._diagCost);var h=e.g+d*_.costMultiplier,u=t._heuristic(_),c=h+u;t.isOpen(_)||t.isClosed(_)?c<_.f&&(_.f=c,_.g=h,_.h=u,_.parent=e):(_.f=c,_.g=h,_.h=u,_.parent=e,t._open.push(_))}}if(t._closed.push(e),0==t._open.length){console.log("没找到最佳节点，无路可走!");var l=t.getTime()-t._startCalculateTime;return t.costTotTime=l,console.log("本次寻路计算总耗时: "+l+"ms"),!1}t._open.sort((function(t,e){return t.f-e.f})),e=t._open.shift()}return t.buildPath(),!0},i.buildPath=function(){var t=this;t._path=[];var e=t._endNode;for(t._path.push(e);e!=t._startNode;)e=e.parent,t._path.unshift(e);t._path.shift();var i=t.getTime()-t._startCalculateTime;t.costTotTime=i,console.log("本次寻路计算总耗时: "+i+"ms")},i.isNeighborOffsetAvailable=function(t){var e=this;if(!e._size)return!0;var i=t.x-e._size,r=t.x+e._size,s=t.y-e._size,o=t.y+e._size;if(i<0||r>e._grid.numCols-e._size||s<0||o>e._grid.numRows-e._size)return!1;for(var a=i;a<=r;a++)for(var n=s;n<=o;n++){if(!e._grid.getNode(a,n).walkable)return!1}return!0},i.getTime=function(){return(new Date).getTime()},i.manhattan=function(t){var e=this;return Math.abs(t.x-e._endNode.x)*e._straightCost+Math.abs(t.y-e._endNode.y)*e._straightCost},i.euclidian=function(t){var e=this,i=t.x-e._endNode.x,r=t.y-e._endNode.y;return Math.sqrt(i*i+r*r)*e._straightCost},i.diagonal=function(t){var e=this,i=Math.abs(t.x-e._endNode.x),r=Math.abs(t.y-e._endNode.y),s=Math.min(i,r),o=i+r;return e._diagCost*s+e._straightCost*(o-2*s)},e(t,[{key:"visited",get:function(){return this._closed.concat(this._open)}},{key:"openArray",get:function(){return this._open}},{key:"closedArray",get:function(){return this._closed}},{key:"path",get:function(){return this._path}}]),t}())||s);i._RF.pop()}}}));

System.register("chunks:///_virtual/AstarHoneycombRoadSeeker.ts",["cc","./BinaryTreeNode.ts","./PathOptimize.ts"],(function(t){var e,s,i;return{setters:[function(t){e=t.cclegacy},function(t){s=t.default},function(t){i=t.PathOptimize}],execute:function(){e._RF.push({},"e497dPYOn9Hv7/j8glFrb7/","AstarHoneycombRoadSeeker",void 0);t("default",function(){function t(t){this.COST_STRAIGHT=10,this.COST_DIAGONAL=10,this.maxStep=1e5,this._openlist=void 0,this._closelist=void 0,this._binaryTreeNode=new s,this._startNode=void 0,this._currentNode=void 0,this._targetNode=void 0,this._roadNodes=void 0,this._round1=[[0,-1],[1,-1],[1,0],[0,1],[-1,0],[-1,-1]],this._round2=[[0,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0]],this._neighbours=void 0,this._neighboursDic={},this.handle=-1,this.optimize=!0,this._pathOptimize=i.best,this._isPassCallBack=null,this._roadNodes=t}var e=t.prototype;return e.setMaxSeekStep=function(t){this.maxStep=t},e.setPathOptimize=function(t){this._pathOptimize=t},e.setPathQuadSeek=function(t){},e.setRoadNodePassCondition=function(t){this._isPassCallBack=t},e.seekPath=function(t,e,s){if(this._startNode=t,this._currentNode=t,this._targetNode=e,this._neighbours=this.getNeighbours(s),!this._startNode||!this._targetNode)return[];if(this._startNode==this._targetNode)return[this._targetNode];if(!this.isCanPass(this._targetNode))return console.warn("目标不可达到："),[];this._startNode.g=0,this._startNode.resetTree(),this._binaryTreeNode.refleshTag();for(var i=0;;){if(i>this.maxStep)return console.warn("没找到目标计算步骤为：",i),[];if(i++,this.searchRoundNodes(this._currentNode),this._binaryTreeNode.isTreeNull())return console.warn("没找到目标计算步骤为：",i),[];if(this._currentNode=this._binaryTreeNode.getMin_F_Node(),this._currentNode==this._targetNode)return console.log("找到目标计算步骤为：",i),this.getPath();this._binaryTreeNode.setRoadNodeInCloseList(this._currentNode)}},e.seekPath2=function(t,e,s){if(this._startNode=t,this._currentNode=t,this._targetNode=e,this._neighbours=this.getNeighbours(s),!this._startNode||!this._targetNode)return[];if(this._startNode==this._targetNode)return[this._targetNode];var i=this.maxStep;this.isCanPass(this._targetNode)||(i=3*(Math.abs(this._targetNode.col-this._startNode.col)+Math.abs(this._targetNode.row-this._startNode.row)))>this.maxStep&&(i=this.maxStep),this._startNode.g=0,this._startNode.resetTree(),this._binaryTreeNode.refleshTag();for(var o=0,r=null;;){if(o>i)return console.warn("没找到目标计算步骤为：",o),this.seekPath(t,r);if(o++,this.searchRoundNodes(this._currentNode),this._binaryTreeNode.isTreeNull())return console.warn("没找到目标计算步骤为：",o),this.seekPath(t,r);if(this._currentNode=this._binaryTreeNode.getMin_F_Node(),(null==r||this._currentNode.h<r.h)&&(r=this._currentNode),this._currentNode==this._targetNode)return console.log("找到目标计算步骤为：",o),this.getPath();this._binaryTreeNode.setRoadNodeInCloseList(this._currentNode)}},e.getPath=function(){for(var t,e,s,i,o,r,h=[],n=this._targetNode;n!=this._startNode;)h.unshift(n),n=n.parent;if(h.unshift(this._startNode),!this.optimize)return h;for(_=1;_<h.length-1;_++){t=h[_-1],e=h[_],s=h[_+1],i=this.getHoneyPoint(t),o=this.getHoneyPoint(e),r=this.getHoneyPoint(s);var a=e.col==t.col&&e.col==s.col,d=e.row==t.row&&e.row==s.row&&t.col%2==e.col%2&&e.col%2==s.col%2,u=i.hx==o.hx&&o.hx==r.hx,N=i.hy==o.hy&&o.hy==r.hy;(a||d||u||N)&&(h.splice(_,1),_--)}for(var _=0;_<h.length-2;_++){for(var l=h[_],c=null,g=h.length-1;g>_+1;g--){var y=h[g];if(this.isArriveBetweenTwoNodes(l,y)){c=y;break}}if(c){var f=g-_-1;h.splice(_+1,f)}}return h},e.isArriveBetweenTwoNodes=function(t,e){var s=this.getHoneyPoint(t),i=this.getHoneyPoint(e);if(s.hx==i.hx&&s.hy==i.hy)return!1;var r=Math.abs(i.hx-s.hx),h=Math.abs(i.hy-s.hy),n=0;i.hx>s.hx?n=1:i.hx<s.hx&&(n=-1);var a=0;i.hy>s.hy?a=1:i.hy<s.hy&&(a=-1);var d=0,u=0,N=0,_=0;if(r>h)for(var l=h/r,c=0;c<r;c+=2){if(u=c*a*l,N=a>0?Math.floor(s.hy+u):Math.ceil(s.hy+u),_=Math.abs(u%1),(g=new o).hx=s.hx+c*n,g.hy=_<=.5?N:N+1*a,u=(c+1)*a*l,N=a>0?Math.floor(s.hy+u):Math.ceil(s.hy+u),_=Math.abs(u%1),(y=new o).hx=s.hx+(c+1)*n,y.hy=_<=.5?N:N+1*a,u=(c+2)*a*l,N=a>0?Math.floor(s.hy+u):Math.ceil(s.hy+u),_=Math.abs(u%1),(f=new o).hx=s.hx+(c+2)*n,f.hy=_<=.5?N:N+1*a,!this.isCrossAtAdjacentNodes(s,i,g,y,f))return!1}else for(l=r/h,c=0;c<h;c+=2){var g,y,f;if(d=c*n*l,N=n>0?Math.floor(s.hx+d):Math.ceil(s.hx+d),_=Math.abs(d%1),(g=new o).hx=_<=.5?N:N+1*n,g.hy=s.hy+c*a,d=(c+1)*n*l,N=n>0?Math.floor(s.hx+d):Math.ceil(s.hx+d),_=Math.abs(d%1),(y=new o).hx=_<=.5?N:N+1*n,y.hy=s.hy+(c+1)*a,d=(c+2)*n*l,N=n>0?Math.floor(s.hx+d):Math.ceil(s.hx+d),_=Math.abs(d%1),(f=new o).hx=_<=.5?N:N+1*n,f.hy=s.hy+(c+2)*a,!this.isCrossAtAdjacentNodes(s,i,g,y,f))return!1}return!0},e.isCrossAtAdjacentNodes=function(t,e,s,i,o){var r=this.getNodeByHoneyPoint(s.hx,s.hy),h=this.getNodeByHoneyPoint(i.hx,i.hy);this.getNodeByHoneyPoint(o.hx,o.hy);if(r==h)return!1;if(!this.isCanPass(r)||!this.isCanPass(h))return!1;var n=s.hx-i.hx,a=s.hy-i.hy,d=o.hx-i.hx,u=o.hy-i.hy;if(Math.abs(n)>1||Math.abs(a)>1||Math.abs(d)>1||Math.abs(u)>1)return!1;if(n==-a)if(-1==n){if(!this.isPassNode(this.getNodeByHoneyPoint(i.hx-1,i.hy))||!this.isPassNode(this.getNodeByHoneyPoint(i.hx,i.hy+1)))return!1}else if(!this.isPassNode(this.getNodeByHoneyPoint(i.hx+1,i.hy))||!this.isPassNode(this.getNodeByHoneyPoint(i.hx,i.hy-1)))return!1;if(i.hx==e.hx&&i.hy==e.hy)return!0;if(d==-u)if(-1==d){if(!this.isPassNode(this.getNodeByHoneyPoint(i.hx-1,i.hy))||!this.isPassNode(this.getNodeByHoneyPoint(i.hx,i.hy+1)))return!1}else if(!this.isPassNode(this.getNodeByHoneyPoint(i.hx+1,i.hy))||!this.isPassNode(this.getNodeByHoneyPoint(i.hx,i.hy-1)))return!1;return s.hx==i.hx&&i.hx==o.hx||!!this.isPassNode(this.getNodeByHoneyPoint(i.hx+(n+d),i.hy+(a+u)))},e.getHoneyPoint=function(t){var e=t.row+Math.ceil(t.col/2),s=t.row-Math.floor(t.col/2);return new o(e,s)},e.getNodeByHoneyPoint=function(t,e){var s=t-e,i=Math.floor((t-e)/2)+e;return this.getRoadNode(s,i)},e.getRoundNodeByIndex=function(t,e){if(!t)return null;var s;e%=6,s=t.col%2==0?this._round1:this._round2;var i=t.col+s[e][0],o=t.row+s[e][1];return this.getRoadNode(i,o)},e.getRoundNodes=function(t){var e;e=t.col%2==0?this._round1:this._round2;for(var s=[],i=0;i<e.length;i++){var o=t.col+e[i][0],r=t.row+e[i][1],h=this.getRoadNode(o,r);s.push(h)}return s},e.isPassNode=function(t){return null!=t&&0!=t.value},e.isCanPass=function(t){if(!this.isPassNode(t))return!1;if(!this._neighbours||!this._neighbours.length)return!0;for(var e=this.getHoneyPoint(t),s=0;s<this._neighbours.length;s++){var i=e.hx+this._neighbours[s][0],o=e.hy+this._neighbours[s][1],r=this.getNodeByHoneyPoint(i,o);if(!this.isPassNode(r))return!1}return!0},e.getRoadNode=function(t,e){var s=t+"_"+e;return this._roadNodes[s]},e.getNeighbours=function(t){if(!t)return null;var e=null;return null!=this._neighboursDic[t]?e=this._neighboursDic[t]:(e=[],this.getNeighboursRecursive(0,0,t,1,e,{},{},[[-1,-1],[-1,0],[0,1],[1,1],[1,0],[0,-1]]),this._neighboursDic[t]=e),e},e.getNeighboursRecursive=function(t,e,s,i,o,r,h,n){if(!(i>s)){r[u=t+"_"+e]=!0;for(var a=n.length,d=0;d<a;d++){var u,N=t+n[d][0],_=e+n[d][1];0==N&&0==_||r[u=N+"_"+_]||(h[u]||(o.push([N,_]),h[u]=!0),this.getNeighboursRecursive(N,_,s,i+1,o,r,h,n))}}},e.testSeekPathStep=function(t,e,s,i,o,r){var h=this;if(void 0===r&&(r=100),this._startNode=t,this._currentNode=t,this._targetNode=e,this._neighbours=this.getNeighbours(s),this.isCanPass(this._targetNode)){this._startNode.g=0,this._startNode.resetTree(),this._binaryTreeNode.refleshTag(),this._closelist=[];var n=0;clearInterval(this.handle),this.handle=setInterval((function(){return n>h.maxStep?(console.warn("没找到目标计算步骤为：",n),void clearInterval(h.handle)):(n++,h.searchRoundNodes(h._currentNode),h._binaryTreeNode.isTreeNull()?(console.warn("没找到目标计算步骤为：",n),void clearInterval(h.handle)):(h._currentNode=h._binaryTreeNode.getMin_F_Node(),void(h._currentNode==h._targetNode?(console.log("找到目标计算步骤为：",n),clearInterval(h.handle),h._openlist=h._binaryTreeNode.getOpenList(),i.apply(o,[h._startNode,h._targetNode,h._currentNode,h._openlist,h._closelist,h.getPath()])):(h._binaryTreeNode.setRoadNodeInCloseList(h._currentNode),h._openlist=h._binaryTreeNode.getOpenList(),h._closelist.push(h._currentNode),i.apply(o,[h._startNode,h._targetNode,h._currentNode,h._openlist,h._closelist,null])))))}),r)}},e.searchRoundNodes=function(t){var e;e=t.col%2==0?this._round1:this._round2;for(var s=0;s<e.length;s++){var i=t.col+e[s][0],o=t.row+e[s][1],r=this.getRoadNode(i,o);this.isCanPass(r)&&r!=this._startNode&&!this.isInCloseList(r)&&this.setNodeF(r)}},e.setNodeF=function(t){var e;e=t.col==this._currentNode.col||t.row==this._currentNode.row?this._currentNode.g+this.COST_STRAIGHT:this._currentNode.g+this.COST_DIAGONAL,this.isInOpenList(t)?e<t.g&&(t.g=e,t.parent=this._currentNode,t.h=(Math.abs(this._targetNode.col-t.col)+Math.abs(this._targetNode.row-t.row))*this.COST_STRAIGHT,t.f=t.g+t.h,this._binaryTreeNode.removeTreeNode(t),this._binaryTreeNode.addTreeNode(t)):(t.g=e,this._binaryTreeNode.setRoadNodeInOpenList(t),t.resetTree(),t.parent=this._currentNode,t.h=(Math.abs(this._targetNode.col-t.col)+Math.abs(this._targetNode.row-t.row))*this.COST_STRAIGHT,t.f=t.g+t.h,this._binaryTreeNode.addTreeNode(t))},e.isInOpenList=function(t){return this._binaryTreeNode.isInOpenList(t)},e.isInCloseList=function(t){return this._binaryTreeNode.isInCloseList(t)},e.dispose=function(){this._roadNodes=null,this._round1=null,this._round2=null},t}());var o=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.hx=0,this.hy=0,this.hx=t,this.hy=e};e._RF.pop()}}}));

System.register("chunks:///_virtual/AStarRoadSeeker.ts",["cc","./BinaryTreeNode.ts","./PathOptimize.ts","./PathQuadSeek.ts"],(function(t){var e,s,r,i;return{setters:[function(t){e=t.cclegacy},function(t){s=t.default},function(t){r=t.PathOptimize},function(t){i=t.PathQuadSeek}],execute:function(){e._RF.push({},"17b41GJgHVCD4qFfzxRO7+J","AStarRoadSeeker",void 0);t("default",function(){function t(t){this.COST_STRAIGHT=10,this.COST_DIAGONAL=14,this.maxStep=1e5,this._openlist=void 0,this._closelist=void 0,this._binaryTreeNode=new s,this._startNode=void 0,this._currentNode=void 0,this._targetNode=void 0,this._roadNodes=void 0,this._round1=[[0,-1],[1,0],[0,1],[-1,0]],this._round2=[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]],this._round=this._round2,this._neighbours=void 0,this._neighboursDic={},this.handle=-1,this.optimize=!0,this._pathOptimize=r.none,this._pathQuadSeek=i.path_dire_8,this._isPassCallBack=null,this._startCalculateTime=void 0,this._roadNodes=t}var e=t.prototype;return e.setMaxSeekStep=function(t){this.maxStep=t},e.setPathOptimize=function(t){this._pathOptimize=t},e.setPathQuadSeek=function(t){this._pathQuadSeek=t,this._pathQuadSeek==i.path_dire_4?this._round=this._round1:this._round=this._round2},e.setRoadNodePassCondition=function(t){this._isPassCallBack=t},e.seekPath=function(t,e,s){if(this._startNode=t,this._currentNode=t,this._targetNode=e,this._neighbours=this.getNeighbours(s),this._startCalculateTime=this.getTime(),!this._startNode||!this._targetNode)return[];if(this._startNode==this._targetNode)return[this._targetNode];if(!this.isCanPass(this._targetNode))return console.warn("目标不可达到, 行: "+this._targetNode.row+", 列: "+this._targetNode.col+", x: "+this._targetNode.px+", y: "+this._targetNode.py),[];this._startNode.g=0,this._startNode.resetTree(),this._binaryTreeNode.refleshTag();for(var r=0;;){if(r>this.maxStep){var i=this.getTime()-this._startCalculateTime;return console.warn("超过最大寻路步数{"+this.maxStep+"}, 没找到目标计算步骤为："+r+", 总耗时: "+i+"ms"),[]}if(r++,this.searchRoundNodes(this._currentNode),this._binaryTreeNode.isTreeNull()){var o=this.getTime()-this._startCalculateTime;return console.warn("没找到目标计算步骤为：: "+r+"，总耗时: "+o+"ms"),[]}if(this._currentNode=this._binaryTreeNode.getMin_F_Node(),this._currentNode==this._targetNode){var a=this.getTime()-this._startCalculateTime;return console.log("找到目标计算步骤为: "+r+"，总耗时: "+a+"ms"),this.getPath()}this._binaryTreeNode.setRoadNodeInCloseList(this._currentNode)}},e.seekPath2=function(t,e,s){if(this._startNode=t,this._currentNode=t,this._targetNode=e,this._neighbours=this.getNeighbours(s),this._startCalculateTime=this.getTime(),!this._startNode||!this._targetNode)return[];if(this._startNode==this._targetNode)return[this._targetNode];var r=this.maxStep;this.isCanPass(this._targetNode)||(r=3*(Math.abs(this._targetNode.col-this._startNode.col)+Math.abs(this._targetNode.row-this._startNode.row)))>this.maxStep&&(r=this.maxStep),this._startNode.g=0,this._startNode.resetTree(),this._binaryTreeNode.refleshTag();for(var i=0,o=null;;){if(i>r){var a=this.getTime()-this._startCalculateTime;return console.warn("seekPath2 超过最大寻路步数{"+this.maxStep+"}, 没找到目标计算步骤为："+i+", 总耗时: "+a+"ms"),this.seekPath(t,o)}if(i++,this.searchRoundNodes(this._currentNode),this._binaryTreeNode.isTreeNull()){var h=this.getTime()-this._startCalculateTime;return console.warn("seekPath2 没找到目标计算步骤为："+i+", 总耗时: "+h+"ms"),this.seekPath(t,o)}if(this._currentNode=this._binaryTreeNode.getMin_F_Node(),(null==o||this._currentNode.h<o.h)&&(o=this._currentNode),this._currentNode==this._targetNode){var n=this.getTime()-this._startCalculateTime;return console.log("seekPath2 找到目标计算步骤为："+i+", 总耗时: "+n+"ms"),this.getPath()}this._binaryTreeNode.setRoadNodeInCloseList(this._currentNode)}},e.getPath=function(){for(var t=[],e=this._targetNode;e!=this._startNode;)t.unshift(e),e=e.parent;if(t.unshift(this._startNode),this._pathOptimize==r.none)return t;for(var s=1;s<t.length-1;s++){var o=t[s-1],a=t[s],h=t[s+1],n=a.col==o.col&&a.col==h.col,d=a.row==o.row&&a.row==h.row,_=!1;this._pathQuadSeek==i.path_dire_8&&(_=(a.col-o.col)/(a.row-o.row)*((h.col-a.col)/(h.row-a.row))==1),(n||d||_)&&(t.splice(s,1),s--)}if(this._pathQuadSeek==i.path_dire_4)return t;if(this._pathOptimize==r.better)return t;for(var u=0;u<t.length-2;u++){for(var l=t[u],c=null,N=t.length-1;N>u+1;N--){var g=t[N];if(l.col!=g.col&&l.row!=g.row&&Math.abs(g.col-l.col)!=Math.abs(g.row-l.row)&&this.isArriveBetweenTwoNodes(l,g)){c=g;break}}if(c){var f=N-u-1;t.splice(u+1,f)}}return t},e.isArriveBetweenTwoNodes=function(t,e){if(t==e)return!1;var s=Math.abs(e.col-t.col),r=Math.abs(e.row-t.row),i=0;e.col>t.col?i=1:e.col<t.col&&(i=-1);var o=0;e.row>t.row?o=1:e.row<t.row&&(o=-1);var a,h=0,n=0,d=0,_=0;if(s>r){a=r/s;for(var u=0;u<s;u++){n=t.row+u*o*a,d=Math.floor(n),_=n%1;var l=t.col+u*i,c=_<=.5?d:d+1;n=t.row+(u+1)*o*a,d=Math.floor(n),_=n%1;var N=t.col+(u+1)*i,g=_<=.5?d:d+1,f=this.getRoadNode(l,c),T=this.getRoadNode(N,g);if(!this.isCrossAtAdjacentNodes(f,T))return!1}}else{a=s/r;for(var p=0;p<r;p++){h=p*i*a,d=i>0?Math.floor(t.col+h):Math.ceil(t.col+h);var v=(_=Math.abs(h%1))<=.5?d:d+1*i,b=t.row+p*o;h=(p+1)*i*a,d=i>0?Math.floor(t.col+h):Math.ceil(t.col+h);var w=(_=Math.abs(h%1))<=.5?d:d+1*i,m=t.row+(p+1)*o,C=this.getRoadNode(v,b),P=this.getRoadNode(w,m);if(!this.isCrossAtAdjacentNodes(C,P))return!1}}return!0},e.isCrossAtAdjacentNodes=function(t,e){if(t==e)return!1;if(!this.isCanPass(t)||!this.isCanPass(e))return!1;var s=e.col-t.col,r=e.row-t.row;return!(Math.abs(s)>1||Math.abs(r)>1)&&(t.col==e.col||t.row==e.row||!(!this.isPassNode(this.getRoadNode(t.col,t.row+r))||!this.isPassNode(this.getRoadNode(t.col+s,t.row))))},e.isPassNode=function(t){return null!=this._isPassCallBack?this._isPassCallBack(t):null!=t&&0!=t.value},e.isCanPass=function(t){if(!this.isPassNode(t))return!1;if(!this._neighbours||!this._neighbours.length)return!0;for(var e=0;e<this._neighbours.length;e++){var s=t.col+this._neighbours[e][0],r=t.row+this._neighbours[e][1],i=this.getRoadNode(s,r);if(!this.isPassNode(i))return!1}return!0},e.getRoadNode=function(t,e){var s=t+"_"+e;return this._roadNodes[s]},e.getNeighbours=function(t){if(!t)return null;var e=null;if(null!=this._neighboursDic[t])e=this._neighboursDic[t];else{e=[];for(var s=-t;s<=t;s++)for(var r=-t;r<=t;r++)0==r&&0==s||Math.abs(r)+Math.abs(s)>t||e.push([r,s]);this._neighboursDic[t]=e}return e},e.testSeekPathStep=function(t,e,s,r,i,o){var a=this;if(void 0===o&&(o=100),this._startNode=t,this._currentNode=t,this._targetNode=e,this._neighbours=this.getNeighbours(s),this.isCanPass(this._targetNode)){this._startNode.g=0,this._startNode.resetTree(),this._binaryTreeNode.refleshTag(),this._closelist=[];var h=0;clearInterval(this.handle),this.handle=setInterval((function(){return h>a.maxStep?(console.warn("超过目标计算步骤为：",h),void clearInterval(a.handle)):(h++,a.searchRoundNodes(a._currentNode),a._binaryTreeNode.isTreeNull()?(console.warn("没找到目标计算步骤为：",h),void clearInterval(a.handle)):(a._currentNode=a._binaryTreeNode.getMin_F_Node(),void(a._currentNode==a._targetNode?(console.log("找到目标计算步骤为：",h),clearInterval(a.handle),a._openlist=a._binaryTreeNode.getOpenList(),r.apply(i,[a._startNode,a._targetNode,a._currentNode,a._openlist,a._closelist,a.getPath()])):(a._binaryTreeNode.setRoadNodeInCloseList(a._currentNode),a._openlist=a._binaryTreeNode.getOpenList(),a._closelist.push(a._currentNode),r.apply(i,[a._startNode,a._targetNode,a._currentNode,a._openlist,a._closelist,null])))))}),o)}},e.searchRoundNodes=function(t){for(var e=0;e<this._round.length;e++){var s=t.col+this._round[e][0],r=t.row+this._round[e][1],i=this.getRoadNode(s,r);!this.isCanPass(i)||i==this._startNode||this.isInCloseList(i)||this.inInCorner(i)||this.setNodeF(i)}},e.setNodeF=function(t){var e;e=t.col==this._currentNode.col||t.row==this._currentNode.row?this._currentNode.g+this.COST_STRAIGHT:this._currentNode.g+this.COST_DIAGONAL,this.isInOpenList(t)?e<t.g&&(t.g=e,t.parent=this._currentNode,t.h=(Math.abs(this._targetNode.col-t.col)+Math.abs(this._targetNode.row-t.row))*this.COST_STRAIGHT,t.f=t.g+t.h,this._binaryTreeNode.removeTreeNode(t),this._binaryTreeNode.addTreeNode(t)):(t.g=e,this._binaryTreeNode.setRoadNodeInOpenList(t),t.resetTree(),t.parent=this._currentNode,t.h=(Math.abs(this._targetNode.col-t.col)+Math.abs(this._targetNode.row-t.row))*this.COST_STRAIGHT,t.f=t.g+t.h,this._binaryTreeNode.addTreeNode(t))},e.isInOpenList=function(t){return this._binaryTreeNode.isInOpenList(t)},e.isInCloseList=function(t){return this._binaryTreeNode.isInCloseList(t)},e.inInCorner=function(t){if(this._pathQuadSeek==i.path_dire_4)return!1;if(t.col==this._currentNode.col||t.row==this._currentNode.row)return!1;var e=this.getRoadNode(this._currentNode.col,t.row),s=this.getRoadNode(t.col,this._currentNode.row);return!this.isPassNode(e)||!this.isPassNode(s)},e.getTime=function(){return(new Date).getTime()},e.dispose=function(){this._roadNodes=null,this._round=null},t}());e._RF.pop()}}}));

System.register("chunks:///_virtual/BaseEnum.ts",["cc"],(function(n){var e;return{setters:[function(n){e=n.cclegacy}],execute:function(){var t;n("BaseEnum",void 0),e._RF.push({},"db093pwWWtDUZTnMgn5P9zO","BaseEnum",void 0),function(n){var e=function(n){return n.onSpPlayEnd="onSpPlayEnd",n}({});n.Game=e;var t=function(n){return n[n.DATA_URL=0]="DATA_URL",n[n.TEXT=1]="TEXT",n[n.BINARY=2]="BINARY",n[n.ARRAYBUFFER=3]="ARRAYBUFFER",n}({});n.READ_FILE_TYPE=t}(t||(t=n("BaseEnum",{}))),e._RF.pop()}}}));

System.register("chunks:///_virtual/BaseUtil.ts",["cc"],(function(t){var e,n,r,a,o,i,c,u,g,h;return{setters:[function(t){e=t.cclegacy,n=t.view,r=t.screen,a=t.Size,o=t.Vec2,i=t.Node,c=t.UITransform,u=t.UIOpacity,g=t.Layers,h=t.game}],execute:function(){var s;t("BaseUT",void 0),e._RF.push({},"cf03fhAu29N34p5XfVowsjF","BaseUtil",void 0),function(t){function e(){return n}function s(){return r}function f(){var t=s().windowSize,n=e();return t.width/=n.getScaleX(),t.height/=n.getScaleY(),t}function l(){var t=f();return new a(t.width,t.height)}function v(t,e,n){t.getComponent(c).setContentSize(e,n)}t.getView=e,t.getScreen=s,t.getStageSize=f,t.getLayerScaleSize=l,t.setFitSize=function(t){var e=l();return v(t,e.width,e.height),e},t.getMousePos=function(t){var n=e();return new o(t.x/n.getScaleX(),t.y/n.getScaleY())},t.newUINode=function(t){var e=new i(t);return e.addComponent(c),e.addComponent(u),e.layer=g.Enum.UI_2D,e},t.setAlpha=function(t,e){t.getComponent(u).opacity=255*e},t.setPivot=function(t,e,n){var r=t.getComponent(c);r.anchorX=e,r.anchorY=n},t.setSize=v,t.getSize=function(t){var e=t.getComponent(c);return new a(e.width,e.height)},t.getFitY=function(t,e){return t+(e-t)*(l().height-1068)/212},t.changeMouseCursor=function(t){void 0===t&&(t="auto"),h.canvas.style.cursor=t},t.getRandomNumber=function(t,e){var n=Math.random()*(e-t+1)+t;return Math.floor(n)},t.angle_to_radian=function(t){return Math.PI/180*t},t.radian_to_angle=function(t){return 180/Math.PI*t},t.angle_to_vector=function(t){var e=this.angle_to_radian(t),n=Math.cos(e),r=Math.sin(e);return new o(n,r).normalize()},t.vector_to_angle=function(t){var e=t.normalize().signAngle(new o(1,0));return-this.radian_to_angle(e)},t.RectCircleColliding=function(t,e){var n=t.cx-Math.max(e.x,Math.min(t.cx,e.x+e.w)),r=t.cy-Math.max(e.y,Math.min(t.cy,e.y+e.h));return n*n+r*r<t.r*t.r}}(s||(s=t("BaseUT",{}))),e._RF.pop()}}}));

System.register("chunks:///_virtual/BinaryTreeNode.ts",["cc"],(function(e){var t;return{setters:[function(e){t=e.cclegacy}],execute:function(){t._RF.push({},"68370IXWBFD74U0GhTF6pAg","BinaryTreeNode",void 0);e("default",function(){function e(){this.seekTag=0,this.openNode=null,this.count=0}var t=e.prototype;return t.refleshTag=function(){this.openNode=null,this.count=0,this.seekTag++,this.seekTag>1e9&&(this.seekTag=0)},t.isTreeNull=function(){return null==this.openNode},t.addTreeNode=function(e,t){if(void 0===t&&(t=null),this.count++,null==t){if(null==this.openNode)return void(this.openNode=e);t=this.openNode}t!=e&&(e.f>=t.f?null==t.right?(t.right=e,e.treeParent=t):this.addTreeNode(e,t.right):null==t.left?(t.left=e,e.treeParent=t):this.addTreeNode(e,t.left))},t.removeTreeNode=function(e){this.count++,null!=e.treeParent||null!=e.left||null!=e.right?(null==e.treeParent?e.left?(this.openNode=e.left,e.left.treeParent=null,e.right&&(e.right.treeParent=null,this.addTreeNode(e.right,this.openNode))):e.right&&(this.openNode=e.right,e.right.treeParent=null):e.treeParent.left==e?e.right?(e.treeParent.left=e.right,e.right.treeParent=e.treeParent,e.left&&(e.left.treeParent=null,this.addTreeNode(e.left,e.right))):(e.treeParent.left=e.left,e.left&&(e.left.treeParent=e.treeParent)):e.treeParent.right==e&&(e.left?(e.treeParent.right=e.left,e.left.treeParent=e.treeParent,e.right&&(e.right.treeParent=null,this.addTreeNode(e.right,e.left))):(e.treeParent.right=e.right,e.right&&(e.right.treeParent=e.treeParent))),e.resetTree()):e==this.openNode&&(this.openNode=null)},t.getMin_F_Node=function(e){if(void 0===e&&(e=null),this.count++,null==e){if(null==this.openNode)return null;e=this.openNode}if(null==e.left){var t=e;return null==e.treeParent?(this.openNode=e.right,this.openNode&&(this.openNode.treeParent=null)):(e.treeParent.left=e.right,e.right&&(e.right.treeParent=e.treeParent)),t}return this.getMin_F_Node(e.left)},t.setRoadNodeInOpenList=function(e){e.openTag=this.seekTag,e.closeTag=0},t.setRoadNodeInCloseList=function(e){e.openTag=0,e.closeTag=this.seekTag},t.isInOpenList=function(e){return e.openTag==this.seekTag},t.isInCloseList=function(e){return e.closeTag==this.seekTag},t.getOpenList=function(){var e=[];return this.seachTree(this.openNode,e),e},t.seachTree=function(e,t){null!=e&&(t.push(e),e.left&&this.seachTree(e.left,t),e.right&&this.seachTree(e.right,t))},e}());t._RF.pop()}}}));

System.register("chunks:///_virtual/ButtonPlus.ts",["./rollupPluginModLoBabelHelpers.js","cc","./SoundMgr.ts"],(function(t){var n,o,u,c,e,i;return{setters:[function(t){n=t.inheritsLoose},function(t){o=t.cclegacy,u=t._decorator,c=t.Node,e=t.Button},function(t){i=t.SoundMgr}],execute:function(){var r;o._RF.push({},"668dcQo8b9L7bzcNhn/f/X6","ButtonPlus",void 0);var s=u.ccclass;u.property,t("ButtonPlus",s("ButtonPlus")(r=function(t){function o(){return t.apply(this,arguments)||this}n(o,t);var u=o.prototype;return u.onLoad=function(){this.node.on(c.EventType.TOUCH_END,this.playClickSound,this)},u.playClickSound=function(){i.inst.playClickSound()},o}(e))||r);o._RF.pop()}}}));

System.register("chunks:///_virtual/CameraCtrl.ts",["./rollupPluginModLoBabelHelpers.js","cc","./JoyStickCtrl.ts","./MapMgr.ts","./PathFindingAgent.ts","./Player.ts"],(function(t){var i,r,e,a,o,s,p,n;return{setters:[function(t){i=t.createClass},function(t){r=t.cclegacy,e=t._decorator,a=t.Vec3},function(t){o=t.JoyStickCtrl},function(t){s=t.MapMgr},function(t){p=t.default},function(t){n=t.Player}],execute:function(){var l;r._RF.push({},"23377GbBLhMGb3Cb+ztuyEZ","CameraCtrl",void 0);var c=e.ccclass;e.property,t("CameraCtrl",c("CameraCtrl")(l=function(){function t(t,i){this.grp_scrollMap=void 0,this._target=void 0,this._editAreaSize=void 0,this.mapMgr=void 0,this._offY=void 0;var r=this;r.mapMgr=s.inst,r.grp_scrollMap=t,r._editAreaSize=i}var r=t.prototype;return r.focusTarget=function(t){var i=this;i._target=t;var r=p.inst.mapData.cellSize,e=t.getComponent(n);i._offY=e.height/2-r/2,i.updateCameraPos()},r.update=function(t){this._target&&o.inst.isMoving&&this.updateCameraPos()},r.updateCameraPos=function(){var t=this;if(t._target&&t.grp_scrollMap){var i=t._target.position;t.grp_scrollMap.setPosition(-i.x*t.mapScale+t._editAreaSize.width/2,-i.y*t.mapScale-t._offY+t._editAreaSize.height/2),t.checkLimitPos()}},r.checkLimitPos=function(){var t=this,i=t.stageWidth-t._editAreaSize.width,r=t.stageHeight-t._editAreaSize.height;t.grp_scrollMap.position.x>0&&t.grp_scrollMap.setPosition(new a(0,t.grp_scrollMap.position.y)),t.grp_scrollMap.position.x<-i&&t.grp_scrollMap.setPosition(new a(-i,t.grp_scrollMap.position.y)),t.grp_scrollMap.position.y>0&&t.grp_scrollMap.setPosition(new a(t.grp_scrollMap.position.x,0)),t.grp_scrollMap.position.y<-r&&t.grp_scrollMap.setPosition(new a(t.grp_scrollMap.position.x,-r))},r.clear=function(){this._target=null},i(t,[{key:"mapScale",get:function(){return this.grp_scrollMap.scale.x}},{key:"stageWidth",get:function(){return this.mapMgr.mapWidth*this.grp_scrollMap.scale.x}},{key:"stageHeight",get:function(){return this.mapMgr.mapHeight*this.grp_scrollMap.scale.y}}]),t}())||l);r._RF.pop()}}}));

System.register("chunks:///_virtual/ColorGrid.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIComp.ts"],(function(r){var o,i,c,t,e;return{setters:[function(r){o=r.inheritsLoose},function(r){i=r.cclegacy,c=r._decorator,t=r.Graphics},function(r){e=r.UIComp}],execute:function(){var a;i._RF.push({},"1a62fyfbCNPZp9Tfm+mNRae","ColorGrid",void 0);var n=c.ccclass;c.property,r("ColorGrid",n("ColorGrid")(a=function(r){function i(){for(var o,i=arguments.length,c=new Array(i),t=0;t<i;t++)c[t]=arguments[t];return(o=r.call.apply(r,[this].concat(c))||this)._graphics=void 0,o}o(i,r);var c=i.prototype;return c.drawRect=function(r,o,i,c,e,a){void 0===a&&(a=.5);var n=this;n._graphics||(n._graphics=n.node.getComponent(t));var s=n._graphics.fillColor;s.fromHEX(r),n._graphics.fillColor.set(s.r,s.g,s.b,255*a),n._graphics.rect(o,i,c,e),n._graphics.fill()},c.clear=function(){this._graphics.clear()},i}(e))||a);i._RF.pop()}}}));

System.register("chunks:///_virtual/ComboBoxComp.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIComp.ts","./SceneMgr.ts","./CONST.ts","./ComboBoxContainerComp.ts"],(function(e){var o,t,n,r,i,a,l,c,p,s,u,m,b,_,C,g,f,d,y;return{setters:[function(e){o=e.applyDecoratedDescriptor,t=e.inheritsLoose,n=e.initializerDefineProperty,r=e.assertThisInitialized,i=e.createClass},function(e){a=e.cclegacy,l=e._decorator,c=e.Prefab,p=e.Node,s=e.Label,u=e.Sprite,m=e.SpriteFrame,b=e.instantiate,_=e.UITransform,C=e.Vec3},function(e){g=e.UIComp},function(e){f=e.SceneMgr},function(e){d=e.CONST},function(e){y=e.ComboBoxContainerComp}],execute:function(){var h,x,v,B,E,S,w,M,T,I,z,A,D,P,F,L,k;a._RF.push({},"1064eJDM3FEBonfQPLkFnt9","ComboBoxComp",void 0);var N=l.ccclass,O=l.property;e("ComboBoxComp",(h=N("ComboBoxComp"),x=O({type:c}),v=O({type:p}),B=O({type:s}),E=O({type:u}),S=O({type:m}),w=O({type:m}),M=O({type:m}),h((z=o((I=function(e){function o(){for(var o,t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return o=e.call.apply(e,[this].concat(i))||this,n(o,"comboBoxContainerPrefab",z,r(o)),n(o,"grp_touchArea",A,r(o)),n(o,"lbl_type",D,r(o)),n(o,"img_bg",P,r(o)),n(o,"normal",F,r(o)),n(o,"hover",L,r(o)),n(o,"press",k,r(o)),o._selectedIndex=void 0,o._comboBoxContainerComp=void 0,o}t(o,e);var a=o.prototype;return a.onEnter=function(){var e=this;e.onEmitter(d.GEVT.ClickSelecBoxItem,e.onClickSelecBoxItem),e.grp_touchArea.on(p.EventType.MOUSE_DOWN,e.onMouseDown,e),e.grp_touchArea.on(p.EventType.MOUSE_ENTER,e.onMouseEnter,e),e.grp_touchArea.on(p.EventType.MOUSE_LEAVE,e.onMouseLeave,e)},a.onClickSelecBoxItem=function(e){e.__deletegate__==this&&(this.selectedIndex=e.__index__)},a.onMouseDown=function(e){var o=this;if(o.img_bg.spriteFrame=o.press,o._comboBoxContainerComp&&!o._comboBoxContainerComp.isDestory)o._comboBoxContainerComp.node.destroy(),o._comboBoxContainerComp=null;else{var t=b(o.comboBoxContainerPrefab),n=o._comboBoxContainerComp=t.getComponent(y);n.__deletegate__=o,n.setData(o.data);var r=o.node.getComponent(_),i=r.convertToWorldSpaceAR(new C(0,-r.height/2,0)),a=f.inst.curScene,l=a.uiTransform.convertToNodeSpaceAR(new C(i.x,i.y,0));t.setParent(a.node),t.setPosition(new C(l.x,l.y))}},a.onMouseEnter=function(e){this.img_bg.spriteFrame=this.hover},a.onMouseLeave=function(e){this.img_bg.spriteFrame=this.normal},i(o,[{key:"selectedIndex",get:function(){return this._selectedIndex},set:function(e){var o=this;if(o.data&&e<o.data.length){o._selectedIndex=e;var t=o.data[e];o.lbl_type.string=t.desc,o.node.emit(d.GEVT.ComboBox_Change,t)}else console.error("设置下拉框超出索引")}}]),o}(g)).prototype,"comboBoxContainerPrefab",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),A=o(I.prototype,"grp_touchArea",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D=o(I.prototype,"lbl_type",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),P=o(I.prototype,"img_bg",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),F=o(I.prototype,"normal",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),L=o(I.prototype,"hover",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k=o(I.prototype,"press",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),T=I))||T));a._RF.pop()}}}));

System.register("chunks:///_virtual/ComboBoxContainerComp.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIComp.ts","./ComboBoxItemComp.ts","./CONST.ts"],(function(e){var t,o,r,i,n,a,c,s,l,p,m,u;return{setters:[function(e){t=e.applyDecoratedDescriptor,o=e.inheritsLoose,r=e.initializerDefineProperty,i=e.assertThisInitialized},function(e){n=e.cclegacy,a=e._decorator,c=e.Prefab,s=e.Node,l=e.instantiate},function(e){p=e.UIComp},function(e){m=e.ComboBoxItemComp},function(e){u=e.CONST}],execute:function(){var _,g,C,f,b,d,h;n._RF.push({},"e252aLqEKFLkq5IW2+PJDdV","ComboBoxContainerComp",void 0);var y=a.ccclass,v=a.property;e("ComboBoxContainerComp",(_=y("ComboBoxContainerComp"),g=v({type:c}),C=v({type:s}),_((d=t((b=function(e){function t(){for(var t,o=arguments.length,n=new Array(o),a=0;a<o;a++)n[a]=arguments[a];return t=e.call.apply(e,[this].concat(n))||this,r(t,"comboBoxItemPrefab",d,i(t)),r(t,"grp_items",h,i(t)),t.__deletegate__=void 0,t._hasTrigger=void 0,t}o(t,e);var n=t.prototype;return n.onEnter=function(){this.onEmitter(u.GEVT.ClickStage,this.onClickStage)},n.dchg=function(){for(var e=this,t=e.data||[],o=0;o<t.length;o++){var r=l(e.comboBoxItemPrefab),i=r.getComponent(m);i.__deletegate__=e.__deletegate__,i.__index__=o,i.setData(t[o]),r.setParent(e.grp_items)}},n.onClickStage=function(){var e=this;e._hasTrigger?e.destory():e._hasTrigger=!0},t}(p)).prototype,"comboBoxItemPrefab",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),h=t(b.prototype,"grp_items",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),f=b))||f));n._RF.pop()}}}));

System.register("chunks:///_virtual/ComboBoxItemComp.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIComp.ts","./CONST.ts"],(function(e){var t,o,n,i,r,a,c,_,s,l,p,u;return{setters:[function(e){t=e.applyDecoratedDescriptor,o=e.inheritsLoose,n=e.initializerDefineProperty,i=e.assertThisInitialized},function(e){r=e.cclegacy,a=e._decorator,c=e.Label,_=e.UITransform,s=e.Graphics,l=e.Node},function(e){p=e.UIComp},function(e){u=e.CONST}],execute:function(){var d,m,g,h,f;r._RF.push({},"2771a6WlRxGN5qrACZwtLKV","ComboBoxItemComp",void 0);var v=a.ccclass,C=a.property;e("ComboBoxItemComp",(d=v("ComboBoxItemComp"),m=C({type:c}),d((f=t((h=function(e){function t(){for(var t,o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return t=e.call.apply(e,[this].concat(r))||this,n(t,"lbl_desc",f,i(t)),t._graphicBg=void 0,t._uiTranform=void 0,t.__deletegate__=void 0,t.__index__=void 0,t}o(t,e);var r=t.prototype;return r.onEnter=function(){var e=this;e._uiTranform=e.getComponent(_),e._graphicBg=e.getComponent(s),e.node.on(l.EventType.MOUSE_ENTER,e.onMouseEnter,e),e.node.on(l.EventType.MOUSE_LEAVE,e.onMouseLeave,e)},r.dchg=function(){var e=this.data;this.lbl_desc.string=e.desc},r.onMouseEnter=function(e){var t=this,o=t._uiTranform.width,n=t._uiTranform.height;t._graphicBg.rect(o/2,n/2,-o,-n),t._graphicBg.fill()},r.onMouseLeave=function(e){this._graphicBg.clear()},r.onItemClick=function(){var e=this,t=e.data;e.emit(u.GEVT.ClickSelecBoxItem,{type:t.type,desc:t.desc,__deletegate__:e.__deletegate__,__index__:e.__index__})},t}(p)).prototype,"lbl_desc",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),g=h))||g));r._RF.pop()}}}));

System.register("chunks:///_virtual/CONST.ts",["cc"],(function(e){var a;return{setters:[function(e){a=e.cclegacy}],execute:function(){var r;e("CONST",void 0),a._RF.push({},"df76eSgj3hMD7PpKkJZSswT","CONST",void 0),function(e){var a=function(e){return e.ImportMapJson="ImportMapJson",e.UpdateMapInfo="UpdateMapInfo",e.ChangeGridType="ChangeGridType",e.ChangeGridSize="ChangeGridSize",e.DragMapThingDown="DragMapThingDown",e.UpdateMapScale="UpdateMapScale",e.DragMapThingStart="DragMapThingStart",e.ClickMapTing="ClickMapTing",e.ReDarwGraphic="ReDarwGraphic",e.ChangeMapThingXY="ChangeMapThingXY",e.ClearCurMapThingInfo="ClearCurMapThingInfo",e.ClickSelecBoxItem="ClickSelecBoxItem",e.ClickStage="ClickStage",e.ComboBox_Change="ComboBox_Change",e.UpdateMousePos="UpdateMousePos",e.UpdateAstarGrid="UpdateAstarGrid",e}({});e.GEVT=a;var r=function(e){return e.GridType_none="GridType_none",e.GridType_walk="GridType_walk",e.GridType_WaterVerts="GridType_WaterVerts",e.GridType_start="GridType_start",e.GridType_mapThing="GridType_mapThing",e}({});e.GridType=r;var n=function(e){return e[e.task=1]="task",e[e.rail=2]="rail",e[e.queen=3]="queen",e[e.keyMan=4]="keyMan",e[e.grass=5]="grass",e[e.tree=6]="tree",e[e.bee=7]="bee",e[e.bevel=999]="bevel",e}({});e.MapThingType=n;var i=function(e){return e[e.MapThingTrigger_light=1]="MapThingTrigger_light",e[e.MapThingTrigger_unWalk=2]="MapThingTrigger_unWalk",e[e.MapThingTrigger_keyManStand=3]="MapThingTrigger_keyManStand",e[e.MapThingTrigger_grass=4]="MapThingTrigger_grass",e}({});e.MapThingTriggerType=i;var g=function(e){return e[e.angle45=0]="angle45",e[e.angle90=1]="angle90",e[e.honeycomb=2]="honeycomb",e[e.honeycomb2=3]="honeycomb2",e}({});e.MapType=g}(r||(r=e("CONST",{}))),a._RF.pop()}}}));

System.register("chunks:///_virtual/debug-view-runtime-control.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,o,i,n,s,l,r,a,g,h,p,c,C,d,m,u,L;return{setters:[function(t){e=t.applyDecoratedDescriptor,o=t.inheritsLoose,i=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){s=t.cclegacy,l=t._decorator,r=t.Node,a=t.Color,g=t.Canvas,h=t.UITransform,p=t.instantiate,c=t.Label,C=t.RichText,d=t.Toggle,m=t.Button,u=t.director,L=t.Component}],execute:function(){var f,M,b,v,T,S,x,E,I;s._RF.push({},"b2bd1+njXxJxaFY3ymm06WU","debug-view-runtime-control",void 0);var A=l.ccclass,y=l.property;t("DebugViewRuntimeControl",(f=A("internal.DebugViewRuntimeControl"),M=y(r),b=y(r),v=y(r),f((x=e((S=function(t){function e(){for(var e,o=arguments.length,s=new Array(o),l=0;l<o;l++)s[l]=arguments[l];return e=t.call.apply(t,[this].concat(s))||this,i(e,"compositeModeToggle",x,n(e)),i(e,"singleModeToggle",E,n(e)),i(e,"EnableAllCompositeModeButton",I,n(e)),e._single=0,e.strSingle=["No Single Debug","Vertex Color","Vertex Normal","Vertex Tangent","World Position","Vertex Mirror","Face Side","UV0","UV1","UV Lightmap","Project Depth","Linear Depth","Fragment Normal","Fragment Tangent","Fragment Binormal","Base Color","Diffuse Color","Specular Color","Transparency","Metallic","Roughness","Specular Intensity","IOR","Direct Diffuse","Direct Specular","Direct All","Env Diffuse","Env Specular","Env All","Emissive","Light Map","Shadow","AO","Fresnel","Direct Transmit Diffuse","Direct Transmit Specular","Env Transmit Diffuse","Env Transmit Specular","Transmit All","Direct Internal Specular","Env Internal Specular","Internal All","Fog"],e.strComposite=["Direct Diffuse","Direct Specular","Env Diffuse","Env Specular","Emissive","Light Map","Shadow","AO","Normal Map","Fog","Tone Mapping","Gamma Correction","Fresnel","Transmit Diffuse","Transmit Specular","Internal Specular","TT"],e.strMisc=["CSM Layer Coloration","Lighting With Albedo"],e.compositeModeToggleList=[],e.singleModeToggleList=[],e.miscModeToggleList=[],e.textComponentList=[],e.labelComponentList=[],e.textContentList=[],e.hideButtonLabel=void 0,e._currentColorIndex=0,e.strColor=["<color=#ffffff>","<color=#000000>","<color=#ff0000>","<color=#00ff00>","<color=#0000ff>"],e.color=[a.WHITE,a.BLACK,a.RED,a.GREEN,a.BLUE],e}o(e,t);var s=e.prototype;return s.start=function(){if(this.node.parent.getComponent(g)){var t=this.node.parent.getComponent(h),e=.5*t.width,o=.5*t.height,i=.1*e-e,n=o-.1*o,s=this.node.getChildByName("MiscMode"),l=p(s);l.parent=this.node,l.name="Buttons";var r=p(s);r.parent=this.node,r.name="Titles";for(var u=0;u<2;u++){var L=p(this.EnableAllCompositeModeButton.getChildByName("Label"));L.setPosition(i+(u>0?450:150),n,0),L.setScale(.75,.75,.75),L.parent=r;var f=L.getComponent(c);f.string=u?"----------Composite Mode----------":"----------Single Mode----------",f.color=a.WHITE,f.overflow=0,this.labelComponentList[this.labelComponentList.length]=f}n-=20;for(var M=0,b=0;b<this.strSingle.length;b++,M++){b===this.strSingle.length>>1&&(i+=200,M=0);var v=b?p(this.singleModeToggle):this.singleModeToggle;v.setPosition(i,n-20*M,0),v.setScale(.5,.5,.5),v.parent=this.singleModeToggle.parent;var T=v.getComponentInChildren(C);T.string=this.strSingle[b],this.textComponentList[this.textComponentList.length]=T,this.textContentList[this.textContentList.length]=T.string,v.on(d.EventType.TOGGLE,this.toggleSingleMode,this),this.singleModeToggleList[b]=v}i+=200,this.EnableAllCompositeModeButton.setPosition(i+15,n,0),this.EnableAllCompositeModeButton.setScale(.5,.5,.5),this.EnableAllCompositeModeButton.on(m.EventType.CLICK,this.enableAllCompositeMode,this),this.EnableAllCompositeModeButton.parent=l;var S=this.EnableAllCompositeModeButton.getComponentInChildren(c);this.labelComponentList[this.labelComponentList.length]=S;var x=p(this.EnableAllCompositeModeButton);x.setPosition(i+90,n,0),x.setScale(.5,.5,.5),x.on(m.EventType.CLICK,this.changeTextColor,this),x.parent=l,(S=x.getComponentInChildren(c)).string="TextColor",this.labelComponentList[this.labelComponentList.length]=S;var E=p(this.EnableAllCompositeModeButton);E.setPosition(i+200,n,0),E.setScale(.5,.5,.5),E.on(m.EventType.CLICK,this.hideUI,this),E.parent=this.node.parent,(S=E.getComponentInChildren(c)).string="Hide UI",this.labelComponentList[this.labelComponentList.length]=S,this.hideButtonLabel=S,n-=40;for(var I=0;I<this.strMisc.length;I++){var A=p(this.compositeModeToggle);A.setPosition(i,n-20*I,0),A.setScale(.5,.5,.5),A.parent=s;var y=A.getComponentInChildren(C);y.string=this.strMisc[I],this.textComponentList[this.textComponentList.length]=y,this.textContentList[this.textContentList.length]=y.string,A.getComponent(d).isChecked=!!I,A.on(d.EventType.TOGGLE,I?this.toggleLightingWithAlbedo:this.toggleCSMColoration,this),this.miscModeToggleList[I]=A}n-=150;for(var D=0;D<this.strComposite.length;D++){var B=D?p(this.compositeModeToggle):this.compositeModeToggle;B.setPosition(i,n-20*D,0),B.setScale(.5,.5,.5),B.parent=this.compositeModeToggle.parent;var w=B.getComponentInChildren(C);w.string=this.strComposite[D],this.textComponentList[this.textComponentList.length]=w,this.textContentList[this.textContentList.length]=w.string,B.on(d.EventType.TOGGLE,this.toggleCompositeMode,this),this.compositeModeToggleList[D]=B}}else console.error("debug-view-runtime-control should be child of Canvas")},s.isTextMatched=function(t,e){var o=new String(t),i=o.search(">");return-1===i?t===e:(o=(o=o.substr(i+1)).substr(0,o.search("<")))===e},s.toggleSingleMode=function(t){for(var e=u.root.debugView,o=t.getComponentInChildren(C),i=0;i<this.strSingle.length;i++)this.isTextMatched(o.string,this.strSingle[i])&&(e.singleMode=i)},s.toggleCompositeMode=function(t){for(var e=u.root.debugView,o=t.getComponentInChildren(C),i=0;i<this.strComposite.length;i++)this.isTextMatched(o.string,this.strComposite[i])&&e.enableCompositeMode(i,t.isChecked)},s.toggleLightingWithAlbedo=function(t){u.root.debugView.lightingWithAlbedo=t.isChecked},s.toggleCSMColoration=function(t){u.root.debugView.csmLayerColoration=t.isChecked},s.enableAllCompositeMode=function(t){var e=u.root.debugView;e.enableAllCompositeMode(!0);for(var o=0;o<this.compositeModeToggleList.length;o++){this.compositeModeToggleList[o].getComponent(d).isChecked=!0}var i=this.miscModeToggleList[0].getComponent(d);i.isChecked=!1,e.csmLayerColoration=!1,(i=this.miscModeToggleList[1].getComponent(d)).isChecked=!0,e.lightingWithAlbedo=!0},s.hideUI=function(t){var e=this.node.getChildByName("Titles"),o=!e.active;this.singleModeToggleList[0].parent.active=o,this.miscModeToggleList[0].parent.active=o,this.compositeModeToggleList[0].parent.active=o,this.EnableAllCompositeModeButton.parent.active=o,e.active=o,this.hideButtonLabel.string=o?"Hide UI":"Show UI"},s.changeTextColor=function(t){this._currentColorIndex++,this._currentColorIndex>=this.strColor.length&&(this._currentColorIndex=0);for(var e=0;e<this.textComponentList.length;e++)this.textComponentList[e].string=this.strColor[this._currentColorIndex]+this.textContentList[e]+"</color>";for(var o=0;o<this.labelComponentList.length;o++)this.labelComponentList[o].color=this.color[this._currentColorIndex]},s.onLoad=function(){},s.update=function(t){},e}(L)).prototype,"compositeModeToggle",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=e(S.prototype,"singleModeToggle",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=e(S.prototype,"EnableAllCompositeModeButton",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=S))||T));s._RF.pop()}}}));

System.register("chunks:///_virtual/Emmiter.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,r,n;return{setters:[function(e){t=e.inheritsLoose},function(e){r=e.cclegacy,n=e.EventTarget}],execute:function(){r._RF.push({},"84d2dBrYchPDarRC6+jwDa+","Emmiter",void 0);var i=e("Emmiter",function(e){function r(){return e.apply(this,arguments)||this}return t(r,e),r}(n));e("emmiter",new i);r._RF.pop()}}}));

System.register("chunks:///_virtual/EntityCtrl.ts",["cc","./Player.ts","./EntityPrefabs.ts","./JoyStickCtrl.ts","./PathFindingAgent.ts"],(function(t){var n,i,r,e,a,o,s;return{setters:[function(t){n=t.cclegacy,i=t._decorator,r=t.instantiate},function(t){e=t.Player},function(t){a=t.EntityPrefabs},function(t){o=t.JoyStickCtrl},function(t){s=t.default}],execute:function(){var y;n._RF.push({},"daf9cdugS1CKYWbY5F0pTpj","EntityCtrl",void 0);var c=i.ccclass;i.property,t("EntityCtrl",c("EntityCtrl")(y=function(){function t(t){this.grp_entity=void 0,this.player=void 0;this.init(t)}var n=t.prototype;return n.init=function(t){this.grp_entity=t,this.addPlayer()},n.addPlayer=function(){var t=this,n=t.grp_entity.getComponent(a),i=r(n.playerPrefab);i.setParent(t.grp_entity);var o=s.inst.getRandomStartPos();i.setPosition(o.x,o.y),t.player=i.getComponent(e)},n.update=function(t){if(o.inst.isMoving){var n=o.inst.radian;this.player.moveByJoyStick(n)}},n.clear=function(){var t=this;t.player&&(t.player.node.destroy(),t.player=null)},t}())||y);n._RF.pop()}}}));

System.register("chunks:///_virtual/EntityPrefabs.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var r,t,i,n,a,o,c,l;return{setters:[function(e){r=e.applyDecoratedDescriptor,t=e.inheritsLoose,i=e.initializerDefineProperty,n=e.assertThisInitialized},function(e){a=e.cclegacy,o=e._decorator,c=e.Prefab,l=e.Component}],execute:function(){var s,p,f,u,y;a._RF.push({},"22c4028939Mf4/vcfEXKfqp","EntityPrefabs",void 0);var b=o.ccclass,P=o.property;e("EntityPrefabs",(s=b("EntityPrefabs"),p=P({type:c}),s((y=r((u=function(e){function r(){for(var r,t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return r=e.call.apply(e,[this].concat(a))||this,i(r,"playerPrefab",y,n(r)),r}return t(r,e),r}(l)).prototype,"playerPrefab",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),f=u))||f));a._RF.pop()}}}));

System.register("chunks:///_virtual/FileIOHandler.ts",["./rollupPluginModLoBabelHelpers.js","cc","./MessageTip.ts","./JuHuaDlg.ts"],(function(e){var t,n,r,a,c,s,u;return{setters:[function(e){t=e.createClass,n=e.asyncToGenerator,r=e.regeneratorRuntime,a=e.asyncIterator},function(e){c=e.cclegacy},function(e){s=e.MessageTip},function(e){u=e.JuHuaDlg}],execute:function(){c._RF.push({},"09c38xC3VBHSLW0NyGV1ocM","FileIOHandler",void 0),e("FileIOHandler",function(){function e(){}var c=e.prototype;return c.getDirTreeMap=function(){var e=n(r().mark((function e(){var t,c,s,u;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=function(){return(u=n(r().mark((function e(t){var n,c,u,i,o,l,p;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("file"!==t.kind){e.next=2;break}return e.abrupt("return",t);case 2:t.children=[],n=t.entries(),c=!1,u=!1,e.prev=6,o=a(n);case 8:return e.next=10,o.next();case 10:if(!(c=!(l=e.sent).done)){e.next=20;break}return p=l.value,e.t0=t.children,e.next=15,s(p[1]);case 15:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 17:c=!1,e.next=8;break;case 20:e.next=26;break;case 22:e.prev=22,e.t2=e.catch(6),u=!0,i=e.t2;case 26:if(e.prev=26,e.prev=27,!c||null==o.return){e.next=31;break}return e.next=31,o.return();case 31:if(e.prev=31,!u){e.next=34;break}throw i;case 34:return e.finish(31);case 35:return e.finish(26);case 36:return e.abrupt("return",t);case 37:case"end":return e.stop()}}),e,null,[[6,22,26,36],[27,,31,35]])})))).apply(this,arguments)},s=function(e){return u.apply(this,arguments)},e.prev=2,e.next=5,window.showDirectoryPicker();case 5:return t=e.sent,e.next=8,s(t);case 8:return c=e.sent,e.abrupt("return",c);case 12:e.prev=12,e.t0=e.catch(2),alert(e.t0);case 15:case"end":return e.stop()}}),e,null,[[2,12]])})));return function(){return e.apply(this,arguments)}}(),c.readLocalText=function(){var e=n(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){if(t){var r=new FileReader;r.readAsText(t,"utf-8"),r.onload=function(){e(r.result+"")},r.onerror=function(e){n(null)}}else n(null)})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),c.saveTextToLocal=function(){var e=n(r().mark((function e(t){var n,a,c,i;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n={suggestedName:"mapData.json",types:[{description:"保存的文件名称",accept:{"text/plain":[".json"]}}],excludeAcceptAllOption:!0},e.next=4,window.showSaveFilePicker(n);case 4:return a=e.sent,e.next=7,a.createWritable();case 7:return c=e.sent,e.next=10,u.show();case 10:return i=e.sent,e.next=13,c.write(t);case 13:return e.next=15,c.close();case 15:i.close(),s.show({msg:"保存成功"}),e.next=22;break;case 19:e.prev=19,e.t0=e.catch(0),alert(e.t0);case 22:case"end":return e.stop()}}),e,null,[[0,19]])})));return function(t){return e.apply(this,arguments)}}(),c.createObjectURL=function(e){return e?null!=window.URL?window.URL.createObjectURL(e):window.webkitURL.createObjectURL(e):null},t(e,null,[{key:"inst",get:function(){return this._inst||(this._inst=new e),this._inst}}]),e}())._inst=void 0,c._RF.pop()}}}));

System.register("chunks:///_virtual/Grid.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Nodes.ts"],(function(o){var t,n,e,s;return{setters:[function(o){t=o.createClass},function(o){n=o.cclegacy,e=o._decorator},function(o){s=o.Nodes}],execute:function(){var r;n._RF.push({},"8e7576mBodECoKcEb1Vy3h5","Grid",void 0);var i=e.ccclass;e.property,o("Grid",i("Grid")(r=function(){function o(){this._startNode=void 0,this._endNode=void 0,this._nodes=void 0,this._numCols=void 0,this._numRows=void 0}var n=o.prototype;return n.init=function(o,t){var n=this;n._numCols=o,n._numRows=t,n._nodes=[];for(var e=0;e<n._numCols;e++){n._nodes[e]=[];for(var r=0;r<n._numRows;r++)n._nodes[e][r]=new s,n._nodes[e][r].init(e,r)}},n.resetWalkable=function(){for(var o=this,t=0;t<o._numCols;t++)for(var n=0;n<o._numRows;n++)o._nodes[t][n].walkable=!0},n.getNode=function(o,t){return this._nodes[o][t]},n.setEndNode=function(o,t){this._endNode=this._nodes[o][t]},n.setStartNode=function(o,t){this._startNode=this._nodes[o][t]},n.setWalkable=function(o,t,n){this._nodes[o][t].walkable=n},n.getRanDomStartPos=function(){for(var o=this,t=[],n=0;n<o._numCols;n++)for(var e=0;e<o._numRows;e++){var s=o._nodes[n][e];s.walkable&&t.push(s)}return t[Math.floor(Math.random()*t.length)]},t(o,[{key:"endNode",get:function(){return this._endNode}},{key:"numCols",get:function(){return this._numCols}},{key:"numRows",get:function(){return this._numRows}},{key:"startNode",get:function(){return this._startNode}}]),o}())||r);n._RF.pop()}}}));

System.register("chunks:///_virtual/HelpDlg.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIDlg.ts"],(function(e){var t,r,l,i,n,o,c,a;return{setters:[function(e){t=e.applyDecoratedDescriptor,r=e.inheritsLoose,l=e.initializerDefineProperty,i=e.assertThisInitialized},function(e){n=e.cclegacy,o=e._decorator,c=e.Button},function(e){a=e.UIDlg}],execute:function(){var p,s,u,f,g,D;n._RF.push({},"843d7OwWjhGEL4au+DaMKqD","HelpDlg",void 0);var d=o.ccclass,y=o.property;e("HelpDlg",(p=d("HelpDlg"),s=y({type:c}),p(((D=function(e){function t(){for(var t,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return t=e.call.apply(e,[this].concat(n))||this,l(t,"btn_close",g,i(t)),t}return r(t,e),t.prototype.ctor=function(){this.outSideClosed=!0},t}(a)).prefabUrl="prefab/mapEditor/dlg/HelpDlg",g=t((f=D).prototype,"btn_close",[s],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),u=f))||u));n._RF.pop()}}}));

System.register("chunks:///_virtual/ImgLoader.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ResMgr.ts"],(function(t){var e,r,i,l,o,s,a;return{setters:[function(t){e=t.inheritsLoose,r=t.createClass},function(t){i=t.cclegacy,l=t._decorator,o=t.Sprite,s=t.Component},function(t){a=t.ResMgr}],execute:function(){var n;i._RF.push({},"bd5ffXtU0JG9LgAlbDlBRyw","ImgLoader",void 0);var u=l.ccclass;l.property,t("ImgLoader",u("ImgLoader")(n=function(t){function i(){for(var e,r=arguments.length,i=new Array(r),l=0;l<r;l++)i[l]=arguments[l];return(e=t.call.apply(t,[this].concat(i))||this)._sprite=void 0,e._url=void 0,e.loadComplete=void 0,e.ctx=void 0,e}return e(i,t),i.prototype.onLoad=function(){var t=this;if(t._sprite=this.node.getComponent(o),t._sprite||(t._sprite=this.node.addComponent(o)),t._url){var e=t._url;t._url=null,t.url=e}},r(i,[{key:"url",set:function(t){var e=this;if(e._url!=t)if(e._url=t,t.startsWith("blob"))a.inst.loadLocalImg(e._url,(function(t){e._sprite&&(e._sprite.spriteFrame=t,e.loadComplete&&e.loadComplete.call(e.ctx,t))}),e);else if(t.startsWith("ui/")){var r=t.slice(0,t.lastIndexOf("/"));if(a.inst.get(r)){if(e._sprite){var i=a.inst.get(t);e._sprite.spriteFrame=i,e.loadComplete&&e.loadComplete.call(e.ctx,i)}}else a.inst.loadWithoutJuHua(r,(function(){if(e._sprite){var r=a.inst.get(t);e._sprite.spriteFrame=r,e.loadComplete&&e.loadComplete.call(e.ctx,r)}}),e)}else{if(""==e._url||null==e._url||null==e._url)return void(e._sprite.spriteFrame=null);var l=t+"/spriteFrame";a.inst.loadWithoutJuHua(l,(function(){if(e._sprite){var r=a.inst.get(t);e._sprite.spriteFrame=r,e.loadComplete&&e.loadComplete.call(e.ctx,r)}}),e)}}}]),i}(s))||n);i._RF.pop()}}}));

System.register("chunks:///_virtual/Interface.ts",["cc"],(function(e){var c;return{setters:[function(e){c=e.cclegacy}],execute:function(){e("G",void 0),c._RF.push({},"d8ec3feXShO84Ymi46+mh8x","Interface",void 0),c._RF.pop()}}}));

System.register("chunks:///_virtual/InvalidImportDlg.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIDlg.ts","./BaseUtil.ts"],(function(t){var e,r,l,o,i,n,a,c,p,s,u;return{setters:[function(t){e=t.applyDecoratedDescriptor,r=t.inheritsLoose,l=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){i=t.cclegacy,n=t._decorator,a=t.Node,c=t.Button,p=t.Label},function(t){s=t.UIDlg},function(t){u=t.BaseUT}],execute:function(){var g,d,f,b,v,I,h,m;i._RF.push({},"c7d6012jNZJ34X2TYUVa72o","InvalidImportDlg",void 0);var y=n.ccclass,D=n.property;t("InvalidImportDlg",(g=y("InvalidImportDlg"),d=D({type:a}),f=D({type:c}),g(((m=function(t){function e(){for(var e,r=arguments.length,i=new Array(r),n=0;n<r;n++)i[n]=arguments[n];return e=t.call.apply(t,[this].concat(i))||this,l(e,"grp_label",I,o(e)),l(e,"btn_close",h,o(e)),e}r(e,t);var i=e.prototype;return i.ctor=function(){this.outSideClosed=!0},i.dchg=function(){for(var t=this.data.errorMsg.split("|"),e=0;e<t.length;e++){var r=t[e];if(r){var l=u.newUINode("lbl_msg"+e),o=l.addComponent(p);o.fontSize=30,o.color.fromHEX("#000000"),o.string=e+1+". "+r,l.setParent(this.grp_label)}}},e}(s)).prefabUrl="prefab/mapEditor/dlg/InvalidImportDlg",I=e((v=m).prototype,"grp_label",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),h=e(v.prototype,"btn_close",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),b=v))||b));i._RF.pop()}}}));

System.register("chunks:///_virtual/IRoadSeeker.ts",["cc"],(function(){var e;return{setters:[function(t){e=t.cclegacy}],execute:function(){e._RF.push({},"a2533dtkP9IH4JPyPbRaJ2y","IRoadSeeker",void 0),e._RF.pop()}}}));

System.register("chunks:///_virtual/JoyStickCtrl.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var i,n,o;return{setters:[function(t){i=t.createClass},function(t){n=t.cclegacy,o=t._decorator}],execute:function(){var r,c;n._RF.push({},"50d9dVTi1RFqKHoebX3Nxaj","JoyStickCtrl",void 0);var e=o.ccclass;o.property,t("JoyStickCtrl",e("JoyStickCtrl")(((c=function(){function t(){this.radian=void 0,this.isMoving=void 0}return t.prototype.init=function(){},i(t,null,[{key:"inst",get:function(){return this._inst||(this._inst=new t),this._inst}}]),t}())._inst=void 0,r=c))||r);n._RF.pop()}}}));

System.register("chunks:///_virtual/JoyStickDlg.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIDlg.ts","./JoyStickCtrl.ts"],(function(t){var o,i,e,r,n,c,a,s,u,p,l;return{setters:[function(t){o=t.applyDecoratedDescriptor,i=t.inheritsLoose,e=t.initializerDefineProperty,r=t.assertThisInitialized},function(t){n=t.cclegacy,c=t._decorator,a=t.Node,s=t.Vec3,u=t.Vec2},function(t){p=t.UIDlg},function(t){l=t.JoyStickCtrl}],execute:function(){var y,_,g,S,h,v,f,k,d,M;n._RF.push({},"4dd117r0DlFVZQ6Blzpga8M","JoyStickDlg",void 0);var C=c.ccclass,T=c.property;t("JoyStickDlg",(y=C("JoyStickDlg"),_=T({type:a}),g=T({type:a}),S=T({type:a}),y(((M=function(t){function o(){for(var o,i=arguments.length,n=new Array(i),c=0;c<i;c++)n[c]=arguments[c];return o=t.call.apply(t,[this].concat(n))||this,e(o,"grp_joyStick",f,r(o)),e(o,"grp_touchArea",k,r(o)),e(o,"joyStick",d,r(o)),o.radius=void 0,o._touchStartPos=void 0,o._initPos=void 0,o._joyStickCtrl=void 0,o}i(o,t);var n=o.prototype;return n.ctor=function(){var t=this;t.outSideClosed=!1,t.maskEnabled=!1,t.penetrable=!0,t.radius=18,t._joyStickCtrl=l.inst},n.onEnter=function(){var t=this;t.grp_touchArea.on(a.EventType.TOUCH_START,t.onMouseDown,t),t.grp_touchArea.on(a.EventType.TOUCH_END,t.onMouseUp,t),t.grp_touchArea.on(a.EventType.TOUCH_CANCEL,t.onMouseUp,t),t._initPos=new s(t.grp_joyStick.position.x,t.grp_joyStick.position.y)},n.onMouseDown=function(t){var o=this;o._touchStartPos=t.getUILocation(),o.grp_joyStick.setPosition(o._touchStartPos.x,o._touchStartPos.y),o.grp_touchArea.on(a.EventType.TOUCH_MOVE,o.onMouseMove,o),o.joyStick.setPosition(new s(0,0,0))},n.onMouseMove=function(t){var o=this,i=t.getUILocation(),e=u.distance(i,o._touchStartPos);if(0!=e){var r=Math.atan2(i.y-o._touchStartPos.y,i.x-o._touchStartPos.x);e>o.radius&&(e=o.radius);var n=e*Math.cos(r),c=e*Math.sin(r);o.joyStick.setPosition(new s(n,c,0)),o._joyStickCtrl.isMoving=!0,o._joyStickCtrl.radian=r}},n.onMouseUp=function(t){var o=this;this.grp_touchArea.off(a.EventType.TOUCH_MOVE,this.onMouseMove,this),o.grp_joyStick.setPosition(o._initPos),o.joyStick.setPosition(new s(0,0,0)),o._joyStickCtrl.isMoving=!1,o._joyStickCtrl.radian=void 0},n.onExit=function(){var t=this;t.grp_touchArea.off(a.EventType.TOUCH_START,t.onMouseDown,t),t.grp_touchArea.off(a.EventType.TOUCH_END,t.onMouseUp,t),t.grp_touchArea.off(a.EventType.TOUCH_CANCEL,t.onMouseUp,t),t._joyStickCtrl.isMoving=!1,t._joyStickCtrl.radian=void 0},o}(p)).prefabUrl="prefab/mapEditor/dlg/JoyStickDlg",f=o((v=M).prototype,"grp_joyStick",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k=o(v.prototype,"grp_touchArea",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),d=o(v.prototype,"joyStick",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),h=v))||h));n._RF.pop()}}}));

System.register("chunks:///_virtual/JuHuaDlg.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseUtil.ts"],(function(e){var t,r,n,o,i,a,s,u,c,l,g,m,p,f,h,d,v,y;return{setters:[function(e){t=e.applyDecoratedDescriptor,r=e.inheritsLoose,n=e.initializerDefineProperty,o=e.assertThisInitialized,i=e.asyncToGenerator,a=e.regeneratorRuntime},function(e){s=e.cclegacy,u=e._decorator,c=e.Node,l=e.Graphics,g=e.Color,m=e.tween,p=e.Component,f=e.instantiate,h=e.director,d=e.resources,v=e.Prefab},function(e){y=e.BaseUT}],execute:function(){var w,_,B,T,b,D;s._RF.push({},"f4946tQ10xJ8YUGT8unTUIw","JuHuaDlg",void 0);var S=u.ccclass,k=u.property;e("JuHuaDlg",(w=S("JuHuaDlg"),_=k(c),w(((D=function(e){function t(){for(var t,r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return t=e.call.apply(e,[this].concat(i))||this,n(t,"img_maskBg",b,o(t)),t._tid=void 0,t._delayShowTime=void 0,t}r(t,e);var s=t.prototype;return s.onLoad=function(){var e=this;e.img_maskBg.active=!1;var t=e.img_maskBg.getComponent(l),r=y.getStageSize(),n=new g(0,0,0,102);t.fillColor=n,t.rect(-r.width/2,-r.height/2,r.width,r.height),t.fill();var o=e.img_maskBg.getChildByName("img_wait"),i=e._delayShowTime||0;e._tid=setTimeout((function(){e.img_maskBg.active=!0,m(o).to(1,{angle:360}).set({angle:0}).union().repeatForever().start()}),1e3*i)},s.setShowWait=function(e){this._delayShowTime=0|e},s.onDestroy=function(){clearTimeout(this._tid)},s.close=function(){this.node.destroy()},t.show=function(){var e=i(a().mark((function e(r){var n,o,i,s,u;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.prefabUrl,e.next=3,new Promise((function(e,t){var r=d.get(n);if(r)return console.log("resName: "+n+"加载完毕(缓存已有)"),e(r);d.load(n,v,(function(r,o){r?(console.log("resName: "+n+"加载失败"),t(r)):(console.log("resName: "+n+"加载完毕"),e(o))}))}));case 3:return o=e.sent,i=f(o),s=i.getComponent(t),u=h.getScene().getChildByName("Canvas"),s.setShowWait(r),i.setParent(u),e.abrupt("return",s);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),t}(p)).prefabUrl="prefab/common/JuHuaDlg",b=t((T=D).prototype,"img_maskBg",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),B=T))||B));s._RF.pop()}}}));

System.register("chunks:///_virtual/List.ts",["./rollupPluginModLoBabelHelpers.js","cc","./env","./ListItem.ts"],(function(t){var e,i,s,o,n,a,l,r,c,h,_,d,u,m,p,g,f,v,I,y,T,S,w,z,b,D,N;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,s=t.initializerDefineProperty,o=t.assertThisInitialized,n=t.createClass},function(t){a=t.cclegacy,l=t._decorator,r=t.ScrollView,c=t.Enum,h=t.Node,_=t.Prefab,d=t.CCFloat,u=t.EventHandler,m=t.CCBoolean,p=t.CCInteger,g=t.isValid,f=t.UITransform,v=t.Layout,I=t.instantiate,y=t.NodePool,T=t.Vec3,S=t.Size,w=t.Widget,z=t.tween,b=t.Component},function(t){D=t.DEV},function(t){N=t.ListItem}],execute:function(){var L,E,P,G,C,O,R,A,U,B,k,M,x,V,F,H,X,Y,Z,W,j,q,J,K,Q,$,tt,et,it,st,ot,nt,at,lt,rt,ct,ht,_t,dt,ut,mt,pt,gt;a._RF.push({},"23702FgpwVKLr+Oe2OJoxQ6","List",void 0);var ft=l.ccclass,vt=l.property,It=l.disallowMultiple,yt=(l.menu,l.executionOrder),Tt=l.requireComponent,St=function(t){return t[t.NODE=1]="NODE",t[t.PREFAB=2]="PREFAB",t}(St||{}),wt=t("SlideType",function(t){return t[t.NORMAL=1]="NORMAL",t[t.ADHERING=2]="ADHERING",t[t.PAGE=3]="PAGE",t}({})),zt=t("SelectedType_List",function(t){return t[t.NONE=0]="NONE",t[t.SINGLE=1]="SINGLE",t[t.MULT=2]="MULT",t}({}));t("List",(L=ft("List"),E=It(),P=Tt(r),G=yt(-5e3),C=vt({type:c(St),tooltip:D,visible:function(){return!1}}),O=vt({type:h,tooltip:D,visible:function(){return!1}}),R=vt({type:_,tooltip:D}),A=vt({}),U=vt({type:c(wt),tooltip:D}),B=vt({type:d,range:[0,1,.1],tooltip:D,slide:!0,visible:function(){return this._slideMode==wt.PAGE}}),k=vt({type:u,tooltip:D,visible:function(){return!1}}),M=vt({}),x=vt({type:m,tooltip:D}),V=vt({tooltip:D,visible:function(){var t=this.slideMode==wt.NORMAL;return t||(this.cyclic=!1),t}}),F=vt({tooltip:D,visible:function(){return this.virtual}}),H=vt({tooltip:D,visible:function(){var t=this.virtual&&!this.lackCenter;return t||(this.lackSlide=!1),t}}),X=vt({type:p}),Y=vt({type:p,range:[0,6,1],tooltip:D,slide:!0}),Z=vt({type:p,range:[0,12,1],tooltip:D,slide:!0}),W=vt({type:u,tooltip:D,visible:function(){return!1}}),j=vt({type:c(zt),tooltip:D}),q=vt({type:u,tooltip:D,visible:function(){return!1}}),J=vt({tooltip:D,visible:function(){return this.selectedMode==zt.SINGLE}}),K=vt({serializable:!1}),L(Q=E(Q=P(Q=G((tt=e(($=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),a=0;a<i;a++)n[a]=arguments[a];return e=t.call.apply(t,[this].concat(n))||this,s(e,"templateType",tt,o(e)),s(e,"tmpNode",et,o(e)),s(e,"tmpPrefab",it,o(e)),s(e,"_slideMode",st,o(e)),s(e,"pageDistance",ot,o(e)),s(e,"pageChangeEvent",nt,o(e)),s(e,"_virtual",at,o(e)),s(e,"cyclic",lt,o(e)),s(e,"lackCenter",rt,o(e)),s(e,"lackSlide",ct,o(e)),s(e,"_updateRate",ht,o(e)),s(e,"frameByFrameRenderNum",_t,o(e)),s(e,"renderEvent",dt,o(e)),s(e,"selectedMode",ut,o(e)),s(e,"selectedEvent",mt,o(e)),s(e,"repeatEventSingle",pt,o(e)),e._selectedId=-1,e._lastSelectedId=void 0,e.multSelected=void 0,e._forceUpdate=!1,e._align=void 0,e._horizontalDir=void 0,e._verticalDir=void 0,e._startAxis=void 0,e._alignCalcType=void 0,e.content=void 0,e._contentUt=void 0,e.firstListId=void 0,e.displayItemNum=void 0,e._updateDone=!0,e._updateCounter=void 0,e._actualNumItems=void 0,e._cyclicNum=void 0,e._cyclicPos1=void 0,e._cyclicPos2=void 0,e._cyclicAllItemSize=void 0,e._cycilcAllItemSizeNoEdge=void 0,s(e,"_dataList",gt,o(e)),e._numItems=0,e._inited=!1,e._scrollView=void 0,e._layout=void 0,e._resizeMode=void 0,e._topGap=void 0,e._rightGap=void 0,e._bottomGap=void 0,e._leftGap=void 0,e._columnGap=void 0,e._lineGap=void 0,e._colLineNum=void 0,e._lastDisplayData=void 0,e.displayData=void 0,e._pool=void 0,e._itemTmp=void 0,e._itemTmpUt=void 0,e._needUpdateWidget=!1,e._itemSize=void 0,e._sizeType=void 0,e._customSize=void 0,e.frameCount=void 0,e._aniDelRuning=!1,e._aniDelCB=void 0,e._aniDelItem=void 0,e._aniDelBeforePos=void 0,e._aniDelBeforeScale=void 0,e.viewTop=void 0,e.viewRight=void 0,e.viewBottom=void 0,e.viewLeft=void 0,e._doneAfterUpdate=!1,e.elasticTop=void 0,e.elasticRight=void 0,e.elasticBottom=void 0,e.elasticLeft=void 0,e.scrollToListId=void 0,e.adhering=!1,e._adheringBarrier=!1,e.nearestListId=void 0,e.curPageNum=0,e._beganPos=void 0,e._scrollPos=void 0,e._curScrollIsTouch=void 0,e._scrollToListId=void 0,e._scrollToEndTime=void 0,e._scrollToSo=void 0,e._lack=void 0,e._allItemSize=void 0,e._allItemSizeNoEdge=void 0,e._scrollItem=void 0,e._thisNodeUt=void 0,e}i(e,t);var a=e.prototype;return a.onLoad=function(){var t=this;t._init(),t._dataList&&(t.dataList=t._dataList)},a.onDestroy=function(){var t=this;g(t._itemTmp)&&t._itemTmp.destroy(),g(t.tmpNode)&&t.tmpNode.destroy(),t._pool&&t._pool.clear()},a.onEnable=function(){this._registerEvent(),this._init(),this._aniDelRuning&&(this._aniDelRuning=!1,this._aniDelItem&&(this._aniDelBeforePos&&(this._aniDelItem.position=this._aniDelBeforePos,delete this._aniDelBeforePos),this._aniDelBeforeScale&&(this._aniDelItem.scale=this._aniDelBeforeScale,delete this._aniDelBeforeScale),delete this._aniDelItem),this._aniDelCB&&(this._aniDelCB(),delete this._aniDelCB))},a.onDisable=function(){this._unregisterEvent()},a._registerEvent=function(){var t=this;t.node.on(h.EventType.TOUCH_START,t._onTouchStart,t),t.node.on("touch-up",t._onTouchUp,t),t.node.on(h.EventType.TOUCH_CANCEL,t._onTouchCancelled,t),t.node.on("scroll-began",t._onScrollBegan,t),t.node.on("scroll-ended",t._onScrollEnded,t),t.node.on("scrolling",t._onScrolling,t),t.node.on(h.EventType.SIZE_CHANGED,t._onSizeChanged,t)},a._unregisterEvent=function(){var t=this;t.node.off(h.EventType.TOUCH_START,t._onTouchStart,t),t.node.off("touch-up",t._onTouchUp,t),t.node.off(h.EventType.TOUCH_CANCEL,t._onTouchCancelled,t),t.node.off("scroll-began",t._onScrollBegan,t),t.node.off("scroll-ended",t._onScrollEnded,t),t.node.off("scrolling",t._onScrolling,t),t.node.off(h.EventType.SIZE_CHANGED,t._onSizeChanged,t)},a._init=function(){var t=this;if(!t._inited)if(t._thisNodeUt=t.node.getComponent(f),t._scrollView=t.node.getComponent(r),t.content=t._scrollView.content,t._contentUt=t.content.getComponent(f),t.content){switch(t._layout=t.content.getComponent(v),t._align=t._layout.type,t._resizeMode=t._layout.resizeMode,t._startAxis=t._layout.startAxis,t._topGap=t._layout.paddingTop,t._rightGap=t._layout.paddingRight,t._bottomGap=t._layout.paddingBottom,t._leftGap=t._layout.paddingLeft,t._columnGap=t._layout.spacingX,t._lineGap=t._layout.spacingY,t._colLineNum,t._verticalDir=t._layout.verticalDirection,t._horizontalDir=t._layout.horizontalDirection,t.setTemplateItem(I(t.templateType==St.PREFAB?t.tmpPrefab:t.tmpNode)),t._slideMode!=wt.ADHERING&&t._slideMode!=wt.PAGE||(t._scrollView.inertia=!1,t._scrollView._onMouseWheel=function(){}),t.virtual||(t.lackCenter=!1),t._lastDisplayData=[],t.displayData=[],t._pool=new y,t._forceUpdate=!1,t._updateCounter=0,t._updateDone=!0,t.curPageNum=0,t.cyclic&&(t._scrollView._processAutoScrolling=this._processAutoScrolling.bind(t),t._scrollView._startBounceBackIfNeeded=function(){return!1}),t._align){case v.Type.HORIZONTAL:switch(t._horizontalDir){case v.HorizontalDirection.LEFT_TO_RIGHT:t._alignCalcType=1;break;case v.HorizontalDirection.RIGHT_TO_LEFT:t._alignCalcType=2}break;case v.Type.VERTICAL:switch(t._verticalDir){case v.VerticalDirection.TOP_TO_BOTTOM:t._alignCalcType=3;break;case v.VerticalDirection.BOTTOM_TO_TOP:t._alignCalcType=4}break;case v.Type.GRID:switch(t._startAxis){case v.AxisDirection.HORIZONTAL:switch(t._verticalDir){case v.VerticalDirection.TOP_TO_BOTTOM:t._alignCalcType=3;break;case v.VerticalDirection.BOTTOM_TO_TOP:t._alignCalcType=4}break;case v.AxisDirection.VERTICAL:switch(t._horizontalDir){case v.HorizontalDirection.LEFT_TO_RIGHT:t._alignCalcType=1;break;case v.HorizontalDirection.RIGHT_TO_LEFT:t._alignCalcType=2}}}t.content.removeAllChildren(),t._inited=!0}else console.error(t.node.name+"'s ScrollView unset content!")},a._processAutoScrolling=function(t){var e=1e-4,i=new T,s=this._scrollView,o=s._isNecessaryAutoScrollBrake(),n=o?.05:1;s._autoScrollAccumulatedTime+=t*(1/n);var a,l=Math.min(1,s._autoScrollAccumulatedTime/s._autoScrollTotalTime);s._autoScrollAttenuate&&(a=l,l=(a-=1)*a*a*a*a+1);var c=s._autoScrollTargetDelta.clone();c.multiplyScalar(l);var h=s._autoScrollStartPosition.clone();h.add(c);var _=Math.abs(l-1)<=e;if(Math.abs(l-1)<=s.getScrollEndedEventTiming()&&!s._isScrollEndedWithThresholdEventFired&&(s._dispatchEvent(r.EventType.SCROLL_ENG_WITH_THRESHOLD),s._isScrollEndedWithThresholdEventFired=!0),s.elastic){var d=h.clone();d.subtract(s._autoScrollBrakingStartPosition),o&&d.multiplyScalar(n),h.set(s._autoScrollBrakingStartPosition),h.add(d)}else{var u=h.clone();u.subtract(s._getContentPosition());var m=s._getHowMuchOutOfBoundary(u);m.equals(i,e)||(h.add(m),_=!0)}_&&(s._autoScrolling=!1);var p=new T(h);p.subtract(s._getContentPosition()),s._clampDelta(p),s._moveContent(p,_),s._dispatchEvent(r.EventType.SCROLLING),s._autoScrolling||(s._isBouncing=!1,s._scrolling=!1,s._dispatchEvent(r.EventType.SCROLL_ENDED))},a.setTemplateItem=function(t){if(t){var e=this;if(e._itemTmp=t,e._itemTmpUt=t.getComponent(f),e._resizeMode==v.ResizeMode.CHILDREN)e._itemSize=e._layout.cellSize;else{var i=t.getComponent(f);e._itemSize=new S(i.width,i.height)}var s=t.getComponent(N),o=!1;switch(s||(o=!0),o&&(e.selectedMode=zt.NONE),(s=t.getComponent(w))&&s.enabled&&(e._needUpdateWidget=!0),e.selectedMode==zt.MULT&&(e.multSelected=[]),e._align){case v.Type.HORIZONTAL:e._colLineNum=1,e._sizeType=!1;break;case v.Type.VERTICAL:e._colLineNum=1,e._sizeType=!0;break;case v.Type.GRID:switch(e._startAxis){case v.AxisDirection.HORIZONTAL:var n=e._contentUt.width-e._leftGap-e._rightGap;e._colLineNum=Math.floor((n+e._columnGap)/(e._itemSize.width+e._columnGap)),e._sizeType=!0;break;case v.AxisDirection.VERTICAL:var a=e._contentUt.height-e._topGap-e._bottomGap;e._colLineNum=Math.floor((a+e._lineGap)/(e._itemSize.height+e._lineGap)),e._sizeType=!1}}}},a.checkInited=function(t){return void 0===t&&(t=!0),!!this._inited||(t&&console.error("List initialization not completed!"),!1)},a._resizeContent=function(){var t,e=this;switch(e._align){case v.Type.HORIZONTAL:if(e._customSize){var i=e._getFixedSize(null);t=e._leftGap+i.val+e._itemSize.width*(e._numItems-i.count)+e._columnGap*(e._numItems-1)+e._rightGap}else t=e._leftGap+e._itemSize.width*e._numItems+e._columnGap*(e._numItems-1)+e._rightGap;break;case v.Type.VERTICAL:if(e._customSize){var s=e._getFixedSize(null);t=e._topGap+s.val+e._itemSize.height*(e._numItems-s.count)+e._lineGap*(e._numItems-1)+e._bottomGap}else t=e._topGap+e._itemSize.height*e._numItems+e._lineGap*(e._numItems-1)+e._bottomGap;break;case v.Type.GRID:switch(e.lackCenter&&(e.lackCenter=!1),e._startAxis){case v.AxisDirection.HORIZONTAL:var o=Math.ceil(e._numItems/e._colLineNum);t=e._topGap+e._itemSize.height*o+e._lineGap*(o-1)+e._bottomGap;break;case v.AxisDirection.VERTICAL:var n=Math.ceil(e._numItems/e._colLineNum);t=e._leftGap+e._itemSize.width*n+e._columnGap*(n-1)+e._rightGap}}var a=e.content.getComponent(v);if(a&&(a.enabled=!1),e._allItemSize=t,e._allItemSizeNoEdge=e._allItemSize-(e._sizeType?e._topGap+e._bottomGap:e._leftGap+e._rightGap),e.cyclic){var l=e._sizeType?e._thisNodeUt.height:e._thisNodeUt.width;e._cyclicPos1=0,l-=e._cyclicPos1,e._cyclicNum=Math.ceil(l/e._allItemSizeNoEdge)+1;var r=e._sizeType?e._lineGap:e._columnGap;e._cyclicPos2=e._cyclicPos1+e._allItemSizeNoEdge+r,e._cyclicAllItemSize=e._allItemSize+e._allItemSizeNoEdge*(e._cyclicNum-1)+r*(e._cyclicNum-1),e._cycilcAllItemSizeNoEdge=e._allItemSizeNoEdge*e._cyclicNum,e._cycilcAllItemSizeNoEdge+=r*(e._cyclicNum-1)}e._lack=!e.cyclic&&e._allItemSize<(e._sizeType?e._thisNodeUt.height:e._thisNodeUt.width);var c=e._lack&&e.lackCenter||!e.lackSlide?.1:0,h=e._lack?(e._sizeType?e._thisNodeUt.height:e._thisNodeUt.width)-c:e.cyclic?e._cyclicAllItemSize:e._allItemSize;h<0&&(h=0),e._sizeType?e._contentUt.height=h:e._contentUt.width=h},a._onScrolling=function(t){if(void 0===t&&(t=null),null==this.frameCount&&(this.frameCount=this._updateRate),!this._forceUpdate&&t&&"scroll-ended"!=t.type&&this.frameCount>0)this.frameCount--;else if(this.frameCount=this._updateRate,!this._aniDelRuning){if(this.cyclic){var e=this.content.getPosition();e=this._sizeType?e.y:e.x;var i=this._allItemSizeNoEdge+(this._sizeType?this._lineGap:this._columnGap),s=this._sizeType?new T(0,i,0):new T(i,0,0),o=this.content.getPosition();switch(this._alignCalcType){case 1:e>-this._cyclicPos1?(o.set(-this._cyclicPos2,o.y,o.z),this.content.setPosition(o),this._scrollView.isAutoScrolling()&&(this._scrollView._autoScrollStartPosition=this._scrollView._autoScrollStartPosition.subtract(s))):e<-this._cyclicPos2&&(o.set(-this._cyclicPos1,o.y,o.z),this.content.setPosition(o),this._scrollView.isAutoScrolling()&&(this._scrollView._autoScrollStartPosition=this._scrollView._autoScrollStartPosition.add(s)));break;case 2:e<this._cyclicPos1?(o.set(this._cyclicPos2,o.y,o.z),this.content.setPosition(o),this._scrollView.isAutoScrolling()&&(this._scrollView._autoScrollStartPosition=this._scrollView._autoScrollStartPosition.add(s))):e>this._cyclicPos2&&(o.set(this._cyclicPos1,o.y,o.z),this.content.setPosition(o),this._scrollView.isAutoScrolling()&&(this._scrollView._autoScrollStartPosition=this._scrollView._autoScrollStartPosition.subtract(s)));break;case 3:e<this._cyclicPos1?(o.set(o.x,this._cyclicPos2,o.z),this.content.setPosition(o),this._scrollView.isAutoScrolling()&&(this._scrollView._autoScrollStartPosition=this._scrollView._autoScrollStartPosition.add(s))):e>this._cyclicPos2&&(o.set(o.x,this._cyclicPos1,o.z),this.content.setPosition(o),this._scrollView.isAutoScrolling()&&(this._scrollView._autoScrollStartPosition=this._scrollView._autoScrollStartPosition.subtract(s)));break;case 4:e>-this._cyclicPos1?(o.set(o.x,-this._cyclicPos2,o.z),this.content.setPosition(o),this._scrollView.isAutoScrolling()&&(this._scrollView._autoScrollStartPosition=this._scrollView._autoScrollStartPosition.subtract(s))):e<-this._cyclicPos2&&(o.set(o.x,-this._cyclicPos1,o.z),this.content.setPosition(o),this._scrollView.isAutoScrolling()&&(this._scrollView._autoScrollStartPosition=this._scrollView._autoScrollStartPosition.add(s)))}}var n,a,l,r;if(this._calcViewPos(),this._sizeType?(n=this.viewTop,l=this.viewBottom):(a=this.viewRight,r=this.viewLeft),this._virtual){var c;this.displayData=[];var h=0,_=this._numItems-1;if(this._customSize)for(var d=!1;h<=_&&!d;h++)switch(c=this._calcItemPos(h),this._align){case v.Type.HORIZONTAL:c.right>=r&&c.left<=a?this.displayData.push(c):0!=h&&this.displayData.length>0&&(d=!0);break;case v.Type.VERTICAL:c.bottom<=n&&c.top>=l?this.displayData.push(c):0!=h&&this.displayData.length>0&&(d=!0);break;case v.Type.GRID:switch(this._startAxis){case v.AxisDirection.HORIZONTAL:c.bottom<=n&&c.top>=l?this.displayData.push(c):0!=h&&this.displayData.length>0&&(d=!0);break;case v.AxisDirection.VERTICAL:c.right>=r&&c.left<=a?this.displayData.push(c):0!=h&&this.displayData.length>0&&(d=!0)}}else{var u=this._itemSize.width+this._columnGap,m=this._itemSize.height+this._lineGap;switch(this._alignCalcType){case 1:h=(r-this._leftGap)/u,_=(a-this._leftGap)/u;break;case 2:h=(-a-this._rightGap)/u,_=(-r-this._rightGap)/u;break;case 3:h=(-n-this._topGap)/m,_=(-l-this._topGap)/m;break;case 4:h=(l-this._bottomGap)/m,_=(n-this._bottomGap)/m}for(h=Math.floor(h)*this._colLineNum,_=Math.ceil(_)*this._colLineNum,h<0&&(h=0),--_>=this._numItems&&(_=this._numItems-1);h<=_;h++)this.displayData.push(this._calcItemPos(h))}if(this._delRedundantItem(),this.displayData.length<=0||!this._numItems)return void(this._lastDisplayData=[]);this.firstListId=this.displayData[0].id,this.displayItemNum=this.displayData.length;var p=this._lastDisplayData.length,g=this.displayItemNum!=p;if(g&&(this.frameByFrameRenderNum>0&&this._lastDisplayData.sort((function(t,e){return t-e})),g=this.firstListId!=this._lastDisplayData[0]||this.displayData[this.displayItemNum-1].id!=this._lastDisplayData[p-1]),this._forceUpdate||g)if(this.frameByFrameRenderNum>0)this._numItems>0?(this._updateDone?this._updateCounter=0:this._doneAfterUpdate=!0,this._updateDone=!1):(this._updateCounter=0,this._updateDone=!0);else{this._lastDisplayData=[];for(var f=0;f<this.displayItemNum;f++)this._createOrUpdateItem(this.displayData[f]);this._forceUpdate=!1}this._calcNearestItem()}}},a._calcViewPos=function(){var t=this.content.getPosition();switch(this._alignCalcType){case 1:this.elasticLeft=t.x>0?t.x:0,this.viewLeft=(t.x<0?-t.x:0)-this.elasticLeft,this.viewRight=this.viewLeft+this._thisNodeUt.width,this.elasticRight=this.viewRight>this._contentUt.width?Math.abs(this.viewRight-this._contentUt.width):0,this.viewRight+=this.elasticRight;break;case 2:this.elasticRight=t.x<0?-t.x:0,this.viewRight=(t.x>0?-t.x:0)+this.elasticRight,this.viewLeft=this.viewRight-this._thisNodeUt.width,this.elasticLeft=this.viewLeft<-this._contentUt.width?Math.abs(this.viewLeft+this._contentUt.width):0,this.viewLeft-=this.elasticLeft;break;case 3:this.elasticTop=t.y<0?Math.abs(t.y):0,this.viewTop=(t.y>0?-t.y:0)+this.elasticTop,this.viewBottom=this.viewTop-this._thisNodeUt.height,this.elasticBottom=this.viewBottom<-this._contentUt.height?Math.abs(this.viewBottom+this._contentUt.height):0,this.viewBottom+=this.elasticBottom;break;case 4:this.elasticBottom=t.y>0?Math.abs(t.y):0,this.viewBottom=(t.y<0?-t.y:0)-this.elasticBottom,this.viewTop=this.viewBottom+this._thisNodeUt.height,this.elasticTop=this.viewTop>this._contentUt.height?Math.abs(this.viewTop-this._contentUt.height):0,this.viewTop-=this.elasticTop}},a._calcItemPos=function(t){var e,i,s,o,n,a,l,r;switch(this._align){case v.Type.HORIZONTAL:switch(this._horizontalDir){case v.HorizontalDirection.LEFT_TO_RIGHT:if(this._customSize){var c=this._getFixedSize(t);n=this._leftGap+(this._itemSize.width+this._columnGap)*(t-c.count)+(c.val+this._columnGap*c.count);var h=this._customSize[t];e=h>0?h:this._itemSize.width}else n=this._leftGap+(this._itemSize.width+this._columnGap)*t,e=this._itemSize.width;if(this.lackCenter)n-=this._leftGap,n+=this._contentUt.width/2-this._allItemSizeNoEdge/2;return{id:t,left:n,right:a=n+e,x:n+this._itemTmpUt.anchorX*e,y:this._itemTmp.y};case v.HorizontalDirection.RIGHT_TO_LEFT:if(this._customSize){var _=this._getFixedSize(t);a=-this._rightGap-(this._itemSize.width+this._columnGap)*(t-_.count)-(_.val+this._columnGap*_.count);var d=this._customSize[t];e=d>0?d:this._itemSize.width}else a=-this._rightGap-(this._itemSize.width+this._columnGap)*t,e=this._itemSize.width;if(this.lackCenter)a+=this._rightGap,a-=this._contentUt.width/2-this._allItemSizeNoEdge/2;return{id:t,right:a,left:n=a-e,x:n+this._itemTmpUt.anchorX*e,y:this._itemTmp.y}}break;case v.Type.VERTICAL:switch(this._verticalDir){case v.VerticalDirection.TOP_TO_BOTTOM:if(this._customSize){var u=this._getFixedSize(t);s=-this._topGap-(this._itemSize.height+this._lineGap)*(t-u.count)-(u.val+this._lineGap*u.count);var m=this._customSize[t];i=m>0?m:this._itemSize.height}else s=-this._topGap-(this._itemSize.height+this._lineGap)*t,i=this._itemSize.height;if(this.lackCenter)s+=this._topGap,s-=this._contentUt.height/2-this._allItemSizeNoEdge/2;return{id:t,top:s,bottom:o=s-i,x:this._itemTmp.x,y:o+this._itemTmpUt.anchorY*i};case v.VerticalDirection.BOTTOM_TO_TOP:if(this._customSize){var p=this._getFixedSize(t);o=this._bottomGap+(this._itemSize.height+this._lineGap)*(t-p.count)+(p.val+this._lineGap*p.count);var g=this._customSize[t];i=g>0?g:this._itemSize.height}else o=this._bottomGap+(this._itemSize.height+this._lineGap)*t,i=this._itemSize.height;if(this.lackCenter)o-=this._bottomGap,o+=this._contentUt.height/2-this._allItemSizeNoEdge/2;return{id:t,top:s=o+i,bottom:o,x:this._itemTmp.x,y:o+this._itemTmpUt.anchorY*i}}case v.Type.GRID:var f=Math.floor(t/this._colLineNum);switch(this._startAxis){case v.AxisDirection.HORIZONTAL:switch(this._verticalDir){case v.VerticalDirection.TOP_TO_BOTTOM:r=(o=(s=-this._topGap-(this._itemSize.height+this._lineGap)*f)-this._itemSize.height)+this._itemTmpUt.anchorY*this._itemSize.height;break;case v.VerticalDirection.BOTTOM_TO_TOP:s=(o=this._bottomGap+(this._itemSize.height+this._lineGap)*f)+this._itemSize.height,r=o+this._itemTmpUt.anchorY*this._itemSize.height}switch(l=this._leftGap+t%this._colLineNum*(this._itemSize.width+this._columnGap),this._horizontalDir){case v.HorizontalDirection.LEFT_TO_RIGHT:l+=this._itemTmpUt.anchorX*this._itemSize.width,l-=this._contentUt.anchorX*this._contentUt.width;break;case v.HorizontalDirection.RIGHT_TO_LEFT:l+=(1-this._itemTmpUt.anchorX)*this._itemSize.width,l-=(1-this._contentUt.anchorX)*this._contentUt.width,l*=-1}return{id:t,top:s,bottom:o,x:l,y:r};case v.AxisDirection.VERTICAL:switch(this._horizontalDir){case v.HorizontalDirection.LEFT_TO_RIGHT:a=(n=this._leftGap+(this._itemSize.width+this._columnGap)*f)+this._itemSize.width,l=n+this._itemTmpUt.anchorX*this._itemSize.width,l-=this._contentUt.anchorX*this._contentUt.width;break;case v.HorizontalDirection.RIGHT_TO_LEFT:l=(n=(a=-this._rightGap-(this._itemSize.width+this._columnGap)*f)-this._itemSize.width)+this._itemTmpUt.anchorX*this._itemSize.width,l+=(1-this._contentUt.anchorX)*this._contentUt.width}switch(r=-this._topGap-t%this._colLineNum*(this._itemSize.height+this._lineGap),this._verticalDir){case v.VerticalDirection.TOP_TO_BOTTOM:r-=(1-this._itemTmpUt.anchorY)*this._itemSize.height,r+=(1-this._contentUt.anchorY)*this._contentUt.height;break;case v.VerticalDirection.BOTTOM_TO_TOP:r-=this._itemTmpUt.anchorY*this._itemSize.height,r+=this._contentUt.anchorY*this._contentUt.height,r*=-1}return{id:t,left:n,right:a,x:l,y:r}}}},a._calcExistItemPos=function(t){var e=this.getItemByListId(t);if(!e)return null;var i=e.getComponent(f),s=e.getPosition(),o={id:t,x:s.x,y:s.y};return this._sizeType?(o.top=s.y+i.height*(1-i.anchorY),o.bottom=s.y-i.height*i.anchorY):(o.left=s.x-i.width*i.anchorX,o.right=s.x+i.width*(1-i.anchorX)),o},a.getItemPos=function(t){return this._virtual||this.frameByFrameRenderNum?this._calcItemPos(t):this._calcExistItemPos(t)},a._getFixedSize=function(t){if(!this._customSize)return null;null==t&&(t=this._numItems);var e=0,i=0;for(var s in this._customSize)parseInt(s)<t&&(e+=this._customSize[s],i++);return{val:e,count:i}},a._onScrollBegan=function(){this._beganPos=this._sizeType?this.viewTop:this.viewLeft},a._onScrollEnded=function(){var t=this;if(t._curScrollIsTouch=!1,null!=t.scrollToListId){var e=t.getItemByListId(t.scrollToListId);t.scrollToListId=null,e&&z(e).to(.1,{scale:1.06}).to(.1,{scale:1}).start()}t._onScrolling(),t._slideMode!=wt.ADHERING||t.adhering?t._slideMode==wt.PAGE&&(null!=t._beganPos&&t._curScrollIsTouch?this._pageAdhere():t.adhere()):t.adhere()},a._onTouchStart=function(t,e){if(!this._scrollView._hasNestedViewGroup(t,e)&&(this._curScrollIsTouch=!0,!(t.eventPhase===Event.AT_TARGET&&t.target===this.node))){for(var i=t.target;null==i._listId&&i.parent;)i=i.parent;this._scrollItem=null!=i._listId?i:t.target}},a._onTouchUp=function(){var t=this;t._scrollPos=null,t._slideMode==wt.ADHERING?(this.adhering&&(this._adheringBarrier=!0),t.adhere()):t._slideMode==wt.PAGE&&(null!=t._beganPos?this._pageAdhere():t.adhere()),this._scrollItem=null},a._onTouchCancelled=function(t,e){var i=this;i._scrollView._hasNestedViewGroup(t,e)||t.simulate||(i._scrollPos=null,i._slideMode==wt.ADHERING?(i.adhering&&(i._adheringBarrier=!0),i.adhere()):i._slideMode==wt.PAGE&&(null!=i._beganPos?i._pageAdhere():i.adhere()),this._scrollItem=null)},a._onSizeChanged=function(){this.checkInited(!1)&&this._onScrolling()},a._onItemAdaptive=function(t){var e=t.getComponent(f);if(!this._sizeType&&e.width!=this._itemSize.width||this._sizeType&&e.height!=this._itemSize.height){this._customSize||(this._customSize={});var i=this._sizeType?e.height:e.width;this._customSize[t._listId]!=i&&(this._customSize[t._listId]=i,this._resizeContent(),this.updateAll(),null!=this._scrollToListId&&(this._scrollPos=null,this.unschedule(this._scrollToSo),this.scrollTo(this._scrollToListId,Math.max(0,this._scrollToEndTime-(new Date).getTime()/1e3))))}},a._pageAdhere=function(){var t=this;if(t.cyclic||!(t.elasticTop>0||t.elasticRight>0||t.elasticBottom>0||t.elasticLeft>0)){var e=t._sizeType?t.viewTop:t.viewLeft,i=(t._sizeType?t._thisNodeUt.height:t._thisNodeUt.width)*t.pageDistance;if(Math.abs(t._beganPos-e)>i){var s=.5;switch(t._alignCalcType){case 1:case 4:t._beganPos>e?t.prePage(s):t.nextPage(s);break;case 2:case 3:t._beganPos<e?t.prePage(s):t.nextPage(s)}}else t.elasticTop<=0&&t.elasticRight<=0&&t.elasticBottom<=0&&t.elasticLeft<=0&&t.adhere();t._beganPos=null}},a.adhere=function(){var t=this;if(t.checkInited()&&!(t.elasticTop>0||t.elasticRight>0||t.elasticBottom>0||t.elasticLeft>0)){t.adhering=!0,t._calcNearestItem();var e=(t._sizeType?t._topGap:t._leftGap)/(t._sizeType?t._thisNodeUt.height:t._thisNodeUt.width);t.scrollTo(t.nearestListId,.7,e)}},a.update=function(){if(!(this.frameByFrameRenderNum<=0||this._updateDone))if(this._virtual){for(var t=this._updateCounter+this.frameByFrameRenderNum>this.displayItemNum?this.displayItemNum:this._updateCounter+this.frameByFrameRenderNum,e=this._updateCounter;e<t;e++){var i=this.displayData[e];i&&this._createOrUpdateItem(i)}this._updateCounter>=this.displayItemNum-1?this._doneAfterUpdate?(this._updateCounter=0,this._updateDone=!1,this._doneAfterUpdate=!1):(this._updateDone=!0,this._delRedundantItem(),this._forceUpdate=!1,this._calcNearestItem(),this.slideMode==wt.PAGE&&(this.curPageNum=this.nearestListId)):this._updateCounter+=this.frameByFrameRenderNum}else if(this._updateCounter<this._numItems){for(var s=this._updateCounter+this.frameByFrameRenderNum>this._numItems?this._numItems:this._updateCounter+this.frameByFrameRenderNum,o=this._updateCounter;o<s;o++)this._createOrUpdateItem2(o);this._updateCounter+=this.frameByFrameRenderNum}else this._updateDone=!0,this._calcNearestItem(),this.slideMode==wt.PAGE&&(this.curPageNum=this.nearestListId)},a._createOrUpdateItem=function(t){var e=this.getItemByListId(t.id);if(e)this._forceUpdate&&this.renderEvent&&(e.setPosition(new T(t.x,t.y,0)),this._resetItemSize(e),this.renderEvent&&u.emitEvents([this.renderEvent],e,t.id%this._actualNumItems));else{var i=this._pool.size()>0;if(e=i?this._pool.get():I(this._itemTmp),i&&g(e)||(e=I(this._itemTmp),i=!1),e._listId!=t.id)e._listId=t.id,e.getComponent(f).setContentSize(this._itemSize);if(e.setPosition(new T(t.x,t.y,0)),this._resetItemSize(e),this.content.addChild(e),i&&this._needUpdateWidget){var s=e.getComponent(w);s&&s.updateAlignment()}e.setSiblingIndex(this.content.children.length-1);var o=e.getComponent(N);e.listItem=o,o&&(o.listId=t.id,o.list=this,o.registerEvent()),this.renderEvent&&u.emitEvents([this.renderEvent],e,t.id%this._actualNumItems)}this._resetItemSize(e),this._updateListItem(e.listItem),this._lastDisplayData.indexOf(t.id)<0&&this._lastDisplayData.push(t.id)},a._createOrUpdateItem2=function(t){var e,i=this.content.children[t];i?this._forceUpdate&&this.renderEvent&&(i._listId=t,e&&(e.listId=t),this.renderEvent&&u.emitEvents([this.renderEvent],i,t%this._actualNumItems)):((i=I(this._itemTmp))._listId=t,this.content.addChild(i),e=i.getComponent(N),i.listItem=e,e&&(e.listId=t,e.list=this,e.registerEvent()),this.renderEvent&&u.emitEvents([this.renderEvent],i,t%this._actualNumItems)),this._updateListItem(e),this._lastDisplayData.indexOf(t)<0&&this._lastDisplayData.push(t)},a._updateListItem=function(t){if(t&&this.selectedMode>zt.NONE){var e=t.node;switch(this.selectedMode){case zt.SINGLE:t.selected=this.selectedId==e._listId;break;case zt.MULT:t.selected=this.multSelected.indexOf(e._listId)>=0}}},a._resetItemSize=function(t){},a._updateItemPos=function(t){var e=isNaN(t)?t:this.getItemByListId(t),i=this.getItemPos(e._listId);e.setPosition(i.x,i.y)},a.setMultSelected=function(t,e){var i=this;if(i.checkInited()){var s,o;if(Array.isArray(t)||(t=[t]),null==e)i.multSelected=t;else if(e)for(var n=t.length-1;n>=0;n--)s=t[n],(o=i.multSelected.indexOf(s))<0&&i.multSelected.push(s);else for(var a=t.length-1;a>=0;a--)s=t[a],(o=i.multSelected.indexOf(s))>=0&&i.multSelected.splice(o,1);i._forceUpdate=!0,i._onScrolling()}},a.getMultSelected=function(){return this.multSelected},a.hasMultSelected=function(t){return this.multSelected&&this.multSelected.indexOf(t)>=0},a.updateItem=function(t){if(this.checkInited()){Array.isArray(t)||(t=[t]);for(var e=0,i=t.length;e<i;e++){var s=t[e],o=this.getItemByListId(s);o&&u.emitEvents([this.renderEvent],o,s%this._actualNumItems)}}},a.updateAll=function(){this.checkInited()&&(this.numItems=this.numItems)},a.getItemByListId=function(t){if(this.content)for(var e=this.content.children.length-1;e>=0;e--){var i=this.content.children[e];if(i._listId==t)return i}},a._getOutsideItem=function(){for(var t,e=[],i=this.content.children.length-1;i>=0;i--)t=this.content.children[i],this.displayData.find((function(e){return e.id==t._listId}))||e.push(t);return e},a._delRedundantItem=function(){if(this._virtual)for(var t=this._getOutsideItem(),e=t.length-1;e>=0;e--){var i=t[e];if(!this._scrollItem||i._listId!=this._scrollItem._listId){i.isCached=!0,this._pool.put(i);for(var s=this._lastDisplayData.length-1;s>=0;s--)if(this._lastDisplayData[s]==i._listId){this._lastDisplayData.splice(s,1);break}}}else for(;this.content.children.length>this._numItems;)this._delSingleItem(this.content.children[this.content.children.length-1])},a._delSingleItem=function(t){t.removeFromParent(),t.destroy&&t.destroy(),t=null},a.aniDelItem=function(t,e,i){var s=this;if(!s.checkInited()||s.cyclic||!s._virtual)return console.error("This function is not allowed to be called!");if(!e)return console.error("CallFunc are not allowed to be NULL, You need to delete the corresponding index in the data array in the CallFunc!");if(s._aniDelRuning)return console.warn("Please wait for the current deletion to finish!");var o,n=s.getItemByListId(t);if(n){o=n.getComponent(N),s._aniDelRuning=!0,s._aniDelCB=e,s._aniDelItem=n,s._aniDelBeforePos=n.position,s._aniDelBeforeScale=n.scale;var a=s.displayData[s.displayData.length-1].id,l=o.selected;o.showAni(i,(function(){var i;if(a<s._numItems-2&&(i=a+1),null!=i){var o=s._calcItemPos(i);s.displayData.push(o),s._virtual?s._createOrUpdateItem(o):s._createOrUpdateItem2(i)}else s._numItems--;if(s.selectedMode==zt.SINGLE)l?s._selectedId=-1:s._selectedId-1>=0&&s._selectedId--;else if(s.selectedMode==zt.MULT&&s.multSelected.length){var r=s.multSelected.indexOf(t);r>=0&&s.multSelected.splice(r,1);for(var c=s.multSelected.length-1;c>=0;c--){s.multSelected[c]>=t&&s.multSelected[c]--}}if(s._customSize){s._customSize[t]&&delete s._customSize[t];var h,_={};for(var d in s._customSize){h=s._customSize[d];var u=parseInt(d);_[u-(u>=t?1:0)]=h}s._customSize=_}for(var m,p,g=null!=i?i:a;g>=t+1;g--)if(n=s.getItemByListId(g)){var f=s._calcItemPos(g-1);m=z(n).to(.2333,{position:new T(f.x,f.y,0)}),g<=t+1&&(p=!0,m.call((function(){s._aniDelRuning=!1,e(t),delete s._aniDelCB}))),m.start()}p||(s._aniDelRuning=!1,e(t),s._aniDelCB=null)}),!0)}else e(t)},a.scrollTo=function(t,e,i,s){void 0===e&&(e=.5),void 0===i&&(i=null),void 0===s&&(s=!1);var o=this;if(o.checkInited(!1)){null==e?e=.5:e<0&&(e=0),t<0?t=0:t>=o._numItems&&(t=o._numItems-1),!o._virtual&&o._layout&&o._layout.enabled&&o._layout.updateLayout();var n,a,l=o.getItemPos(t);if(!l)return D;switch(o._alignCalcType){case 1:n=l.left,n-=null!=i?o._thisNodeUt.width*i:o._leftGap,l=new T(n,0,0);break;case 2:n=l.right-o._thisNodeUt.width,n+=null!=i?o._thisNodeUt.width*i:o._rightGap,l=new T(n+o._contentUt.width,0,0);break;case 3:a=l.top,a+=null!=i?o._thisNodeUt.height*i:o._topGap,l=new T(0,-a,0);break;case 4:a=l.bottom+o._thisNodeUt.height,a-=null!=i?o._thisNodeUt.height*i:o._bottomGap,l=new T(0,-a+o._contentUt.height,0)}var r=o.content.getPosition();r=Math.abs(o._sizeType?r.y:r.x);var c=o._sizeType?l.y:l.x;Math.abs((null!=o._scrollPos?o._scrollPos:r)-c)>.5&&(o._scrollView.scrollToOffset(l,e),o._scrollToListId=t,o._scrollToEndTime=(new Date).getTime()/1e3+e,o._scrollToSo=o.scheduleOnce((function(){if(o._adheringBarrier||(o.adhering=o._adheringBarrier=!1),o._scrollPos=o._scrollToListId=o._scrollToEndTime=o._scrollToSo=null,s){var e=o.getItemByListId(t);e&&z(e).to(.1,{scale:1.05}).to(.1,{scale:1}).start()}}),e+.1),e<=0&&o._onScrolling())}},a._calcNearestItem=function(){var t,e,i,s,o,n,a=this;a.nearestListId=null,a._virtual&&a._calcViewPos(),i=a.viewTop,s=a.viewRight,o=a.viewBottom,n=a.viewLeft;for(var l=!1,r=0;r<a.content.children.length&&!l;r+=a._colLineNum)if(t=a._virtual?a.displayData[r]:a._calcExistItemPos(r))switch(e=a._sizeType?(t.top+t.bottom)/2:e=(t.left+t.right)/2,a._alignCalcType){case 1:t.right>=n&&(a.nearestListId=t.id,n>e&&(a.nearestListId+=a._colLineNum),l=!0);break;case 2:t.left<=s&&(a.nearestListId=t.id,s<e&&(a.nearestListId+=a._colLineNum),l=!0);break;case 3:t.bottom<=i&&(a.nearestListId=t.id,i<e&&(a.nearestListId+=a._colLineNum),l=!0);break;case 4:t.top>=o&&(a.nearestListId=t.id,o>e&&(a.nearestListId+=a._colLineNum),l=!0)}if((t=a._virtual?a.displayData[a.displayItemNum-1]:a._calcExistItemPos(a._numItems-1))&&t.id==a._numItems-1)switch(e=a._sizeType?(t.top+t.bottom)/2:e=(t.left+t.right)/2,a._alignCalcType){case 1:s>e&&(a.nearestListId=t.id);break;case 2:n<e&&(a.nearestListId=t.id);break;case 3:o<e&&(a.nearestListId=t.id);break;case 4:i>e&&(a.nearestListId=t.id)}},a.prePage=function(t){void 0===t&&(t=.5),this.checkInited()&&this.skipPage(this.curPageNum-1,t)},a.nextPage=function(t){void 0===t&&(t=.5),this.checkInited()&&this.skipPage(this.curPageNum+1,t)},a.skipPage=function(t,e){var i=this;if(i.checkInited())return i._slideMode!=wt.PAGE?console.error("This function is not allowed to be called, Must SlideMode = PAGE!"):void(t<0||t>=i._numItems||i.curPageNum!=t&&(i.curPageNum=t,i.pageChangeEvent&&u.emitEvents([i.pageChangeEvent],i,t),i.scrollTo(t,e)))},a.calcCustomSize=function(t){var e=this;if(e.checkInited()){if(!e._itemTmp)return console.error("Unset template item!");if(!e.renderEvent)return console.error("Unset Render-Event!");e._customSize={};var i=I(e._itemTmp),s=i.getComponent(f);e.content.addChild(i);for(var o=0;o<t;o++)u.emitEvents([e.renderEvent],i,o),s.height==e._itemSize.height&&s.width==e._itemSize.width||(e._customSize[o]=e._sizeType?s.height:s.width);return Object.keys(e._customSize).length||(e._customSize=null),i.removeFromParent(),i.destroy&&i.destroy(),e._customSize}},n(e,[{key:"slideMode",get:function(){return this._slideMode},set:function(t){this._slideMode=t}},{key:"virtual",get:function(){return this._virtual},set:function(t){null!=t&&(this._virtual=t),0!=this._numItems&&this._onScrolling()}},{key:"updateRate",get:function(){return this._updateRate},set:function(t){t>=0&&t<=6&&(this._updateRate=t)}},{key:"selectedId",get:function(){return this._selectedId},set:function(t){var e,i=this;switch(i.selectedMode){case zt.SINGLE:if(!i.repeatEventSingle&&t==i._selectedId)return;if(e=i.getItemByListId(t),i._selectedId>=0?i._lastSelectedId=i._selectedId:i._lastSelectedId=null,i._selectedId=t,e&&(e.getComponent(N).selected=!0),i._lastSelectedId>=0&&i._lastSelectedId!=i._selectedId){var s=i.getItemByListId(i._lastSelectedId);s&&(s.getComponent(N).selected=!1)}i.selectedEvent&&u.emitEvents([i.selectedEvent],e,t%this._actualNumItems,null==i._lastSelectedId?null:i._lastSelectedId%this._actualNumItems);break;case zt.MULT:if(!(e=i.getItemByListId(t)))return;var o=e.getComponent(N);i._selectedId>=0&&(i._lastSelectedId=i._selectedId),i._selectedId=t;var n=!o.selected;o.selected=n;var a=i.multSelected.indexOf(t);n&&a<0?i.multSelected.push(t):!n&&a>=0&&i.multSelected.splice(a,1),i.selectedEvent&&u.emitEvents([i.selectedEvent],e,t%this._actualNumItems,null==i._lastSelectedId?null:i._lastSelectedId%this._actualNumItems,n)}}},{key:"dataList",get:function(){return this._dataList},set:function(t){this._dataList=t,t?this.numItems=t.length:console.warn("设置的列表数据为null")}},{key:"numItems",get:function(){return this._actualNumItems},set:function(t){var e=this;if(e.checkInited(!1))if(null==t||t<0)console.error("numItems set the wrong::",t);else if(e._actualNumItems=e._numItems=t,e._forceUpdate=!0,e._virtual)e._resizeContent(),e.cyclic&&(e._numItems=e._cyclicNum*e._numItems),e._onScrolling(),e.frameByFrameRenderNum||e.slideMode!=wt.PAGE||(e.curPageNum=e.nearestListId);else{e.cyclic&&(e._resizeContent(),e._numItems=e._cyclicNum*e._numItems);var i=e.content.getComponent(v);if(i&&(i.enabled=!0),e._delRedundantItem(),e.firstListId=0,e.frameByFrameRenderNum>0){for(var s=e.frameByFrameRenderNum>e._numItems?e._numItems:e.frameByFrameRenderNum,o=0;o<s;o++)e._createOrUpdateItem2(o);e.frameByFrameRenderNum<e._numItems&&(e._updateCounter=e.frameByFrameRenderNum,e._updateDone=!1)}else{for(var n=0;n<e._numItems;n++)e._createOrUpdateItem2(n);e.displayItemNum=e._numItems}}}},{key:"scrollView",get:function(){return this._scrollView}}]),e}(b)).prototype,"templateType",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return St.PREFAB}}),et=e($.prototype,"tmpNode",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),it=e($.prototype,"tmpPrefab",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),st=e($.prototype,"_slideMode",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return wt.NORMAL}}),e($.prototype,"slideMode",[U],Object.getOwnPropertyDescriptor($.prototype,"slideMode"),$.prototype),ot=e($.prototype,"pageDistance",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),nt=e($.prototype,"pageChangeEvent",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new u}}),at=e($.prototype,"_virtual",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),e($.prototype,"virtual",[x],Object.getOwnPropertyDescriptor($.prototype,"virtual"),$.prototype),lt=e($.prototype,"cyclic",[V],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),rt=e($.prototype,"lackCenter",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ct=e($.prototype,"lackSlide",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ht=e($.prototype,"_updateRate",[X],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),e($.prototype,"updateRate",[Y],Object.getOwnPropertyDescriptor($.prototype,"updateRate"),$.prototype),_t=e($.prototype,"frameByFrameRenderNum",[Z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),dt=e($.prototype,"renderEvent",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new u}}),ut=e($.prototype,"selectedMode",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return zt.NONE}}),mt=e($.prototype,"selectedEvent",[q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new u}}),pt=e($.prototype,"repeatEventSingle",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),gt=e($.prototype,"_dataList",[K],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Q=$))||Q)||Q)||Q)||Q));a._RF.pop()}}}));

System.register("chunks:///_virtual/ListItem.ts",["./rollupPluginModLoBabelHelpers.js","cc","./env","./ButtonPlus.ts","./Emmiter.ts","./SoundMgr.ts"],(function(t){var e,n,i,r,o,a,s,l,c,u,d,h,f,p,m,_,v,g,b,E,T,w,y;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,i=t.initializerDefineProperty,r=t.assertThisInitialized,o=t.createClass},function(t){a=t.cclegacy,s=t._decorator,l=t.Sprite,c=t.Node,u=t.Enum,d=t.SpriteFrame,h=t.js,f=t.Component,p=t.tween,m=t.Tween,_=t.EventHandler,v=t.UITransform,g=t.Vec3,b=t.Button},function(t){E=t.DEV},function(t){T=t.ButtonPlus},function(t){w=t.emmiter},function(t){y=t.SoundMgr}],execute:function(){var I,C,L,S,N,A,M,F,D,k,z,O,x,H,j,R,G,P;a._RF.push({},"dbedcTlseZDMaAxug16qFYi","ListItem",void 0);var B=s.ccclass,W=s.property,U=s.disallowMultiple,V=s.executionOrder,Z=t("SelectedType_ListItem",function(t){return t[t.NONE=0]="NONE",t[t.TOGGLE=1]="TOGGLE",t[t.SWITCH=2]="SWITCH",t}({}));t("ListItem",(I=B("ListItem"),C=U(),L=V(-5001),S=W({type:l,tooltip:E}),N=W({type:c,tooltip:E}),A=W({type:u(Z),tooltip:E}),M=W({type:c,tooltip:E,visible:function(){return this.selectedMode>Z.NONE}}),F=W({type:d,tooltip:E,visible:function(){return this.selectedMode==Z.SWITCH}}),D=W({tooltip:E}),I(k=C(k=L(((P=function(t){function e(){for(var e,n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return e=t.call.apply(t,[this].concat(o))||this,i(e,"icon",O,r(e)),i(e,"title",x,r(e)),i(e,"selectedMode",H,r(e)),i(e,"selectedFlag",j,r(e)),i(e,"selectedSpriteFrame",R,r(e)),e._unselectedSpriteFrame=null,i(e,"adaptiveSize",G,r(e)),e._selected=!1,e._btnCom=void 0,e.list=void 0,e._eventReg=!1,e.listId=void 0,e._emmitMap=void 0,e._objTapMap=void 0,e._tweenTargetList=void 0,e.data=void 0,e.isFirstEnter=!0,e.hasDestory=void 0,e.scriptName=void 0,e.needRefreshListOnEnter=!0,e.timeoutIdArr=void 0,e.intervalIdArr=void 0,e}n(e,t);var a=e.prototype;return a.__preload=function(){var t=this;t.ctor_b(),t.ctor(),t.ctor_a()},a.onLoad=function(){if(this.scriptName=h.getClassName(this),this.selectedMode==Z.SWITCH){var t=this.selectedFlag.getComponent(l);this._unselectedSpriteFrame=t.spriteFrame}},a.onEnable=function(){this.__doEnter()},a.onDisable=function(){this.__dispose()},a.ctor_b=function(){},a.ctor=function(){},a.ctor_a=function(){},a.onEnter_b=function(){},a.onEnter=function(){},a.onFirstEnter=function(){},a.onEnter_a=function(){},a.dchg_b=function(){},a.dchg=function(){},a.dchg_a=function(){},a.onExit_b=function(){},a.onExit=function(){},a.onExit_a=function(){},a.onEmitter=function(t,e){var n=this;w.on(t,e,n),n._emmitMap||(n._emmitMap={}),n._emmitMap[t]=e},a.unEmitter=function(t,e){w.off(t,e,this)},a.emit=function(t,e){w.emit(t,e)},a.setData=function(t){var e=this;e.data!=t&&(e.data=t,e.dchg_b(),e.dchg(),e.dchg_a())},a.__doEnter=function(){var t=this;t.hasDestory||(t.addListener(),t.onEnter_b(),t.onEnter(),t.isFirstEnter&&(t.isFirstEnter=!1,t.onFirstEnter()),t.onEnter_a(),t.refreshAllList())},a.addListener=function(){var t=this;for(var e in t._objTapMap={},t){var n=t[e];if(n){var i="_tap_"+e;if(t[i]&&(n instanceof f||n instanceof c)){var r=c.EventType.TOUCH_END,o=n instanceof f?n.node:n;o.on(r,t.onNodeClick,t),t._objTapMap[i+"&"+r]=o}}}},a.onNodeClick=function(t){y.inst.playClickSound(),this["_tap_"+t.currentTarget.name](t)},a.refreshAllList=function(){var t=this;if(t.needRefreshListOnEnter)for(var e in t){if(t[e])t["_data_"+e]&&t.refreshList(e)}},a.refreshList=function(t){var e=this,n=e[t];if(!n)return console.warn("找不到id为"+t+"的列表");var i=n.getComponent("List");if(!i)return console.warn("列表"+t+"没有绑定List脚本");i.nodeName=t;var r=i.renderEvent;if(r.target=e.node,r.component=e.scriptName,r.handler="__onListRender",0!=i.selectedMode){var o=i.selectedEvent;o.target=e.node,o.component=e.scriptName,o.handler="__onSelectEvent"}if(3==i.slideMode){var a=i.pageChangeEvent;a.target=e.node,a.component=e.scriptName,a.handler="__onPageChangeEvent"}var s=e["_data_"+t]();i.dataList=s||[]},a.__onListRender=function(t,n){var i=t.getComponent(e),r=i.list.dataList[n];i.setData(r)},a.__onSelectEvent=function(t,n,i,r){var o=t.getComponent(e),a=o.list.nodeName;this["_select_"+a]&&this["_select_"+a](o.data,n,i)},a.__onPageChangeEvent=function(t,e){var n=t.nodeName;this["_pageChange_"+n]&&this["_pageChange_"+n](e)},a.getTween=function(t){return this._tweenTargetList||(this._tweenTargetList=[]),-1==this._tweenTargetList.indexOf(t)&&this._tweenTargetList.push(t),p(t)},a.rmTween=function(t){m.stopAllByTarget(t)},a.rmAllTweens=function(){if(this._tweenTargetList)for(var t=0;t<this._tweenTargetList.length;t++)this.rmTween(this._tweenTargetList[t]);this._tweenTargetList=null},a.setTimeout=function(t){function e(e,n){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(t,e){var n=this;this.timeoutIdArr||(this.timeoutIdArr=[]);var i=setTimeout((function(){t.call(n)}),e);return this.timeoutIdArr.push(i),i})),a.setInterval=function(t){function e(e,n){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(t,e){var n=this;this.intervalIdArr||(this.intervalIdArr=[]);var i=setInterval((function(){t.call(n)}),e);return this.intervalIdArr.push(i),i})),a.clearAllTimeoutOrInterval=function(){var t=this;if(t.timeoutIdArr){for(var e=0;e<t.timeoutIdArr.length;e++)clearTimeout(t.timeoutIdArr[e]);t.timeoutIdArr=null,console.log("清除timeoutIdArr: "+t.scriptName)}if(t.intervalIdArr){for(var n=0;n<t.intervalIdArr.length;n++)clearInterval(t.intervalIdArr[n]);t.intervalIdArr=null,console.log("清除intervalIdArr: "+t.scriptName)}},a.destory=function(){var t=this;t.hasDestory||(t.node.destroy(),t.hasDestory=!0)},a.__dispose=function(){var t=this;if(t._emmitMap){for(var e in t._emmitMap)t.unEmitter(e,t._emmitMap[e]);t._emmitMap=null}if(t._objTapMap){for(var n in t._objTapMap){var i=n.split("&"),r=(i[0],i[1]);t._objTapMap[n].off(r,t.onNodeClick,t)}t._objTapMap=null}t.clearAllTimeoutOrInterval(),t.rmAllTweens(),t.onExit_b(),t.onExit(),t.onExit_a()},a.registerEvent=function(){this._eventReg||(this.btnCom&&this.list.selectedMode>0&&this.btnCom.clickEvents.unshift(this.createEvt(this,"onClickThis")),this.adaptiveSize&&this.node.on(c.EventType.SIZE_CHANGED,this.onSizeChange,this),this._eventReg=!0)},a.onSizeChange=function(){this.list._onItemAdaptive(this.node)},a.createEvt=function(t,e,n){if(void 0===n&&(n=null),t.isValid){t.comName=t.comName||h.getClassName(t);var i=new _;return i.target=n||t.node,i.component=t.comName,i.handler=e,i}},a.showAni=function(t,e,n){var i,r=this,o=r.node.getComponent(v);switch(t){case 0:i=r.getTween(r.node).to(.2,{scale:new g(.7,.7)}).by(.3,{position:new g(0,2*o.height)});break;case 1:i=r.getTween(r.node).to(.2,{scale:new g(.7,.7)}).by(.3,{position:new g(2*o.width,0)});break;case 2:i=r.getTween(r.node).to(.2,{scale:new g(.7,.7)}).by(.3,{position:new g(0,-2*o.height)});break;case 3:i=r.getTween(r.node).to(.2,{scale:new g(.7,.7)}).by(.3,{position:new g(-2*o.width,0)});break;default:i=r.getTween(r.node).to(.3,{scale:new g(.1,.1)})}(e||n)&&i.call((function(){if(n){r.list._delSingleItem(r.node);for(var t=r.list.displayData.length-1;t>=0;t--)if(r.list.displayData[t].id==r.listId){r.list.displayData.splice(t,1);break}}e()})),i.start()},a.onClickThis=function(){this.list.selectedId=this.listId},a.onDestroy=function(){this.node.off(c.EventType.SIZE_CHANGED,this.onSizeChange,this)},o(e,[{key:"selected",get:function(){return this._selected},set:function(t){if(this._selected=t,this.selectedFlag)switch(this.selectedMode){case Z.TOGGLE:this.selectedFlag.active=t;break;case Z.SWITCH:var e=this.selectedFlag.getComponent(l);e&&(e.spriteFrame=t?this.selectedSpriteFrame:this._unselectedSpriteFrame)}}},{key:"btnCom",get:function(){return this._btnCom||(this._btnCom=this.node.getComponent(b)||this.node.getComponent(T)),this._btnCom}}],[{key:"__className",get:function(){return h.getClassName(this)}}]),e}(f)).prefabUrl="",O=e((z=P).prototype,"icon",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=e(z.prototype,"title",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=e(z.prototype,"selectedMode",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Z.NONE}}),j=e(z.prototype,"selectedFlag",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=e(z.prototype,"selectedSpriteFrame",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G=e(z.prototype,"adaptiveSize",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),k=z))||k)||k)||k));a._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./debug-view-runtime-control.ts","./Main.ts","./BaseEnum.ts","./BaseUtil.ts","./Emmiter.ts","./ModuleCfgInfo.ts","./ScaleMode.ts","./FileIOHandler.ts","./ModuleMgr.ts","./ResMgr.ts","./SceneMgr.ts","./SoundMgr.ts","./SubLayerMgr.ts","./TickMgr.ts","./WebFileHandler.ts","./ButtonPlus.ts","./ImgLoader.ts","./List.ts","./ListItem.ts","./Sp.ts","./JuHuaDlg.ts","./UIComp.ts","./UIDlg.ts","./UILayer.ts","./UIMenu.ts","./UIMsg.ts","./UIScene.ts","./AStar.ts","./Grid.ts","./Nodes.ts","./TestAStar.ts","./CONST.ts","./Interface.ts","./MapMgr.ts","./UT.ts","./MessageTip.ts","./MapThingIR.ts","./PathIR.ts","./PathSizeIR.ts","./MapEditorLayer.ts","./MapEditorScene.ts","./ColorGrid.ts","./ComboBoxComp.ts","./ComboBoxContainerComp.ts","./ComboBoxItemComp.ts","./MapScrollComp.ts","./MapThingPropertyComp.ts","./mapThingSelect.ts","./CameraCtrl.ts","./EntityCtrl.ts","./JoyStickCtrl.ts","./RunDemoCtrl.ts","./HelpDlg.ts","./InvalidImportDlg.ts","./JoyStickDlg.ts","./TestAstarDlg.ts","./Player.ts","./EntityPrefabs.ts","./MapGridFactory.ts","./MapThingFactory.ts","./AStarRoadSeeker.ts","./AstarHoneycombRoadSeeker.ts","./BinaryTreeNode.ts","./IRoadSeeker.ts","./MapRoadUtils.ts","./PathFindingAgent.ts","./PathOptimize.ts","./PathQuadSeek.ts","./Point.ts","./RoadNode.ts","./rodeTest.mjs_cjs=&original=.js"],(function(){return{setters:[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/Main.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseUtil.ts","./SceneMgr.ts","./TickMgr.ts","./MapEditorScene.ts","./MapMgr.ts","./Emmiter.ts","./CONST.ts"],(function(n){var t,e,i,o,c,s,r,a,u,l,g,p,M,f;return{setters:[function(n){t=n.inheritsLoose},function(n){e=n.cclegacy,i=n._decorator,o=n.sys,c=n.director,s=n.Node,r=n.Component},function(n){a=n.BaseUT},function(n){u=n.SceneMgr},function(n){l=n.TickMgr},function(n){g=n.MapEditorScene},function(n){p=n.MapMgr},function(n){M=n.emmiter},function(n){f=n.CONST}],execute:function(){var d;e._RF.push({},"b6d2eYpyWlINadRQvfSwzwk","Main",void 0);var S=i.ccclass;n("Main",S("Main")(d=function(n){function e(){return n.apply(this,arguments)||this}t(e,n);var i=e.prototype;return i.onLoad=function(){globalThis.BaseUT=a,globalThis.MapMgr=p,l.inst.mainNode=this,p.inst.version="1.0.0",console.log("系统相关环境变量: "),console.log(o);c.getScene().getChildByName("Canvas").on(s.EventType.MOUSE_UP,this.onClickStage,this),u.inst.run(g)},i.onClickStage=function(n){M.emit(f.GEVT.ClickStage)},i.update=function(n){l.inst.onTick(n)},e}(r))||d);e._RF.pop()}}}));

System.register("chunks:///_virtual/MapEditorLayer.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UILayer.ts","./MapScrollComp.ts","./MapMgr.ts","./List.ts","./CONST.ts","./JuHuaDlg.ts","./ResMgr.ts","./BaseUtil.ts","./MapThingPropertyComp.ts","./HelpDlg.ts","./MessageTip.ts","./PathFindingAgent.ts","./JoyStickDlg.ts","./RunDemoCtrl.ts","./TestAstarDlg.ts","./UT.ts"],(function(t){var e,i,a,r,n,o,p,l,s,u,g,c,m,_,h,d,b,y,f,M,T,w,S,v,D,z,C,P,I,E,G,L;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,a=t.initializerDefineProperty,r=t.assertThisInitialized,n=t.asyncToGenerator,o=t.regeneratorRuntime},function(t){p=t.cclegacy,l=t._decorator,s=t.Label,u=t.Button,g=t.Node,c=t.Prefab,m=t.Vec3,_=t.EventMouse,h=t.profiler,d=t.ScrollView},function(t){b=t.UILayer},function(t){y=t.MapScrollComp},function(t){f=t.MapMgr},function(t){M=t.List},function(t){T=t.CONST},function(t){w=t.JuHuaDlg},function(t){S=t.ResMgr},function(t){v=t.BaseUT},function(t){D=t.MapThingPropertyComp},function(t){z=t.HelpDlg},function(t){C=t.MessageTip},function(t){P=t.default},function(t){I=t.JoyStickDlg},function(t){E=t.RunDemoCtrl},function(t){G=t.TestAstarDlg},function(t){L=t.UT}],execute:function(){var x,U,N,V,A,O,k,R,J,B,F,H,W,j,q,K,Q,X,Y,Z,$,tt,et,it,at,rt,nt,ot,pt,lt,st,ut,gt,ct,mt,_t,ht,dt,bt,yt,ft,Mt,Tt,wt,St,vt,Dt,zt,Ct,Pt,It,Et,Gt,Lt,xt,Ut,Nt,Vt,At,Ot,kt,Rt;p._RF.push({},"75368kdEdpBArp/O6WgIFaA","MapEditorLayer",void 0);var Jt=l.ccclass,Bt=l.property;t("MapEditorLayer",(x=Jt("MapEditorLayer"),U=Bt({type:s}),N=Bt({type:u}),V=Bt({type:u}),A=Bt({type:u}),O=Bt({type:u}),k=Bt({type:u}),R=Bt({type:u}),J=Bt({type:u}),B=Bt({type:u}),F=Bt({type:u}),H=Bt({type:u}),W=Bt({type:u}),j=Bt({type:s}),q=Bt({type:s}),K=Bt({type:s}),Q=Bt({type:s}),X=Bt({type:s}),Y=Bt({type:s}),Z=Bt({type:s}),$=Bt({type:y,tooltip:"编辑器地图滚动组件"}),tt=Bt({type:D}),et=Bt({type:g}),it=Bt({type:g}),at=Bt({type:g}),rt=Bt({type:M}),nt=Bt({type:M}),ot=Bt({type:M}),pt=Bt({type:g}),lt=Bt({type:c}),x(((Rt=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,a(e,"lbl_version",gt,r(e)),a(e,"btn_create",ct,r(e)),a(e,"btn_open",mt,r(e)),a(e,"btn_save",_t,r(e)),a(e,"btn_runDemo",ht,r(e)),a(e,"btn_testAstar",dt,r(e)),a(e,"btn_showGrid",bt,r(e)),a(e,"btn_showPath",yt,r(e)),a(e,"btn_showMapThing",ft,r(e)),a(e,"btn_profiler",Mt,r(e)),a(e,"btn_resetScale",Tt,r(e)),a(e,"btn_help",wt,r(e)),a(e,"lbl_grid",St,r(e)),a(e,"lbl_path",vt,r(e)),a(e,"lbl_mapthing",Dt,r(e)),a(e,"lbl_mapSize",zt,r(e)),a(e,"lbl_mapScale",Ct,r(e)),a(e,"lbl_mousePos",Pt,r(e)),a(e,"lbl_runDemo",It,r(e)),a(e,"mapScrollComp",Et,r(e)),a(e,"mapThingPropertyComp",Gt,r(e)),a(e,"grp_editPathSize",Lt,r(e)),a(e,"grp_editPath",xt,r(e)),a(e,"grp_editMathing",Ut,r(e)),a(e,"list_mapThing",Nt,r(e)),a(e,"list_pathSize",Vt,r(e)),a(e,"list_path",At,r(e)),a(e,"grp_dragMapthing",Ot,r(e)),a(e,"mapThingComp",kt,r(e)),e.mapMgr=void 0,e._selectIdx=void 0,e._mapThingComp=void 0,e._drawMapThingData=void 0,e._curLocation=void 0,e._listPathDataList=void 0,e._tid=void 0,e}i(e,t);var p=e.prototype;return p.onEnter=function(){var t=this;t.mapMgr=f.inst,t.onEmitter(T.GEVT.ImportMapJson,t.onImportMapJson),t.onEmitter(T.GEVT.UpdateMapScale,t.updateMapScale),t.onEmitter(T.GEVT.DragMapThingStart,t.onDragMapThingStart),t.onEmitter(T.GEVT.UpdateMousePos,t.updateMousePos),t.lbl_version.string="version: "+t.mapMgr.version,t._selectIdx=1,t.list_pathSize.selectedId=0,t.showEditOperate()},p.showEditOperate=function(){var t=this;t.grp_editPathSize.active=0==t._selectIdx,t.grp_editPath.active=1==t._selectIdx,t.grp_editMathing.active=2==t._selectIdx,1==t._selectIdx?t.emit(T.GEVT.ChangeGridType,{gridType:-1!=t.list_path.selectedId?t._listPathDataList[t.list_path.selectedId].gridType:T.GridType.GridType_none}):2==t._selectIdx&&t.emit(T.GEVT.ChangeGridType,{gridType:T.GridType.GridType_mapThing})},p.onImportMapJson=function(){var t=n(o().mark((function t(e){var i,a,r;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=this,t.next=3,w.show();case 3:return a=t.sent,(r=i.list_mapThing.getComponent(d)).stopAutoScroll(),r.scrollToTop(),S.inst.decRefLocalImg(),i.refreshList("list_mapThing"),t.next=11,i.mapScrollComp.onImportMapJson(e);case 11:return i.mapThingPropertyComp.init(e),a.close(),i.updateMapInfo(),i.initEvent(),t.next=17,new Promise((function(t,e){i.setTimeout((function(){S.inst.relaseAllLocal(),t()}),500)}));case 17:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),p.updateMapInfo=function(){var t=this;t.lbl_mapSize.string="地图宽高："+t.mapMgr.mapWidth+", "+t.mapMgr.mapHeight,t.updateMapScale()},p.updateMapScale=function(){var t=this,e=t.mapScrollComp.mapScale;t.lbl_mapScale.string="地图缩放比例："+e.toFixed(2),t._mapThingComp&&t._mapThingComp.setScale(new m(e,e,e))},p.updateMousePos=function(t){var e=this,i=t.localUIPos,a=e.mapMgr.pos2Grid(i.x,i.y);e.lbl_mousePos.string="鼠标所在行列: "+a.row+", "+a.col+"\nx: "+a.col*e.mapMgr.cellSize+", y: "+a.row*e.mapMgr.cellSize},p.initEvent=function(){var t=this;t.node.on(g.EventType.MOUSE_DOWN,t.onMouseDown,t),t.node.on(g.EventType.MOUSE_MOVE,t.onMouseMove,t)},p._data_list_path=function(){var t=[{gridType:T.GridType.GridType_walk,desc:"可行走点"},{gridType:T.GridType.GridType_start,desc:"起始地点"},{gridType:T.GridType.GridType_WaterVerts,desc:"落水点"}];return this._listPathDataList=t,t},p._data_list_pathSize=function(){return[{radius:10,size:0},{radius:15,size:1},{radius:20,size:3},{radius:25,size:5},{radius:30,size:7},{radius:35,size:9}]},p._data_list_mapThing=function(){var t=[],e=this.mapMgr.mapThingUrlMap;for(var i in e)t.push({thingName:i,nativePath:e[i]});return t},p._select_list_path=function(t,e,i){this.emit(T.GEVT.ChangeGridType,{gridType:t.gridType})},p._select_list_pathSize=function(t,e,i){this.emit(T.GEVT.ChangeGridSize,{range:t.size})},p._select_list_mapThing=function(t,e,i){this.newDragMapThing(t.nativePath),this._drawMapThingData={url:t.nativePath,thingName:t.thingName}},p.onDragMapThingStart=function(t){this.newDragMapThing(t.url),this._drawMapThingData={url:t.url,thingName:t.thingName,taskId:t.taskId,groupId:t.groupId,type:t.type,groupIdStr:t.groupIdStr}},p.newDragMapThing=function(t){var e=this;e.mapMgr.isForbidDrawGrid=!0,e.disposeDragMapThing();var i=e._mapThingComp=e.mapMgr.getMapThingComp(e.mapThingComp,t),a=e.mapScrollComp.mapScale,r=v.getMousePos(e._curLocation);i.setPosition(r.x,r.y),i.setParent(e.grp_dragMapthing),i.setScale(new m(a,a,a))},p.disposeDragMapThing=function(){var t=this;t._mapThingComp&&(t._mapThingComp.destroy(),t._mapThingComp=null),t._drawMapThingData=null},p.onMouseDown=function(t){var e=this;if(e._curLocation=t.getLocation(),t.getButton()==_.BUTTON_LEFT&&!e.mapMgr.isPressSpace&&e._mapThingComp){if(e.mapScrollComp.isInEditArea){var i=v.getMousePos(e._curLocation),a=e.mapScrollComp.scrollMapUITranstorm.convertToNodeSpaceAR(new m(i.x,i.y,0));e.emit(T.GEVT.DragMapThingDown,{x:a.x,y:a.y,url:e._drawMapThingData.url,thingName:e._drawMapThingData.thingName,taskId:e._drawMapThingData.taskId||0,groupId:e._drawMapThingData.groupId||0,groupIdStr:e._drawMapThingData.groupIdStr||0,type:e._drawMapThingData.type||0,isByDrag:!0})}e.disposeDragMapThing(),e.clearTimeout(e._tid),e._tid=e.setTimeout((function(){e.mapMgr.isForbidDrawGrid=!1}),200)}},p.onMouseMove=function(t){var e=this;if(e._curLocation=t.getLocation(),e._mapThingComp){var i=v.getMousePos(e._curLocation);e._mapThingComp.setPosition(i.x,i.y)}},p._tap_btn_create=function(){C.show({msg:"功能开发中....."})},p._tap_btn_open=function(){this.mapMgr.openMap()},p._tap_btn_save=function(){this.mapMgr.exportJson()},p._tap_btn_profiler=function(){h.isShowingStats()?h.hideStats():h.showStats()},p._tap_btn_help=function(){z.show()},p.select_toogle_group=function(t){var e=this,i=t.node,a=t.node.parent.children.indexOf(i);-1!=a&&e._selectIdx!=a&&(e._selectIdx=a,e.showEditOperate())},p._tap_btn_showGrid=function(){var t=this;t.lbl_grid.string="显示网格"==t.lbl_grid.string?"隐藏网格":"显示网格",t.mapScrollComp.graphicsLine.node.active=!t.mapScrollComp.graphicsLine.node.active},p._tap_btn_showPath=function(){var t=this;t.lbl_path.string="显示路点"==t.lbl_path.string?"隐藏路点":"显示路点",t.mapScrollComp.grp_colorGrid.active=!t.mapScrollComp.grp_colorGrid.active},p._tap_btn_showMapThing=function(){var t=this;t.lbl_mapthing.string="显示物件"==t.lbl_mapthing.string?"隐藏物件":"显示物件",t.mapScrollComp.mapThingFactory.refSelfVsb()},p._tap_btn_resetScale=function(){this.mapScrollComp.setMapScale(1),this.updateMapScale()},p._tap_btn_runDemo=function(){var t=this;if("关闭运行"==t.lbl_runDemo.string)return t.lbl_runDemo.string="测试运行",t.mapMgr.isRunningDemoMode=!1,L.closeDlgByName(["JoyStickDlg"]),E.inst.clear(),void v.changeMouseCursor("auto");var e=t.mapMgr.getMapData();e?(t.lbl_runDemo.string="关闭运行",t.mapMgr.isRunningDemoMode=!0,v.changeMouseCursor("url('/assets/resources/native/34/341c4534-3c0a-4dd7-adc1-1c235faf3c20.png'),auto"),I.show(),console.log("地图数据"),console.log(e),t.mapScrollComp.setMapScale(1),t.updateMapScale(),P.inst.init(e),E.inst.init(t.mapScrollComp.grp_scrollMap,t.mapScrollComp.grp_entity,v.getSize(t.mapScrollComp.grp_mapLayer))):C.show({msg:"地图数据为空"})},p._tap_btn_testAstar=function(){var t=this.mapMgr.getMapData();t?(P.inst.init(t),G.show()):C.show({msg:"地图数据为空"})},e}(b)).prefabUrl="prefab/mapEditor/MapEditorLayer",gt=e((ut=Rt).prototype,"lbl_version",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ct=e(ut.prototype,"btn_create",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mt=e(ut.prototype,"btn_open",[V],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_t=e(ut.prototype,"btn_save",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ht=e(ut.prototype,"btn_runDemo",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dt=e(ut.prototype,"btn_testAstar",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bt=e(ut.prototype,"btn_showGrid",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yt=e(ut.prototype,"btn_showPath",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ft=e(ut.prototype,"btn_showMapThing",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mt=e(ut.prototype,"btn_profiler",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tt=e(ut.prototype,"btn_resetScale",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wt=e(ut.prototype,"btn_help",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),St=e(ut.prototype,"lbl_grid",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vt=e(ut.prototype,"lbl_path",[q],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dt=e(ut.prototype,"lbl_mapthing",[K],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zt=e(ut.prototype,"lbl_mapSize",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ct=e(ut.prototype,"lbl_mapScale",[X],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pt=e(ut.prototype,"lbl_mousePos",[Y],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),It=e(ut.prototype,"lbl_runDemo",[Z],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Et=e(ut.prototype,"mapScrollComp",[$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gt=e(ut.prototype,"mapThingPropertyComp",[tt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lt=e(ut.prototype,"grp_editPathSize",[et],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xt=e(ut.prototype,"grp_editPath",[it],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ut=e(ut.prototype,"grp_editMathing",[at],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nt=e(ut.prototype,"list_mapThing",[rt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Vt=e(ut.prototype,"list_pathSize",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),At=e(ut.prototype,"list_path",[ot],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ot=e(ut.prototype,"grp_dragMapthing",[pt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),kt=e(ut.prototype,"mapThingComp",[lt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),st=ut))||st));p._RF.pop()}}}));

System.register("chunks:///_virtual/MapEditorScene.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIScene.ts","./ModuleMgr.ts","./MapEditorLayer.ts"],(function(e){var t,r,n,o,i,c,s;return{setters:[function(e){t=e.inheritsLoose},function(e){r=e.cclegacy,n=e._decorator,o=e.profiler},function(e){i=e.UIScene},function(e){c=e.registerModule},function(e){s=e.MapEditorLayer}],execute:function(){var a;r._RF.push({},"bc8f5ANVUhJsoqjBU5/wdS2","MapEditorScene",void 0);var u=n.ccclass,p=(n.property,e("MapEditorScene",u("MapEditorScene")(a=function(e){function r(){return e.apply(this,arguments)||this}t(r,e);var n=r.prototype;return n.ctor=function(){this.mainClassLayer=s;for(var e=this.subLayerMgr,t=[],r=0;r<t.length;r++)e.register(t[r])},n.onEnter=function(){o.hideStats()},r}(i))||a));c(p,["ui/grid"]),r._RF.pop()}}}));

System.register("chunks:///_virtual/MapGridFactory.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIComp.ts","./MapMgr.ts","./ColorGrid.ts","./CONST.ts"],(function(r){var a,i,e,o,t,p,n,c,d,g,h,T;return{setters:[function(r){a=r.applyDecoratedDescriptor,i=r.inheritsLoose,e=r.initializerDefineProperty,o=r.assertThisInitialized},function(r){t=r.cclegacy,p=r._decorator,n=r.Prefab,c=r.instantiate},function(r){d=r.UIComp},function(r){g=r.MapMgr},function(r){h=r.ColorGrid},function(r){T=r.CONST}],execute:function(){var l,s,M,f,G;t._RF.push({},"f32f0FYwI1Lw6oM6B1ks0rm","MapGridFactory",void 0);var y=p.ccclass,m=p.property;r("MapGridFactory",(l=y("MapGridFactory"),s=m({type:n}),l((G=a((f=function(r){function a(){for(var a,i=arguments.length,t=new Array(i),p=0;p<i;p++)t[p]=arguments[p];return a=r.call.apply(r,[this].concat(t))||this,e(a,"colorGridPrefab",G,o(a)),a.mapMgr=void 0,a._graphicsDic=void 0,a._colorDic=void 0,a._redrawTempMap=void 0,a}i(a,r);var t=a.prototype;return t.onEnter=function(){var r=this;r.mapMgr=g.inst,r.onEmitter(T.GEVT.ReDarwGraphic,r.onReDarwGraphic)},t.init=function(r){var a=this;a._graphicsDic={},a._colorDic={};for(var i=r.mapData,e=i.walkList||[],o=0;o<e.length;o++)for(var t=e[o],p=0;p<t.length;p++)if(0!=t[p]){var n=void 0;1==t[p]&&(n=T.GridType.GridType_walk),a.addGrid(n,{col:p,row:o})}function c(r,i){for(var e=0;e<i.length;e++){var o=a.mapMgr.idx2Grid(i[e]);a.addGrid(r,{col:o.col,row:o.row})}}c(T.GridType.GridType_start,i.startList||[]),c(T.GridType.GridType_WaterVerts,i.waterVertList||[]),i.mapThingList&&i.mapThingList.forEach((function(r){var i={};i.x=r.x,i.y=r.y,a.mapMgr.curMapThingInfo=i,r.area&&c(T.GridType.GridType_mapThing+T.MapThingTriggerType.MapThingTrigger_light,r.area),r.unWalkArea&&c(T.GridType.GridType_mapThing+T.MapThingTriggerType.MapThingTrigger_unWalk,r.unWalkArea),r.keyManStandArea&&c(T.GridType.GridType_mapThing+T.MapThingTriggerType.MapThingTrigger_keyManStand,r.keyManStandArea),r.grassArea&&c(T.GridType.GridType_mapThing+T.MapThingTriggerType.MapThingTrigger_grass,r.grassArea)}))},t.onAddNodeHandler=function(r){this.addOrRmRangeGrid(r,!0)},t.onRemoveNodeHandler=function(r){this.addOrRmRangeGrid(r,!1)},t.addOrRmRangeGrid=function(r,a){var i=this,e=i.mapMgr.gridRange,o=i.mapMgr.pos2Grid(r.x,r.y),t=i.mapMgr.gridType;if(i._redrawTempMap={},0==e)a?i.addGrid(t,o):i.removeGrid(t,o);else for(var p=i.mapMgr.totCol,n=i.mapMgr.totRow,c=Math.max(0,o.col-e),d=Math.min(p-1,o.col+e),g=Math.max(0,o.row-e),h=Math.min(n-1,o.row+e),T=c;T<=d;T++)for(var l=g;l<=h;l++)a?i.addGrid(t,{col:T,row:l}):i.removeGrid(t,{col:T,row:l});a||i.drawGraphic()},t.addGrid=function(r,a){var i=this,e=i.mapMgr,o=a.col+"_"+a.row,t=Math.floor(a.col/e.areaGraphicSize),p=Math.floor(a.row/e.areaGraphicSize),n=e.gridDataMap,c=t+"_"+p,d=r;if(r.indexOf(T.GridType.GridType_mapThing)>-1){var g=e.curMapThingInfo;if(!g||g.type==T.MapThingType.bevel)return;var h=Math.floor(g.x)+"_"+Math.floor(g.y);d=r==T.GridType.GridType_mapThing?r+e.curMapThingTriggerType:r,r=r==T.GridType.GridType_mapThing?r+e.curMapThingTriggerType+"_"+h:r+"_"+h}if(n[r]||(n[r]={}),n[r][c]||(n[r][c]={}),!n[r][c][o]){n[r][c][o]=o;var l=i._colorDic[r]=e.getColorByType(d),s=e.cellSize,M=r+"_"+c;i.getGraphic(M).drawRect(l,a.col*s,a.row*s,s,s)}},t.removeGrid=function(r,a){var i=this.mapMgr,e=a.col+"_"+a.row;if(r.indexOf(T.GridType.GridType_mapThing)>-1){var o=i.curMapThingInfo;if(!o)return;var t=Math.floor(o.x)+"_"+Math.floor(o.y);r=r+i.curMapThingTriggerType+"_"+t}var p=i.gridDataMap,n=Math.floor(a.col/i.areaGraphicSize)+"_"+Math.floor(a.row/i.areaGraphicSize);p[r]&&p[r][n]&&p[r][n][e]&&(delete p[r][n][e],this._redrawTempMap[r+"|"+n]=r+"_"+n)},t.onReDarwGraphic=function(r){this._redrawTempMap=r.redrawDic,this.drawGraphic()},t.drawGraphic=function(){var r=this,a=r.mapMgr.gridDataMap,i=r.mapMgr.cellSize;for(var e in r._redrawTempMap){var o=e.split("|"),t=o[0],p=o[1],n=r._redrawTempMap[e],c=r.getGraphic(n);c.clear();var d=r._colorDic[t],g=a[t][p];if(g)for(var h in g){var T=h.split("_");c.drawRect(d,Number(T[0])*i,Number(T[1])*i,i,i)}}},t.getGraphic=function(r){var a=this;if(!a._graphicsDic[r]){var i=c(a.colorGridPrefab);i.setParent(a.node);var e=i.getComponent(h);a._graphicsDic[r]=e}return a._graphicsDic[r]},a}(d)).prototype,"colorGridPrefab",[s],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M=f))||M));t._RF.pop()}}}));

System.register("chunks:///_virtual/MapMgr.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Emmiter.ts","./FileIOHandler.ts","./CONST.ts","./BaseUtil.ts","./ImgLoader.ts","./InvalidImportDlg.ts"],(function(e){var r,i,t,a,n,s,p,o,g,h,l;return{setters:[function(e){r=e.createClass,i=e.asyncToGenerator,t=e.regeneratorRuntime},function(e){a=e.cclegacy,n=e.instantiate},function(e){s=e.emmiter},function(e){p=e.FileIOHandler},function(e){o=e.CONST},function(e){g=e.BaseUT},function(e){h=e.ImgLoader},function(e){l=e.InvalidImportDlg}],execute:function(){a._RF.push({},"cc9f7xHCA1EZIThSysIidSS","MapMgr",void 0),e("MapMgr",function(){function e(){this.version=void 0,this.mapFloorArr=void 0,this.mapslice=void 0,this.mapWidth=void 0,this.mapHeight=void 0,this.totCol=void 0,this.totRow=void 0,this.cellSize=void 0,this.gridRange=void 0,this.gridType=void 0,this.mapScale=void 0,this.areaGraphicSize=void 0,this.mapThingUrlMap=void 0,this.gridDataMap=void 0,this.mapThingMap=void 0,this.curMapThingInfo=void 0,this.isPressSpace=void 0,this.isPressCtrl=void 0,this.isForbidDrawGrid=void 0,this.bavelResStr="black.png",this.curMapThingTriggerType=void 0,this.triggerTypes=void 0,this.isRunningDemoMode=void 0}var a=e.prototype;return a.init=function(){var e=this;e.gridRange=0,e.gridType=o.GridType.GridType_none,e.curMapThingTriggerType=o.MapThingTriggerType.MapThingTrigger_light,e.triggerTypes=[{type:o.MapThingTriggerType.MapThingTrigger_light,desc:"触发发亮"},{type:o.MapThingTriggerType.MapThingTrigger_unWalk,desc:"不可行走"},{type:o.MapThingTriggerType.MapThingTrigger_keyManStand,desc:"犯人站立点"},{type:o.MapThingTriggerType.MapThingTrigger_grass,desc:"草丛范围点"}]},a.openMap=function(){var e=i(t().mark((function e(){var r,a,n,g,h,T,c,u,d,f,y,v;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return y=function(){return(y=i(t().mark((function e(r){var i,n,s,p,o,l,y,v,m,M,x,_,k,G;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("directory"!==r.kind){e.next=34;break}if(i=r.children||[],"floor"!==r.name){e.next=13;break}n=0;case 4:if(!(n<i.length)){e.next=11;break}return i[n].rootName="floor",e.next=8,f(i[n]);case 8:n++,e.next=4;break;case 11:e.next=32;break;case 13:if("thing"!==r.name){e.next=24;break}s=0;case 15:if(!(s<i.length)){e.next=22;break}return i[s].rootName="thing",e.next=19,f(i[s]);case 19:s++,e.next=15;break;case 22:e.next=32;break;case 24:p=r.children,o=0;case 26:if(!(o<p.length)){e.next=32;break}return e.next=29,f(p[o]);case 29:o++,e.next=26;break;case 32:e.next=70;break;case 34:if("floor"!=r.rootName){e.next=46;break}return l=r.name.split(".")[0].split("_"),y=Number(l[1]),v=Number(l[0]),e.next=40,r.getFile();case 40:m=e.sent,c||(c=v),c==v&&T++,g.push({col:y,row:v,sourceName:r.name,nativePath:a.createObjectURL(m)}),e.next=52;break;case 46:if("thing"!=r.rootName){e.next=52;break}if(-1!=r.name.indexOf("_")){e.next=52;break}return e.next=50,r.getFile();case 50:M=e.sent,h[r.name]=a.createObjectURL(M);case 52:if("mapData.json"!=r.name){e.next=62;break}return e.next=55,r.getFile();case 55:return x=e.sent,e.next=58,a.readLocalText(x);case 58:_=e.sent,u=JSON.parse(_),e.next=70;break;case 62:if("thingPram.json"!=r.name){e.next=70;break}return e.next=65,r.getFile();case 65:return k=e.sent,e.next=68,a.readLocalText(k);case 68:G=e.sent,d=JSON.parse(G);case 70:case"end":return e.stop()}}),e)})))).apply(this,arguments)},f=function(e){return y.apply(this,arguments)},r=this,a=p.inst,e.next=6,a.getDirTreeMap();case 6:if(n=e.sent,console.log(n),n){e.next=10;break}return e.abrupt("return");case 10:return g=[],h={},T=0,e.next=15,f(n);case 15:if(v="",u||(v+="mapData.json文件不存在|"),d||(v+="thingPram.json文件不存在|"),g.length||(v+="floor地图切片文件夹不存在|"),Object.keys(h).length||(v+="thing地图场景物件文件夹不存在|"),!v){e.next=23;break}return l.show({errorMsg:v}),e.abrupt("return");case 23:r.mapFloorArr=g,r.mapThingUrlMap=h,r.mapslice=T,r.mapFloorArr.sort((function(e,r){return e.row<r.row?-1:e.row>r.row||e.col>r.col?1:-1})),console.log(u,d),r.cellSize=u.cellSize||20,r.gridDataMap={},r.mapThingMap={},s.emit(o.GEVT.ImportMapJson,{mapData:u,thingPram:d});case 32:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),a.getColorByType=function(e){switch(e){case o.GridType.GridType_walk:return"#00FF00";case o.GridType.GridType_WaterVerts:return"#FF00FF";case o.GridType.GridType_start:return"#FFFF00";case o.GridType.GridType_mapThing+o.MapThingTriggerType.MapThingTrigger_light:return"#0000FF";case o.GridType.GridType_mapThing+o.MapThingTriggerType.MapThingTrigger_unWalk:return"#330000";case o.GridType.GridType_mapThing+o.MapThingTriggerType.MapThingTrigger_keyManStand:return"#CB00FF";case o.GridType.GridType_mapThing+o.MapThingTriggerType.MapThingTrigger_grass:return"#00FFFF";default:return"#000000"}},a.pos2Idx=function(e,r){var i=this,t=i.cellSize;Math.ceil(i.mapHeight/t);return r*Math.ceil(i.mapWidth/t)+e},a.pos2Grid=function(e,r){return{col:Math.floor(e/this.cellSize),row:Math.floor(r/this.cellSize)}},a.idx2Grid=function(e){var r=this,i=r.cellSize,t=(Math.ceil(r.mapHeight/i),Math.ceil(r.mapWidth/i)),a=Math.floor(e/t);return{col:e-a*t,row:a}},a.idx2Pos=function(e,r){var i=this,t=i.idx2Grid(e),a=r?i.cellSize/2:0;return{x:t.col*i.cellSize+a,y:t.row*i.cellSize+a}},a.getMapThingComp=function(e,r,i,t,a,s){void 0===i&&(i=.5),void 0===t&&(t=.5);var p=n(e);g.setPivot(p,i,t),g.setAlpha(p,.6);var o=p.getComponent(h);return o.ctx=s,o.loadComplete=function(e){var r=e.width,i=e.height;g.setSize(p,r,i),a&&a.call(s,r,i)},o.url=r,p},a.getMapThingCompByXY=function(e,r){return this.mapThingMap[Math.floor(e)+"_"+Math.floor(r)][1]},a.rmMapThingGrid=function(e){for(var r,i=this,t={},a=0;a<i.triggerTypes.length;a++){var n=i.triggerTypes[a].type,p=o.GridType.GridType_mapThing+n+"_"+e,g=i.gridDataMap[p];if(g)for(var h in g){var l=g[h];for(var T in l)delete i.gridDataMap[p][h][T],t[p+"|"+h]=p+"_"+h,r=!0}}r&&s.emit(o.GEVT.ReDarwGraphic,{redrawDic:t})},a.exportJson=function(){var e=this.getMapData();e&&p.inst.saveTextToLocal(JSON.stringify(e))},a.getMapData=function(){var e=this,r=e.gridDataMap;if(!r)return null;var i={};i.mapWidth=e.mapWidth,i.mapHeight=e.mapHeight,i.cellSize=e.cellSize,i.totRow=e.totRow,i.totCol=e.totCol,i.type=o.MapType.angle90,i.walkList=[],i.waterVertList=[],i.startList=[],i.mapThingList=[],i.borderList=[];var t=r[o.GridType.GridType_walk];if(t)for(var a=0;a<e.totRow;a++){var n=[];i.walkList.push(n);for(var s=0;s<e.totCol;s++){var p={x:Math.floor(s/e.areaGraphicSize),y:Math.floor(a/e.areaGraphicSize)},g=t[p.x+"_"+p.y];if(t&&g){var h=g?g[s+"_"+a]:null;n.push(null!=h?1:0)}else n.push(0)}}function l(t){var a=r[t];if(a)for(var n in a){var s=a[n];for(var p in s){var g=[];t==o.GridType.GridType_start?g=i.startList:t==o.GridType.GridType_WaterVerts&&(g=i.waterVertList);var h=p.split("_");g.push(e.pos2Idx(Number(h[0]),Number(h[1])))}}}if(l(o.GridType.GridType_start),l(o.GridType.GridType_WaterVerts),e.mapThingMap){var T=e.triggerTypes;for(var c in e.mapThingMap){var u=e.mapThingMap[c][0];u.area=[],u.unWalkArea=[],u.keyManStandArea=[],u.grassArea=[];for(var d=0;d<T.length;d++){var f=T[d].type,y=r[o.GridType.GridType_mapThing+f+"_"+Math.floor(u.x)+"_"+Math.floor(u.y)];if(y)for(var v in y){var m=y[v];for(var M in m){var x=M.split("_"),_=e.pos2Idx(Number(x[0]),Number(x[1]));f==o.MapThingTriggerType.MapThingTrigger_light&&u.area.push(_),f==o.MapThingTriggerType.MapThingTrigger_unWalk&&u.unWalkArea.push(_),f==o.MapThingTriggerType.MapThingTrigger_keyManStand&&u.keyManStandArea.push(_),f==o.MapThingTriggerType.MapThingTrigger_grass&&u.grassArea.push(_)}}}if(u.type==o.MapThingType.bevel){for(var k,G,b=null!=(k=null==(G=u.groupIdStr)?void 0:G.split(","))?k:[],S=[],F=0;F<b.length;F++)S.push(Number(b[F]));i.borderList.push({x:u.x,y:u.y,groupIdList:S})}else i.mapThingList.push(u)}}return i},r(e,null,[{key:"inst",get:function(){return this._inst||(this._inst=new e,this._inst.init()),this._inst}}]),e}())._inst=void 0,a._RF.pop()}}}));

System.register("chunks:///_virtual/MapRoadUtils.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Point.ts","./RoadNode.ts","./CONST.ts"],(function(t){var e,i,o,h,n;return{setters:[function(t){e=t.createClass},function(t){i=t.cclegacy},function(t){o=t.default},function(t){h=t.default},function(t){n=t.CONST}],execute:function(){i._RF.push({},"3dcb3d1Af1IZb60N42Cr73R","MapRoadUtils",void 0),t("default",function(){function t(){this._mapWidth=void 0,this._mapHeight=void 0,this._row=void 0,this._col=void 0,this._nodeWidth=void 0,this._nodeHeight=void 0,this._halfNodeWidth=void 0,this._halfNodeHeight=void 0,this._mapType=void 0,this._mapRoad=void 0}var i=t.prototype;return i.updateMapInfo=function(t,e,i,o,h){switch(this._mapWidth=t,this._mapHeight=e,this._nodeWidth=i,this._nodeHeight=o,this._halfNodeWidth=Math.floor(this._nodeWidth/2),this._halfNodeHeight=Math.floor(this._nodeHeight/2),this._mapType=h,this._mapType){case n.MapType.angle45:this._col=Math.ceil(t/this._nodeWidth),this._row=2*Math.ceil(e/this._nodeHeight),this._mapRoad=new d(this._row,this._col,this._nodeWidth,this._nodeHeight,this._halfNodeWidth,this._halfNodeHeight);break;case n.MapType.angle90:this._col=Math.ceil(t/this._nodeWidth),this._row=Math.ceil(e/this._nodeHeight),this._mapRoad=new r(this._row,this._col,this._nodeWidth,this._nodeHeight,this._halfNodeWidth,this._halfNodeHeight);break;case n.MapType.honeycomb:this._col=2*Math.ceil((this._mapWidth-this._nodeWidth/4)/(this._nodeWidth/4*6)),this._row=Math.ceil((this._mapHeight-this._nodeHeight/2)/this._nodeHeight),this._mapRoad=new s(this._row,this._col,this._nodeWidth,this._nodeHeight,this._halfNodeWidth,this._halfNodeHeight);break;case n.MapType.honeycomb2:this._col=Math.ceil((this._mapWidth-this._nodeHeight/2)/this._nodeHeight),this._row=2*Math.ceil((this._mapHeight-this._nodeWidth/4)/(this._nodeWidth/4*6)),this._mapRoad=new a(this._row,this._col,this._nodeWidth,this._nodeHeight,this._halfNodeWidth,this._halfNodeHeight)}},i.getNodeByPixel=function(t,e){return this._mapRoad?this._mapRoad.getNodeByPixel(t,e):new h},i.getNodeByDerect=function(t,e){return this._mapRoad?this._mapRoad.getNodeByDerect(t,e):new h},i.getNodeByWorldPoint=function(t,e){return this._mapRoad?this._mapRoad.getNodeByWorldPoint(t,e):new h},i.getWorldPointByPixel=function(t,e){return this._mapRoad?this._mapRoad.getWorldPointByPixel(t,e):new o},i.getPixelByWorldPoint=function(t,e){return this._mapRoad?this._mapRoad.getPixelByWorldPoint(t,e):new o},i.getDerectByPixel=function(t,e){return this._mapRoad?this._mapRoad.getDerectByPixel(t,e):new o},i.getDerectByWorldPoint=function(t,e){return this._mapRoad?this._mapRoad.getDerectByWorldPoint(t,e):new o},i.getPixelByDerect=function(t,e){return this._mapRoad?this._mapRoad.getPixelByDerect(t,e):new o},e(t,[{key:"mapWidth",get:function(){return this._mapWidth}},{key:"mapHeight",get:function(){return this._mapHeight}},{key:"nodeWidth",get:function(){return this._nodeWidth}},{key:"nodeHeight",get:function(){return this._nodeHeight}},{key:"row",get:function(){return this._row}},{key:"col",get:function(){return this._col}},{key:"halfNodeWidth",get:function(){return this._halfNodeWidth}},{key:"halfNodeHeight",get:function(){return this._halfNodeHeight}},{key:"mapType",get:function(){return this._mapType}}],[{key:"instance",get:function(){return null==this._instance&&(this._instance=new t),this._instance}}]),t}())._instance=void 0;var d=function(){function t(t,e,i,o,h,n){this._row=void 0,this._col=void 0,this._nodeWidth=void 0,this._nodeHeight=void 0,this._halfNodeWidth=void 0,this._halfNodeHeight=void 0,this._row=t,this._col=e,this._nodeWidth=i,this._nodeHeight=o,this._halfNodeWidth=h,this._halfNodeHeight=n}var e=t.prototype;return e.getNodeByPixel=function(t,e){var i=this.getWorldPointByPixel(t,e),o=this.getPixelByWorldPoint(i.x,i.y),n=this.getDerectByPixel(t,e),d=new h;return d.col=i.x,d.row=i.y,d.px=o.x,d.py=o.y,d.dx=n.x,d.dy=n.y,d},e.getNodeByDerect=function(t,e){var i=this.getPixelByDerect(t,e),o=this.getWorldPointByPixel(i.x,i.y),n=new h;return n.col=o.x,n.row=o.y,n.px=i.x,n.py=i.y,n.dx=t,n.dy=e,n},e.getNodeByWorldPoint=function(t,e){var i=this.getPixelByWorldPoint(t,e);return this.getNodeByPixel(i.x,i.y)},e.getWorldPointByPixel=function(t,e){var i=Math.ceil(t/this._nodeWidth-.5+e/this._nodeHeight)-1,h=this._col-1-Math.ceil(t/this._nodeWidth-.5-e/this._nodeHeight);return new o(i,h)},e.getPixelByWorldPoint=function(t,e){var i=Math.floor((t+1-(e-(this._col-1)))*this._halfNodeWidth),h=Math.floor((t+1+(e-(this._col-1)))*this._halfNodeHeight);return new o(i,h)},e.getDerectByPixel=function(t,e){var i=this.getWorldPointByPixel(t,e),h=this.getPixelByWorldPoint(i.x,i.y),n=Math.floor(h.x/this._nodeWidth)-(h.x%this._nodeWidth==0?1:0),d=Math.floor(h.y/this._halfNodeHeight)-1;return new o(n,d)},e.getDerectByWorldPoint=function(t,e){var i=Math.floor((t-(e-(this._col-1)))/2),h=t+(e-(this._col-1));return new o(i,h)},e.getPixelByDerect=function(t,e){var i=Math.floor((t+e%2)*this._nodeWidth+(1-e%2)*this._halfNodeWidth),h=Math.floor((e+1)*this._halfNodeHeight);return new o(i,h)},t}(),r=function(){function t(t,e,i,o,h,n){this._row=void 0,this._col=void 0,this._nodeWidth=void 0,this._nodeHeight=void 0,this._halfNodeWidth=void 0,this._halfNodeHeight=void 0,this._row=t,this._col=e,this._nodeWidth=i,this._nodeHeight=o,this._halfNodeWidth=h,this._halfNodeHeight=n}var e=t.prototype;return e.getNodeByPixel=function(t,e){var i=this.getWorldPointByPixel(t,e),o=this.getPixelByWorldPoint(i.x,i.y),n=this.getDerectByPixel(t,e),d=new h;return d.col=i.x,d.row=i.y,d.px=o.x,d.py=o.y,d.dx=n.x,d.dy=n.y,d},e.getNodeByDerect=function(t,e){var i=this.getPixelByDerect(t,e),o=this.getWorldPointByPixel(i.x,i.y),n=new h;return n.col=o.x,n.row=o.y,n.px=i.x,n.py=i.y,n.dx=t,n.dy=e,n},e.getNodeByWorldPoint=function(t,e){var i=this.getPixelByWorldPoint(t,e);return this.getNodeByPixel(i.x,i.y)},e.getWorldPointByPixel=function(t,e){var i=Math.floor(t/this._nodeWidth),h=Math.floor(e/this._nodeHeight);return new o(i,h)},e.getPixelByWorldPoint=function(t,e){var i=Math.floor((t+1)*this._nodeWidth-this._halfNodeWidth),h=Math.floor((e+1)*this._nodeHeight-this._halfNodeHeight);return new o(i,h)},e.getDerectByPixel=function(t,e){var i=Math.floor(t/this._nodeWidth),h=Math.floor(e/this._nodeHeight);return new o(i,h)},e.getDerectByWorldPoint=function(t,e){return new o(t,e)},e.getPixelByDerect=function(t,e){var i=Math.floor((t+1)*this._nodeWidth-this._halfNodeWidth),h=Math.floor((e+1)*this._nodeHeight-this._halfNodeHeight);return new o(i,h)},t}(),s=function(){function t(t,e,i,o,h,n){this._row=void 0,this._col=void 0,this._nodeWidth=void 0,this._nodeHeight=void 0,this._halfNodeWidth=void 0,this._halfNodeHeight=void 0,this._nwDiv4=void 0,this._radius=void 0,this._proportion=1.732,this._row=t,this._col=e,this._nodeWidth=i,this._nodeHeight=o,this._halfNodeWidth=h,this._halfNodeHeight=n,this._nwDiv4=this._nodeWidth/4,this._radius=4*this._nwDiv4,this._proportion=2*this._nodeHeight/this._nodeWidth}var e=t.prototype;return e.getNodeByPixel=function(t,e){var i=this.getWorldPointByPixel(t,e),o=this.getPixelByWorldPoint(i.x,i.y),n=new h;return n.col=i.x,n.row=i.y,n.px=o.x,n.py=o.y,n.dx=i.x,n.dy=i.y,n},e.getNodeByDerect=function(t,e){var i=this.getPixelByDerect(t,e),o=new h;return o.col=t,o.row=e,o.px=i.x,o.py=i.y,o.dx=t,o.dy=e,o},e.getNodeByWorldPoint=function(t,e){var i=this.getPixelByWorldPoint(t,e);return this.getNodeByPixel(i.x,i.y)},e.getWorldPointByPixel=function(t,e){var i,h=Math.floor(t/this._nwDiv4),n=Math.floor(h/3);return(h-1)%6==0||(h-2)%6==0?(n=n,i=i=Math.floor(e/this._nodeHeight)):(h-4)%6==0||(h-5)%6==0?(n=n,i=i=e<this._nodeHeight/2?-1:Math.floor((e-this._nodeHeight/2)/this._nodeHeight)):n%2==0?(i=Math.floor(e/this._nodeHeight),this.testPointInHoneycomb(n,i,t,e)?(n=n,i=i):this.testPointInHoneycomb(n-1,i-1,t,e)?(n-=1,i-=1):(n-=1,i=i)):(i=e<this._nodeHeight/2?-1:Math.floor((e-this._nodeHeight/2)/this._nodeHeight),this.testPointInHoneycomb(n,i,t,e)?(n=n,i=i):this.testPointInHoneycomb(n-1,i,t,e)?(n-=1,i=i):(n-=1,i+=1)),new o(n,i)},e.testPointInHoneycomb=function(t,e,i,o){var h=2*this._nwDiv4,n=this.getPixelByWorldPoint(t,e);return h-Math.abs(i-n.x)>=Math.abs(o-n.y)/this._proportion},e.getPixelByWorldPoint=function(t,e){var i=Math.floor((2+3*t)/4*this._nodeWidth),h=Math.floor((e+.5*(1+t%2))*this._nodeHeight);return new o(i,h)},e.getDerectByPixel=function(t,e){return this.getWorldPointByPixel(t,e)},e.getDerectByWorldPoint=function(t,e){return new o(t,e)},e.getPixelByDerect=function(t,e){var i=(2+3*t)/4*this._nodeWidth,h=(e+.5*(1+t%2))*this._nodeHeight;return new o(i,h)},t}(),a=function(){function t(t,e,i,o,h,n){this.mapRoadHoneycomb=void 0,this.mapRoadHoneycomb=new s(t,e,i,o,h,n)}var e=t.prototype;return e.transposedNode=function(t){var e=t.col,i=t.dx,o=t.px;return t.col=t.row,t.row=e,t.dx=t.dy,t.dy=i,t.px=t.py,t.py=o,t},e.transposedPoint=function(t){var e=t.x;return t.x=t.y,t.y=e,t},e.getNodeByPixel=function(t,e){return this.transposedNode(this.mapRoadHoneycomb.getNodeByPixel(e,t))},e.getNodeByDerect=function(t,e){return this.transposedNode(this.mapRoadHoneycomb.getNodeByDerect(e,t))},e.getNodeByWorldPoint=function(t,e){return this.transposedNode(this.mapRoadHoneycomb.getNodeByWorldPoint(e,t))},e.getWorldPointByPixel=function(t,e){return this.transposedPoint(this.mapRoadHoneycomb.getWorldPointByPixel(e,t))},e.getPixelByWorldPoint=function(t,e){return this.transposedPoint(this.mapRoadHoneycomb.getPixelByWorldPoint(e,t))},e.getDerectByPixel=function(t,e){return this.transposedPoint(this.mapRoadHoneycomb.getDerectByPixel(e,t))},e.getDerectByWorldPoint=function(t,e){return this.transposedPoint(this.mapRoadHoneycomb.getDerectByWorldPoint(e,t))},e.getPixelByDerect=function(t,e){return this.transposedPoint(this.mapRoadHoneycomb.getPixelByDerect(e,t))},t}();i._RF.pop()}}}));

System.register("chunks:///_virtual/MapScrollComp.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIComp.ts","./CONST.ts","./MapMgr.ts","./ResMgr.ts","./BaseUtil.ts","./MapGridFactory.ts","./MessageTip.ts","./MapThingFactory.ts"],(function(e){var r,o,t,a,i,n,p,s,l,c,g,u,d,M,m,h,_,y,f,v,T,S,w,E,L,U,C,G,b;return{setters:[function(e){r=e.applyDecoratedDescriptor,o=e.inheritsLoose,t=e.initializerDefineProperty,a=e.assertThisInitialized,i=e.createClass,n=e.asyncToGenerator,p=e.regeneratorRuntime},function(e){s=e.cclegacy,l=e._decorator,c=e.Node,g=e.Graphics,u=e.UITransform,d=e.input,M=e.Input,m=e.EventMouse,h=e.Vec3,_=e.Widget,y=e.Vec2,f=e.KeyCode,v=e.Layout,T=e.Sprite},function(e){S=e.UIComp},function(e){w=e.CONST},function(e){E=e.MapMgr},function(e){L=e.ResMgr},function(e){U=e.BaseUT},function(e){C=e.MapGridFactory},function(e){G=e.MessageTip},function(e){b=e.MapThingFactory}],execute:function(){var A,P,x,N,R,I,H,F,z,k,D,O,W,V,B,K,Y,j,J,Q,X,q;s._RF.push({},"903aawUQppCPKupPtNR9P69","MapScrollComp",void 0);var Z=l.ccclass,$=l.property;e("MapScrollComp",(A=Z("MapScrollComp"),P=$({type:c,tooltip:"地图总容器"}),x=$({type:c,tooltip:"地图滚动容器"}),N=$({type:c,tooltip:"地图切片容器"}),R=$({type:c,tooltip:"地图格子路点容器"}),I=$({type:g,tooltip:"地图网格线条"}),H=$({type:g,tooltip:"绘制A*x寻路路线线条"}),F=$({type:C,tooltip:"地图格子绘制工厂"}),z=$({type:b,tooltip:"地图物件生成工厂"}),k=$({type:c,tooltip:"场景实体容器"}),A(((q=function(e){function r(){for(var r,o=arguments.length,i=new Array(o),n=0;n<o;n++)i[n]=arguments[n];return r=e.call.apply(e,[this].concat(i))||this,t(r,"grp_mapLayer",W,a(r)),t(r,"grp_scrollMap",V,a(r)),t(r,"grp_mapSlices",B,a(r)),t(r,"grp_colorGrid",K,a(r)),t(r,"graphicsLine",Y,a(r)),t(r,"graphicsDarwAstarLine",j,a(r)),t(r,"mapGridFactory",J,a(r)),t(r,"mapThingFactory",Q,a(r)),t(r,"grp_entity",X,a(r)),r.isInEditArea=void 0,r.mapMgr=void 0,r._editAreaSize=void 0,r._pressSpace=void 0,r._pressMouseLeft=void 0,r._pressMouseRight=void 0,r._isCtrlDown=void 0,r._preUIPos=void 0,r._scrollMapUITranstorm=void 0,r.onAddNodeHandler=void 0,r.onRemoveNodeHandler=void 0,r}o(r,e);var s=r.prototype;return s.onEnter=function(){var e=this;e.mapMgr=E.inst,e._scrollMapUITranstorm=e.grp_scrollMap.getComponent(u),e.onEmitter(w.GEVT.ChangeGridType,e.onChangeGridType),e.onEmitter(w.GEVT.ChangeGridSize,e.onChangeGridRange),e.onEmitter(w.GEVT.UpdateAstarGrid,e.drawAstarGrid)},s.onImportMapJson=function(){var e=n(p().mark((function e(r){var o;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=this,e.next=3,o.addMapSlices(r);case 3:case"end":return e.stop()}}),e,this)})));return function(r){return e.apply(this,arguments)}}(),s.addMapSlices=function(){var e=n(p().mark((function e(r){var o,t,a,i,s,l,c,g,u,d,M;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:M=function(){return(M=n(p().mark((function e(r){var t;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.nativePath,e.abrupt("return",new Promise((function(e,a){L.inst.loadLocalImg(t,(function(t){s++,console.log(r.sourceName,t.texture.width,t.texture.height),t.texture.width,g||(l+=t.texture.width),s==i&&(s=0,0,t.texture.height,c+=t.texture.height,g=!0);var a=U.newUINode(r.sourceName);a.addComponent(T).spriteFrame=t,a.setParent(o.grp_mapSlices),e()}),o)})));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)},d=function(e){return M.apply(this,arguments)},(o=this).grp_mapSlices.destroyAllChildren(),o.grp_colorGrid.destroyAllChildren(),o.grp_scrollMap.setPosition(0,0,0),o.grp_scrollMap.setScale(new h(1,1,1)),o.mapMgr.mapScale=1,t=o.mapMgr,a=t.mapFloorArr,i=t.mapslice,0,0,s=0,l=0,c=0,o.grp_mapSlices.getComponent(v).constraintNum=i,u=0;case 19:if(!(u<a.length)){e.next=25;break}return e.next=22,d(a[u]);case 22:u++,e.next=19;break;case 25:t.mapWidth=l,t.mapHeight=c,U.setSize(o.grp_scrollMap,l,c),U.setSize(o.grp_mapSlices,l,c),console.log("地图宽高:",t.mapWidth,t.mapHeight),o.init(r);case 31:case"end":return e.stop()}}),e,this)})));return function(r){return e.apply(this,arguments)}}(),s.init=function(e){var r=this;r.initGridLine(),r.initEvent(),r.mapGridFactory.init(e),r.mapThingFactory.init(e)},s.initGridLine=function(){var e=this,r=e.mapMgr.cellSize,o=e.mapMgr.totCol=Math.ceil(e.mapMgr.mapWidth/r),t=e.mapMgr.totRow=Math.ceil(e.mapMgr.mapHeight/r),a=t*o;e.mapMgr.areaGraphicSize=a<65536?16:a<3e5?32:64;var i=e.graphicsLine;i.clear(),i.lineWidth=1;for(var n=0;n<o+1;n++)i.moveTo(n*r,0),i.lineTo(n*r,t*r);for(var p=0;p<t+1;p++)i.moveTo(0,p*r),i.lineTo(o*r,p*r);i.stroke()},s.drawAstarGrid=function(e){var r=this,o=r.mapMgr.cellSize,t=e.roadNodeArr,a=r.graphicsDarwAstarLine;r.graphicsDarwAstarLine.clear();for(var i=0,n=t.length;i<n;i++){var p=t[i];a.rect(p.px-o/2,p.py-o/2,o,o),a.fill()}},s.initEvent=function(){var e=this;e._editAreaSize=U.getSize(e.grp_mapLayer),e.grp_mapLayer.on(c.EventType.MOUSE_DOWN,e.onMouseDown,e),e.grp_mapLayer.on(c.EventType.MOUSE_ENTER,e.onMouseEnter,e,!0),e.grp_mapLayer.on(c.EventType.MOUSE_LEAVE,e.onMouseLeave,e),e.grp_mapLayer.on(c.EventType.MOUSE_WHEEL,e.onMouseWheel,e),d.on(M.EventType.KEY_DOWN,e.onKeyDown,e),d.on(M.EventType.KEY_UP,e.onKeyUp,e),e.onAddNodeHandler=e.mapGridFactory.onAddNodeHandler,e.onRemoveNodeHandler=e.mapGridFactory.onRemoveNodeHandler},s.onMouseDown=function(e){var r=this,o=e.getButton();if(o!=m.BUTTON_MIDDLE){if(r._preUIPos=e.getUILocation(),r.grp_mapLayer.on(c.EventType.MOUSE_MOVE,r.onMouseMove,r),r.grp_mapLayer.on(c.EventType.MOUSE_UP,r.onMouseUp,r),!r._pressSpace)if(r.mapMgr.gridType!=w.GridType.GridType_none){if(o==m.BUTTON_LEFT?r._pressMouseLeft=!0:o==m.BUTTON_RIGHT&&(r._pressMouseRight=!0),r._pressMouseLeft&&!r.mapMgr.isForbidDrawGrid){var t=U.getMousePos(e.getLocation()),a=r._scrollMapUITranstorm.convertToNodeSpaceAR(new h(t.x,t.y,0));r._isCtrlDown?r.onRemoveNodeHandler&&r.onRemoveNodeHandler.call(r.mapGridFactory,a):r.onAddNodeHandler&&r.onAddNodeHandler.call(r.mapGridFactory,a)}}else G.show({msg:"请选择操作功能！"})}else{var i=U.getMousePos(e.getLocation()),n=r._scrollMapUITranstorm.convertToNodeSpaceAR(new h(i.x,i.y,0));r.emit(w.GEVT.UpdateMousePos,{localUIPos:n})}},s.onMouseMove=function(e){var r=this;if(r._pressSpace){var o=e.getUILocation(),t=o.x-r._preUIPos.x,a=o.y-r._preUIPos.y,i=r.grp_scrollMap.position.x+t,n=r.grp_scrollMap.position.y+a;r.grp_scrollMap.setPosition(i,n),r._preUIPos=o,r.checkLimitPos()}else if(r.mapMgr.gridType!=w.GridType.GridType_none&&r._pressMouseLeft&&!r.mapMgr.isForbidDrawGrid){var p=U.getMousePos(e.getLocation()),s=r._scrollMapUITranstorm.convertToNodeSpaceAR(new h(p.x,p.y,0));r._isCtrlDown?r.onRemoveNodeHandler&&r.onRemoveNodeHandler.call(r.mapGridFactory,s):r.onAddNodeHandler&&r.onAddNodeHandler.call(r.mapGridFactory,s)}},s.onMouseUp=function(e){var r=this;this.grp_mapLayer.off(c.EventType.MOUSE_MOVE,this.onMouseMove,this),r.grp_mapLayer.off(c.EventType.MOUSE_UP,r.onMouseUp,r);var o=e.getButton();o==m.BUTTON_LEFT?r._pressMouseLeft=!1:o==m.BUTTON_RIGHT&&(r._pressMouseRight=!1)},s.onChangeGridType=function(e){this.mapMgr.gridType=e.gridType},s.onChangeGridRange=function(e){this.mapMgr.gridRange=e.range},s.onMouseEnter=function(e){this.isInEditArea=!0,this.checkMousCursor()},s.onMouseLeave=function(e){this.isInEditArea=!1,this.checkMousCursor()},s.onMouseWheel=function(e){var r=e.getLocation();e.getScrollY()>0?this.scaleMap(.1,r):this.scaleMap(-.1,r)},s.setMapScale=function(e){var r=this;if(r.mapScale!=e){var o=r.node.getComponent(_),t=U.getSize(r.node),a=U.getView(),i=new y((o.left+t.width/2)*a.getScaleX(),(o.bottom+t.height/2)*a.getScaleY());r.scaleMap(e-r.mapScale,i)}},s.scaleMap=function(e,r){var o=this,t=o.grp_scrollMap.scale.x+e,a=o._editAreaSize.width,i=o._editAreaSize.height,n=Math.max(a/o.mapMgr.mapWidth,i/o.mapMgr.mapHeight);if(t>2.5&&(t=2.5),t<n&&(t=n),o.mapScale!=t){o.mapMgr.mapScale=t;var p=U.getMousePos(r),s=o._scrollMapUITranstorm.convertToNodeSpaceAR(new h(p.x,p.y,0));o.grp_scrollMap.setScale(new h(t,t,t));var l=o._scrollMapUITranstorm.convertToWorldSpaceAR(new h(s.x,s.y,0)),c=new y(p.x-l.x,p.y-l.y),g=o.grp_scrollMap.position.x+c.x,u=o.grp_scrollMap.position.y+c.y;o.grp_scrollMap.setPosition(g,u),o.checkLimitPos(),o.emit(w.GEVT.UpdateMapScale)}},s.checkLimitPos=function(){var e=this,r=e.stageWidth-e._editAreaSize.width,o=e.stageHeight-e._editAreaSize.height;e.grp_scrollMap.position.x>0&&e.grp_scrollMap.setPosition(new h(0,e.grp_scrollMap.position.y)),e.grp_scrollMap.position.x<-r&&e.grp_scrollMap.setPosition(new h(-r,e.grp_scrollMap.position.y)),e.grp_scrollMap.position.y>0&&e.grp_scrollMap.setPosition(new h(e.grp_scrollMap.position.x,0)),e.grp_scrollMap.position.y<-o&&e.grp_scrollMap.setPosition(new h(e.grp_scrollMap.position.x,-o))},s.onKeyDown=function(e){var r=this;switch(e.keyCode){case f.SPACE:r.mapMgr.isPressSpace=r._pressSpace=!0,r.checkMousCursor();break;case f.CTRL_LEFT:case f.CTRL_RIGHT:r.mapMgr.isPressCtrl=r._isCtrlDown=!0}},s.onKeyUp=function(e){var r=this;switch(e.keyCode){case f.SPACE:r.mapMgr.isPressSpace=r._pressSpace=!1,r.checkMousCursor();break;case f.CTRL_LEFT:case f.CTRL_RIGHT:r.mapMgr.isPressCtrl=r._isCtrlDown=!1}},s.checkMousCursor=function(){var e=this;e.mapMgr.isRunningDemoMode||(e._pressSpace&&e.isInEditArea?U.changeMouseCursor("grab"):U.changeMouseCursor("auto"))},i(r,[{key:"scrollMapUITranstorm",get:function(){return this._scrollMapUITranstorm}},{key:"mapScale",get:function(){return this.grp_scrollMap.scale.x}},{key:"stageWidth",get:function(){return this.mapMgr.mapWidth*this.grp_scrollMap.scale.x}},{key:"stageHeight",get:function(){return this.mapMgr.mapHeight*this.grp_scrollMap.scale.y}}]),r}(S)).prefabUrl="prefab/mapEditor/MapScrollComp",W=r((O=q).prototype,"grp_mapLayer",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),V=r(O.prototype,"grp_scrollMap",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),B=r(O.prototype,"grp_mapSlices",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),K=r(O.prototype,"grp_colorGrid",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Y=r(O.prototype,"graphicsLine",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),j=r(O.prototype,"graphicsDarwAstarLine",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),J=r(O.prototype,"mapGridFactory",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Q=r(O.prototype,"mapThingFactory",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),X=r(O.prototype,"grp_entity",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D=O))||D));s._RF.pop()}}}));

System.register("chunks:///_virtual/MapThingFactory.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIComp.ts","./MapMgr.ts","./CONST.ts","./BaseUtil.ts","./mapThingSelect.ts"],(function(e){var a,i,t,n,r,o,p,g,h,l,c,T,s,m,u,d;return{setters:[function(e){a=e.applyDecoratedDescriptor,i=e.inheritsLoose,t=e.initializerDefineProperty,n=e.assertThisInitialized},function(e){r=e.cclegacy,o=e._decorator,p=e.Prefab,g=e.Node,h=e.instantiate,l=e.Vec2,c=e.EventMouse},function(e){T=e.UIComp},function(e){s=e.MapMgr},function(e){m=e.CONST},function(e){u=e.BaseUT},function(e){d=e.mapThingSelect}],execute:function(){var M,f,y,S,v,_,I,b,w,C,G;r._RF.push({},"00009wqJKpH66FGRwnw1wBN","MapThingFactory",void 0);var D=o.ccclass,x=o.property;e("MapThingFactory",(M=D("MapThingFactory"),f=x({type:p}),y=x({type:p}),S=x({type:g}),v=x({type:g}),M((b=a((I=function(e){function a(){for(var a,i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return a=e.call.apply(e,[this].concat(r))||this,t(a,"mapThingPrefab",b,n(a)),t(a,"mapThingSelectPrefab",w,n(a)),t(a,"grp_mapThingBevel",C,n(a)),t(a,"grp_mapThingSelect",G,n(a)),a.mapMgr=void 0,a._mapThingSortList=void 0,a._mapThingSelect=void 0,a._lastSelectMapThingComp=void 0,a._tid=void 0,a}i(a,e);var r=a.prototype;return r.onEnter=function(){var e=this;if(e.mapMgr=s.inst,e.onEmitter(m.GEVT.DragMapThingDown,e.onDragMapThingDown),e.onEmitter(m.GEVT.ChangeGridType,e.onChangeGridType),e.onEmitter(m.GEVT.ChangeMapThingXY,e.onChangeMapThingXY),!e._mapThingSelect){var a=h(e.mapThingSelectPrefab);a.setParent(e.grp_mapThingSelect),e._mapThingSelect=a.getComponent(d)}},r.init=function(e){var a=this;a.node.destroyAllChildren(),a._mapThingSortList=[];var i=e.mapData;i.mapThingList&&i.mapThingList.forEach((function(e){a.onDragMapThingDown({url:a.mapMgr.mapThingUrlMap[e.thingName],thingName:e.thingName,x:e.x,y:e.y,anchorX:e.anchorX,anchorY:e.anchorY,taskId:e.taskId,groupId:e.groupId,type:e.type})})),i.borderList&&i.borderList.forEach((function(e){for(var i=e.groupIdList||[],t="",n=0;n<i.length;n++)t+=i[n]+(n==i.length-1?"":",");a.onDragMapThingDown({url:a.mapMgr.mapThingUrlMap[a.mapMgr.bavelResStr],thingName:a.mapMgr.bavelResStr,x:e.x,y:e.y,anchorX:.5,anchorY:.5,groupIdStr:t,type:m.MapThingType.bevel})})),a.sortMapThing(),a._mapThingSelect.clear(),a.mapMgr.curMapThingInfo=null,a.emit(m.GEVT.ClearCurMapThingInfo)},r.refSelfVsb=function(){var e=this;e.grp_mapThingSelect.active=!e.grp_mapThingSelect.active,e.grp_mapThingBevel.active=!e.grp_mapThingBevel.active,e.node.active=!e.node.active},r.onChangeGridType=function(e){var a=this;e.gridType==m.GridType.GridType_mapThing?a.mapMgr.isForbidDrawGrid=!a._mapThingSelect.isShow:(a._mapThingSelect.clear(),a.mapMgr.curMapThingInfo=null,a.emit(m.GEVT.ClearCurMapThingInfo))},r.onChangeMapThingXY=function(e){this._mapThingSelect.isShow&&this._mapThingSelect.drawRect(e.x-e.width/2,e.y-e.height/2,e.width,e.height)},r.onDragMapThingDown=function(e){var a=this,i=e.isByDrag,t=e.x,n=e.y,r=null==e.anchorX?.5:e.anchorX,o=null==e.anchorY?.5:e.anchorY,p={},h=a.mapMgr.getMapThingComp(a.mapThingPrefab,e.url,r,o,(function(e,r){p.width=e,p.height=r,i&&(a.emit(m.GEVT.ClickMapTing),a._mapThingSelect.drawRect(t-e/2,n-r/2,e,r))}),a),c=e.thingName,T=c.indexOf(a.mapMgr.bavelResStr)>-1;if(T){if(i){var s,d=a.mapMgr.pos2Grid(t,n),M=a.mapMgr.cellSize,f=[[d.col*M,d.row*M],[d.col*M+M,d.row*M],[d.col*M+M,d.row*M+M],[d.col*M,d.row*M+M]],y=[];y.push(l.distance({x:Math.floor(t),y:Math.floor(n)},{x:f[0][0],y:f[0][1]})),y.push(l.distance({x:Math.floor(t),y:Math.floor(n)},{x:f[1][0],y:f[1][1]})),y.push(l.distance({x:Math.floor(t),y:Math.floor(n)},{x:f[2][0],y:f[2][1]})),y.push(l.distance({x:Math.floor(t),y:Math.floor(n)},{x:f[3][0],y:f[3][1]}));for(var S=0;S<y.length;S++)s?y[S]<s&&(s=y[S]):s=y[S];var v=y.indexOf(s);t=f[v][0],n=f[v][1]}p.type=m.MapThingType.bevel}else p.type=e.type||m.MapThingType.task,a._mapThingSortList.push({y:n,node:h});h.setPosition(t,n),u.setPivot(h,r,o),h.setParent(T?a.grp_mapThingBevel:a.node),h.name=Math.floor(t)+"_"+Math.floor(n),p.thingName=c,p.anchorX=r,p.anchorY=o,p.x=t,p.y=n,e.taskId&&(p.taskId=e.taskId),e.groupId&&(p.groupId=e.groupId),e.groupIdStr&&(p.groupIdStr=e.groupIdStr),a.mapMgr.mapThingMap[h.name]&&a.mapMgr.mapThingMap[h.name][1].destroy(),a.mapMgr.mapThingMap[h.name]=[p,h],i&&(a._lastSelectMapThingComp=h,a.mapMgr.curMapThingInfo=p,a.sortMapThing()),h.on(g.EventType.MOUSE_DOWN,a.onMouseDown,a)},r.onMouseDown=function(e){var a=this,i=a.mapMgr,t=e.getButton(),n=e.currentTarget,r=i.mapThingMap[n.name][0];if(t==c.BUTTON_LEFT){if(console.log("左键点击场景物件"),i.gridType!=m.GridType.GridType_mapThing||i.isPressCtrl||i.isPressSpace)return;a._lastSelectMapThingComp!=n&&(a._lastSelectMapThingComp=n,i.isForbidDrawGrid=!0),a.clearTimeout(a._tid),a._tid=a.setTimeout((function(){i.isForbidDrawGrid=!1}),200),a._mapThingSelect.drawRect(r.x-r.width/2,r.y-r.height/2,r.width,r.height),i.curMapThingInfo=r,a.emit(m.GEVT.ClickMapTing)}else if(t==c.BUTTON_RIGHT){if(i.gridType!=m.GridType.GridType_mapThing||i.isPressSpace)return;i.isPressCtrl||a.emit(m.GEVT.DragMapThingStart,{thingName:r.thingName,url:i.mapThingUrlMap[r.thingName],taskId:r.taskId,groupId:r.groupId,type:r.type,groupIdStr:r.groupIdStr}),a._mapThingSelect.clear(),n.destroy(),r.thingName.indexOf(a.mapMgr.bavelResStr)>-1||a.removeItemFromMapThingSortList(r.y),i.rmMapThingGrid(Math.floor(r.x)+"_"+Math.floor(r.y)),i.curMapThingInfo=null,delete i.mapThingMap[n.name],a.emit(m.GEVT.ClearCurMapThingInfo),console.log("右键点击场景物件")}},r.sortMapThing=function(){var e=this._mapThingSortList;if(e&&e.length){e.sort((function(e,a){return e.y<a.y?1:-1}));for(var a=0;a<e.length;a++)e[a].node.removeFromParent(),this.node.addChild(e[a].node)}},r.removeItemFromMapThingSortList=function(e){var a=this._mapThingSortList;if(a&&a.length)for(var i=a.length-1;i>=0;i--)if(a[i].y==e){this._mapThingSortList.splice(i,1);break}},a}(T)).prototype,"mapThingPrefab",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),w=a(I.prototype,"mapThingSelectPrefab",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),C=a(I.prototype,"grp_mapThingBevel",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),G=a(I.prototype,"grp_mapThingSelect",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_=I))||_));r._RF.pop()}}}));

System.register("chunks:///_virtual/MapThingIR.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ListItem.ts","./ImgLoader.ts","./BaseUtil.ts"],(function(t){var e,i,n,a,r,o,l,p,c,s,u;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,a=t.assertThisInitialized},function(t){r=t.cclegacy,o=t._decorator,l=t.Node,p=t.Label},function(t){c=t.ListItem},function(t){s=t.ImgLoader},function(t){u=t.BaseUT}],execute:function(){var g,h,m,f,d,y,b;r._RF.push({},"afc11EZ5wFCI7p9n1nBnAke","MapThingIR",void 0);var _=o.ccclass,v=o.property;t("MapThingIR",(g=_("MapThingIR"),h=v({type:l,tooltip:"物件资源图片"}),m=v({type:p,tooltip:"物件名称"}),g((y=e((d=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return e=t.call.apply(t,[this].concat(r))||this,n(e,"img_mapthing",y,a(e)),n(e,"lbl_name",b,a(e)),e}return i(e,t),e.prototype.dchg=function(){var t=this,e=t.data;t.lbl_name.string=e.thingName;var i=t.img_mapthing.getComponent(s);i.loadComplete=function(e){var i=70/Math.max(e.width,e.height);u.setSize(t.img_mapthing,e.width*i,e.height*i)},i.ctx=t,i.url=e.nativePath},e}(c)).prototype,"img_mapthing",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),b=e(d.prototype,"lbl_name",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),f=d))||f));r._RF.pop()}}}));

System.register("chunks:///_virtual/MapThingPropertyComp.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIComp.ts","./CONST.ts","./MapMgr.ts","./BaseUtil.ts","./MessageTip.ts","./ComboBoxComp.ts"],(function(t){var e,n,i,o,r,a,p,l,u,g,c,s,d,b,h,_,T;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,i=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){r=t.cclegacy,a=t._decorator,p=t.Label,l=t.EditBox,u=t.Node,g=t.Button,c=t.Vec3},function(t){s=t.UIComp},function(t){d=t.CONST},function(t){b=t.MapMgr},function(t){h=t.BaseUT},function(t){_=t.MessageTip},function(t){T=t.ComboBoxComp}],execute:function(){var y,m,f,M,v,I,C,E,X,Y,x,w,P,N,O,A,R,k,z,U,S,G,B,F,D,L,V,H,W,$,j,J,q,K,Q,Z,tt,et,nt;r._RF.push({},"90c95G2uJBFYrriiARbP6N3","MapThingPropertyComp",void 0);var it=a.ccclass,ot=a.property;t("MapThingPropertyComp",(y=it("MapThingPropertyComp"),m=ot({type:p}),f=ot({type:l}),M=ot({type:l}),v=ot({type:l}),I=ot({type:l}),C=ot({type:l}),E=ot({type:l}),X=ot({type:l}),Y=ot({type:p}),x=ot({type:p}),w=ot({type:T}),P=ot({type:T}),N=ot({type:u}),O=ot({type:u}),A=ot({type:g}),R=ot({type:g}),k=ot({type:g}),z=ot({type:g}),y((G=e((S=function(t){function e(){for(var e,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r))||this,i(e,"lbl_propertyName",G,o(e)),i(e,"lbl_taskId",B,o(e)),i(e,"lbl_groupId",F,o(e)),i(e,"lbl_groupId2",D,o(e)),i(e,"lbl_x",L,o(e)),i(e,"lbl_y",V,o(e)),i(e,"lbl_anchorX",H,o(e)),i(e,"lbl_anchorY",W,o(e)),i(e,"lbl_thingRect",$,o(e)),i(e,"lbl_thingName",j,o(e)),i(e,"combo_taskType",J,o(e)),i(e,"combo_triggerType",q,o(e)),i(e,"grp_mapThingInfo",K,o(e)),i(e,"grp_bevel",Q,o(e)),i(e,"btn_XReduce",Z,o(e)),i(e,"btn_XAdd",tt,o(e)),i(e,"btn_YReduce",et,o(e)),i(e,"btn_YAdd",nt,o(e)),e.mapMgr=void 0,e._tid1=void 0,e._tid1_1=void 0,e._tid2=void 0,e._tid2_1=void 0,e._tid3=void 0,e._tid3_1=void 0,e._tid4=void 0,e._tid4_1=void 0,e}n(e,t);var r=e.prototype;return r.onEnter=function(){var t=this;t.mapMgr=b.inst,t.onEmitter(d.GEVT.ClickMapTing,t.onClickMapTing),t.onEmitter(d.GEVT.ChangeGridType,t.onChangeGridType),t.onEmitter(d.GEVT.ClearCurMapThingInfo,t.onClearCurMapThingInfo),t.btn_XReduce.node.on(u.EventType.MOUSE_DOWN,t.reduceX,t),t.btn_XReduce.node.on(u.EventType.MOUSE_UP,t.stopReduceX,t),t.btn_XReduce.node.on(u.EventType.TOUCH_CANCEL,t.stopReduceX,t),t.btn_XAdd.node.on(u.EventType.MOUSE_DOWN,t.addX,t),t.btn_XAdd.node.on(u.EventType.MOUSE_UP,t.stopAddX,t),t.btn_XAdd.node.on(u.EventType.TOUCH_CANCEL,t.stopAddX,t),t.btn_YReduce.node.on(u.EventType.MOUSE_DOWN,t.reduceY,t),t.btn_YReduce.node.on(u.EventType.MOUSE_UP,t.stopReduceY,t),t.btn_YReduce.node.on(u.EventType.TOUCH_CANCEL,t.stopReduceY,t),t.btn_YAdd.node.on(u.EventType.MOUSE_DOWN,t.addY,t),t.btn_YAdd.node.on(u.EventType.MOUSE_UP,t.stopAddY,t),t.btn_YAdd.node.on(u.EventType.TOUCH_CANCEL,t.stopAddY,t),t.combo_triggerType.setData(t.mapMgr.triggerTypes),t.combo_triggerType.node.on(d.GEVT.ComboBox_Change,t.onClickTriggerType,t),t.combo_triggerType.selectedIndex=0,t.grp_mapThingInfo.active=t.grp_bevel.active=!1},r.init=function(t){var e,n,i=this,o=null!=(e=null==(n=t.thingPram)?void 0:n.thingTypeList)?e:[];i.combo_taskType.setData(o),i.combo_taskType.node.on(d.GEVT.ComboBox_Change,i.onClickTaskType,i),i.combo_taskType.selectedIndex=0},r.onChangeGridType=function(t){var e="";e=t.gridType==d.GridType.GridType_mapThing?"场景物件":"路点",this.lbl_propertyName.string=e},r.onClickMapTing=function(){var t=this,e=t.mapMgr.curMapThingInfo,n=e.type==d.MapThingType.bevel;n?t.lbl_groupId2.string=e.groupIdStr?e.groupIdStr:"":(t.lbl_taskId.string=(e.taskId||"")+"",t.lbl_groupId.string=(e.groupId||"")+"",t.lbl_x.string=e.x+"",t.lbl_y.string=e.y+"",t.lbl_anchorX.string=e.anchorX+"",t.lbl_anchorY.string=e.anchorY+"",t.lbl_thingRect.string=e.width+","+e.height,t.lbl_thingName.string=e.thingName,t.combo_taskType.selectedIndex=e.type-1),t.grp_mapThingInfo.active=!n,t.grp_bevel.active=n},r.onClearCurMapThingInfo=function(){this.grp_mapThingInfo.active=this.grp_bevel.active=!1},r.onClickTaskType=function(t){this.mapMgr.curMapThingInfo&&(this.mapMgr.curMapThingInfo.type=t.type)},r.onClickTriggerType=function(t){this.mapMgr.curMapThingTriggerType=t.type},r.onFocusOutTaskId=function(t){this.mapMgr.curMapThingInfo&&(this.mapMgr.curMapThingInfo.taskId=Number(t.string))},r.onFocusOutGroupId=function(t){this.mapMgr.curMapThingInfo&&(this.mapMgr.curMapThingInfo.groupId=Number(t.string))},r.onFocusOutGroupId2=function(t){var e=this.mapMgr.curMapThingInfo;if(e){var n=t.string,i=/^(\d+,?)+$/.test(n);e.groupIdStr=i?t.string:e.groupIdStr,i||(t.string=e.groupIdStr||"",_.show({msg:"输入内容不合法"}))}},r.onFocusOutX=function(t){var e=this.mapMgr.curMapThingInfo;e&&this.setMapThingPosition(Number(t.string),e.y)},r.onFocusOutY=function(t){var e=this.mapMgr.curMapThingInfo;e&&this.setMapThingPosition(e.x,Number(t.string))},r.reduceX=function(){var t=this,e=t.mapMgr.curMapThingInfo;e&&(t.setMapThingPosition(e.x-1,e.y),t.stopReduceX(),t._tid1_1=t.setTimeout((function(){t._tid1=t.setInterval((function(){t.setMapThingPosition(e.x-1,e.y)}),50)}),200))},r.stopReduceX=function(){var t=this;t.clearTimeout(t._tid1_1),t.clearInterval(t._tid1)},r.addX=function(){var t=this,e=t.mapMgr.curMapThingInfo;e&&(t.setMapThingPosition(e.x+1,e.y),t._tid2_1=t.setTimeout((function(){t._tid2=t.setInterval((function(){t.setMapThingPosition(e.x+1,e.y)}),50)}),200))},r.stopAddX=function(){var t=this;t.clearTimeout(t._tid2_1),t.clearInterval(t._tid2)},r.reduceY=function(){var t=this,e=t.mapMgr.curMapThingInfo;e&&(t.setMapThingPosition(e.x,e.y-1),t._tid3_1=t.setTimeout((function(){t._tid3=t.setInterval((function(){t.setMapThingPosition(e.x,e.y-1)}),50)}),200))},r.stopReduceY=function(){var t=this;t.clearTimeout(t._tid3_1),t.clearInterval(t._tid3)},r.addY=function(){var t=this,e=t.mapMgr.curMapThingInfo;e&&(t.setMapThingPosition(e.x,e.y+1),t._tid4_1=t.setTimeout((function(){t._tid4=t.setInterval((function(){t.setMapThingPosition(e.x,e.y+1)}),50)}),200))},r.stopAddY=function(){var t=this;t.clearTimeout(t._tid4_1),t.clearInterval(t._tid4)},r.setMapThingPosition=function(t,e){var n=this,i=n.mapMgr,o=i.curMapThingInfo;if(o){var r=o.x,a=o.y,p=i.getMapThingCompByXY(r,a);delete i.mapThingMap[p.name];var l=t,u=e;n.lbl_x.string=l+"",n.lbl_y.string=u+"",p.setPosition(new c(l,u)),o.x=l,o.y=u,p.name=Math.floor(l)+"_"+Math.floor(u),i.mapThingMap[p.name]=[o,p],n.emit(d.GEVT.ChangeMapThingXY,{x:l,y:u,width:o.width,height:o.height})}},r.onFocusOutAnchorX=function(t){var e=this.mapMgr,n=e.curMapThingInfo;if(n){var i=e.getMapThingCompByXY(n.x,n.y),o=t.string,r=/^[\.\d]*$/.test(o);n.anchorX=r?Number(o):n.anchorX;var a=n.anchorX,p=n.anchorY;h.setPivot(i,a,p),r||(t.string=a+"",_.show({msg:"输入内容不合法"}))}},r.onFocusOutAnchorY=function(t){var e=this.mapMgr,n=e.curMapThingInfo;if(n){var i=e.getMapThingCompByXY(n.x,n.y),o=t.string,r=/^[\.\d]*$/.test(o);n.anchorY=r?Number(o):n.anchorY;var a=n.anchorX,p=n.anchorY;h.setPivot(i,a,p),r||(t.string=p+"",_.show({msg:"输入内容不合法"}))}},e}(s)).prototype,"lbl_propertyName",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),B=e(S.prototype,"lbl_taskId",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),F=e(S.prototype,"lbl_groupId",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D=e(S.prototype,"lbl_groupId2",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),L=e(S.prototype,"lbl_x",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),V=e(S.prototype,"lbl_y",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H=e(S.prototype,"lbl_anchorX",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),W=e(S.prototype,"lbl_anchorY",[X],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$=e(S.prototype,"lbl_thingRect",[Y],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),j=e(S.prototype,"lbl_thingName",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),J=e(S.prototype,"combo_taskType",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),q=e(S.prototype,"combo_triggerType",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),K=e(S.prototype,"grp_mapThingInfo",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Q=e(S.prototype,"grp_bevel",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Z=e(S.prototype,"btn_XReduce",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tt=e(S.prototype,"btn_XAdd",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),et=e(S.prototype,"btn_YReduce",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nt=e(S.prototype,"btn_YAdd",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),U=S))||U));r._RF.pop()}}}));

System.register("chunks:///_virtual/mapThingSelect.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIComp.ts","./CONST.ts","./MapMgr.ts"],(function(i){var a,r,t,c,e,n,o,s;return{setters:[function(i){a=i.inheritsLoose,r=i.createClass},function(i){t=i.cclegacy,c=i._decorator,e=i.Graphics},function(i){n=i.UIComp},function(i){o=i.CONST},function(i){s=i.MapMgr}],execute:function(){var h;t._RF.push({},"1f1afNcum1O1az0psI7TSAW","mapThingSelect",void 0);var p=c.ccclass;c.property,i("mapThingSelect",p("mapThingSelect")(h=function(i){function t(){for(var a,r=arguments.length,t=new Array(r),c=0;c<r;c++)t[c]=arguments[c];return(a=i.call.apply(i,[this].concat(t))||this)._graphics=void 0,a._isShow=void 0,a._curDrawInfo=void 0,a.mapMgr=void 0,a}a(t,i);var c=t.prototype;return c.onEnter=function(){var i=this;i.mapMgr=s.inst,i.onEmitter(o.GEVT.UpdateMapScale,i.onMapScaleChg)},c.onMapScaleChg=function(){var i=this;if(i._isShow){var a=i._curDrawInfo;i.drawRect(a.x,a.y,a.width,a.height,a.alpha)}},c.drawRect=function(i,a,r,t,c){void 0===c&&(c=1);var n=this;n._graphics||(n._graphics=n.node.getComponent(e)),n._curDrawInfo={x:i,y:a,width:r,height:t,alpha:c};var o=4/n.mapMgr.mapScale,s=o/2;n._graphics.clear(),n._graphics.lineWidth=o,n._graphics.moveTo(i-s,a-s),n._graphics.lineTo(i+r+s,a-s),n._graphics.lineTo(i+r+s,a+t+s),n._graphics.lineTo(i-s,a+t+s),n._graphics.lineTo(i-s,a-s),n._graphics.stroke(),n._isShow=!0},c.clear=function(){var i=this;i._graphics&&i._graphics.clear(),i._isShow=!1},r(t,[{key:"isShow",get:function(){return this._isShow}}]),t}(n))||h);t._RF.pop()}}}));

System.register("chunks:///_virtual/MessageTip.ts",["./rollupPluginModLoBabelHelpers.js","cc","./SceneMgr.ts"],(function(e){var t,r,n,s,o,a,i,l,c,u,p,g,f,m,b,y;return{setters:[function(e){t=e.applyDecoratedDescriptor,r=e.inheritsLoose,n=e.initializerDefineProperty,s=e.assertThisInitialized,o=e.asyncToGenerator,a=e.regeneratorRuntime},function(e){i=e.cclegacy,l=e._decorator,c=e.Label,u=e.tween,p=e.Vec3,g=e.Component,f=e.instantiate,m=e.resources,b=e.Prefab},function(e){y=e.SceneMgr}],execute:function(){var d,h,v,_,w,M,T,D;i._RF.push({},"c821bE2xlFB/YKnGjjQYccl","MessageTip",void 0);var P=l.ccclass,x=l.property;e("MessageTip",(d=P("MessageTip"),h=x({type:c}),v=x({type:c}),d(((D=function(e){function t(){for(var t,r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return t=e.call.apply(e,[this].concat(o))||this,n(t,"lbl_msg",M,s(t)),n(t,"lbl_msg1",T,s(t)),t}return r(t,e),t.show=function(){var e=o(a().mark((function e(r){var n,s,o,i;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.prefabUrl,e.next=3,new Promise((function(e,t){var r=m.get(n);if(r)return console.log("resName: "+n+"加载完毕(缓存已有)"),e(r);m.load(n,b,(function(r,s){r?(console.log("resName: "+n+"加载失败"),t(r)):(console.log("resName: "+n+"加载完毕"),e(s))}))}));case 3:return s=e.sent,o=f(s),(i=o.getComponent(t)).setData(r),o.setParent(y.inst.curScene.msg),e.abrupt("return",i);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),t.prototype.setData=function(e){var t=this;t.lbl_msg.string=t.lbl_msg1.string=e.msg,u(t.node).to(.5,{position:new p(0,60,0)},{easing:"elasticOut"}).delay(.8).call((function(){t.node.destroy()})).start()},t}(g)).prefabUrl="prefab/common/MessageTip",M=t((w=D).prototype,"lbl_msg",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),T=t(w.prototype,"lbl_msg1",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_=w))||_));i._RF.pop()}}}));

System.register("chunks:///_virtual/ModuleCfgInfo.ts",["cc"],(function(e){var t;return{setters:[function(e){t=e.cclegacy}],execute:function(){t._RF.push({},"802ea/uTaVN97NyAr/lScbS","ModuleCfgInfo",void 0);e("ModuleCfgInfo",(function(){this.targetClass=void 0,this.name=void 0,this.cacheEnabled=void 0,this.preResList=void 0}));t._RF.pop()}}}));

System.register("chunks:///_virtual/ModuleMgr.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ModuleCfgInfo.ts"],(function(e){var n,t,s,u;return{setters:[function(e){n=e.createClass},function(e){t=e.cclegacy,s=e.js},function(e){u=e.ModuleCfgInfo}],execute:function(){e("registerModule",(function(e,n,t){var i=new u;i.targetClass=e,i.name=s.getClassName(e),i.cacheEnabled=t,i.preResList=n,o[i.name]=i})),t._RF.push({},"c3e75NNacJMkZL7B89FwtDv","ModuleMgr",void 0),e("ModuleMgr",function(){function e(){}return n(e,null,[{key:"inst",get:function(){return this._inst||(this._inst=new e),this._inst}}]),e}())._inst=void 0;var o=e("moduleInfoMap",{});t._RF.pop()}}}));

System.register("chunks:///_virtual/Nodes.ts",["cc"],(function(t){var i,o;return{setters:[function(t){i=t.cclegacy,o=t._decorator}],execute:function(){var e;i._RF.push({},"ca8904DRoVOz6T7l8wyJAOp","Nodes",void 0);var r=o.ccclass;o.property,t("Nodes",r("Nodes")(e=function(){function t(){this.x=void 0,this.y=void 0,this.f=void 0,this.g=void 0,this.h=void 0,this.walkable=!0,this.parent=void 0,this.costMultiplier=1}var i=t.prototype;return i.init=function(t,i){this.x=t,this.y=i},i.toString=function(){var t=this;return"x="+t.x.toString()+",y="+t.y.toString()+",g="+Number(t.g).toFixed(1)+",h="+Number(t.h).toFixed(1)+",f="+Number(t.f).toFixed(1)},t}())||e);i._RF.pop()}}}));

System.register("chunks:///_virtual/PathFindingAgent.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseUtil.ts","./CONST.ts","./MapMgr.ts","./AstarHoneycombRoadSeeker.ts","./AStarRoadSeeker.ts","./MapRoadUtils.ts"],(function(e){var t,i,a,o,n,s,r,h;return{setters:[function(e){t=e.createClass},function(e){i=e.cclegacy},function(e){a=e.BaseUT},function(e){o=e.CONST},function(e){n=e.MapMgr},function(e){s=e.default},function(e){r=e.default},function(e){h=e.default}],execute:function(){i._RF.push({},"8adbePOHkJNMJDq5I1kro9n","PathFindingAgent",void 0),e("default",function(){function e(){this._roadDic={},this._roadSeeker=void 0,this._mapData=null,this._mapType=o.MapType.angle45,this._round=[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]],this._round1=[[0,-1],[1,-1],[1,0],[0,1],[-1,0],[-1,-1]],this._round2=[[0,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0]]}var i=e.prototype;return i.init=function(e){this._mapData=e,this._mapType=e.type,h.instance.updateMapInfo(this._mapData.mapWidth,this._mapData.mapHeight,this._mapData.cellSize,this._mapData.cellSize,this._mapData.type);var t=this._mapData.walkList.length;if(t){for(var i=this._mapData.walkList[0].length,a=0,n=0,d=0,u=0,c=0,p=0;p<t;p++)for(var l=0;l<i;l++){a=this._mapData.walkList[p][l],n=l,d=p;var _=h.instance.getNodeByDerect(n,d);_.value=a,this._mapType==o.MapType.honeycomb2&&(u=_.col,c=_.row,_.col=c,_.row=u),this._roadDic[_.col+"_"+_.row]=_}this._mapType==o.MapType.honeycomb||this._mapType==o.MapType.honeycomb2?this._roadSeeker=new s(this._roadDic):this._roadSeeker=new r(this._roadDic)}},i.seekPath=function(e,t,i,a,o){var n=this.getRoadNodeByPixel(e,t),s=this.getRoadNodeByPixel(i,a),r=this.getSeekSize(o);return this._roadSeeker.seekPath(n,s,r)},i.seekPath2=function(e,t,i,a,o){var n=this.getRoadNodeByPixel(e,t),s=this.getRoadNodeByPixel(i,a),r=this.getSeekSize(o);return this._roadSeeker.seekPath2(n,s,r)},i.testSeekRoad=function(e,t,i,a,o,n,s,r){var h=this.getRoadNodeByPixel(e,t),d=this.getRoadNodeByPixel(i,a),u=this.getSeekSize(o);this._roadSeeker.testSeekPathStep(h,d,u,n,s,r)},i.getSeekSize=function(e){void 0===e&&(e=0);var t=this._mapData,i=Math.min(t.cellSize/2,t.cellSize/2),a=Math.ceil((e-i)/(2*i));return a>0?a:0},i.isArriveBetweenTwoNodes=function(e,t){return null!=e&&null!=t&&this._roadSeeker.isArriveBetweenTwoNodes(e,t)},i.isArriveBetweenTwoPos=function(e,t,i,a){var o=this.getRoadNodeByPixel(e,t),n=this.getRoadNodeByPixel(i,a);return this._roadSeeker.isArriveBetweenTwoNodes(o,n)},i.getRoadNodeByPixel=function(e,t){var i=h.instance.getWorldPointByPixel(e,t);return this._mapType==o.MapType.honeycomb2?this.getRoadNode(i.y,i.x):this.getRoadNode(i.x,i.y)},i.getRoadNode=function(e,t){return this._roadSeeker.getRoadNode(e,t)},i.getRoundRoadNodes=function(e,t){if(void 0===t&&(t=!1),null==e)return[];var i=[];t&&i.push(e),this.mapType==o.MapType.honeycomb||this.mapType==o.MapType.honeycomb2?e.col%2==0?this._round1:this._round2:this._round;for(var a=0;a<this._round.length;a++){var n=e.col+this._round[a][0],s=e.row+this._round[a][1];i.push(this.getRoadNode(n,s))}return i},i.setMaxSeekStep=function(e){this._roadSeeker.setMaxSeekStep(e)},i.setPathOptimize=function(e){this._roadSeeker.setPathOptimize(e)},i.setPathQuadSeek=function(e){this._roadSeeker.setPathQuadSeek(e)},i.setRoadNodePassCondition=function(e){this._roadSeeker.setRoadNodePassCondition(e)},i.getRandomStartPos=function(){var e=this._mapData.startList;if(!e||!e.length)return{x:0,y:0};var t=a.getRandomNumber(0,e.length-1),i=n.inst.idx2Pos(e[t]);return i.x+=n.inst.cellSize/2,i},i.isCanMoveTo=function(e,t,i){var a=i?{col:e,row:t}:n.inst.pos2Grid(e,t),o=this._roadDic[a.col+"_"+a.row];return o&&1==o.value},t(e,[{key:"mapType",get:function(){return this._mapType}},{key:"mapData",get:function(){return this._mapData}},{key:"roadSeeker",get:function(){return this._roadSeeker}}],[{key:"inst",get:function(){return null==this._instance&&(this._instance=new e),this._instance}}]),e}())._instance=void 0,i._RF.pop()}}}));

System.register("chunks:///_virtual/PathIR.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ListItem.ts","./MapMgr.ts"],(function(e){var t,i,r,a,l,n,o,c,p,s;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.inheritsLoose,r=e.initializerDefineProperty,a=e.assertThisInitialized},function(e){l=e.cclegacy,n=e._decorator,o=e.Graphics,c=e.Label},function(e){p=e.ListItem},function(e){s=e.MapMgr}],execute:function(){var u,h,g,y,f,b,z;l._RF.push({},"9c338KgPklH/Zkpsy8Mqhyu","PathIR",void 0);var d=n.ccclass,m=n.property;e("PathIR",(u=d("PathIR"),h=m({type:o,tooltip:"物件资源图片"}),g=m({type:c,tooltip:"路径类型"}),u((b=t((f=function(e){function t(){for(var t,i=arguments.length,l=new Array(i),n=0;n<i;n++)l[n]=arguments[n];return t=e.call.apply(e,[this].concat(l))||this,r(t,"graphicsSize",b,a(t)),r(t,"lbl_name",z,a(t)),t}return i(t,e),t.prototype.dchg=function(){var e=this,t=e.data;e.lbl_name.string=t.desc;var i=s.inst.getColorByType(t.gridType);e.graphicsSize.clear(),e.graphicsSize.fillColor.fromHEX(i),e.graphicsSize.rect(-40,-40,80,80),e.graphicsSize.fill()},t}(p)).prototype,"graphicsSize",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z=t(f.prototype,"lbl_name",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),y=f))||y));l._RF.pop()}}}));

System.register("chunks:///_virtual/PathOptimize.ts",["cc"],(function(e){var t;return{setters:[function(e){t=e.cclegacy}],execute:function(){t._RF.push({},"e2e9cAefOZGUbZd0Nc78JCX","PathOptimize",void 0);e("PathOptimize",function(e){return e[e.none=0]="none",e[e.better=1]="better",e[e.best=2]="best",e}({}));t._RF.pop()}}}));

System.register("chunks:///_virtual/PathQuadSeek.ts",["cc"],(function(e){var t;return{setters:[function(e){t=e.cclegacy}],execute:function(){t._RF.push({},"433bfqoDBRNpLyhTW1iHMRn","PathQuadSeek",void 0);e("PathQuadSeek",function(e){return e[e.path_dire_4=0]="path_dire_4",e[e.path_dire_8=1]="path_dire_8",e}({}));t._RF.pop()}}}));

System.register("chunks:///_virtual/PathSizeIR.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ListItem.ts"],(function(i){var e,r,t,a,c,o,n,s;return{setters:[function(i){e=i.applyDecoratedDescriptor,r=i.inheritsLoose,t=i.initializerDefineProperty,a=i.assertThisInitialized},function(i){c=i.cclegacy,o=i._decorator,n=i.Graphics},function(i){s=i.ListItem}],execute:function(){var l,p,u,h,f;c._RF.push({},"4befdIS91tCOrS6fTifoPTr","PathSizeIR",void 0);var z=o.ccclass,S=o.property;i("PathSizeIR",(l=z("PathSizeIR"),p=S({type:n,tooltip:"物件资源图片"}),l((f=e((h=function(i){function e(){for(var e,r=arguments.length,c=new Array(r),o=0;o<r;o++)c[o]=arguments[o];return e=i.call.apply(i,[this].concat(c))||this,t(e,"graphicsSize",f,a(e)),e}return r(e,i),e.prototype.dchg=function(){var i=this,e=i.data.radius;i.graphicsSize.clear(),i.graphicsSize.fillColor.fromHEX("#000000"),i.graphicsSize.circle(0,0,e),i.graphicsSize.fill()},e}(s)).prototype,"graphicsSize",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),u=h))||u));c._RF.pop()}}}));

System.register("chunks:///_virtual/Player.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIComp.ts","./MapMgr.ts","./PathFindingAgent.ts","./BaseUtil.ts"],(function(i){var e,r,o,t,n,a,s,c,l,u,d,p,y,_;return{setters:[function(i){e=i.applyDecoratedDescriptor,r=i.inheritsLoose,o=i.initializerDefineProperty,t=i.assertThisInitialized,n=i.createClass},function(i){a=i.cclegacy,s=i._decorator,c=i.Node,l=i.UITransform,u=i.Graphics},function(i){d=i.UIComp},function(i){p=i.MapMgr},function(i){y=i.default},function(i){_=i.BaseUT}],execute:function(){var f,h,v,g,m,x,C;a._RF.push({},"1668bb4K3VL5LyYKpnWwWGa","Player",void 0);var M=s.ccclass,b=s.property;i("Player",(f=M("Player"),h=b({type:c}),v=b({type:c}),f((x=e((m=function(i){function e(){for(var e,r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];return e=i.call.apply(i,[this].concat(n))||this,o(e,"sp_player",x,t(e)),o(e,"collider",C,t(e)),e._uiTranstorm=void 0,e.speed=void 0,e._dir=void 0,e._cx=void 0,e._cy=void 0,e._cRadius=void 0,e}r(e,i);var a=e.prototype;return a.ctor=function(){var i=this;i.speed=4,i._uiTranstorm=i.node.getComponent(l),i._cx=0,i._cy=25,i._cRadius=25;var e=i.collider.getComponent(u),r=e.fillColor;r.fromHEX("00FFFF"),e.fillColor.set(r.r,r.g,r.b,153),e.circle(i._cx,i._cy,i._cRadius),e.fill()},a.moveByJoyStick=function(i){for(var e=this,r=e.node.position,o=Math.cos(i),t=Math.sin(i),n=r.x+e.speed*o,a=r.y+e.speed*t,s=y.inst,c=p.inst,l=c.cellSize,u=o>0?1:-1,d=!0,f=n-e._cRadius+e._cx,h=n+e._cRadius+e._cx,v=r.y,g=r.y+2*e._cRadius,m=1==u?c.pos2Grid(h,r.y).col:c.pos2Grid(f,r.y).col,x=Math.round(v/l),C=Math.round(g/l),M={cx:n+e._cx,cy:r.y+e._cy,r:e._cRadius},b=x,w=C;b<w;b++){var R={x:m*l,y:b*l,w:l,h:l};if(_.RectCircleColliding(M,R)&&!s.isCanMoveTo(m,b,!0)){d=!1,console.warn("第"+b+"列不可行走");break}}for(var P=!0,T=t>0?c.pos2Grid(r.x,g).row:c.pos2Grid(r.x,v).row,F=Math.round(f/l),k=Math.round(h/l);F<k;F++){var G={x:F*l,y:T*l,w:l,h:l};if(_.RectCircleColliding(M,G)&&!s.isCanMoveTo(F,T,!0)){P=!1,console.warn("第"+F+"行不可行走");break}}d&&e.node.setPosition(n,r.y),P&&e.node.setPosition(r.x,a),e.setDir(u)},a.setDir=function(i){var e=this;if(e._dir!=i){e._dir=i;var r=e.sp_player.scale;e.sp_player.setScale(i,r.y)}},n(e,[{key:"width",get:function(){return this._uiTranstorm.width}},{key:"height",get:function(){return this._uiTranstorm.height}}]),e}(d)).prototype,"sp_player",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),C=e(m.prototype,"collider",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),g=m))||g));a._RF.pop()}}}));

System.register("chunks:///_virtual/Point.ts",["cc"],(function(t){var i;return{setters:[function(t){i=t.cclegacy}],execute:function(){i._RF.push({},"85eb3ZSo0RPkr9hx9TZmKnp","Point",void 0);t("default",(function(t,i){void 0===t&&(t=0),void 0===i&&(i=0),this.x=0,this.y=0,this.x=t,this.y=i}));i._RF.pop()}}}));

System.register("chunks:///_virtual/ResMgr.ts",["./rollupPluginModLoBabelHelpers.js","cc","./JuHuaDlg.ts"],(function(e){var t,n,o,r,a,s,u,i,l,c,h;return{setters:[function(e){t=e.createClass,n=e.asyncToGenerator,o=e.regeneratorRuntime},function(e){r=e.cclegacy,a=e.assetManager,s=e.SpriteFrame,u=e.Texture2D,i=e.resources,l=e.Asset,c=e.Prefab},function(e){h=e.JuHuaDlg}],execute:function(){r._RF.push({},"f9d1cbIYAVJf4Zd+nmUKR1h","ResMgr",void 0),e("ResMgr",function(){function e(){this.curSceneName=void 0,this.moduleResMap=void 0,this._juHuaDlg=void 0,this._localTexture=void 0}var r=e.prototype;return r.closeJuHuaDlg=function(){this._juHuaDlg&&(this._juHuaDlg.close(),this._juHuaDlg=null)},r.loadPrefab=function(){var e=n(o().mark((function e(t){var n=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,o){var r=n.get(t);if(r)return console.log("resName: "+t+"加载完毕(缓存已有)"),n.pushResNametoMap(t),e(r);i.load(t,c,(function(r,a){r?(console.log("resName: "+t+"加载失败"),o(r)):(console.log("resName: "+t+"加载完毕"),n.pushResNametoMap(t),e(a))}))})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r._loadWithItor=function(){var e=n(o().mark((function e(t,n,r,a,s,u){var c,f,d,g,p,v,x,_,m,R,b=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===s&&(s=!0),c=this,d=(f="string"==typeof t?[t]:t).length,g=0,!s){e.next=20;break}p=!0,v=0;case 8:if(!(v<d)){e.next=16;break}if(x=f[v],this.get(x)){e.next=13;break}return p=!1,e.abrupt("break",16);case 13:v++,e.next=8;break;case 16:if(p||this._juHuaDlg||"IndexScene"==u){e.next=20;break}return e.next=19,h.show(4);case 19:c._juHuaDlg=e.sent;case 20:_=function(e,t){g++,console.log("resName: "+e+"加载完毕"+(t?"(缓存已有)":"")),b.pushResNametoMap(e,u),n&&n.call(a,e,g),g==d&&(b.closeJuHuaDlg(),r&&r.call(a))},m=o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=f[R],b.get(t)?_(t,!0):i.load(t,l,(function(e,n){e?console.error(e):_(t)}));case 2:case"end":return e.stop()}}),e)})),R=0;case 23:if(!(R<d)){e.next=28;break}return e.delegateYield(m(),"t0",25);case 25:R++,e.next=23;break;case 28:case"end":return e.stop()}}),e,this)})));return function(t,n,o,r,a,s){return e.apply(this,arguments)}}(),r._loadWithProgress=function(){var e=n(o().mark((function e(t,n,r,a,s,u){var l,c,f,d,g,p,v,x,_,m,R=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===s&&(s=!0),l=this,f=(c="string"==typeof t?[t]:t).length,d=0,!s){e.next=20;break}g=!0,p=0;case 8:if(!(p<f)){e.next=16;break}if(v=c[p],this.get(v)){e.next=13;break}return g=!1,e.abrupt("break",16);case 13:p++,e.next=8;break;case 16:if(g||this._juHuaDlg){e.next=20;break}return e.next=19,h.show(4);case 19:l._juHuaDlg=e.sent;case 20:x=function(e,t){d++,console.log("resName: "+e+"加载完毕"+(t?"(缓存已有)":"")),R.pushResNametoMap(e,u),d==f&&(R.closeJuHuaDlg(),r&&r.call(a))},_=o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=c[m],R.get(t)?x(t,!0):i.load(t,(function(e,t,o){n.call(a,e,t,o)}),(function(e,n){e?console.error(e):x(t)}));case 2:case"end":return e.stop()}}),e)})),m=0;case 23:if(!(m<f)){e.next=28;break}return e.delegateYield(_(),"t0",25);case 25:m++,e.next=23;break;case 28:case"end":return e.stop()}}),e,this)})));return function(t,n,o,r,a,s){return e.apply(this,arguments)}}(),r.loadWithProgress=function(e,t,n,o,r){void 0===r&&(r=!0),this._loadWithProgress(e,t,n,o,r)},r.loadWithItor=function(e,t,n,o,r){void 0===r&&(r=!0),this._loadWithItor(e,t,n,o,r)},r.loadToWithItor=function(e,t,n,o,r,a){void 0===a&&(a=!0),this._loadWithItor(t,n,o,r,a,e)},r.load=function(e,t,n){this._loadWithItor(e,null,t,n)},r.loadTo=function(e,t,n,o){this._loadWithItor(t,null,n,o,!0,e)},r.loadWithoutJuHua=function(e,t,n){this._loadWithItor(e,null,t,n,!1)},r.loadToWithoutJuHua=function(e,t,n,o){this._loadWithItor(t,null,n,o,!1,e)},r.loadLocalImg=function(e,t,n){var o=this;a.loadRemote(e,{ext:".png"},(function(e,r){var a=new s,i=new u;i.image=r,a.texture=i,i.addRef(),o._localTexture.push(i),t&&t.call(n,a)}))},r.decRefLocalImg=function(){for(var e=this._localTexture.length,t=0;t<e;t++)this._localTexture[t].decRef()},r.relaseAllLocal=function(){var e=this;console.log("清除前数量："+e._localTexture.length);for(var t=0,n=e._localTexture.length-1;n>=0;n--){var o=e._localTexture[n];o.refCount||(t++,e._localTexture.splice(n,1),a.releaseAsset(o))}console.log("清除所有本地无用资源！！！清除数量："+t),console.log("清除后数量："+e._localTexture.length)},r.get=function(e){return i.get(e)},r.releaseRes=function(e){for(var t="string"==typeof e?[e]:e,n=0;n<t.length;n++){var o=t[n];this.get(o)&&(i.release(o),console.log("释放资源: "+o))}},r.releaseResModule=function(e){var t=[],n=this.moduleResMap[e];n&&(delete this.moduleResMap[e],t=t.concat(n)),this.releaseRes(t)},r.pushResNametoMap=function(e,t){var n=this,o=t||n.curSceneName,r=n.moduleResMap.global||[],a=n.moduleResMap[o]=n.moduleResMap[o]||[];-1==r.indexOf(e)&&-1==a.indexOf(e)&&a.push(e)},r.setGlobal=function(){for(var e=0;e<arguments.length;e++)this.pushResNametoMap(e<0||arguments.length<=e?void 0:arguments[e],"global")},t(e,null,[{key:"inst",get:function(){return this._inst||(this._inst=new e,this._inst.moduleResMap={},this._inst._localTexture=[]),this._inst}}]),e}())._inst=void 0,r._RF.pop()}}}));

System.register("chunks:///_virtual/RoadNode.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,n;return{setters:[function(t){e=t.createClass},function(t){n=t.cclegacy}],execute:function(){n._RF.push({},"b5640PRj6BI465jXHZNy45K","RoadNode",void 0);t("default",function(){function t(){this._px=void 0,this._py=void 0,this._col=void 0,this._row=void 0,this._dx=void 0,this._dy=void 0,this._value=0,this._f=0,this._g=0,this._h=0,this._parent=null,this._treeParent=null,this._left=null,this._right=null,this._openTag=0,this._closeTag=0}var n=t.prototype;return n.resetTree=function(){this._treeParent=null,this._left=null,this._right=null},n.toString=function(){return"路点像素坐标：（"+this._px+","+this._py+"),  路点世界坐标：（"+this._col+","+this._row+"),  路点平面直角坐标：（"+this._dx+","+this._dy+")"},e(t,[{key:"px",get:function(){return this._px},set:function(t){this._px=t}},{key:"py",get:function(){return this._py},set:function(t){this._py=t}},{key:"col",get:function(){return this._col},set:function(t){this._col=t}},{key:"row",get:function(){return this._row},set:function(t){this._row=t}},{key:"dx",get:function(){return this._dx},set:function(t){this._dx=t}},{key:"dy",get:function(){return this._dy},set:function(t){this._dy=t}},{key:"value",get:function(){return this._value},set:function(t){this._value=t}},{key:"f",get:function(){return this._f},set:function(t){this._f=t}},{key:"g",get:function(){return this._g},set:function(t){this._g=t}},{key:"h",get:function(){return this._h},set:function(t){this._h=t}},{key:"parent",get:function(){return this._parent},set:function(t){this._parent=t}},{key:"treeParent",get:function(){return this._treeParent},set:function(t){this._treeParent=t}},{key:"left",get:function(){return this._left},set:function(t){this._left=t}},{key:"right",get:function(){return this._right},set:function(t){this._right=t}},{key:"openTag",get:function(){return this._openTag},set:function(t){this._openTag=t}},{key:"closeTag",get:function(){return this._closeTag},set:function(t){this._closeTag=t}}]),t}());n._RF.pop()}}}));

System.register("chunks:///_virtual/rodeTest.js",["./cjs-loader.mjs"],(function(t,e){var i;return{setters:[function(t){i=t.default}],execute:function(){t("default",void 0);var n=t("__cjsMetaURL",e.meta.url);i.define(n,(function(e,i,n,o,r){var s,a;System.register("chunks:///_virtual/Actor.ts",["./rollupPluginModLoBabelHelpers.js","cc","./NavUnit.ts"],(function(t){var e,i,n,o;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,n=t._decorator},function(t){o=t.default}],execute:function(){var r;i._RF.push({},"697c0YMyJNE4YASev2ekfVg","Actor",void 0);var s=n.ccclass;n.property,t("default",s("Actor")(r=function(t){function i(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this)._lastRoadNode=null,e}e(i,t);var n=i.prototype;return n.onLoad=function(){t.prototype.onLoad.call(this)},n.start=function(){t.prototype.start.call(this)},n.update=function(e){t.prototype.update.call(this,e),this.updateActorStateByNode()},n.updateActorStateByNode=function(){var t=this.roadNode;if(t!=this._lastRoadNode&&(this._lastRoadNode=t,this._lastRoadNode))switch(this._lastRoadNode.value){case 2:.4!=this.alpha&&(this.alpha=.4);break;case 3:this.alpha>0&&(this.alpha=0);break;default:this.alpha<1&&(this.alpha=1)}},i}(o))||r),i._RF.pop()}}})),System.register("chunks:///_virtual/Actor2.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Unit.ts","./Actor.ts"],(function(t){var e,i,n,o,r,s,a,l,h,c,u,d,p;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized,r=t.createClass},function(t){s=t.cclegacy,a=t._decorator,l=t.CCBoolean,h=t.CCFloat,c=t.CCInteger,u=t.Vec2},function(t){d=t.UnitState},function(t){p=t.default}],execute:function(){var f,g,y,m,v,_,b,P,x;s._RF.push({},"f05eeJGSLFCfYlOD/5ZskEP","Actor2",void 0);var T=a.ccclass,C=a.property;t("default",(f=T("Actor2"),g=C(l),y=C(h),m=C(c),f((b=e((_=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,n(e,"isPatrol",b,o(e)),n(e,"patrolRange",P,o(e)),n(e,"defaultDir",x,o(e)),e.basePos=null,e.targetPos=new u,e.timer=3.5,e.isStopPatrol=!1,e}i(e,t);var s=e.prototype;return s.start=function(){t.prototype.start.call(this),this.basePos=this.node.position,this.timer=this.Range(.5,1.5)},s.update=function(e){t.prototype.update.call(this,e),this.isStopPatrol||this.isPatrol&&(this.timer-=e,this.timer<=0&&(this.timer=this.Range(1.5,4),this.patrol()))},s.Range=function(t,e){return e>t?Math.random()*(e-t)+t:Math.random()*(t-e)+e},s.patrol=function(){this.targetPos.x=this.basePos.x+this.Range(-this.patrolRange,this.patrolRange),this.targetPos.y=this.basePos.y+this.Range(-this.patrolRange,this.patrolRange),this.navTo(this.targetPos.x,this.targetPos.y)},r(e,[{key:"direction",get:function(){return this._direction},set:function(t){var e;this._direction=t,t>4?(this.movieClip.rowIndex=4-t%4,(e=this.movieClip.node.scale).x=-1,this.movieClip.node.scale=e):(this.movieClip.rowIndex=t,(e=this.movieClip.node.scale).x=1,this.movieClip.node.scale=e)}},{key:"state",get:function(){return this._state},set:function(t){this._state=t;var e=this.movieClip.col/2;switch(this._state){case d.idle:this.movieClip.begin=0,this.movieClip.end=e;break;case d.walk:this.movieClip.begin=e,this.movieClip.end=this.movieClip.col}}}]),e}(p)).prototype,"isPatrol",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),P=e(_.prototype,"patrolRange",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 200}}),x=e(_.prototype,"defaultDir",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),v=_))||v)),s._RF.pop()}}})),System.register("chunks:///_virtual/Agent.ts",["cc","./Common.ts"],(function(t){var e,i,n,o,r;return{setters:[function(t){e=t.cclegacy},function(t){i=t.RVOMath,n=t.Vector2,o=t.KeyValuePair,r=t.Line}],execute:function(){e._RF.push({},"99d7fX9+uZBBrp6k8HimNAB","Agent",void 0),t("Agent",function(){function t(){this.agentNeighbors_=[],this.obstaclNeighbors_=[],this.orcaLines_=[],this.position_=new n(0,0),this.prefVelocity_=new n(0,0),this.velocity_=new n(0,0),this.id=0,this.maxNeighbors_=0,this.maxSpeed_=0,this.neighborDist=0,this.radius_=0,this.timeHorizon=0,this.timeHorizonObst=0,this.newVelocity_=new n(0,0),this.mass=1}var e=t.prototype;return e.computeNeighbors=function(t){this.obstaclNeighbors_.length=0;var e=Math.pow(this.timeHorizonObst*this.maxSpeed_+this.radius_,2);t.kdTree.computeObstacleNeighbors(this,e),this.agentNeighbors_.length=0,this.maxNeighbors_>0&&(e=Math.pow(this.neighborDist,2),e=t.kdTree.computeAgentNeighbors(this,e))},e.computeNewVelocity=function(t){this.orcaLines_.length=0;for(var e=this.orcaLines_,o=1/this.timeHorizonObst,s=0;s<this.obstaclNeighbors_.length;++s){for(var a=this.obstaclNeighbors_[s].value,l=a.next,h=a.point.minus(this.position_),c=l.point.minus(this.position_),u=!1,d=0;d<e.length;++d)if(i.det(h.scale(o).minus(e[d].point),e[d].direction)-o*this.radius_>=-i.RVO_EPSILON&&i.det(c.scale(o).minus(e[d].point),e[d].direction)-o*this.radius_>=-i.RVO_EPSILON){u=!0;break}if(!u){var p=i.absSq(h),f=i.absSq(c),g=i.sqr(this.radius_),y=l.point.minus(a.point),m=h.scale(-1).multiply(y)/i.absSq(y),v=i.absSq(h.scale(-1).minus(y.scale(m))),_=new r;if(m<0&&p<=g)a.convex&&(_.point=new n(0,0),_.direction=i.normalize(new n(-h.y,h.x)),e.push(_));else if(m>1&&f<=g)l.convex&&i.det(c,l.direction)>=0&&(_.point=new n(0,0),_.direction=i.normalize(new n(-c.y,c.x)),e.push(_));else if(m>=0&&m<=1&&v<=g)_.point=new n(0,0),_.direction=a.direction.scale(-1),e.push(_);else{var b=void 0,P=void 0;if(m<0&&v<=g){if(!a.convex)continue;l=a;var x=Math.sqrt(p-g);b=new n(h.x*x-h.y*this.radius_,h.x*this.radius_+h.y*x).scale(1/p),P=new n(h.x*x+h.y*this.radius_,-h.x*this.radius_+h.y*x).scale(1/p)}else if(m>1&&v<=g){if(!l.convex)continue;a=l;var T=Math.sqrt(f-g);b=new n(c.x*T-c.y*this.radius_,c.x*this.radius_+c.y*T).scale(1/f),P=new n(c.x*T+c.y*this.radius_,-c.x*this.radius_+c.y*T).scale(1/f)}else{if(a.convex){var C=Math.sqrt(p-g);b=new n(h.x*C-h.y*this.radius_,h.x*this.radius_+h.y*C).scale(1/p)}else b=a.direction.scale(-1);if(l.convex){var N=Math.sqrt(f-g);P=new n(c.x*N+c.y*this.radius_,-c.x*this.radius_+c.y*N).scale(1/f)}else P=a.direction}var w=a.previous,M=!1,S=!1;a.convex&&i.det(b,w.direction.scale(-1))>=0&&(b=w.direction.scale(-1),M=!0),l.convex&&i.det(P,l.direction)<=0&&(P=l.direction,S=!0);var k=a.point.minus(this.position_).scale(o),D=l.point.minus(this.position_).scale(o),R=D.minus(k),A=a==l?.5:this.velocity_.minus(k).multiply(R)/i.absSq(R),I=this.velocity_.minus(k).multiply(b),L=this.velocity_.minus(D).multiply(P);if(A<0&&I<0||a==l&&I<0&&L<0){var B=i.normalize(this.velocity_.minus(k));_.direction=new n(B.y,-B.x),_.point=k.plus(B.scale(this.radius_*o)),e.push(_)}else if(A>1&&L<0){var O=i.normalize(this.velocity_.minus(D));_.direction=new n(O.y,-O.x),_.point=D.plus(O.scale(this.radius_*o)),e.push(_)}else{var z=A<0||A>1||a==l?1/0:i.absSq(this.velocity_.minus(R.scale(A).plus(k))),F=I<0?1/0:i.absSq(this.velocity_.minus(b.scale(I).plus(k))),E=L<0?1/0:i.absSq(this.velocity_.minus(P.scale(L).plus(D)));if(z<=F&&z<=E){_.direction=a.direction.scale(-1);var H=new n(-_.direction.y,_.direction.x);_.point=H.scale(this.radius_*o).plus(k),e.push(_)}else if(F<=E){if(M)continue;_.direction=b;var U=new n(-_.direction.y,_.direction.x);_.point=U.scale(this.radius_*o).plus(k),e.push(_)}else if(!S){_.direction=P.scale(-1);var V=new n(-_.direction.y,_.direction.x);_.point=V.scale(this.radius_*o).plus(D),e.push(_)}}}}}for(var W=e.length,j=1/this.timeHorizon,G=0;G<this.agentNeighbors_.length;++G){var q=this.agentNeighbors_[G].value,Y=q.position_.minus(this.position_),K=q.mass/(this.mass+q.mass),X=this.mass/(this.mass+q.mass),J=K>=.5?this.velocity_.minus(this.velocity_.scale(K)).scale(2):this.prefVelocity_.plus(this.velocity_.minus(this.prefVelocity_).scale(2*K)),Z=X>=.5?q.velocity_.scale(2).scale(1-X):q.prefVelocity_.plus(q.velocity_.minus(q.prefVelocity_).scale(2*X)),Q=J.minus(Z),$=i.absSq(Y),tt=this.radius_+q.radius_,et=i.sqr(tt),it=new r,nt=void 0;if($>et){var ot=Q.minus(Y.scale(j)),rt=i.absSq(ot),st=ot.multiply(Y);if(st<0&&i.sqr(st)>et*rt){var at=Math.sqrt(rt),lt=ot.scale(1/at);it.direction=new n(lt.y,-lt.x),nt=lt.scale(tt*j-at)}else{var ht=Math.sqrt($-et);if(i.det(Y,ot)>0){var ct=new n(Y.x*ht-Y.y*tt,Y.x*tt+Y.y*ht);it.direction=ct.scale(1/$)}else{var ut=new n(Y.x*ht+Y.y*tt,-Y.x*tt+Y.y*ht);it.direction=ut.scale(-1/$)}var dt=Q.multiply(it.direction);nt=it.direction.scale(dt).minus(Q)}}else{var pt=1/t,ft=Q.minus(Y.scale(pt)),gt=i.abs(ft),yt=ft.scale(1/gt);it.direction=new n(yt.y,-yt.x),nt=yt.scale(tt*pt-gt)}it.point=J.plus(nt.scale(K)),e.push(it)}var mt=this.linearProgram2(e,this.maxSpeed_,this.prefVelocity_,!1,this.newVelocity_);mt<e.length&&this.linearProgram3(e,W,mt,this.maxSpeed_,this.newVelocity_)},e.insertAgentNeighbor=function(t,e){if(this!=t){var n=i.absSq(this.position_.minus(t.position_));if(n<e){this.agentNeighbors_.length<this.maxNeighbors_&&this.agentNeighbors_.push(new o(n,t));for(var r=this.agentNeighbors_.length-1;0!=r&&n<this.agentNeighbors_[r-1].key;)this.agentNeighbors_[r]=this.agentNeighbors_[r-1],--r;this.agentNeighbors_[r]=new o(n,t),this.agentNeighbors_.length==this.maxNeighbors_&&(e=this.agentNeighbors_[this.agentNeighbors_.length-1].key)}}return e},e.insertObstacleNeighbor=function(t,e){var n=t.next,r=i.distSqPointLineSegment(t.point,n.point,this.position_);if(r<e){this.obstaclNeighbors_.push(new o(r,t));for(var s=this.obstaclNeighbors_.length-1;0!=s&&r<this.obstaclNeighbors_[s-1].key;)this.obstaclNeighbors_[s]=this.obstaclNeighbors_[s-1],--s;this.obstaclNeighbors_[s]=new o(r,t)}},e.update=function(t){this.velocity_.copy(this.newVelocity_),this.position_.copy(this.position_.plus(this.velocity_.scale(t)))},e.linearProgram1=function(t,e,n,o,r,s){var a=t[e].point.multiply(t[e].direction),l=i.sqr(a)+i.sqr(n)-i.absSq(t[e].point);if(l<0)return!1;for(var h=Math.sqrt(l),c=-a-h,u=-a+h,d=0;d<e;++d){var p=i.det(t[e].direction,t[d].direction),f=i.det(t[d].direction,t[e].point.minus(t[d].point));if(Math.abs(p)<=i.RVO_EPSILON){if(f<0)return!1}else{var g=f/p;if(p>=0?u=Math.min(u,g):c=Math.max(c,g),c>u)return!1}}if(r)o.multiply(t[e].direction)>0?s.copy(t[e].point.plus(t[e].direction.scale(u))):s.copy(t[e].point.plus(t[e].direction.scale(c)));else{var y=t[e].direction.multiply(o.minus(t[e].point));y<c?s.copy(t[e].point.plus(t[e].direction.scale(c))):y>u?s.copy(t[e].point.plus(t[e].direction.scale(u))):s.copy(t[e].point.plus(t[e].direction.scale(y)))}return!0},e.linearProgram2=function(t,e,n,o,r){o?r.copy(n.scale(e)):i.absSq(n)>i.sqr(e)?r.copy(i.normalize(n).scale(e)):r.copy(n);for(var s=0;s<t.length;++s)if(i.det(t[s].direction,t[s].point.minus(r))>0){var a=r.clone();if(!this.linearProgram1(t,s,e,n,o,r))return r.copy(a),s}return t.length},e.linearProgram3=function(t,e,o,s,a){for(var l=0,h=o;h<t.length;++h)if(i.det(t[h].direction,t[h].point.minus(a))>l){for(var c=[],u=0;u<e;++u)c.push(t[u]);for(var d=e;d<h;++d){var p=new r,f=i.det(t[h].direction,t[d].direction);if(Math.abs(f)<=i.RVO_EPSILON){if(t[h].direction.multiply(t[d].direction)>0)continue;p.point=t[h].point.plus(t[d].point).scale(.5)}else p.point=t[h].point.plus(t[h].direction.scale(i.det(t[d].direction,t[h].point.minus(t[d].point))/f));p.direction=i.normalize(t[d].direction.minus(t[h].direction)),c.push(p)}var g=a.clone();this.linearProgram2(c,s,new n(-t[h].direction.y,t[h].direction.x),!0,a)<c.length&&a.copy(g),l=i.det(t[h].direction,t[h].point.minus(a))}},t}()),e._RF.pop()}}})),System.register("chunks:///_virtual/AnimationController.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,i,n,o,r,s,a,l,h,c,u,d,p,f;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized,r=t.createClass},function(t){s=t.cclegacy,a=t._decorator,l=t.SpriteFrame,h=t.CCFloat,c=t.CCInteger,u=t.CCBoolean,d=t.Sprite,p=t.UITransform,f=t.Component}],execute:function(){var g,y,m,v,_,b,P,x,T,C,N,w,M,S,k;s._RF.push({},"a5491LI8SNJ4YgtDHwBcK0d","AnimationController",void 0);var D=a.ccclass,R=a.property;t("default",(g=D("AnimationController"),y=R(l),m=R(h),v=R(c),_=R({displayName:"是否倒播",tooltip:"勾选，倒着播放，不钩，顺序播放"}),b=R(u),P=R({tooltip:"勾选，播放完自动销毁"}),g((C=e((T=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,n(e,"images",C,o(e)),n(e,"frameTime",N,o(e)),n(e,"playTimes",w,o(e)),n(e,"reverse",M,o(e)),n(e,"autoPlayOnLoad",S,o(e)),n(e,"autoDestroy",k,o(e)),e.frameNum=0,e.frameIndex=0,e.nextFrameIndex=0,e.running=!0,e.m_render=void 0,e.time=0,e.completeTimesCallback=void 0,e.completeCallback=void 0,e.frameCallback=void 0,e.currentTimes=0,e._uiTransform=null,e}i(e,t);var s=e.prototype;return s.onLoad=function(){this.m_render=this.getComponent(d)},s.start=function(){0!=this.images.length&&(this.frameNum=this.images.length),this.running=this.autoPlayOnLoad,this.reverse&&(this.frameIndex=this.frameNum-1,this.nextFrameIndex=this.frameNum-1)},s.update=function(t){if(this.running&&0!=this.images.length)if(this.time-=t,0==this.playTimes||this.currentTimes!=this.playTimes){if(this.time<=0)if(this.time=this.frameTime,this.reverse)this.frameIndex=(this.nextFrameIndex+this.frameNum)%this.frameNum,this.nextFrameIndex=this.frameIndex-1,this.m_render.spriteFrame=this.images[this.frameIndex],this.m_render.spriteFrame&&(e=this.m_render.spriteFrame.rect,this.uiTransform.width=e.width,this.uiTransform.height=e.height),null!=this.frameCallback&&this.frameCallback(this.frameIndex),0==this.frameIndex&&(this.currentTimes++,this.node.emit("completeTimes",this.currentTimes),null!=this.completeTimesCallback&&this.completeTimesCallback(this.currentTimes),0!=this.playTimes&&this.currentTimes==this.playTimes&&(this.node.emit("complete"),null!=this.completeCallback&&this.completeCallback(),this.autoDestroy&&this.node.destroy()));else{if(this.frameIndex=this.nextFrameIndex%this.frameNum,this.nextFrameIndex=this.frameIndex+1,this.m_render.spriteFrame=this.images[this.frameIndex],this.m_render.spriteFrame){var e=this.m_render.spriteFrame.rect;this.uiTransform.width=e.width,this.uiTransform.height=e.height}null!=this.frameCallback&&this.frameCallback(this.frameIndex),this.frameIndex==this.frameNum-1&&(this.currentTimes++,this.node.emit("completeTimes",this.currentTimes),null!=this.completeTimesCallback&&this.completeTimesCallback(this.currentTimes),0!=this.playTimes&&this.currentTimes==this.playTimes&&(this.node.emit("complete"),null!=this.completeCallback&&this.completeCallback(),this.autoDestroy&&this.node.destroy()))}}else this.running=!1},s.play=function(t,e){if(void 0===t&&(t=null),void 0===e&&(e=null),this.frameCallback=t,this.completeCallback=e,this.running=!0,this.frameIndex=0,this.currentTimes=0,this.time=this.frameTime,0!=this.images.length&&(this.frameNum=this.images.length,this.reverse&&(this.frameIndex=this.frameNum-1,this.nextFrameIndex=this.frameNum-1)),this.m_render||(this.m_render=this.getComponent(d)),this.m_render&&(this.m_render.spriteFrame=this.images[0]),this.m_render.spriteFrame){var i=this.m_render.spriteFrame.rect;this.uiTransform.width=i.width,this.uiTransform.height=i.height}},s.gotoAndPlay=function(t){this.m_render||(this.m_render=this.getComponent(d)),this.running=!0,this.frameIndex=t,this.nextFrameIndex=t,this.currentTimes=0},s.stop=function(){this.running=!1},s.gotoAndStop=function(t){if(this.frameIndex=t,this.frameIndex<0&&(this.frameIndex=0),this.frameIndex>this.images.length-1&&(this.frameIndex=this.images.length-1),this.m_render||(this.m_render=this.getComponent(d)),this.m_render.spriteFrame=this.images[this.frameIndex],this.m_render.spriteFrame){var e=this.m_render.spriteFrame.rect;this.uiTransform.width=e.width,this.uiTransform.height=e.height}this.running=!1},s.isPlayEnd=function(){return this.frameIndex==this.frameNum},r(e,[{key:"uiTransform",get:function(){return this._uiTransform||(this._uiTransform=this.node.getComponent(p)),this._uiTransform}}]),e}(f)).prototype,"images",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),N=e(T.prototype,"frameTime",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),w=e(T.prototype,"playTimes",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),M=e(T.prototype,"reverse",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),S=e(T.prototype,"autoPlayOnLoad",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),k=e(T.prototype,"autoDestroy",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),x=T))||x)),s._RF.pop()}}})),System.register("chunks:///_virtual/AstarHoneycombRoadSeeker.ts",["cc","./BinaryTreeNode.ts","./PathLog.ts","./PathOptimize.ts"],(function(t){var e,i,n,o;return{setters:[function(t){e=t.cclegacy},function(t){i=t.default},function(t){n=t.default},function(t){o=t.PathOptimize}],execute:function(){e._RF.push({},"470f8oyv3xHR719BwQrvDie","AstarHoneycombRoadSeeker",void 0),t("default",function(){function t(t){this.COST_STRAIGHT=10,this.COST_DIAGONAL=10,this.maxStep=1e3,this._openlist=void 0,this._closelist=void 0,this._binaryTreeNode=new i,this._startNode=void 0,this._currentNode=void 0,this._targetNode=void 0,this._roadNodes=void 0,this._round1=[[0,-1],[1,-1],[1,0],[0,1],[-1,0],[-1,-1]],this._round2=[[0,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0]],this._neighbours=null,this._neighboursDic={},this.handle=-1,this._pathOptimize=o.best,this._isPassCallBack=null,this._roadNodes=t}var e=t.prototype;return e.setMaxSeekStep=function(t){this.maxStep=t},e.setPathOptimize=function(t){this._pathOptimize=t},e.setPathQuadSeek=function(t){},e.setRoadNodePassCondition=function(t){this._isPassCallBack=t},e.seekPath=function(t,e,i){if(this._startNode=t,this._currentNode=t,this._targetNode=e,this._neighbours=this.getNeighbours(i),!this._startNode||!this._targetNode)return[];if(this._startNode==this._targetNode)return[this._targetNode];if(!this.isCanPass(this._targetNode))return n.log("目标不可达到："),[];this._startNode.g=0,this._startNode.resetTree(),this._binaryTreeNode.refleshTag();for(var o=0;;){if(o>this.maxStep)return n.log("没找到目标计算步骤为：",o),[];if(o++,this.searchRoundNodes(this._currentNode),this._binaryTreeNode.isTreeNull())return n.log("没找到目标计算步骤为：",o),[];if(this._currentNode=this._binaryTreeNode.getMin_F_Node(),this._currentNode==this._targetNode)return n.log("找到目标计算步骤为：",o),this.getPath();this._binaryTreeNode.setRoadNodeInCloseList(this._currentNode)}return[]},e.seekPath2=function(t,e,i){if(this._startNode=t,this._currentNode=t,this._targetNode=e,this._neighbours=this.getNeighbours(i),!this._startNode||!this._targetNode)return[];if(this._startNode==this._targetNode)return[this._targetNode];var o=this.maxStep;this.isCanPass(this._targetNode)||(o=3*(Math.abs(this._targetNode.cx-this._startNode.cx)+Math.abs(this._targetNode.cy-this._startNode.cy)))>this.maxStep&&(o=this.maxStep),this._startNode.g=0,this._startNode.resetTree(),this._binaryTreeNode.refleshTag();for(var r=0,s=null;;){if(r>o)return n.log("没找到目标计算步骤为：",r),this.seekPath(t,s,i);if(r++,this.searchRoundNodes(this._currentNode),this._binaryTreeNode.isTreeNull())return n.log("没找到目标计算步骤为：",r),this.seekPath(t,s,i);if(this._currentNode=this._binaryTreeNode.getMin_F_Node(),(null==s||this._currentNode.h<s.h)&&(s=this._currentNode),this._currentNode==this._targetNode)return n.log("找到目标计算步骤为：",r),this.getPath();this._binaryTreeNode.setRoadNodeInCloseList(this._currentNode)}return this.seekPath(t,s,i)},e.getPath=function(){for(var t,e,i,n,r,s,a=[],l=this._targetNode;l!=this._startNode;)a.unshift(l),l=l.parent;if(a.unshift(this._startNode),this._pathOptimize==o.none)return a;for(var h=1;h<a.length-1;h++){t=a[h-1],e=a[h],i=a[h+1],n=this.getHoneyPoint(t),r=this.getHoneyPoint(e),s=this.getHoneyPoint(i);var c=e.cx==t.cx&&e.cx==i.cx,u=e.cy==t.cy&&e.cy==i.cy&&t.cx%2==e.cx%2&&e.cx%2==i.cx%2,d=n.hx==r.hx&&r.hx==s.hx,p=n.hy==r.hy&&r.hy==s.hy;(c||u||d||p)&&(a.splice(h,1),h--)}if(this._pathOptimize==o.better)return a;for(h=0;h<a.length-2;h++){for(var f=a[h],g=null,y=a.length-1;y>h+1;y--){var m=a[y];if(this.isArriveBetweenTwoNodes(f,m)){g=m;break}}if(g){var v=y-h-1;a.splice(h+1,v)}}return a},e.isArriveBetweenTwoNodes=function(t,e){var i=this.getHoneyPoint(t),n=this.getHoneyPoint(e);if(i.hx==n.hx&&i.hy==n.hy)return!1;var o=Math.abs(n.hx-i.hx),s=Math.abs(n.hy-i.hy),a=0;n.hx>i.hx?a=1:n.hx<i.hx&&(a=-1);var l=0;n.hy>i.hy?l=1:n.hy<i.hy&&(l=-1);var h=0,c=0,u=0,d=0;if(o>s){for(var p=s/o,f=0;f<o;f+=2)if(c=f*l*p,u=l>0?Math.floor(i.hy+c):Math.ceil(i.hy+c),d=Math.abs(c%1),(g=new r).hx=i.hx+f*a,g.hy=d<=.5?u:u+1*l,c=(f+1)*l*p,u=l>0?Math.floor(i.hy+c):Math.ceil(i.hy+c),d=Math.abs(c%1),(y=new r).hx=i.hx+(f+1)*a,y.hy=d<=.5?u:u+1*l,c=(f+2)*l*p,u=l>0?Math.floor(i.hy+c):Math.ceil(i.hy+c),d=Math.abs(c%1),(m=new r).hx=i.hx+(f+2)*a,m.hy=d<=.5?u:u+1*l,!this.isCrossAtAdjacentNodes(i,n,g,y,m))return!1}else for(p=o/s,f=0;f<s;f+=2){var g,y,m;if(h=f*a*p,u=a>0?Math.floor(i.hx+h):Math.ceil(i.hx+h),d=Math.abs(h%1),(g=new r).hx=d<=.5?u:u+1*a,g.hy=i.hy+f*l,h=(f+1)*a*p,u=a>0?Math.floor(i.hx+h):Math.ceil(i.hx+h),d=Math.abs(h%1),(y=new r).hx=d<=.5?u:u+1*a,y.hy=i.hy+(f+1)*l,h=(f+2)*a*p,u=a>0?Math.floor(i.hx+h):Math.ceil(i.hx+h),d=Math.abs(h%1),(m=new r).hx=d<=.5?u:u+1*a,m.hy=i.hy+(f+2)*l,!this.isCrossAtAdjacentNodes(i,n,g,y,m))return!1}return!0},e.isCrossAtAdjacentNodes=function(t,e,i,n,o){var r=this.getNodeByHoneyPoint(i.hx,i.hy),s=this.getNodeByHoneyPoint(n.hx,n.hy);if(this.getNodeByHoneyPoint(o.hx,o.hy),r==s)return!1;if(!this.isPassNode(r)||!this.isPassNode(s))return!1;if(!this.isCanPass(r)||!this.isCanPass(s))return!1;var a=i.hx-n.hx,l=i.hy-n.hy,h=o.hx-n.hx,c=o.hy-n.hy;if(Math.abs(a)>1||Math.abs(l)>1||Math.abs(h)>1||Math.abs(c)>1)return!1;if(a==-l)if(-1==a){if(!this.isPassNode(this.getNodeByHoneyPoint(n.hx-1,n.hy))||!this.isPassNode(this.getNodeByHoneyPoint(n.hx,n.hy+1)))return!1}else if(!this.isPassNode(this.getNodeByHoneyPoint(n.hx+1,n.hy))||!this.isPassNode(this.getNodeByHoneyPoint(n.hx,n.hy-1)))return!1;if(n.hx==e.hx&&n.hy==e.hy)return!0;if(h==-c)if(-1==h){if(!this.isPassNode(this.getNodeByHoneyPoint(n.hx-1,n.hy))||!this.isPassNode(this.getNodeByHoneyPoint(n.hx,n.hy+1)))return!1}else if(!this.isPassNode(this.getNodeByHoneyPoint(n.hx+1,n.hy))||!this.isPassNode(this.getNodeByHoneyPoint(n.hx,n.hy-1)))return!1;return i.hx==n.hx&&n.hx==o.hx||!!this.isPassNode(this.getNodeByHoneyPoint(n.hx+(a+h),n.hy+(l+c)))},e.getHoneyPoint=function(t){var e=t.cy+Math.ceil(t.cx/2),i=t.cy-Math.floor(t.cx/2);return new r(e,i)},e.getNodeByHoneyPoint=function(t,e){var i=t-e,n=Math.floor((t-e)/2)+e;return this.getRoadNode(i,n)},e.getRoundNodeByIndex=function(t,e){if(!t)return null;var i;e%=6,i=t.cx%2==0?this._round1:this._round2;var n=t.cx+i[e][0],o=t.cy+i[e][1];return this.getRoadNode(n,o)},e.getRoundNodes=function(t){var e;e=t.cx%2==0?this._round1:this._round2;for(var i=[],n=0;n<e.length;n++){var o=t.cx+e[n][0],r=t.cy+e[n][1],s=this.getRoadNode(o,r);i.push(s)}return i},e.isPassNode=function(t){return null!=this._isPassCallBack?this._isPassCallBack(t):null!=t&&1!=t.value},e.isCanPass=function(t){if(!this.isPassNode(t))return!1;if(null==this._neighbours||0==this._neighbours.length)return!0;for(var e=this.getHoneyPoint(t),i=0;i<this._neighbours.length;i++){var n=e.hx+this._neighbours[i][0],o=e.hy+this._neighbours[i][1],r=this.getNodeByHoneyPoint(n,o);if(!this.isPassNode(r))return!1}return!0},e.getRoadNode=function(t,e){var i=t+"_"+e;return this._roadNodes[i]},e.getNeighbours=function(t){if(0==t)return null;var e=null;return null!=this._neighboursDic[t]?e=this._neighboursDic[t]:(e=[],this.getNeighboursRecursive(0,0,t,1,e,{},{},[[-1,-1],[-1,0],[0,1],[1,1],[1,0],[0,-1]]),this._neighboursDic[t]=e),e},e.getNeighboursRecursive=function(t,e,i,n,o,r,s,a){if(!(n>i)){r[c=t+"_"+e]=!0;for(var l=a.length,h=0;h<l;h++){var c,u=t+a[h][0],d=e+a[h][1];0==u&&0==d||r[c=u+"_"+d]||(s[c]||(o.push([u,d]),s[c]=!0),this.getNeighboursRecursive(u,d,i,n+1,o,r,s,a))}}},e.testSeekPathStep=function(t,e,i,o,r,s){var a=this;if(void 0===s&&(s=100),this._startNode=t,this._currentNode=t,this._targetNode=e,this._neighbours=this.getNeighbours(i),this.isCanPass(this._targetNode)){this._startNode.g=0,this._startNode.resetTree(),this._binaryTreeNode.refleshTag(),this._closelist=[];var l=0;clearInterval(this.handle),this.handle=setInterval((function(){return l>a.maxStep?(n.log("没找到目标计算步骤为：",l),void clearInterval(a.handle)):(l++,a.searchRoundNodes(a._currentNode),a._binaryTreeNode.isTreeNull()?(n.log("没找到目标计算步骤为：",l),void clearInterval(a.handle)):(a._currentNode=a._binaryTreeNode.getMin_F_Node(),void(a._currentNode==a._targetNode?(n.log("找到目标计算步骤为：",l),clearInterval(a.handle),a._openlist=a._binaryTreeNode.getOpenList(),o.apply(r,[a._startNode,a._targetNode,a._currentNode,a._openlist,a._closelist,a.getPath()])):(a._binaryTreeNode.setRoadNodeInCloseList(a._currentNode),a._openlist=a._binaryTreeNode.getOpenList(),a._closelist.push(a._currentNode),o.apply(r,[a._startNode,a._targetNode,a._currentNode,a._openlist,a._closelist,null])))))}),s)}},e.searchRoundNodes=function(t){var e;e=t.cx%2==0?this._round1:this._round2;for(var i=0;i<e.length;i++){var n=t.cx+e[i][0],o=t.cy+e[i][1],r=this.getRoadNode(n,o);this.isPassNode(r)&&this.isCanPass(r)&&r!=this._startNode&&!this.isInCloseList(r)&&this.setNodeF(r)}},e.setNodeF=function(t){var e;e=t.cx==this._currentNode.cx||t.cy==this._currentNode.cy?this._currentNode.g+this.COST_STRAIGHT:this._currentNode.g+this.COST_DIAGONAL,this.isInOpenList(t)?e<t.g&&(t.g=e,t.parent=this._currentNode,t.h=(Math.abs(this._targetNode.cx-t.cx)+Math.abs(this._targetNode.cy-t.cy))*this.COST_STRAIGHT,t.f=t.g+t.h,this._binaryTreeNode.removeTreeNode(t),this._binaryTreeNode.addTreeNode(t)):(t.g=e,this._binaryTreeNode.setRoadNodeInOpenList(t),t.resetTree(),t.parent=this._currentNode,t.h=(Math.abs(this._targetNode.cx-t.cx)+Math.abs(this._targetNode.cy-t.cy))*this.COST_STRAIGHT,t.f=t.g+t.h,this._binaryTreeNode.addTreeNode(t))},e.isInOpenList=function(t){return this._binaryTreeNode.isInOpenList(t)},e.isInCloseList=function(t){return this._binaryTreeNode.isInCloseList(t)},e.dispose=function(){this._roadNodes=null,this._round1=null,this._round2=null},t}());var r=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.hx=0,this.hy=0,this.hx=t,this.hy=e};e._RF.pop()}}})),System.register("chunks:///_virtual/AStarRoadSeeker.ts",["cc","./BinaryTreeNode.ts","./PathLog.ts","./PathOptimize.ts","./PathQuadSeek.ts"],(function(t){var e,i,n,o,r;return{setters:[function(t){e=t.cclegacy},function(t){i=t.default},function(t){n=t.default},function(t){o=t.PathOptimize},function(t){r=t.PathQuadSeek}],execute:function(){e._RF.push({},"a3a193EdkVIWoDgtJ/bBisA","AStarRoadSeeker",void 0),t("default",function(){function t(t){this.COST_STRAIGHT=10,this.COST_DIAGONAL=14,this.maxStep=1e3,this._openlist=void 0,this._closelist=void 0,this._binaryTreeNode=new i,this._startNode=void 0,this._currentNode=void 0,this._targetNode=void 0,this._roadNodes=void 0,this._round1=[[0,-1],[1,0],[0,1],[-1,0]],this._round2=[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]],this._round=this._round2,this._neighbours=null,this._neighboursDic={},this.handle=-1,this._pathOptimize=o.best,this._pathQuadSeek=r.path_dire_8,this._isPassCallBack=null,this._roadNodes=t}var e=t.prototype;return e.setMaxSeekStep=function(t){this.maxStep=t},e.setPathOptimize=function(t){this._pathOptimize=t},e.setPathQuadSeek=function(t){this._pathQuadSeek=t,this._pathQuadSeek==r.path_dire_4?this._round=this._round1:this._round=this._round2},e.setRoadNodePassCondition=function(t){this._isPassCallBack=t},e.seekPath=function(t,e,i){if(this._startNode=t,this._currentNode=t,this._targetNode=e,this._neighbours=this.getNeighbours(i),!this._startNode||!this._targetNode)return[];if(this._startNode==this._targetNode)return[this._targetNode];if(!this.isCanPass(this._targetNode))return n.log("目标不可达到："),[];this._startNode.g=0,this._startNode.resetTree(),this._binaryTreeNode.refleshTag();for(var o=0;;){if(o>this.maxStep)return n.warn("没找到目标计算步骤为：",o),[];if(o++,this.searchRoundNodes(this._currentNode),this._binaryTreeNode.isTreeNull())return n.log("没找到目标计算步骤为：",o),[];if(this._currentNode=this._binaryTreeNode.getMin_F_Node(),this._currentNode==this._targetNode)return n.log("找到目标计算步骤为：",o),this.getPath();this._binaryTreeNode.setRoadNodeInCloseList(this._currentNode)}return[]},e.seekPath2=function(t,e,i){if(void 0===i&&(i=0),this._startNode=t,this._currentNode=t,this._targetNode=e,this._neighbours=this.getNeighbours(i),!this._startNode||!this._targetNode)return[];if(this._startNode==this._targetNode)return[this._targetNode];var o=this.maxStep;this.isCanPass(this._targetNode)||(o=3*(Math.abs(this._targetNode.cx-this._startNode.cx)+Math.abs(this._targetNode.cy-this._startNode.cy)))>this.maxStep&&(o=this.maxStep),this._startNode.g=0,this._startNode.resetTree(),this._binaryTreeNode.refleshTag();for(var r=0,s=null;;){if(r>o)return n.log("没找到目标计算步骤为：",r),this.seekPath(t,s,i);if(r++,this.searchRoundNodes(this._currentNode),this._binaryTreeNode.isTreeNull())return n.log("没找到目标计算步骤为：",r),this.seekPath(t,s,i);if(this._currentNode=this._binaryTreeNode.getMin_F_Node(),(null==s||this._currentNode.h<s.h)&&(s=this._currentNode),this._currentNode==this._targetNode)return n.log("找到目标计算步骤为：",r),this.getPath();this._binaryTreeNode.setRoadNodeInCloseList(this._currentNode)}return this.seekPath(t,s,i)},e.getPath=function(){for(var t=[],e=this._targetNode;e!=this._startNode;)t.unshift(e),e=e.parent;if(t.unshift(this._startNode),this._pathOptimize==o.none)return t;for(var i=1;i<t.length-1;i++){var n=t[i-1],s=t[i],a=t[i+1],l=s.cx==n.cx&&s.cx==a.cx,h=s.cy==n.cy&&s.cy==a.cy,c=!1;this._pathQuadSeek==r.path_dire_8&&(c=(s.cx-n.cx)/(s.cy-n.cy)*((a.cx-s.cx)/(a.cy-s.cy))==1),(l||h||c)&&(t.splice(i,1),i--)}if(this._pathQuadSeek==r.path_dire_4)return t;if(this._pathOptimize==o.better)return t;for(i=0;i<t.length-2;i++){for(var u=t[i],d=null,p=t.length-1;p>i+1;p--){var f=t[p];if(u.cx!=f.cx&&u.cy!=f.cy&&Math.abs(f.cx-u.cx)!=Math.abs(f.cy-u.cy)&&this.isArriveBetweenTwoNodes(u,f)){d=f;break}}if(d){var g=p-i-1;t.splice(i+1,g)}}return t},e.isArriveBetweenTwoNodes=function(t,e){if(t==e)return!1;var i=Math.abs(e.cx-t.cx),n=Math.abs(e.cy-t.cy),o=0;e.cx>t.cx?o=1:e.cx<t.cx&&(o=-1);var r=0;e.cy>t.cy?r=1:e.cy<t.cy&&(r=-1);var s=0,a=0,l=0,h=0;if(i>n)for(var c=n/i,u=0;u<i;u++){a=t.cy+u*r*c,l=Math.floor(a),h=a%1;var d=t.cx+u*o,p=h<=.5?l:l+1;a=t.cy+(u+1)*r*c,l=Math.floor(a),h=a%1;var f=t.cx+(u+1)*o,g=h<=.5?l:l+1,y=this.getRoadNode(d,p),m=this.getRoadNode(f,g);if(!this.isCrossAtAdjacentNodes(y,m))return!1}else for(c=i/n,u=0;u<n;u++)if(s=u*o*c,l=o>0?Math.floor(t.cx+s):Math.ceil(t.cx+s),d=(h=Math.abs(s%1))<=.5?l:l+1*o,p=t.cy+u*r,s=(u+1)*o*c,l=o>0?Math.floor(t.cx+s):Math.ceil(t.cx+s),f=(h=Math.abs(s%1))<=.5?l:l+1*o,g=t.cy+(u+1)*r,y=this.getRoadNode(d,p),m=this.getRoadNode(f,g),!this.isCrossAtAdjacentNodes(y,m))return!1;return!0},e.isCrossAtAdjacentNodes=function(t,e){if(t==e)return!1;if(!this.isPassNode(t)||!this.isPassNode(e))return!1;if(!this.isCanPass(t)||!this.isCanPass(e))return!1;var i=e.cx-t.cx,n=e.cy-t.cy;return!(Math.abs(i)>1||Math.abs(n)>1||t.cx!=e.cx&&t.cy!=e.cy&&(!this.isPassNode(this.getRoadNode(t.cx,t.cy+n))||!this.isPassNode(this.getRoadNode(t.cx+i,t.cy))))},e.isPassNode=function(t){return null!=this._isPassCallBack?this._isPassCallBack(t):null!=t&&1!=t.value},e.isCanPass=function(t){if(!this.isPassNode(t))return!1;if(null==this._neighbours||0==this._neighbours.length)return!0;for(var e=0;e<this._neighbours.length;e++){var i=t.cx+this._neighbours[e][0],n=t.cy+this._neighbours[e][1],o=this.getRoadNode(i,n);if(!this.isPassNode(o))return!1}return!0},e.getRoadNode=function(t,e){var i=t+"_"+e;return this._roadNodes[i]},e.getNeighbours=function(t){if(0==t)return null;var e=null;if(null!=this._neighboursDic[t])e=this._neighboursDic[t];else{e=[];for(var i=-t;i<=t;i++)for(var n=-t;n<=t;n++)0==n&&0==i||Math.abs(n)+Math.abs(i)>t||e.push([n,i]);this._neighboursDic[t]=e}return e},e.testSeekPathStep=function(t,e,i,o,r,s){var a=this;if(void 0===s&&(s=100),this._startNode=t,this._currentNode=t,this._targetNode=e,this._neighbours=this.getNeighbours(i),this.isCanPass(this._targetNode)){this._startNode.g=0,this._startNode.resetTree(),this._binaryTreeNode.refleshTag(),this._closelist=[];var l=0;clearInterval(this.handle),this.handle=setInterval((function(){return l>a.maxStep?(n.log("没找到目标计算步骤为：",l),void clearInterval(a.handle)):(l++,a.searchRoundNodes(a._currentNode),a._binaryTreeNode.isTreeNull()?(n.log("没找到目标计算步骤为：",l),void clearInterval(a.handle)):(a._currentNode=a._binaryTreeNode.getMin_F_Node(),void(a._currentNode==a._targetNode?(n.log("找到目标计算步骤为：",l),clearInterval(a.handle),a._openlist=a._binaryTreeNode.getOpenList(),o.apply(r,[a._startNode,a._targetNode,a._currentNode,a._openlist,a._closelist,a.getPath()])):(a._binaryTreeNode.setRoadNodeInCloseList(a._currentNode),a._openlist=a._binaryTreeNode.getOpenList(),a._closelist.push(a._currentNode),o.apply(r,[a._startNode,a._targetNode,a._currentNode,a._openlist,a._closelist,null])))))}),s)}},e.searchRoundNodes=function(t){for(var e=0;e<this._round.length;e++){var i=t.cx+this._round[e][0],n=t.cy+this._round[e][1],o=this.getRoadNode(i,n);this.isPassNode(o)&&this.isCanPass(o)&&o!=this._startNode&&!this.isInCloseList(o)&&!this.inInCorner(o)&&this.setNodeF(o)}},e.setNodeF=function(t){var e;e=t.cx==this._currentNode.cx||t.cy==this._currentNode.cy?this._currentNode.g+this.COST_STRAIGHT:this._currentNode.g+this.COST_DIAGONAL,this.isInOpenList(t)?e<t.g&&(t.g=e,t.parent=this._currentNode,t.h=(Math.abs(this._targetNode.cx-t.cx)+Math.abs(this._targetNode.cy-t.cy))*this.COST_STRAIGHT,t.f=t.g+t.h,this._binaryTreeNode.removeTreeNode(t),this._binaryTreeNode.addTreeNode(t)):(t.g=e,this._binaryTreeNode.setRoadNodeInOpenList(t),t.resetTree(),t.parent=this._currentNode,t.h=(Math.abs(this._targetNode.cx-t.cx)+Math.abs(this._targetNode.cy-t.cy))*this.COST_STRAIGHT,t.f=t.g+t.h,this._binaryTreeNode.addTreeNode(t))},e.isInOpenList=function(t){return this._binaryTreeNode.isInOpenList(t)},e.isInCloseList=function(t){return this._binaryTreeNode.isInCloseList(t)},e.inInCorner=function(t){if(this._pathQuadSeek==r.path_dire_4)return!1;if(t.cx==this._currentNode.cx||t.cy==this._currentNode.cy)return!1;var e=this.getRoadNode(this._currentNode.cx,t.cy),i=this.getRoadNode(t.cx,this._currentNode.cy);return!this.isPassNode(e)||!this.isPassNode(i)},e.dispose=function(){this._roadNodes=null,this._round=null},t}()),e._RF.pop()}}})),System.register("chunks:///_virtual/BaseView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Behaviour.ts"],(function(t){var e,i,n,o,r,s,a,l,h,c,u;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){r=t.cclegacy,s=t._decorator,a=t.Node,l=t.UITransform,h=t.Vec3,c=t.view},function(t){u=t.Behaviour}],execute:function(){var d,p,f,g,y,m,v,_,b,P,x;r._RF.push({},"fa0a6xU1slHuanA+q9oE3z8","BaseView",void 0);var T=s.ccclass,C=s.property;t("default",(d=T("BaseView"),p=C({tooltip:"窗口是否可拖拽:\n勾选可拖拽 \n不勾选不可拖拽"}),f=C(a),g=C(a),y=C(a),d((_=e((v=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,n(e,"canDrag",_,o(e)),n(e,"content",b,o(e)),n(e,"title",P,o(e)),n(e,"closeBtn",x,o(e)),e._startDrag=!1,e}i(e,t);var r=e.prototype;return r.onLoad=function(){var t=this;this.closeBtn.on(a.EventType.TOUCH_START,this.onCloseBtnClick,this),this.canDrag&&(this.title.on(a.EventType.TOUCH_START,(function(e){t._startDrag=!0}),this),this.title.on(a.EventType.TOUCH_END,(function(e){t._startDrag=!1}),this),this.node.on(a.EventType.TOUCH_MOVE,(function(e){if(t._startDrag){var i=t.node.parent.getComponent(l);null==i&&(i=t.node.parent.addComponent(l));var n=i.convertToNodeSpaceAR(new h(e.getUILocation().x,e.getUILocation().y)).subtract(t.title.position),o=c.getVisibleSize();n.x<-(o.width-t.width)/2?n.x=-(o.width-t.width)/2:n.x>(o.width-t.width)/2&&(n.x=(o.width-t.width)/2),n.y<-(o.height-t.height)/2?n.y=-(o.height-t.height)/2:n.y>(o.height-t.height)/2&&(n.y=(o.height-t.height)/2),t.node.position=n}}),this))},r.start=function(){},r.onCloseBtnClick=function(t){this.close()},r.open=function(){this._startDrag=!1,this.node.active=!0,this.node.position=new h(0,0,0)},r.close=function(){this.node.active=!1},e}(u)).prototype,"canDrag",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),b=e(v.prototype,"content",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=e(v.prototype,"title",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=e(v.prototype,"closeBtn",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=v))||m)),r._RF.pop()}}})),System.register("chunks:///_virtual/Behaviour.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,i,n,o,r,s,a,l,h,c,u,d,p;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized,r=t.createClass},function(t){s=t.cclegacy,a=t._decorator,l=t.Collider2D,h=t.Contact2DType,c=t.Collider,u=t.UITransform,d=t.UIOpacity,p=t.Component}],execute:function(){var f,g,y,m,v;s._RF.push({},"e79bdNTsHBHU5QkvvzTQ10j","Behaviour",void 0);var _=a.ccclass,b=a.property;t("Behaviour",(f=_("Behaviour"),g=b({tooltip:"对象标识"}),f((v=e((m=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,n(e,"tag",v,o(e)),e.colliders_2D=null,e.colliders_3D=null,e._transform=null,e._gameObject=null,e._uiTransform=null,e._uiOpacity=null,e._alpha=1,e._opacity=255,e}i(e,t);var s=e.prototype;return s.onLoad=function(){this.addColliderEventListener()},s.addColliderEventListener=function(){this.add2DColliderEventListener(),this.add3DColliderEventListener()},s.add2DColliderEventListener=function(){if(this.colliders_2D=this.getComponents(l),this.onTriggerEnter2D)for(var t=0;t<this.colliders_2D.length;t++)this.colliders_2D[t].on(h.BEGIN_CONTACT,this.onTriggerEnter2D,this);if(this.onTriggerExit2D)for(t=0;t<this.colliders_2D.length;t++)this.colliders_2D[t].on(h.END_CONTACT,this.onTriggerExit2D,this);if(this.onCollisionEnter2D)for(t=0;t<this.colliders_2D.length;t++)this.colliders_2D[t].on(h.BEGIN_CONTACT,this.onCollisionEnter2D,this);if(this.onCollisionExit2D)for(t=0;t<this.colliders_2D.length;t++)this.colliders_2D[t].on(h.END_CONTACT,this.onCollisionExit2D,this)},s.add3DColliderEventListener=function(){if(this.colliders_3D=this.getComponents(c),this.onTriggerEnter)for(var t=0;t<this.colliders_3D.length;t++)this.colliders_3D[t].on("onTriggerEnter",this.onTriggerEnter,this);if(this.onTriggerStay)for(t=0;t<this.colliders_3D.length;t++)this.colliders_3D[t].on("onTriggerStay",this.onTriggerStay,this);if(this.onTriggerExit)for(t=0;t<this.colliders_3D.length;t++)this.colliders_3D[t].on("onTriggerExit",this.onTriggerExit,this);if(this.onCollisionEnter)for(t=0;t<this.colliders_3D.length;t++)this.colliders_3D[t].on("onCollisionEnter",this.onCollisionEnter,this);if(this.onCollisionStay)for(t=0;t<this.colliders_3D.length;t++)this.colliders_3D[t].on("onCollisionStay",this.onCollisionStay,this);if(this.onCollisionExit)for(t=0;t<this.colliders_3D.length;t++)this.colliders_3D[t].on("onCollisionExit",this.onCollisionExit,this)},s.removeAllColliderEventListener=function(){if(this.colliders_2D)for(var t=0;t<this.colliders_2D.length;t++)this.onTriggerEnter2D&&this.colliders_2D[t].off(h.BEGIN_CONTACT,this.onTriggerEnter2D,this),this.onTriggerExit2D&&this.colliders_2D[t].off(h.END_CONTACT,this.onTriggerExit2D,this),this.onCollisionEnter2D&&this.colliders_2D[t].off(h.BEGIN_CONTACT,this.onCollisionEnter2D,this),this.onCollisionExit2D&&this.colliders_2D[t].off(h.END_CONTACT,this.onCollisionExit2D,this);if(this.colliders_3D)for(t=0;t<this.colliders_3D.length;t++)this.onTriggerEnter&&this.colliders_3D[t].off("onTriggerEnter",this.onTriggerEnter,this),this.onTriggerStay&&this.colliders_3D[t].off("onTriggerStay",this.onTriggerStay,this),this.onTriggerExit&&this.colliders_3D[t].off("onTriggerExit",this.onTriggerExit,this),this.onCollisionEnter&&this.colliders_3D[t].off("onCollisionEnter",this.onCollisionEnter,this),this.onCollisionStay&&this.colliders_3D[t].off("onCollisionStay",this.onCollisionStay,this),this.onCollisionExit&&this.colliders_3D[t].off("onCollisionExit",this.onCollisionExit,this)},s.onDestroy=function(){this.removeAllColliderEventListener()},r(e,[{key:"transform",get:function(){return this._transform||(this._transform=this.node),this._transform}},{key:"gameObject",get:function(){return this._gameObject||(this._gameObject=this.node),this._gameObject}},{key:"uiTransform",get:function(){return this._uiTransform||(this._uiTransform=this.node.getComponent(u)),this._uiTransform}},{key:"uiOpacity",get:function(){return this._uiOpacity||(this._uiOpacity=this.node.getComponent(d)),this._uiOpacity}},{key:"width",get:function(){return this.uiTransform?this.uiTransform.width:0},set:function(t){this.uiTransform&&(this.uiTransform.width=t)}},{key:"height",get:function(){return this.uiTransform?this.uiTransform.height:0},set:function(t){this.uiTransform&&(this.uiTransform.height=t)}},{key:"alpha",get:function(){return this._alpha},set:function(t){this._alpha=t,this._alpha<0?this._alpha=0:this._alpha>1&&(this._alpha=1),null!=this.uiOpacity&&(this.uiOpacity.opacity=this._alpha/1*255)}},{key:"opacity",get:function(){return this._opacity},set:function(t){this._opacity=t,this._opacity<0?this._opacity=0:this._opacity>255&&(this._opacity=255),null!=this.uiOpacity&&(this.uiOpacity.opacity=this._opacity)}},{key:"x",get:function(){return this.transform.position.x},set:function(t){var e=this.transform.position;e.x=t,this.transform.position=e}},{key:"y",get:function(){return this.transform.position.y},set:function(t){var e=this.transform.position;e.y=t,this.transform.position=e}},{key:"z",get:function(){return this.transform.position.z},set:function(t){var e=this.transform.position;e.z=t,this.transform.position=e}},{key:"wx",get:function(){return this.transform.worldPosition.x},set:function(t){var e=this.transform.worldPosition;e.x=t,this.transform.worldPosition=e}},{key:"wy",get:function(){return this.transform.worldPosition.y},set:function(t){var e=this.transform.transform.worldPosition;e.y=t,this.transform.worldPosition=e}},{key:"wz",get:function(){return this.transform.worldPosition.z},set:function(t){var e=this.transform.worldPosition;e.z=t,this.transform.worldPosition=e}}]),e}(p)).prototype,"tag",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),y=m))||y)),s._RF.pop()}}})),System.register("chunks:///_virtual/BinaryTreeNode.ts",["cc"],(function(t){var e;return{setters:[function(t){e=t.cclegacy}],execute:function(){e._RF.push({},"60d7a9yrfZNFZCCoRQd6Y7i","BinaryTreeNode",void 0),t("default",function(){function t(){this.seekTag=0,this.openNode=null,this.count=0}var e=t.prototype;return e.refleshTag=function(){this.openNode=null,this.count=0,this.seekTag++,this.seekTag>1e9&&(this.seekTag=0)},e.isTreeNull=function(){return null==this.openNode},e.addTreeNode=function(t,e){if(void 0===e&&(e=null),this.count++,null==e){if(null==this.openNode)return void(this.openNode=t);e=this.openNode}e!=t&&(t.f>=e.f?null==e.right?(e.right=t,t.treeParent=e):this.addTreeNode(t,e.right):null==e.left?(e.left=t,t.treeParent=e):this.addTreeNode(t,e.left))},e.removeTreeNode=function(t){this.count++,null!=t.treeParent||null!=t.left||null!=t.right?(null==t.treeParent?t.left?(this.openNode=t.left,t.left.treeParent=null,t.right&&(t.right.treeParent=null,this.addTreeNode(t.right,this.openNode))):t.right&&(this.openNode=t.right,t.right.treeParent=null):t.treeParent.left==t?t.right?(t.treeParent.left=t.right,t.right.treeParent=t.treeParent,t.left&&(t.left.treeParent=null,this.addTreeNode(t.left,t.right))):(t.treeParent.left=t.left,t.left&&(t.left.treeParent=t.treeParent)):t.treeParent.right==t&&(t.left?(t.treeParent.right=t.left,t.left.treeParent=t.treeParent,t.right&&(t.right.treeParent=null,this.addTreeNode(t.right,t.left))):(t.treeParent.right=t.right,t.right&&(t.right.treeParent=t.treeParent))),t.resetTree()):t==this.openNode&&(this.openNode=null)},e.getMin_F_Node=function(t){if(void 0===t&&(t=null),this.count++,null==t){if(null==this.openNode)return null;t=this.openNode}if(null==t.left){var e=t;return null==t.treeParent?(this.openNode=t.right,this.openNode&&(this.openNode.treeParent=null)):(t.treeParent.left=t.right,t.right&&(t.right.treeParent=t.treeParent)),e}return this.getMin_F_Node(t.left)},e.setRoadNodeInOpenList=function(t){t.openTag=this.seekTag,t.closeTag=0},e.setRoadNodeInCloseList=function(t){t.openTag=0,t.closeTag=this.seekTag},e.isInOpenList=function(t){return t.openTag==this.seekTag},e.isInCloseList=function(t){return t.closeTag==this.seekTag},e.getOpenList=function(){var t=[];return this.seachTree(this.openNode,t),t},e.seachTree=function(t,e){null!=t&&(e.push(t),t.left&&this.seachTree(t.left,e),t.right&&this.seachTree(t.right,e))},t}()),e._RF.pop()}}})),System.register("chunks:///_virtual/Body.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Player.ts"],(function(t){var e,i,n,o,r;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,n=t._decorator,o=t.Component},function(t){r=t.default}],execute:function(){var s;i._RF.push({},"6f987iEmGpFs7oQJ+Xpz5XM","Body",void 0);var a=n.ccclass;n.property,t("default",a("Body")(s=function(t){function i(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).player=null,e}e(i,t);var n=i.prototype;return n.onLoad=function(){this.player=this.node.parent.getComponent(r)},n.start=function(){},n.update=function(t){},i}(o))||s),i._RF.pop()}}})),System.register("chunks:///_virtual/BottomToolBar.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIManager.ts"],(function(t){var e,i,n,o,r,s,a,l,h,c;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){r=t.cclegacy,s=t._decorator,a=t.Button,l=t.Node,h=t.Component},function(t){c=t.default}],execute:function(){var u,d,p,f,g,y,m,v,_,b,P;r._RF.push({},"7e7f0nDJRREtoMMADJs+uNP","BottomToolBar",void 0);var x=s.ccclass,T=s.property;t("default",(u=x("BottomToolBar"),d=T(a),p=T(a),f=T(a),g=T(a),u((v=e((m=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,n(e,"mapBtn",v,o(e)),n(e,"introduceBtn",_,o(e)),n(e,"helpBtn",b,o(e)),n(e,"getPrjBtn",P,o(e)),e}i(e,t);var r=e.prototype;return r.start=function(){var t=this;this.mapBtn.node.on(l.EventType.TOUCH_END,(function(e){t.scheduleOnce((function(){window.open("https://easymapeditor-1258223435.cos.ap-guangzhou.myqcloud.com/v2.0.0/web-mobile/index.html","_blank")}),.2)}),this),this.introduceBtn.node.on(l.EventType.TOUCH_START,(function(e){t.closeAllView(),c.instance.introduceView.open()}),this),this.helpBtn.node.on(l.EventType.TOUCH_START,(function(e){t.closeAllView(),c.instance.helpView.open()}),this),this.getPrjBtn.node.on(l.EventType.TOUCH_END,(function(t){c.instance.getPrjView.open()}),this)},r.closeAllView=function(){c.instance.helpView.close(),c.instance.introduceView.close(),c.instance.getPrjView.close()},e}(h)).prototype,"mapBtn",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=e(m.prototype,"introduceBtn",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),b=e(m.prototype,"helpBtn",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=e(m.prototype,"getPrjBtn",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=m))||y)),r._RF.pop()}}})),System.register("chunks:///_virtual/CameraController.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,i,n,o,r,s,a,l,h,c,u;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized,r=t.createClass},function(t){s=t.cclegacy,a=t._decorator,l=t.Camera,h=t.Vec3,c=t.view,u=t.Component}],execute:function(){var d,p,f,g,y,m;s._RF.push({},"622efjTeKdBl5ayGMAr/R0K","CameraController",void 0);var v=a.ccclass,_=a.property;t("default",(d=v("CameraController"),p=_(l),d(((m=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,n(e,"camera",y,o(e)),e.target=null,e.targetPos=new h(0,0,0),e._mapParams=null,e._winSize=void 0,e}i(e,t);var s=e.prototype;return s.onLoad=function(){e.instance=this},s.init=function(t){this._mapParams=t},s.update=function(t){this.followTarget(t)},s.getCameraPos=function(){return null==this.camera?new h(0,0,0):new h(Math.ceil(this.camera.node.position.x),Math.ceil(this.camera.node.position.y),0)},s.setTarget=function(t){this.target=t},s.followTarget=function(t){null!=this.target&&this.target.isValid&&null!=this.camera&&(this.targetPos=this.target.position.clone().subtract(new h(this.winSize.width/2,this.winSize.height/2)),this._mapParams.mapWidth<this.winSize.width?this.targetPos.x=(this._mapParams.mapWidth-this.winSize.width)/2:this.targetPos.x>this._mapParams.mapWidth-this.winSize.width?this.targetPos.x=this._mapParams.mapWidth-this.winSize.width:this.targetPos.x<0&&(this.targetPos.x=0),this._mapParams.mapHeight<this.winSize.height?this.targetPos.y=(this._mapParams.mapHeight-this.winSize.height)/2:this.targetPos.y>this._mapParams.mapHeight-this.winSize.height?this.targetPos.y=this._mapParams.mapHeight-this.winSize.height:this.targetPos.y<0&&(this.targetPos.y=0),this.targetPos.z=this.camera.node.position.z,this.targetPos=this.camera.node.position.lerp(this.targetPos,2*t),this.camera.node.position=this.targetPos)},s.setViewToPoint=function(t,e){this.targetPos=new h(t,e).subtract(new h(this.winSize.width/2,this.winSize.height/2)),this._mapParams.mapWidth<this.winSize.width?this.targetPos.x=(this._mapParams.mapWidth-this.winSize.width)/2:this.targetPos.x>this._mapParams.mapWidth-this.winSize.width?this.targetPos.x=this._mapParams.mapWidth-this.winSize.width:this.targetPos.x<0&&(this.targetPos.x=0),this._mapParams.mapHeight<this.winSize.height?this.targetPos.y=(this._mapParams.mapHeight-this.winSize.height)/2:this.targetPos.y>this._mapParams.mapHeight-this.winSize.height?this.targetPos.y=this._mapParams.mapHeight-this.winSize.height:this.targetPos.y<0&&(this.targetPos.y=0),this.targetPos.z=this.camera.node.position.z,this.camera.node.position=this.targetPos},s.onDestroy=function(){e.instance=null},r(e,[{key:"winSize",get:function(){return null==this._winSize&&(this._winSize=c.getVisibleSize()),this._winSize}}]),e}(u)).instance=null,y=e((g=m).prototype,"camera",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),f=g))||f)),s._RF.pop()}}})),System.register("chunks:///_virtual/Common.ts",["cc"],(function(t){var e;return{setters:[function(t){e=t.cclegacy}],execute:function(){e._RF.push({},"b21ab/9QsZNQ7vgDt0vtZ9T","Common",void 0),t("Vector2",function(){function t(t,e){this.x=0,this.y=0,this.x=t,this.y=e}var e=t.prototype;return e.plus=function(e){return new t(this.x+e.x,this.y+e.y)},e.minus=function(e){return new t(this.x-e.x,this.y-e.y)},e.multiply=function(t){return this.x*t.x+this.y*t.y},e.scale=function(e){return new t(this.x*e,this.y*e)},e.copy=function(t){return this.x=t.x,this.y=t.y,this},e.clone=function(){return new t(this.x,this.y)},e.substract=function(t,e){return t.x-=e.x,t.y-=e.y,t},e.lengthSqr=function(){return Math.pow(this.x,2)+Math.pow(this.y,2)},t}()),t("Obstacle",(function(){this.next=void 0,this.previous=void 0,this.direction=void 0,this.point=void 0,this.id=void 0,this.convex=void 0})),t("Line",(function(){this.point=void 0,this.direction=void 0})),t("KeyValuePair",(function(t,e){this.key=void 0,this.value=void 0,this.key=t,this.value=e})),t("RVOMath",function(){function t(){}return t.absSq=function(t){return t.multiply(t)},t.normalize=function(e){return e.scale(1/t.abs(e))},t.distSqPointLineSegment=function(e,i,n){var o=n.minus(e),r=i.minus(e),s=o.multiply(r)/t.absSq(r);return s<0?t.absSq(o):s>1?t.absSq(n.minus(i)):t.absSq(n.minus(e.plus(r.scale(s))))},t.sqr=function(t){return t*t},t.det=function(t,e){return t.x*e.y-t.y*e.x},t.abs=function(e){return Math.sqrt(t.absSq(e))},t.leftOf=function(e,i,n){return t.det(e.minus(n),i.minus(e))},t}()).RVO_EPSILON=1e-5,e._RF.pop()}}})),System.register("chunks:///_virtual/ControlMode.ts",["cc"],(function(t){var e;return{setters:[function(t){e=t.cclegacy}],execute:function(){var i;t("ControlMode",void 0),e._RF.push({},"fd1b36VZM5JO7pVY7NY84Gm","ControlMode",void 0),function(t){t[t.touch=0]="touch",t[t.joystick=1]="joystick"}(i||(i=t("ControlMode",{}))),e._RF.pop()}}})),System.register("chunks:///_virtual/DataConfig.ts",["cc","./SoundManager.ts"],(function(t){var e,i;return{setters:[function(t){e=t.cclegacy},function(t){i=t.BGSound}],execute:function(){e._RF.push({},"b338e6tD1pAdofYapDnsV6s","DataConfig",void 0);var n=t("DataConfig",function(){function t(){}return t.getMapBGSound=function(e){return t.BGMData[e]?t.BGMData[e]:t.NpcTalkData[1e4]},t.getNpcTalkData=function(e){return t.NpcTalkData[e]?t.NpcTalkData[e]:t.NpcTalkData[1e3]},t}());n.BGMData={1e4:i.none,10001:i.bgm1,10002:i.bgm2,10003:i.bgm3,10004:i.bgm4,10005:i.bgm5},n.NpcTalkData={1e3:"你好！",2001:"我是装备商，要买点什么装备吗？",2002:"往西边走，可以去长寿！",3001:"天上人间很好玩！，你快去体验一下吧！",3002:"我是楼主！你是谁？",4001:"私闯民宅，给我滚出去！",5001:"大爷，我们这里的姑娘只卖身不卖艺的！",5002:"我寂寞，我冷！",5003:"什么才一两，当我什么啊，最少也要给十两",5004:"大爷，不要这样，你再这样我可要叫了！",5005:"禽兽！"},e._RF.pop()}}})),System.register("chunks:///_virtual/EditObjData.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,i;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy}],execute:function(){i._RF.push({},"3d0dfoRXqtGe4rOoa+utwRI","EditObjData",void 0);var n=t("default",(function(){this.objId="",this.objName="",this.objType="",this.skin="",this.x=0,this.y=0,this.cx=0,this.cy=0,this.params=""}));t("EditNpcData",function(t){function i(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).direction=0,e.isPatrol=!1,e.dialogueId=0,e.taskId=0,e.funcId=0,e.npcType=0,e}return e(i,t),i}(n)),t("EditMonsterData",function(t){function i(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).direction=0,e.isPatrol=!1,e.dialogueId=0,e.fightId=0,e.monsterType=0,e}return e(i,t),i}(n)),t("EditTransferData",function(t){function i(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).targetMapId="",e.targetMapSpawnId=0,e.transferType=0,e}return e(i,t),i}(n)),t("EditSpawnPointData",function(t){function i(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).spawnId=0,e.defaultSpawn=!1,e}return e(i,t),i}(n)),i._RF.pop()}}})),System.register("chunks:///_virtual/EntityLayer.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,i,n,o;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,n=t._decorator,o=t.Component}],execute:function(){var r;i._RF.push({},"6639ayo4DFKZYCU2OBZzyb+","EntityLayer",void 0);var s=n.ccclass;n.property,t("default",s("EntityLayer")(r=function(t){function i(){return t.apply(this,arguments)||this}e(i,t);var n=i.prototype;return n.start=function(){},n.update=function(t){this.sortZindex()},n.clear=function(){},n.sortZindex=function(){var t=this.node.children.slice();t.sort((function(t,e){return t.position.y>e.position.y?-1:t.position.y<e.position.y?1:0}));for(var e=t.length,i=0;i<e;i++)t[i].setSiblingIndex(i)},i}(o))||r),i._RF.pop()}}})),System.register("chunks:///_virtual/FogOfWar.ts",["./rollupPluginModLoBabelHelpers.js","cc","./TextureUtils.ts"],(function(t){var e,i,n,o,r,s,a,l,h,c,u,d,p,f,g;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){r=t.cclegacy,s=t._decorator,a=t.Sprite,l=t.CCInteger,h=t.Color,c=t.Vec3,u=t.UITransform,d=t.Texture2D,p=t.Vec2,f=t.Component},function(t){g=t.TextureUtils}],execute:function(){var y,m,v,_,b,P,x,T,C,N,w,M;r._RF.push({},"243feOTIJNKZ5LbKNreaswF","FogOfWar",void 0);var S=s.ccclass,k=s.property;t("FogOfWar",(y=S("FogOfWar"),m=k(a),v=k(l),_=k(l),b=k(h),y(((M=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,n(e,"fogMask",T,o(e)),n(e,"texWidth",C,o(e)),n(e,"texHeight",N,o(e)),n(e,"defaultColor",w,o(e)),e.maskTex=null,e.texUtils=void 0,e.maskSize=null,e.maskScaleX=1,e.maskScaleY=1,e.maskScale=1,e.tempVec3=new c,e.isTexChange=!1,e}i(e,t);var r=e.prototype;return r.onLoad=function(){e.instance=this},r.init=function(t,e){this.fogMask.node.getComponent(u).setContentSize(t,e),this.maskTex=new d,this.maskTex.reset({width:this.texWidth,height:this.texHeight,format:d.PixelFormat.RGBA8888}),this.texUtils=new g,this.texUtils.init(this.maskTex),this.resetColor(),this.maskTex.uploadData(this.texUtils.getData()),this.maskSize=this.fogMask.node.getComponent(u).contentSize,this.maskScaleX=this.texWidth/this.maskSize.width,this.maskScaleY=this.texHeight/this.maskSize.height,this.maskScale=Math.max(this.maskScaleX,this.maskScaleY),this.fogMask.enabled=!0,this.fogMask.spriteFrame.texture=this.maskTex},r.convertNodePosToTexPos=function(t,e){this.tempVec3.set(e.x,e.y,0);var i=t.getComponent(u).convertToNodeSpaceAR(this.tempVec3);return i.x+=t.getComponent(u).width*t.getComponent(u).anchorX,i.y+=t.getComponent(u).height*t.getComponent(u).anchorY,i.y=t.getComponent(u).height-i.y,new p(i.x,i.y)},r.lateUpdate=function(){this.isTexChange&&(this.isTexChange=!1,this.maskTex.uploadData(this.texUtils.getData()))},r.resetColor=function(){for(var t=0;t<this.texHeight;t++)for(var e=0;e<this.texWidth;e++)this.texUtils.setPixel(e,t,this.defaultColor)},r.drawCircle=function(t,e,i){var n=this.convertNodePosToTexPos(this.fogMask.node,new p(t,e));t=Math.floor(n.x*this.maskScaleX),e=Math.floor(n.y*this.maskScaleY);var o=(i=Math.floor(i))*this.maskScale,r=i*this.maskScale;this.drawColor(t,e,o,r,i)},r.drawOval=function(t,e,i,n){var o=this.convertNodePosToTexPos(this.fogMask.node,new p(t,e));t=Math.floor(o.x*this.maskScaleX),e=Math.floor(o.y*this.maskScaleY);var r=i*this.maskScale,s=n*this.maskScale,a=Math.max(r,s);this.drawColor(t,e,r,s,a)},r.drawColor=function(t,e,i,n,o){this.maskSize.width<this.maskSize.height?n*=this.maskSize.width/this.maskSize.height:this.maskSize.width>this.maskSize.height&&(i*=this.maskSize.height/this.maskSize.width);for(var r=i*i,s=n*n,a=e-o;a<e+o;a++)for(var l=t-o;l<t+o;l++){var h=l,c=a,u=h-t,d=c-e,p=u*u/r+d*d/s;if(p<=1){var f=this.texUtils.getPixel(h,c);f.a=Math.floor(f.a*p),this.texUtils.setPixel(h,c,f)}}this.isTexChange=!0},e}(f)).instance=null,T=e((x=M).prototype,"fogMask",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=e(x.prototype,"texWidth",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 256}}),N=e(x.prototype,"texHeight",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 256}}),w=e(x.prototype,"defaultColor",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new h(0,0,0,255)}}),P=x))||P)),r._RF.pop()}}})),System.register("chunks:///_virtual/FootTrigger.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Behaviour.ts","./Actor.ts","./TransferDoor.ts"],(function(t){var e,i,n,o,r,s,a,l,h,c;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized,r=t.createClass},function(t){s=t.cclegacy,a=t._decorator},function(t){l=t.Behaviour},function(t){h=t.default},function(t){c=t.default}],execute:function(){var u,d,p,f,g;s._RF.push({},"e6f05YZAHRGiorL9OHBeRYw","FootTrigger",void 0);var y=a.ccclass,m=a.property;t("default",(u=y("FootTrigger"),d=m(h),u((g=e((f=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,n(e,"selfActor",g,o(e)),e}i(e,t);var s=e.prototype;return s.start=function(){},s.onTriggerEnter=function(t){var e=t.otherCollider.getComponent(c);null!=e&&e.onTriggerEnter(this.actor)},s.onTriggerExit=function(t){var e=t.otherCollider.getComponent(c);null!=e&&e.onTriggerEnter(this.actor)},r(e,[{key:"actor",get:function(){return!this.selfActor&&this.node.parent&&(this.selfActor=this.node.parent.getComponent(h)),this.selfActor}}]),e}(l)).prototype,"selfActor",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),p=f))||p)),s._RF.pop()}}})),System.register("chunks:///_virtual/GameController.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ControlMode.ts","./SceneManager.ts","./GameWorld.ts"],(function(t){var e,i,n,o,r,s,a,l,h,c,u,d;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){r=t.cclegacy,s=t._decorator,a=t.Enum,l=t.Component},function(t){h=t.ControlMode},function(t){c=t.default,u=t.SceneLoadStatus},function(t){d=t.default}],execute:function(){var p,f,g,y,m,v;r._RF.push({},"31c2aC2pFRIBruSNZr6cbm3","GameController",void 0);var _=s.ccclass,b=s.property;t("default",(p=_("GameController"),f=b({type:a(h),tooltip:"控制模式:\ntouch  点击行走 \njoystick 摇杆操作 "}),p(((v=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,n(e,"controlMode",m,o(e)),e}i(e,t);var r=e.prototype;return r.onLoad=function(){e.instance=this,this.init()},r.start=function(){},r.init=function(){},r.isCanControlPlayer=function(){return c.instance.loadStatus!=u.loading&&!!d.instance.isMapValid()&&null!=d.instance.gameMap.myPlayer},e}(l)).instance=null,m=e((y=v).prototype,"controlMode",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return h.touch}}),g=y))||g)),r._RF.pop()}}})),System.register("chunks:///_virtual/GameManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./MonsterManager.ts","./NpcManager.ts","./OtherManager.ts","./PetManager.ts","./PlayerManager.ts"],(function(t){var e,i,n,o,r,s,a,l,h,c,u;return{setters:[function(t){e=t.inheritsLoose,i=t.createClass},function(t){n=t.cclegacy,o=t._decorator,r=t.game,s=t.Component},function(t){a=t.default},function(t){l=t.default},function(t){h=t.default},function(t){c=t.default},function(t){u=t.default}],execute:function(){var d,p;n._RF.push({},"c63a6DR8ZRHQpBvpeEqDbvH","GameManager",void 0);var f=o.ccclass;o.property,t("default",f("GameManager")(((p=function(t){function n(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this)._playerMgr=null,e._petMgr=null,e._npcMgr=null,e._monsterMgr=null,e._otherMgr=null,e}e(n,t);var o=n.prototype;return o.onLoad=function(){n._instance?this.node.destroy():(n._instance=this,r.addPersistRootNode(this.node),this.init())},o.init=function(){},i(n,[{key:"playerMgr",get:function(){return null==this._playerMgr&&(this._playerMgr=this.getComponentInChildren(u)),this._playerMgr}},{key:"petMgr",get:function(){return null==this._petMgr&&(this._petMgr=this.getComponentInChildren(c)),this._petMgr}},{key:"npcMgr",get:function(){return null==this._npcMgr&&(this._npcMgr=this.getComponentInChildren(l)),this._npcMgr}},{key:"monsterMgr",get:function(){return null==this._monsterMgr&&(this._monsterMgr=this.getComponentInChildren(a)),this._monsterMgr}},{key:"otherMgr",get:function(){return null==this._otherMgr&&(this._otherMgr=this.getComponentInChildren(h)),this._otherMgr}}],[{key:"instance",get:function(){return n._instance}}]),n}(s))._instance=void 0,d=p))||d),n._RF.pop()}}})),System.register("chunks:///_virtual/GameMap.ts",["./rollupPluginModLoBabelHelpers.js","cc","./PathLog.ts","./PathFindingAgent.ts","./Common.ts","./Simulator.ts","./RVOSystem.ts","./Behaviour.ts","./FogOfWar.ts","./Player.ts","./CameraController.ts","./SoundManager.ts","./DataConfig.ts","./EntityLayer.ts","./TransferDoor.ts","./Monster.ts","./NPC.ts","./SpawnPoint.ts","./GameManager.ts","./MapParams.ts","./MapLayer.ts","./ObstacleEdgeUtils.ts","./GameController.ts"],(function(t){var e,i,n,o,r,s,a,l,h,c,u,d,p,f,g,y,m,v,_,b,P,x,T,C,N,w,M,S,k,D,R,A,I;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized,r=t.createClass},function(t){s=t.cclegacy,a=t._decorator,l=t.Node,h=t.Vec3,c=t.Graphics,u=t.view},function(t){d=t.default},function(t){p=t.default},function(t){f=t.Vector2},function(t){g=t.Simulator},function(t){y=t.default},function(t){m=t.Behaviour},function(t){v=t.FogOfWar},function(t){_=t.PlayerType,b=t.PlayerControlType},function(t){P=t.default},function(t){x=t.SoundManager},function(t){T=t.DataConfig},function(t){C=t.default},function(t){N=t.default},function(t){w=t.default},function(t){M=t.default},function(t){S=t.default},function(t){k=t.default},function(t){D=t.default},function(t){R=t.default},function(t){A=t.default},function(t){I=t.default}],execute:function(){var L,B,O,z,F,E,H,U,V,W,j,G;s._RF.push({},"89c47E03L1GW547eXJCInNz","GameMap",void 0);var q=a.ccclass,Y=a.property;t("default",(L=q("GameMap"),B=Y(l),O=Y(R),z=Y(C),F=Y(l),L(((G=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,n(e,"layer",U,o(e)),n(e,"mapLayer",V,o(e)),n(e,"entityLayer",W,o(e)),n(e,"roadLayer",j,o(e)),e._myPlayer=null,e._sceneData=null,e._mapData=null,e._mapParams=null,e.roadSign=null,e.spawnPointList=[],e.transferDoorList=[],e.npcList=[],e.monsterList=[],e._winSize=void 0,e._fogWartime=0,e._lastPlayerPos=null,e}i(e,t);var s=e.prototype;return s.onLoad=function(){e.instance=this},s.start=function(){this.node.position=new h(-this.winSize.width/2,-this.winSize.height/2),this.roadLayer.active=e.isDrawRoadLayer},s.init=function(t){this._sceneData=t,this._mapData=t.mapData,this._mapParams=this.getMapParams(t.mapData,t.bgTex,t.mapLoadModel),this.mapLayer.init(this._mapParams),d.setLogEnable(!1),p.instance.init(t.mapData),this.width=this.mapLayer.width,this.height=this.mapLayer.height,this.initRVO(),this.initMapElement(),this.afterInitMapElement(),this.initPlayer(),this.initCamera(),this.initBGM(),this.initFogOfWar()},s.initMapElement=function(){var t=this._mapData.mapItems;if(t)for(var e=0;e<t.length;e++){var i=t[e];"npc"==i.type?this.initNpc(i):"monster"==i.type?this.initMonster(i):"transfer"==i.type?this.initTransferDoor(i):"spawnPoint"==i.type&&this.initSpawnPoint(i)}},s.initNpc=function(t){var e=k.instance.npcMgr.getNPC();e.node.parent=this.entityLayer.node,e.initEditData(t),e.init(),y.instance.runing&&e.initRVO()},s.initMonster=function(t){var e=k.instance.monsterMgr.getMonster();e.node.parent=this.entityLayer.node,e.initEditData(t),e.init(),y.instance.runing&&e.initRVO()},s.initTransferDoor=function(t){var e=k.instance.otherMgr.getTransferDoor(t.transferType);e.node.parent=this.entityLayer.node,e.initEditData(t),e.init()},s.initSpawnPoint=function(t){var e=k.instance.otherMgr.getSpawnPoint();e.node.parent=this.entityLayer.node,e.initEditData(t),e.init()},s.afterInitMapElement=function(){this.spawnPointList=this.getComponentsInChildren(S),this.transferDoorList=this.getComponentsInChildren(N),this.npcList=this.getComponentsInChildren(M),this.monsterList=this.getComponentsInChildren(w)},s.initPlayer=function(){var t=this.getSpawnPoint(this.sceneData.enterSpawnId),e=k.instance.playerMgr.selectRoleId;this._myPlayer=k.instance.playerMgr.getPlayer(e),this._myPlayer.node.parent=this.entityLayer.node,this._myPlayer.playerType=_.my,this._myPlayer.controlType=b.user,this._myPlayer.controlMode=I.instance.controlMode,this._myPlayer.node.position=null!=t?t.node.position:new h(1e3,1e3,0),y.instance.runing&&this._myPlayer.initRVO()},s.switchPlayer=function(t){var e=new h;null!=this._myPlayer&&(e=this._myPlayer.node.position,this._myPlayer.destroySelf(),this._myPlayer=null),this._myPlayer=k.instance.playerMgr.getPlayer(t),this._myPlayer.node.parent=this.entityLayer.node,this._myPlayer.playerType=_.my,this._myPlayer.controlType=b.user,this._myPlayer.controlMode=I.instance.controlMode,this._myPlayer.node.position=e,y.instance.runing&&this._myPlayer.initRVO(),P.instance.setTarget(this._myPlayer.node)},s.initCamera=function(){P.instance.init(this._mapParams),P.instance.setTarget(this._myPlayer.node),P.instance.setViewToPoint(this._myPlayer.node.position.x,this._myPlayer.node.position.y)},s.initBGM=function(){x.instance.stopBGSound(),x.instance.playBGSound(T.getMapBGSound(this.sceneData.currentMapId))},s.initRVO=function(){y.instance.refresh();for(var t=A.instance.getObstacleEdge(),e=t.length,i=0;i<e;i++){var n=t[i],o=[];o.push(new f(n.startX,n.startY)),o.push(new f(n.endX,n.endY)),g.instance.addObstacle(o)}g.instance.processObstacles(),y.instance.startup();var r=this.roadLayer.getComponent(c);A.instance.showObstacleEdge(r)},s.initFogOfWar=function(){null!=v.instance&&(v.instance.node.position=new h(-this.winSize.width/2,-this.winSize.height/2),v.instance.init(this.mapLayer.width,this.mapLayer.height))},s.getMapParams=function(t,e,i){void 0===i&&(i=1);var n=new D;return n.name=t.name,n.bgName=t.bgName,n.mapType=t.type,n.mapWidth=t.mapWidth,n.mapHeight=t.mapHeight,n.ceilWidth=t.nodeWidth,n.ceilHeight=t.nodeHeight,n.viewWidth=t.mapWidth>this.winSize.width?this.winSize.width:t.mapWidth,n.viewHeight=t.mapHeight>this.winSize.height?this.winSize.height:t.mapHeight,n.sliceWidth=256,n.sliceHeight=256,n.bgTex=e,n.mapLoadModel=i,n},s.getSpawnPoint=function(t){void 0===t&&(t=0);for(var e=0;e<this.spawnPointList.length;e++)if(this.spawnPointList[e].spawnId==t)return this.spawnPointList[e];if(0==t)for(e=0;e<this.spawnPointList.length;e++)if(this.spawnPointList[e].defaultSpawn)return this.spawnPointList[e];return console.error("地图"+this.sceneData.currentMapId+"不存在这个出生点 spawnId = "+t),null},s.showRoadSign=function(t){this.roadSign||(this.roadSign=k.instance.otherMgr.getRoadSign(),this.roadSign.node.parent=this.node),this.roadSign.node.position=t,this.roadSign.play()},s.update2=function(t){if(null!=v.instance&&(this._fogWartime-=t,this._fogWartime<=0)){this._fogWartime=.02;var e=this.myPlayer.mapPos;(null==this._lastPlayerPos||Math.abs(e.x-this._lastPlayerPos.x)>1||Math.abs(e.y-this._lastPlayerPos.y)>1)&&(null==this._lastPlayerPos&&(this._lastPlayerPos=new h),this._lastPlayerPos.x=e.x,this._lastPlayerPos.y=e.y,v.instance.drawOval(this.myPlayer.x,this.myPlayer.y+35,80,120));for(var i=0;i<this.npcList.length;i++)v.instance.drawOval(this.npcList[i].x,this.npcList[i].y+35,160,100)}},s.getPos=function(){return new h(Math.ceil(this.myPlayer.x),Math.ceil(this.myPlayer.y),0)},s.destroySelf=function(){this.node.destroy()},r(e,[{key:"myPlayer",get:function(){return this._myPlayer}},{key:"sceneData",get:function(){return this._sceneData}},{key:"mapData",get:function(){return this._mapData}},{key:"winSize",get:function(){return null==this._winSize&&(this._winSize=u.getVisibleSize()),this._winSize}}]),e}(m)).instance=null,G.isDrawRoadLayer=!0,U=e((H=G).prototype,"layer",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=e(H.prototype,"mapLayer",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=e(H.prototype,"entityLayer",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j=e(H.prototype,"roadLayer",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=H))||E)),s._RF.pop()}}})),System.register("chunks:///_virtual/GameObject.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,i,n,o,r,s;return{setters:[function(t){e=t.inheritsLoose,i=t.createClass},function(t){n=t.cclegacy,o=t._decorator,r=t.Node,s=t.director}],execute:function(){var a;n._RF.push({},"75cc0eX5ChHrrsMSLK1O49f","GameObject",void 0);var l=o.ccclass,h=(o.property,t("GameObject",l("GameObject")(a=function(t){function n(){return t.apply(this,arguments)||this}return e(n,t),n.prototype.setActive=function(t){this.active!=t&&(this.active=t)},n.Find=function(t){var e=s.getScene();return this.searchChildByName(e,t)},n.searchChildByName=function(t,e){var i=t.getChildByName(e);if(i)return i;for(var n=t.children.length,o=null,r=0;r<n;r++){if((o=t.children[r]).name==e)return o;if(i=this.searchChildByName(o,e))return i}return i},n.FindObjectOfType=function(t){var e=t;return s.getScene().getComponentInChildren(e)},n.FindObjectsOfType=function(t){var e=t;return s.getScene().getComponentsInChildren(e)},i(n,[{key:"transform",get:function(){return this}},{key:"gameObject",get:function(){return this}}]),n}(r))||a));r.prototype.gameObject=h.prototype.gameObject,r.prototype.transform=h.prototype.transform,n._RF.pop()}}})),System.register("chunks:///_virtual/GamePlatformConfig.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GamePlatformType.ts"],(function(t){var e,i,n,o,r,s,a,l,h,c;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){r=t.cclegacy,s=t._decorator,a=t.Enum,l=t.CCString,h=t.Component},function(t){c=t.GamePlatformType}],execute:function(){var u,d,p,f,g,y,m,v,_,b,P,x,T;r._RF.push({},"528cbjxl4NMPJHih40vL3Fg","GamePlatformConfig",void 0);var C=s.ccclass,N=s.property;t("default",(u=C("GamePlatformConfig"),d=N({type:a(c),displayName:"平台类型"}),p=N({displayName:"游戏appid"}),f=N({displayName:"游戏密匙"}),g=N({type:l,displayName:"视频广告"}),y=N({type:l,displayName:"横幅广告"}),u((_=e((v=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,n(e,"type",_,o(e)),n(e,"appId",b,o(e)),n(e,"secret",P,o(e)),n(e,"videoAd_unitIds",x,o(e)),n(e,"bannerAd_unitIds",T,o(e)),e}return i(e,t),e}(h)).prototype,"type",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return c.none}}),b=e(v.prototype,"appId",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),P=e(v.prototype,"secret",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),x=e(v.prototype,"videoAd_unitIds",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return["","","","",""]}}),T=e(v.prototype,"bannerAd_unitIds",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return["","","","",""]}}),m=v))||m)),r._RF.pop()}}})),System.register("chunks:///_virtual/GamePlatformType.ts",["cc"],(function(t){var e;return{setters:[function(t){e=t.cclegacy}],execute:function(){var i;t("GamePlatformType",void 0),e._RF.push({},"6a74ffrhv9Is5BipTnepB3S","GamePlatformType",void 0),function(t){t[t.none=0]="none",t[t.pc=1]="pc",t[t.wx=2]="wx",t[t.tt=3]="tt",t[t.qq=4]="qq",t[t.oppo=5]="oppo",t[t.vivo=6]="vivo"}(i||(i=t("GamePlatformType",{}))),e._RF.pop()}}})),System.register("chunks:///_virtual/GameWorld.ts",["./rollupPluginModLoBabelHelpers.js","cc","./SceneManager.ts","./GameMap.ts"],(function(t){var e,i,n,o,r,s,a,l,h,c,u,d,p;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){r=t.cclegacy,s=t._decorator,a=t.Prefab,l=t.instantiate,h=t.Vec3,c=t.Component},function(t){u=t.default,d=t.SceneEventType},function(t){p=t.default}],execute:function(){var f,g,y,m,v,_;r._RF.push({},"80b063gthdC1Lm58FnLGdM3","GameWorld",void 0);var b=s.ccclass,P=s.property;t("default",(f=b("GameWorld"),g=P(a),f(((_=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,n(e,"gameMapPrefab",v,o(e)),e.gameMap=null,e}i(e,t);var r=e.prototype;return r.onLoad=function(){e.instance=this,this.init()},r.start=function(){},r.init=function(){this.registerEvent()},r.registerEvent=function(){u.instance.on(d.LOAD_COMPLETE,this.onSceneLoadComp,this)},r.onSceneLoadComp=function(t){null!=this.gameMap&&(this.gameMap.destroySelf(),this.gameMap=null),this.gameMap=this.createMap(),this.gameMap.init(t)},r.createMap=function(){var t=l(this.gameMapPrefab).getComponent(p);return t.node.parent=this.node,t.node.active=!0,t.node.position=new h(0,0,0),t},r.isMapValid=function(){return null!=this.gameMap&&this.gameMap.isValid&&this.gameMap.node.isValid},e}(c)).instance=null,v=e((m=_).prototype,"gameMapPrefab",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=m))||y)),r._RF.pop()}}})),System.register("chunks:///_virtual/InputManager.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,i,n,o,r,s,a,l,h,c,u,d;return{setters:[function(t){e=t.inheritsLoose,i=t.createClass},function(t){n=t.cclegacy,o=t._decorator,r=t.Vec2,s=t.input,a=t.Input,l=t.EventMouse,h=t.Node,c=t.game,u=t.UITransform,d=t.Component}],execute:function(){var p,f;t({KeyStatus:void 0,MouseButtonCode:void 0,TouchPhase:void 0,UKeyCode:void 0}),n._RF.push({},"a966d1Zw7RNab7Zw0mTKGMY","InputManager",void 0);var g=o.ccclass,y=(o.property,t("UInput",function(){function t(){}return t.getKeyDown=function(e){return t.keyDic[e]==m.keyDown},t.getKey=function(e){return t.keyDic[e]==m.keyDown||t.keyDic[e]==m.press},t.getKeyUp=function(e){return t.keyDic[e]==m.keyUp},t.getMouseButtonDown=function(e){return t.mouseBtnDic[e]==m.keyDown},t.getMouseButton=function(e){return t.mouseBtnDic[e]==m.keyDown||t.mouseBtnDic[e]==m.press},t.getMouseButtonUp=function(e){return t.mouseBtnDic[e]==m.keyUp},t.getTouch=function(t){for(var e=0;e<this.touches.length;e++)if(this.touches[e].fingerId==t)return this.touches[e];return null},t}()));y.mousePosition=r.ZERO,y.axis=r.ZERO,y.keyDic={},y.mouseBtnDic={},y.touches=[];var m,v,_,b=t("default",g("InputManager")(((f=function(t){function n(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).discardKeyList=[],e.mouseDiscardKeyList=[],e.axisDir=new r(0,0),e}e(n,t);var o=n.prototype;return o.init=function(){},o.onLoad=function(){s.on(a.EventType.KEY_DOWN,this.onKeyDown,this),s.on(a.EventType.KEY_UP,this.onKeyUp,this)},o.start=function(){s.on(a.EventType.MOUSE_DOWN,this.onMouseDown,this),s.on(a.EventType.MOUSE_UP,this.onMouseUp,this),s.on(a.EventType.MOUSE_MOVE,this.onMouseMove,this),s.on(a.EventType.TOUCH_START,this.onTouchStart,this),s.on(a.EventType.TOUCH_MOVE,this.onTouchMove,this),s.on(a.EventType.TOUCH_END,this.onTouchEnd,this),s.on(a.EventType.TOUCH_CANCEL,this.onTouchCancle,this)},o.startup=function(){console.log("InputManager 启动输入管理")},o.onKeyDown=function(t){var e=t.keyCode;t.keyCode>=48&&t.keyCode<=57&&(e+=48),y.keyDic[e]||(y.keyDic[e]=m.keyDown)},o.onKeyUp=function(t){var e=t.keyCode;t.keyCode>=48&&t.keyCode<=57&&(e+=48),y.keyDic[e]=m.keyUp},o.onMouseDown=function(t){t.preventSwallow=!0,t.getButton()==l.BUTTON_LEFT?y.mouseBtnDic[_.Left]=m.keyDown:t.getButton()==l.BUTTON_RIGHT?y.mouseBtnDic[_.Right]=m.keyDown:t.getButton()==l.BUTTON_MIDDLE&&(y.mouseBtnDic[_.Midden]=m.keyDown)},o.onMouseUp=function(t){t.preventSwallow=!0,t.getButton()==l.BUTTON_LEFT?y.mouseBtnDic[_.Left]=m.keyUp:t.getButton()==l.BUTTON_RIGHT?y.mouseBtnDic[_.Right]=m.keyUp:t.getButton()==l.BUTTON_MIDDLE&&(y.mouseBtnDic[_.Midden]=m.keyUp)},o.onMouseMove=function(t){t.preventSwallow=!0,y.mousePosition=t.getUILocation()},o.onMouseLeave=function(t){t.preventSwallow=!0,y.mousePosition=r.ZERO},o.onTouchStart=function(t){t.preventSwallow=!0;for(var e=t.getTouches(),i=[],n=0;n<e.length;n++){var o=new x;o.touch=e[n],o.fingerId=n,o.phase=P.Began,i.push(o)}y.touches=i},o.onTouchMove=function(t){t.preventSwallow=!0;for(var e=t.getTouches(),i=[],n=0;n<e.length;n++){var o=new x;o.touch=e[n],o.fingerId=n,o.phase=P.Moved,i.push(o)}y.touches=i},o.onTouchEnd=function(t){t.preventSwallow=!0;for(var e=0;e<y.touches.length;e++)y.touches[e].phase=P.Ended},o.onTouchCancle=function(t){t.preventSwallow=!0;for(var e=0;e<y.touches.length;e++)y.touches[e].phase=P.Canceled},o.update=function(t){this.axisDir.x=0,this.axisDir.y=0,(y.getKey(v.LeftArrow)||y.getKey(v.A))&&(this.axisDir.x=-1),(y.getKey(v.RightArrow)||y.getKey(v.D))&&(this.axisDir.x=1),(y.getKey(v.UpArrow)||y.getKey(v.W))&&(this.axisDir.y=1),(y.getKey(v.DownArrow)||y.getKey(v.S))&&(this.axisDir.y=-1),y.axis=this.axisDir},o.lateUpdate=function(){for(var t=0;t<this.discardKeyList.length;t++)delete y.keyDic[this.discardKeyList[t]];for(var e in this.discardKeyList.length=0,y.keyDic)y.keyDic[e]==m.keyDown&&(y.keyDic[e]=m.press),y.keyDic[e]==m.keyUp&&(y.keyDic[e]=m.none,this.discardKeyList.push(Number(e)));for(t=0;t<this.mouseDiscardKeyList.length;t++)delete y.mouseBtnDic[this.mouseDiscardKeyList[t]];for(var i in this.mouseDiscardKeyList.length=0,y.mouseBtnDic)y.mouseBtnDic[i]==m.keyDown&&(y.mouseBtnDic[i]=m.press),y.mouseBtnDic[i]==m.keyUp&&(y.mouseBtnDic[i]=m.none,this.mouseDiscardKeyList.push(Number(i)));for(t=0;t<y.touches.length;t++){var n=y.touches[t];n.phase!=P.Began&&n.phase!=P.Moved||(n.phase=P.Stationary),n.phase!=P.Ended&&n.phase!=P.Canceled||(y.touches.splice(t,1),t--)}},i(n,null,[{key:"instance",get:function(){if(null==this._instance){var t=new h("InputManager");c.addPersistRootNode(t),t.addComponent(u),this._instance=t.addComponent(n),this._instance.init()}return this._instance}}]),n}(d))._instance=void 0,p=f))||p);CC_EDITOR||b.instance.startup(),function(t){t[t.none=0]="none",t[t.keyDown=1]="keyDown",t[t.press=2]="press",t[t.keyUp=3]="keyUp"}(m||(m=t("KeyStatus",{}))),function(t){t[t.None=0]="None",t[t.Space=32]="Space",t[t.Enter=13]="Enter",t[t.Ctrl=17]="Ctrl",t[t.Alt=18]="Alt",t[t.Escape=27]="Escape",t[t.LeftArrow=37]="LeftArrow",t[t.UpArrow=38]="UpArrow",t[t.RightArrow=39]="RightArrow",t[t.DownArrow=40]="DownArrow",t[t.A=65]="A",t[t.B=66]="B",t[t.C=67]="C",t[t.D=68]="D",t[t.E=69]="E",t[t.F=70]="F",t[t.G=71]="G",t[t.H=72]="H",t[t.I=73]="I",t[t.J=74]="J",t[t.K=75]="K",t[t.L=76]="L",t[t.M=77]="M",t[t.N=78]="N",t[t.O=79]="O",t[t.P=80]="P",t[t.Q=81]="Q",t[t.R=82]="R",t[t.S=83]="S",t[t.T=84]="T",t[t.U=85]="U",t[t.V=86]="V",t[t.W=87]="W",t[t.X=88]="X",t[t.Y=89]="Y",t[t.Z=90]="Z",t[t.F1=112]="F1",t[t.F2=113]="F2",t[t.F3=114]="F3",t[t.F4=115]="F4",t[t.F5=116]="F5",t[t.F6=117]="F6",t[t.F7=118]="F7",t[t.F8=119]="F8",t[t.F9=120]="F9",t[t.F10=121]="F10",t[t.F11=122]="F11",t[t.F12=123]="F12",t[t.Num0=96]="Num0",t[t.Num1=97]="Num1",t[t.Num2=98]="Num2",t[t.Num3=99]="Num3",t[t.Num4=100]="Num4",t[t.Num5=101]="Num5",t[t.Num6=102]="Num6",t[t.Num7=103]="Num7",t[t.Num8=104]="Num8",t[t.Num9=105]="Num9"}(v||(v=t("UKeyCode",{}))),function(t){t[t.Left=0]="Left",t[t.Right=1]="Right",t[t.Midden=2]="Midden"}(_||(_=t("MouseButtonCode",{})));var P,x=t("TouchData",(function(){this.touch=null,this.fingerId=0,this.phase=P.Began}));!function(t){t[t.Began=0]="Began",t[t.Moved=1]="Moved",t[t.Stationary=2]="Stationary",t[t.Ended=3]="Ended",t[t.Canceled=4]="Canceled"}(P||(P=t("TouchPhase",{}))),n._RF.pop()}}})),System.register("chunks:///_virtual/IRoadSeeker.ts",["cc"],(function(){var t;return{setters:[function(e){t=e.cclegacy}],execute:function(){t._RF.push({},"e4f3f6Ez/xAyqwa4NhT8jTY","IRoadSeeker",void 0),t._RF.pop()}}})),System.register("chunks:///_virtual/Joystick.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,i,n,o,r,s,a,l;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){r=t.cclegacy,s=t._decorator,a=t.Node,l=t.Component}],execute:function(){var h,c,u,d,p;r._RF.push({},"5cf1eUddDtEbo4Yg+BcoH4F","Joystick",void 0);var f=s.ccclass,g=s.property;t("default",(h=f("Joystick"),c=g(a),h((p=e((d=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,n(e,"cursor",p,o(e)),e}i(e,t);var r=e.prototype;return r.start=function(){},r.cursorTo=function(t){this.cursor.position=t.clone().multiplyScalar(20)},r.show=function(){this.node.active=!0},r.hidden=function(){this.node.active=!1},e}(l)).prototype,"cursor",[c],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),u=d))||u)),r._RF.pop()}}})),System.register("chunks:///_virtual/JoystickController.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ControlMode.ts","./SceneManager.ts","./GameWorld.ts","./GameController.ts","./InputManager.ts","./Joystick.ts"],(function(t){var e,i,n,o,r,s,a,l,h,c,u,d,p,f,g,y,m,v;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){r=t.cclegacy,s=t._decorator,a=t.Vec2,l=t.Vec3,h=t.Node,c=t.view,u=t.Component},function(t){d=t.ControlMode},function(t){p=t.default,f=t.SceneEventType},function(t){g=t.default},function(t){y=t.default},function(t){m=t.UInput},function(t){v=t.default}],execute:function(){var _,b,P,x,T;r._RF.push({},"6b1bfPm88pBV4mbkuwBDXbM","JoystickController",void 0);var C=s.ccclass,N=s.property;t("default",(_=C("JoystickController"),b=N(v),_((T=e((x=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,n(e,"joyStick",T,o(e)),e.touchPos=a.ZERO,e.gameController=null,e.joyMoveDir=new l(0,0,0),e}i(e,t);var r=e.prototype;return r.onLoad=function(){this.gameController=this.getComponent(y)},r.start=function(){p.instance.on(f.Map_INIT_COMPLETE,this.onMapInitComp,this)},r.onMapInitComp=function(t){var e=g.instance.gameMap.node;e.on(h.EventType.TOUCH_START,this.onJoystickTouchStart,this),e.on(h.EventType.TOUCH_MOVE,this.onJoystickTouchMove,this),e.on(h.EventType.TOUCH_END,this.onJoystickTouchEnd,this),e.on(h.EventType.TOUCH_CANCEL,this.onJoystickTouchEnd,this)},r.update=function(t){if(this.gameController.controlMode==d.joystick&&this.gameController.isCanControlPlayer()){var e=g.instance.gameMap.myPlayer;0!=m.axis.x?e.moveDir.x=m.axis.x:e.moveDir.x=this.joyMoveDir.x,0!=m.axis.y?e.moveDir.y=m.axis.y:e.moveDir.y=this.joyMoveDir.y}},r.onJoystickTouchStart=function(t){if(this.gameController.controlMode==d.joystick){if(!this.gameController.isCanControlPlayer())return;var e=c.getVisibleSize();this.touchPos=t.getUILocation(),this.joyStick.node.position=new l(this.touchPos.x-.5*e.width,this.touchPos.y-.5*e.height),this.joyStick.show()}},r.onJoystickTouchMove=function(t){if(this.gameController.controlMode==d.joystick){if(!this.gameController.isCanControlPlayer())return;var e=t.getUILocation().subtract(this.touchPos).normalize();this.joyMoveDir.x=e.x,this.joyMoveDir.y=e.y,this.joyStick.cursorTo(this.joyMoveDir)}},r.onJoystickTouchEnd=function(t){if(this.gameController.controlMode==d.joystick){if(!this.gameController.isCanControlPlayer())return;this.joyMoveDir.x=0,this.joyMoveDir.y=0,this.joyStick.hidden()}},e}(u)).prototype,"joyStick",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=x))||P)),r._RF.pop()}}})),System.register("chunks:///_virtual/kdtree.ts",["cc","./Common.ts","./Simulator.ts"],(function(t){var e,i,n,o;return{setters:[function(t){e=t.cclegacy},function(t){i=t.RVOMath,n=t.Obstacle},function(t){o=t.Simulator}],execute:function(){e._RF.push({},"a7ee442uqxHILoPf3eaf9Mo","kdtree",void 0);var r=function(){function t(t,e){this.a=void 0,this.b=void 0,this.a=t,this.b=e}var e=t.prototype;return e.lessThan=function(t){return this.a<t.a||!(t.a<this.a)&&this.b<t.b},e.lessEqualThan=function(t){return this.a==t.a&&this.b==t.b||this.lessThan(t)},e.bigThan=function(t){return!this.lessEqualThan(t)},e.bigEqualThan=function(t){return!this.lessThan(t)},t}(),s=function(){this.begin=void 0,this.end=void 0,this.left=void 0,this.right=void 0,this.maxX=void 0,this.maxY=void 0,this.minX=void 0,this.minY=void 0},a=function(){this.obstacle=void 0,this.left=void 0,this.right=void 0};t("KdTree",function(){function t(){this.MAX_LEAF_SIZE=10,this.agents=null,this.agentTree=[],this.obstacleTree=null}var e=t.prototype;return e.buildAgentTree=function(t){if(!this.agents||this.agents.length!=t||o.instance.hasAgentChange){o.instance.hasAgentChange=!1,this.agents=new Array(t);for(var e=0;e<this.agents.length;e++)this.agents[e]=o.instance.getAgent(e);this.agentTree=new Array(2*this.agents.length);for(var i=0;i<this.agentTree.length;i++)this.agentTree[i]=new s}0!=this.agents.length&&this.buildAgentTreeRecursive(0,this.agents.length,0)},e.buildObstacleTree=function(){this.obstacleTree=new a;for(var t=new Array(o.instance.obstacles.length),e=0;e<t.length;e++)t[e]=o.instance.obstacles[e];this.obstacleTree=this.buildObstacleTreeRecursive(t)},e.computeAgentNeighbors=function(t,e){return this.queryAgentTreeRecursive(t,e,0)},e.computeObstacleNeighbors=function(t,e){this.queryObstacleTreeRecursive(t,e,this.obstacleTree)},e.queryVisibility=function(t,e,i){return this.queryVisibilityRecursive(t,e,i,this.obstacleTree)},e.buildAgentTreeRecursive=function(t,e,i){this.agentTree[i].begin=t,this.agentTree[i].end=e,this.agentTree[i].minX=this.agentTree[i].maxX=this.agents[t].position_.x,this.agentTree[i].minY=this.agentTree[i].maxY=this.agents[t].position_.y;for(var n=t+1;n<e;++n)this.agentTree[i].maxX=Math.max(this.agentTree[i].maxX,this.agents[n].position_.x),this.agentTree[i].minX=Math.min(this.agentTree[i].minX,this.agents[n].position_.x),this.agentTree[i].maxY=Math.max(this.agentTree[i].maxY,this.agents[n].position_.y),this.agentTree[i].minY=Math.min(this.agentTree[i].minY,this.agents[n].position_.y);if(e-t>this.MAX_LEAF_SIZE){for(var o=this.agentTree[i].maxX-this.agentTree[i].minX>this.agentTree[i].maxY-this.agentTree[i].minY,r=.5*(o?this.agentTree[i].maxX+this.agentTree[i].minX:this.agentTree[i].maxY+this.agentTree[i].minY),s=t,a=e;s<a;){for(;s<a&&(o?this.agents[s].position_.x:this.agents[s].position_.y)<r;)++s;for(;a>s&&(o?this.agents[a-1].position_.x:this.agents[a-1].position_.y)>=r;)--a;if(s<a){var l=this.agents[s];this.agents[s]=this.agents[a-1],this.agents[a-1]=l,++s,--a}}var h=s-t;0==h&&(++h,++s,++a),this.agentTree[i].left=i+1,this.agentTree[i].right=i+2*h,this.buildAgentTreeRecursive(t,s,this.agentTree[i].left),this.buildAgentTreeRecursive(s,e,this.agentTree[i].right)}},e.buildObstacleTreeRecursive=function(t){if(0==t.length)return null;for(var e=new a,s=0,l=t.length,h=l,c=0;c<t.length;++c){for(var u=0,d=0,p=t[c],f=p.next,g=0;g<t.length;g++)if(c!=g){var y=t[g],m=y.next,v=i.leftOf(p.point,f.point,y.point),_=i.leftOf(p.point,f.point,m.point);v>=-i.RVO_EPSILON&&_>=-i.RVO_EPSILON?++u:(v<=i.RVO_EPSILON&&_<=i.RVO_EPSILON||++u,++d);var b=new r(Math.max(u,d),Math.min(u,d)),P=new r(Math.max(l,h),Math.min(l,h));if(b.bigEqualThan(P))break}var x=new r(Math.max(u,d),Math.min(u,d)),T=new r(Math.max(l,h),Math.min(l,h));x.lessThan(T)&&(l=u,h=d,s=c)}for(var C=[],N=0;N<l;++N)C.push(null);for(var w=[],M=0;M<h;++M)w.push(null);for(var S=0,k=0,D=s,R=t[D],A=R.next,I=0;I<t.length;++I)if(D!=I){var L=t[I],B=L.next,O=i.leftOf(R.point,A.point,L.point),z=i.leftOf(R.point,A.point,B.point);if(O>=-i.RVO_EPSILON&&z>=-i.RVO_EPSILON)C[S++]=t[I];else if(O<=i.RVO_EPSILON&&z<=i.RVO_EPSILON)w[k++]=t[I];else{var F=i.det(A.point.minus(R.point),L.point.minus(R.point))/i.det(A.point.minus(R.point),L.point.minus(B.point)),E=L.point.plus(B.point.minus(L.point).scale(F)),H=new n;H.point=E,H.previous=L,H.next=B,H.convex=!0,H.direction=L.direction,H.id=o.instance.obstacles.length,o.instance.obstacles.push(H),L.next=H,B.previous=H,O>0?(C[S++]=L,w[k++]=H):(w[k++]=L,C[S++]=H)}}return e.obstacle=R,e.left=this.buildObstacleTreeRecursive(C),e.right=this.buildObstacleTreeRecursive(w),e},e.queryAgentTreeRecursive=function(t,e,n){if(this.agentTree[n].end-this.agentTree[n].begin<=this.MAX_LEAF_SIZE)for(var o=this.agentTree[n].begin;o<this.agentTree[n].end;++o)e=t.insertAgentNeighbor(this.agents[o],e);else{var r=i.sqr(Math.max(0,this.agentTree[this.agentTree[n].left].minX-t.position_.x))+i.sqr(Math.max(0,t.position_.x-this.agentTree[this.agentTree[n].left].maxX))+i.sqr(Math.max(0,this.agentTree[this.agentTree[n].left].minY-t.position_.y))+i.sqr(Math.max(0,t.position_.y-this.agentTree[this.agentTree[n].left].maxY)),s=i.sqr(Math.max(0,this.agentTree[this.agentTree[n].right].minX-t.position_.x))+i.sqr(Math.max(0,t.position_.x-this.agentTree[this.agentTree[n].right].maxX))+i.sqr(Math.max(0,this.agentTree[this.agentTree[n].right].minY-t.position_.y))+i.sqr(Math.max(0,t.position_.y-this.agentTree[this.agentTree[n].right].maxY));r<s?r<e&&s<(e=this.queryAgentTreeRecursive(t,e,this.agentTree[n].left))&&(e=this.queryAgentTreeRecursive(t,e,this.agentTree[n].right)):s<e&&r<(e=this.queryAgentTreeRecursive(t,e,this.agentTree[n].right))&&(e=this.queryAgentTreeRecursive(t,e,this.agentTree[n].left))}return e},e.queryObstacleTreeRecursive=function(t,e,n){if(null==n)return e;var o=n.obstacle,r=o.next,s=i.leftOf(o.point,r.point,t.position_);return e=this.queryObstacleTreeRecursive(t,e,s>=0?n.left:n.right),i.sqr(s)/i.absSq(r.point.minus(o.point))<e&&(s<0&&t.insertObstacleNeighbor(n.obstacle,e),this.queryObstacleTreeRecursive(t,e,s>=0?n.right:n.left)),e},e.queryVisibilityRecursive=function(t,e,n,o){if(null==o)return!0;var r=o.obstacle,s=r.next,a=i.leftOf(r.point,s.point,t),l=i.leftOf(r.point,s.point,e),h=1/i.absSq(s.point.minus(r.point));if(a>=0&&l>=0)return this.queryVisibilityRecursive(t,e,n,o.left)&&(i.sqr(a)*h>=i.sqr(n)&&i.sqr(l)*h>=i.sqr(n)||this.queryVisibilityRecursive(t,e,n,o.right));if(a<=0&&l<=0)return this.queryVisibilityRecursive(t,e,n,o.right)&&(i.sqr(a)*h>=i.sqr(n)&&i.sqr(l)*h>=i.sqr(n)||this.queryVisibilityRecursive(t,e,n,o.left));if(a>=0&&l<=0)return this.queryVisibilityRecursive(t,e,n,o.left)&&this.queryVisibilityRecursive(t,e,n,o.right);var c=i.leftOf(t,e,r.point),u=i.leftOf(t,e,s.point),d=1/i.absSq(e.minus(t));return c*u>=0&&i.sqr(c)*d>i.sqr(n)&&i.sqr(u)*d>i.sqr(n)&&this.queryVisibilityRecursive(t,e,n,o.left)&&this.queryVisibilityRecursive(t,e,n,o.right)},t}()),e._RF.pop()}}})),System.register("chunks:///_virtual/Launch.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GamePlatformType.ts","./GamePlatformConfig.ts"],(function(t){var e,i,n,o,r,s,a,l,h,c,u,d;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){r=t.cclegacy,s=t._decorator,a=t.Enum,l=t.Node,h=t.director,c=t.Component},function(t){u=t.GamePlatformType},function(t){d=t.default}],execute:function(){var p,f,g,y,m,v,_;r._RF.push({},"5eeafsFYQxFToZfTwT0EzBs","Launch",void 0);var b=s.ccclass,P=s.property;t("default",(p=b("Launch"),f=P({type:a(u),displayName:"选择平台"}),g=P(l),p((v=e((m=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,n(e,"type",v,o(e)),n(e,"platformConfig",_,o(e)),e}return i(e,t),e.prototype.start=function(){for(var t=this.platformConfig.getComponentsInChildren(d),e=null,i=0;i<t.length;i++)t[i].type==this.type&&(e=t[i]);null==e&&((e=new d).type=u.pc),console.log("当前选择的游戏平台为 ",u[e.type]),h.loadScene("Login")},e}(c)).prototype,"type",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return u.pc}}),_=e(m.prototype,"platformConfig",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=m))||y)),r._RF.pop()}}})),System.register("chunks:///_virtual/Loading.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,i,n,o,r,s,a,l,h,c,u;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized,r=t.createClass},function(t){s=t.cclegacy,a=t._decorator,l=t.Sprite,h=t.Label,c=t.director,u=t.Component}],execute:function(){var d,p,f,g,y,m,v,_;t("LoadingStatus",void 0),s._RF.push({},"2fc5cC47nhPwqk1BxMh3sMc","Loading",void 0);var b,P=a.ccclass,x=a.property;!function(t){t[t.none=0]="none",t[t.prepareLoading=1]="prepareLoading",t[t.loading=2]="loading",t[t.complete=3]="complete"}(b||(b=t("LoadingStatus",{}))),t("default",(d=P("Loading"),p=x(l),f=x(h),d(((_=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,n(e,"bar",m,o(e)),n(e,"progressTxt",v,o(e)),e.currentLoad=0,e.alreadyLoad=0,e.loadScale=1,e.totalLoad=100,e._progress=0,e}i(e,t),e.loadScene=function(t){this.status!=b.loading&&(this.sceneName=t,this.status=b.loading,c.loadScene("Loading"))},e.reloadScene=function(){this.status=b.none,this.loadScene(this.sceneName)};var s=e.prototype;return s.start=function(){var t=this;this.bar.fillRange=0,this.currentLoad=0,this.alreadyLoad=5,e.sceneName&&(e.status=b.loading,this.loadSceneRes((function(){e.status=b.complete,t.alreadyLoad=t.totalLoad,t.loadScale=2.5}))),this.scheduleOnce((function(){e.status!=b.loading&&e.status!=b.complete||(console.error("场景加载超时！"),e.reloadScene())}),18)},s.loadSceneRes=function(t){c.preloadScene(e.sceneName,(function(t,e,i){Number((t/e).toFixed(10))}),(function(i){i?(console.log("场景加载异常：sceneName",e.sceneName," error ",i),e.reloadScene()):(console.log("加载完成"),t())}))},s.update=function(t){if(this.currentLoad<this.alreadyLoad){if(this.currentLoad+=t*(50*(this.alreadyLoad-this.currentLoad)/this.totalLoad+50)*this.loadScale,this.currentLoad>=this.alreadyLoad){this.currentLoad=this.alreadyLoad;var e=.8*this.totalLoad;this.alreadyLoad<e&&(this.alreadyLoad=this.alreadyLoad+(e-this.alreadyLoad)*(.005*Math.random()),this.alreadyLoad>e&&(this.alreadyLoad=e))}this.progress=this.currentLoad/this.totalLoad,this.currentLoad>=this.totalLoad&&this.scheduleOnce(this.loadSceneComp,.1)}},s.loadSceneComp=function(){c.loadScene(e.sceneName,(function(){console.log("场景"+e.sceneName+"加载完成"),e.status=b.none}))},r(e,[{key:"progress",get:function(){return this._progress},set:function(t){this._progress!=t&&(this._progress=t,null!=this.bar&&(this.bar.fillRange=this._progress),null!=this.progressTxt&&(this.progressTxt.string=Math.floor(100*this._progress)+"%"))}}]),e}(u)).status=b.none,_.sceneName=null,m=e((y=_).prototype,"bar",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=e(y.prototype,"progressTxt",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),g=y))||g)),s._RF.pop()}}})),System.register("chunks:///_virtual/Login.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Loading.ts"],(function(t){var e,i,n,o,r,s,a,l,h,c;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){r=t.cclegacy,s=t._decorator,a=t.Button,l=t.Node,h=t.Component},function(t){c=t.default}],execute:function(){var u,d,p,f,g,y,m;r._RF.push({},"f06e3GRWftBwKyyVCcYT5ZO","Login",void 0);var v=s.ccclass,_=s.property;t("default",(u=v("Login"),d=_(a),p=_(a),u((y=e((g=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,n(e,"loginBtn",y,o(e)),n(e,"registerBtn",m,o(e)),e}return i(e,t),e.prototype.start=function(){this.loginBtn.node.on(l.EventType.TOUCH_START,(function(t){c.loadScene("Main")}),this),this.registerBtn.node.on(l.EventType.TOUCH_START,(function(t){}),this)},e}(h)).prototype,"loginBtn",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=e(g.prototype,"registerBtn",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),f=g))||f)),r._RF.pop()}}})),System.register("chunks:///_virtual/main",["./ControlMode.ts","./Point.ts","./RoadNode.ts","./MapType.ts","./MapRoadUtils.ts","./BinaryTreeNode.ts","./PathLog.ts","./PathOptimize.ts","./AstarHoneycombRoadSeeker.ts","./PathQuadSeek.ts","./AStarRoadSeeker.ts","./PathFindingAgent.ts","./Common.ts","./Agent.ts","./kdtree.ts","./Simulator.ts","./RVOSystem.ts","./NavJoystick.ts","./NavPath.ts","./NavRVO.ts","./NavAgent.ts","./Behaviour.ts","./MovieClip.ts","./TextureUtils.ts","./FogOfWar.ts","./Unit.ts","./NavUnit.ts","./Actor.ts","./Actor2.ts","./AnimationController.ts","./BaseView.ts","./Player.ts","./Body.ts","./UIManager.ts","./BottomToolBar.ts","./CameraController.ts","./SoundManager.ts","./DataConfig.ts","./EditObjData.ts","./EntityLayer.ts","./MapLoadModel.ts","./SceneManager.ts","./TransferDoor.ts","./FootTrigger.ts","./Monster.ts","./MonsterManager.ts","./NPCTalkBoard.ts","./NPC.ts","./NpcManager.ts","./RoadSign.ts","./SpawnPoint.ts","./OtherManager.ts","./Pet.ts","./PetManager.ts","./PlayerManager.ts","./GameManager.ts","./MapParams.ts","./MapLayer.ts","./ObstacleEdgeUtils.ts","./GameMap.ts","./GameWorld.ts","./GameController.ts","./GameObject.ts","./GamePlatformType.ts","./GamePlatformConfig.ts","./InputManager.ts","./IRoadSeeker.ts","./Joystick.ts","./JoystickController.ts","./Launch.ts","./Loading.ts","./Login.ts","./Main.ts","./MapBar.ts","./MapData.ts","./MiniMapView.ts","./MouseCursorController.ts","./SystemManager.ts","./TopToolBar.ts","./TouchController.ts","./Transform.ts"],(function(){return{setters:[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){}}})),System.register("chunks:///_virtual/Main.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Behaviour.ts","./MapLoadModel.ts","./SceneManager.ts"],(function(t){var e,i,n,o,r,s,a;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,n=t._decorator,o=t.setDisplayStats},function(t){r=t.Behaviour},function(t){s=t.MapLoadModel},function(t){a=t.default}],execute:function(){var l;i._RF.push({},"08578t5Vl9N1ZlW30M5nHYi","Main",void 0);var h=n.ccclass;n.property,t("default",h("Main")(l=function(t){function i(){return t.apply(this,arguments)||this}e(i,t);var n=i.prototype;return n.onLoad=function(){o(!1)},n.start=function(){this.init()},n.update=function(t){},n.init=function(){this.initScene()},n.initScene=function(){a.instance.loadMap("10001",0,s.slices)},i}(r))||l),i._RF.pop()}}})),System.register("chunks:///_virtual/MapBar.ts",["./rollupPluginModLoBabelHelpers.js","cc","./MapLoadModel.ts","./SceneManager.ts"],(function(t){var e,i,n,o,r,s,a,l,h,c;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){r=t.cclegacy,s=t._decorator,a=t.Node,l=t.Component},function(t){h=t.MapLoadModel},function(t){c=t.default}],execute:function(){var u,d,p,f,g;r._RF.push({},"d2544RaaRdHhrjMgF9cvxf4","MapBar",void 0);var y=s.ccclass,m=s.property;t("default",(u=y("MapBar"),d=m(a),u((g=e((f=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,n(e,"mapItems",g,o(e)),e}return i(e,t),e.prototype.start=function(){for(var t=this,e=function(e){t.mapItems[e].on(a.EventType.TOUCH_START,(function(t){c.instance.loadMap(""+(1e4+(e+1)),1,h.slices)}))},i=0;i<this.mapItems.length;i++)e(i)},e}(l)).prototype,"mapItems",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),p=f))||p)),r._RF.pop()}}})),System.register("chunks:///_virtual/MapData.ts",["cc","./MapType.ts"],(function(t){var e,i;return{setters:[function(t){e=t.cclegacy},function(t){i=t.MapType}],execute:function(){e._RF.push({},"a0091ubw51FsLzsP1pcYli/","MapData",void 0),t("default",(function(){this.name="",this.bgName="",this.type=i.angle45,this.mapWidth=0,this.mapHeight=0,this.nodeWidth=0,this.nodeHeight=0,this.roadDataArr=[],this.mapItems=[],this.alignment=0,this.offsetX=0,this.offsetY=0})),e._RF.pop()}}})),System.register("chunks:///_virtual/MapLayer.ts",["./rollupPluginModLoBabelHelpers.js","cc","./CameraController.ts","./MapLoadModel.ts"],(function(t){var e,i,n,o,r,s,a,l,h,c,u,d,p,f,g,y,m;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized,r=t.createClass},function(t){s=t.cclegacy,a=t._decorator,l=t.Sprite,h=t.Node,c=t.UITransform,u=t.SpriteFrame,d=t.Vec3,p=t.resources,f=t.Texture2D,g=t.Component},function(t){y=t.default},function(t){m=t.MapLoadModel}],execute:function(){var v,_,b,P,x;s._RF.push({},"753fbcKY45E1Lc2+Glt9EhY","MapLayer",void 0);var T=a.ccclass,C=a.property;t("default",(v=T("MapLayer"),_=C(l),v((x=e((P=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))||this)._sliceImgDic={},e._mapParams=null,e._lastCameraPos=null,n(e,"bgImg",x,o(e)),e}i(e,t);var s=e.prototype;return s.init=function(t){if(this._mapParams=t,!this.bgImg){var e=new h;this.node.addChild(e),e.layer=this.node.layer,this.bgImg=e.addComponent(l),this.bgImg.sizeMode=l.SizeMode.RAW,e.getComponent(c).anchorX=0,e.getComponent(c).anchorY=0}var i=new u;i.texture=this._mapParams.bgTex,this.bgImg.spriteFrame=i,t.mapLoadModel==m.slices&&(this.bgImg.getComponent(c).width=t.mapWidth,this.bgImg.getComponent(c).height=t.mapHeight),this.getComponent(c).width=this.width,this.getComponent(c).height=this.height},s.loadSliceImage=function(t,e){for(var i,n=this,o=Math.floor(e/this._mapParams.sliceHeight),r=Math.floor((e+this._mapParams.viewHeight)/this._mapParams.sliceHeight),s=Math.floor(t/this._mapParams.sliceWidth),a=Math.floor((t+this._mapParams.viewWidth)/this._mapParams.sliceWidth),l=o;l<=r;l++)for(var h=s;h<=a;h++)i=l+1+"_"+(h+1),this._sliceImgDic[i]||function(){var t=n.getSliceSprite(i);n._sliceImgDic[i]=t,n.node.addChild(t.node),t.node.position=new d(h*n._mapParams.sliceWidth,l*n._mapParams.sliceHeight,0),p.load("map/bg/"+n._mapParams.bgName+"/slices/"+i+"/texture",f,(function(e,i){if(null==e){var n=new u;n.texture=i,t.spriteFrame=n}}))}()},s.getSliceSprite=function(t){var e=new h(t);e.layer=this.node.layer;var i=e.addComponent(l);return i.sizeMode=l.SizeMode.RAW,e.getComponent(c).anchorX=0,e.getComponent(c).anchorY=0,i},s.clear=function(){for(var t in this.bgImg.spriteFrame=null,this._sliceImgDic){var e=this._sliceImgDic[t];e&&e.node.destroy(),this._sliceImgDic[t]=null,delete this._sliceImgDic[t]}},s.update=function(t){if(null!=y.instance&&null!=this._mapParams&&this._mapParams.mapLoadModel==m.slices){var e=y.instance.getCameraPos();null!=this._lastCameraPos&&e.x==this._lastCameraPos.x&&e.y==this._lastCameraPos.y||(this._lastCameraPos=e,this.loadSliceImage(e.x,e.y))}},r(e,[{key:"bgImage",get:function(){return this.bgImg}},{key:"width",get:function(){return this.bgImg?this.bgImg.getComponent(c).width:this._mapParams.viewWidth}},{key:"height",get:function(){return this.bgImg?this.bgImg.getComponent(c).height:this._mapParams.viewHeight}}]),e}(g)).prototype,"bgImg",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),b=P))||b)),s._RF.pop()}}})),System.register("chunks:///_virtual/MapLoadModel.ts",["cc"],(function(t){var e;return{setters:[function(t){e=t.cclegacy}],execute:function(){var i;t("MapLoadModel",void 0),e._RF.push({},"2f328tajjBEEabRmXaJoxWn","MapLoadModel",void 0),function(t){t[t.single=0]="single",t[t.slices=1]="slices"}(i||(i=t("MapLoadModel",{}))),e._RF.pop()}}})),System.register("chunks:///_virtual/MapParams.ts",["cc","./MapType.ts","./MapLoadModel.ts"],(function(t){var e,i,n;return{setters:[function(t){e=t.cclegacy},function(t){i=t.MapType},function(t){n=t.MapLoadModel}],execute:function(){e._RF.push({},"6b00e3/60pNy69HrXB4iMm4","MapParams",void 0),t("default",(function(){this.name="",this.bgName="",this.mapType=i.angle45,this.mapWidth=750,this.mapHeight=1600,this.ceilWidth=75,this.ceilHeight=75,this.viewWidth=750,this.viewHeight=1334,this.sliceWidth=256,this.sliceHeight=256,this.mapLoadModel=n.single,this.bgTex=null})),e._RF.pop()}}})),System.register("chunks:///_virtual/MapRoadUtils.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Point.ts","./RoadNode.ts","./MapType.ts"],(function(t){var e,i,n,o,r;return{setters:[function(t){e=t.createClass},function(t){i=t.cclegacy},function(t){n=t.default},function(t){o=t.default},function(t){r=t.MapType}],execute:function(){i._RF.push({},"38983rww8xCor2DSeawAfiI","MapRoadUtils",void 0),t("default",function(){function t(){this._mapWidth=void 0,this._mapHeight=void 0,this._row=void 0,this._col=void 0,this._nodeWidth=void 0,this._nodeHeight=void 0,this._halfNodeWidth=void 0,this._halfNodeHeight=void 0,this._mapType=void 0,this._mapRoad=void 0}var i=t.prototype;return i.updateMapInfo=function(t,e,i,n,o){switch(this._mapWidth=t,this._mapHeight=e,this._nodeWidth=i,this._nodeHeight=n,this._halfNodeWidth=Math.floor(this._nodeWidth/2),this._halfNodeHeight=Math.floor(this._nodeHeight/2),this._mapType=o,this._mapType){case r.angle45:this._col=Math.ceil(t/this._nodeWidth),this._row=2*Math.ceil(e/this._nodeHeight),this._mapRoad=new s(this._row,this._col,this._nodeWidth,this._nodeHeight,this._halfNodeWidth,this._halfNodeHeight);break;case r.angle90:this._col=Math.ceil(t/this._nodeWidth),this._row=Math.ceil(e/this._nodeHeight),this._mapRoad=new a(this._row,this._col,this._nodeWidth,this._nodeHeight,this._halfNodeWidth,this._halfNodeHeight);break;case r.honeycomb:this._col=2*Math.ceil((this._mapWidth-this._nodeWidth/4)/(this._nodeWidth/4*6)),this._row=Math.ceil((this._mapHeight-this._nodeHeight/2)/this._nodeHeight),this._mapRoad=new l(this._row,this._col,this._nodeWidth,this._nodeHeight,this._halfNodeWidth,this._halfNodeHeight);break;case r.honeycomb2:this._col=Math.ceil((this._mapWidth-this._nodeHeight/2)/this._nodeHeight),this._row=2*Math.ceil((this._mapHeight-this._nodeWidth/4)/(this._nodeWidth/4*6)),this._mapRoad=new h(this._row,this._col,this._nodeWidth,this._nodeHeight,this._halfNodeWidth,this._halfNodeHeight)}},i.getNodeByPixel=function(t,e){return this._mapRoad?this._mapRoad.getNodeByPixel(t,e):new o},i.getNodeByDerect=function(t,e){return this._mapRoad?this._mapRoad.getNodeByDerect(t,e):new o},i.getNodeByWorldPoint=function(t,e){return this._mapRoad?this._mapRoad.getNodeByWorldPoint(t,e):new o},i.getWorldPointByPixel=function(t,e){return this._mapRoad?this._mapRoad.getWorldPointByPixel(t,e):new n},i.getPixelByWorldPoint=function(t,e){return this._mapRoad?this._mapRoad.getPixelByWorldPoint(t,e):new n},i.getDerectByPixel=function(t,e){return this._mapRoad?this._mapRoad.getDerectByPixel(t,e):new n},i.getDerectByWorldPoint=function(t,e){return this._mapRoad?this._mapRoad.getDerectByWorldPoint(t,e):new n},i.getPixelByDerect=function(t,e){return this._mapRoad?this._mapRoad.getPixelByDerect(t,e):new n},e(t,[{key:"mapWidth",get:function(){return this._mapWidth}},{key:"mapHeight",get:function(){return this._mapHeight}},{key:"nodeWidth",get:function(){return this._nodeWidth}},{key:"nodeHeight",get:function(){return this._nodeHeight}},{key:"row",get:function(){return this._row}},{key:"col",get:function(){return this._col}},{key:"halfNodeWidth",get:function(){return this._halfNodeWidth}},{key:"halfNodeHeight",get:function(){return this._halfNodeHeight}},{key:"mapType",get:function(){return this._mapType}}],[{key:"instance",get:function(){return null==this._instance&&(this._instance=new t),this._instance}}]),t}())._instance=void 0;var s=function(){function t(t,e,i,n,o,r){this._row=void 0,this._col=void 0,this._nodeWidth=void 0,this._nodeHeight=void 0,this._halfNodeWidth=void 0,this._halfNodeHeight=void 0,this._row=t,this._col=e,this._nodeWidth=i,this._nodeHeight=n,this._halfNodeWidth=o,this._halfNodeHeight=r}var e=t.prototype;return e.getNodeByPixel=function(t,e){var i=this.getWorldPointByPixel(t,e),n=this.getPixelByWorldPoint(i.x,i.y),r=this.getDerectByPixel(t,e),s=new o;return s.cx=i.x,s.cy=i.y,s.px=n.x,s.py=n.y,s.dx=r.x,s.dy=r.y,s},e.getNodeByDerect=function(t,e){var i=this.getPixelByDerect(t,e),n=this.getWorldPointByPixel(i.x,i.y),r=new o;return r.cx=n.x,r.cy=n.y,r.px=i.x,r.py=i.y,r.dx=t,r.dy=e,r},e.getNodeByWorldPoint=function(t,e){var i=this.getPixelByWorldPoint(t,e);return this.getNodeByPixel(i.x,i.y)},e.getWorldPointByPixel=function(t,e){var i=Math.ceil(t/this._nodeWidth-.5+e/this._nodeHeight)-1,o=this._col-1-Math.ceil(t/this._nodeWidth-.5-e/this._nodeHeight);return new n(i,o)},e.getPixelByWorldPoint=function(t,e){var i=Math.floor((t+1-(e-(this._col-1)))*this._halfNodeWidth),o=Math.floor((t+1+(e-(this._col-1)))*this._halfNodeHeight);return new n(i,o)},e.getDerectByPixel=function(t,e){var i=this.getWorldPointByPixel(t,e),o=this.getPixelByWorldPoint(i.x,i.y),r=Math.floor(o.x/this._nodeWidth)-(o.x%this._nodeWidth==0?1:0),s=Math.floor(o.y/this._halfNodeHeight)-1;return new n(r,s)},e.getDerectByWorldPoint=function(t,e){var i=Math.floor((t-(e-(this._col-1)))/2),o=t+(e-(this._col-1));return new n(i,o)},e.getPixelByDerect=function(t,e){var i=Math.floor((t+e%2)*this._nodeWidth+(1-e%2)*this._halfNodeWidth),o=Math.floor((e+1)*this._halfNodeHeight);return new n(i,o)},t}(),a=function(){function t(t,e,i,n,o,r){this._row=void 0,this._col=void 0,this._nodeWidth=void 0,this._nodeHeight=void 0,this._halfNodeWidth=void 0,this._halfNodeHeight=void 0,this._row=t,this._col=e,this._nodeWidth=i,this._nodeHeight=n,this._halfNodeWidth=o,this._halfNodeHeight=r}var e=t.prototype;return e.getNodeByPixel=function(t,e){var i=this.getWorldPointByPixel(t,e),n=this.getPixelByWorldPoint(i.x,i.y),r=this.getDerectByPixel(t,e),s=new o;return s.cx=i.x,s.cy=i.y,s.px=n.x,s.py=n.y,s.dx=r.x,s.dy=r.y,s},e.getNodeByDerect=function(t,e){var i=this.getPixelByDerect(t,e),n=this.getWorldPointByPixel(i.x,i.y),r=new o;return r.cx=n.x,r.cy=n.y,r.px=i.x,r.py=i.y,r.dx=t,r.dy=e,r},e.getNodeByWorldPoint=function(t,e){var i=this.getPixelByWorldPoint(t,e);return this.getNodeByPixel(i.x,i.y)},e.getWorldPointByPixel=function(t,e){var i=Math.floor(t/this._nodeWidth),o=Math.floor(e/this._nodeHeight);return new n(i,o)},e.getPixelByWorldPoint=function(t,e){var i=Math.floor((t+1)*this._nodeWidth-this._halfNodeWidth),o=Math.floor((e+1)*this._nodeHeight-this._halfNodeHeight);return new n(i,o)},e.getDerectByPixel=function(t,e){var i=Math.floor(t/this._nodeWidth),o=Math.floor(e/this._nodeHeight);return new n(i,o)},e.getDerectByWorldPoint=function(t,e){return new n(t,e)},e.getPixelByDerect=function(t,e){var i=Math.floor((t+1)*this._nodeWidth-this._halfNodeWidth),o=Math.floor((e+1)*this._nodeHeight-this._halfNodeHeight);return new n(i,o)},t}(),l=function(){function t(t,e,i,n,o,r){this._row=void 0,this._col=void 0,this._nodeWidth=void 0,this._nodeHeight=void 0,this._halfNodeWidth=void 0,this._halfNodeHeight=void 0,this._nwDiv4=void 0,this._radius=void 0,this._proportion=1.732,this._row=t,this._col=e,this._nodeWidth=i,this._nodeHeight=n,this._halfNodeWidth=o,this._halfNodeHeight=r,this._nwDiv4=this._nodeWidth/4,this._radius=4*this._nwDiv4,this._proportion=2*this._nodeHeight/this._nodeWidth}var e=t.prototype;return e.getNodeByPixel=function(t,e){var i=this.getWorldPointByPixel(t,e),n=this.getPixelByWorldPoint(i.x,i.y),r=new o;return r.cx=i.x,r.cy=i.y,r.px=n.x,r.py=n.y,r.dx=i.x,r.dy=i.y,r},e.getNodeByDerect=function(t,e){var i=this.getPixelByDerect(t,e),n=new o;return n.cx=t,n.cy=e,n.px=i.x,n.py=i.y,n.dx=t,n.dy=e,n},e.getNodeByWorldPoint=function(t,e){var i=this.getPixelByWorldPoint(t,e);return this.getNodeByPixel(i.x,i.y)},e.getWorldPointByPixel=function(t,e){var i,o,r,s=Math.floor(t/this._nwDiv4),a=Math.floor(s/3);return(s-1)%6==0||(s-2)%6==0?(o=a,r=i=Math.floor(e/this._nodeHeight)):(s-4)%6==0||(s-5)%6==0?(o=a,r=i=e<this._nodeHeight/2?-1:Math.floor((e-this._nodeHeight/2)/this._nodeHeight)):a%2==0?(i=Math.floor(e/this._nodeHeight),this.testPointInHoneycomb(a,i,t,e)?(o=a,r=i):this.testPointInHoneycomb(a-1,i-1,t,e)?(o=a-1,r=i-1):(o=a-1,r=i)):(i=e<this._nodeHeight/2?-1:Math.floor((e-this._nodeHeight/2)/this._nodeHeight),this.testPointInHoneycomb(a,i,t,e)?(o=a,r=i):this.testPointInHoneycomb(a-1,i,t,e)?(o=a-1,r=i):(o=a-1,r=i+1)),new n(o,r)},e.testPointInHoneycomb=function(t,e,i,n){var o=2*this._nwDiv4,r=this.getPixelByWorldPoint(t,e);return o-Math.abs(i-r.x)>=Math.abs(n-r.y)/this._proportion},e.getPixelByWorldPoint=function(t,e){var i=Math.floor((2+3*t)/4*this._nodeWidth),o=Math.floor((e+.5*(1+t%2))*this._nodeHeight);return new n(i,o)},e.getDerectByPixel=function(t,e){return this.getWorldPointByPixel(t,e)},e.getDerectByWorldPoint=function(t,e){return new n(t,e)},e.getPixelByDerect=function(t,e){var i=(2+3*t)/4*this._nodeWidth,o=(e+.5*(1+t%2))*this._nodeHeight;return new n(i,o)},t}(),h=function(){function t(t,e,i,n,o,r){this.mapRoadHoneycomb=void 0,this.mapRoadHoneycomb=new l(t,e,i,n,o,r)}var e=t.prototype;return e.transposedNode=function(t){var e=t.cx,i=t.dx,n=t.px;return t.cx=t.cy,t.cy=e,t.dx=t.dy,t.dy=i,t.px=t.py,t.py=n,t},e.transposedPoint=function(t){var e=t.x;return t.x=t.y,t.y=e,t},e.getNodeByPixel=function(t,e){return this.transposedNode(this.mapRoadHoneycomb.getNodeByPixel(e,t))},e.getNodeByDerect=function(t,e){return this.transposedNode(this.mapRoadHoneycomb.getNodeByDerect(e,t))},e.getNodeByWorldPoint=function(t,e){return this.transposedNode(this.mapRoadHoneycomb.getNodeByWorldPoint(e,t))},e.getWorldPointByPixel=function(t,e){return this.transposedPoint(this.mapRoadHoneycomb.getWorldPointByPixel(e,t))},e.getPixelByWorldPoint=function(t,e){return this.transposedPoint(this.mapRoadHoneycomb.getPixelByWorldPoint(e,t))},e.getDerectByPixel=function(t,e){return this.transposedPoint(this.mapRoadHoneycomb.getDerectByPixel(e,t))},e.getDerectByWorldPoint=function(t,e){return this.transposedPoint(this.mapRoadHoneycomb.getDerectByWorldPoint(e,t))},e.getPixelByDerect=function(t,e){return this.transposedPoint(this.mapRoadHoneycomb.getPixelByDerect(e,t))},t}();i._RF.pop()}}})),System.register("chunks:///_virtual/MapType.ts",["cc"],(function(t){var e;return{setters:[function(t){e=t.cclegacy}],execute:function(){var i;t("MapType",void 0),e._RF.push({},"967a1oZod1CQYHXqS8EHBnp","MapType",void 0),function(t){t[t.angle45=0]="angle45",t[t.angle90=1]="angle90",t[t.honeycomb=2]="honeycomb",t[t.honeycomb2=3]="honeycomb2"}(i||(i=t("MapType",{}))),e._RF.pop()}}})),System.register("chunks:///_virtual/MiniMapView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./MapRoadUtils.ts","./FogOfWar.ts","./CameraController.ts","./SceneManager.ts","./GameWorld.ts"],(function(t){var e,i,n,o,r,s,a,l,h,c,u,d,p,f,g,y,m,v,_,b,P;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){r=t.cclegacy,s=t._decorator,a=t.Node,l=t.Sprite,h=t.Size,c=t.SpriteFrame,u=t.UITransform,d=t.view,p=t.Graphics,f=t.Vec3,g=t.Component},function(t){y=t.default},function(t){m=t.FogOfWar},function(t){v=t.default},function(t){_=t.default,b=t.SceneEventType},function(t){P=t.default}],execute:function(){var x,T,C,N,w,M,S,k,D,R,A;r._RF.push({},"95695BykxVFO6rw6g+nCzTD","MiniMapView",void 0);var I=s.ccclass,L=s.property;t("default",(x=I("MiniMapView"),T=L(a),C=L(l),N=L(l),w=L(a),x((k=e((S=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,n(e,"content",k,o(e)),n(e,"miniMap",D,o(e)),n(e,"fogMask",R,o(e)),n(e,"viewRect",A,o(e)),e._mapScale=1,e._rectSize=new h(0,0),e._isInit=!1,e}i(e,t);var r=e.prototype;return r.start=function(){this.miniMap.node.on(a.EventType.TOUCH_START,this.onClickMiniMap,this),_.instance.on(b.Map_INIT_COMPLETE,this.onMapInitComp,this)},r.onMapInitComp=function(t){this.init(t.bgTex)},r.init=function(t){this._isInit=!0;var e=new c;e.texture=t,this.miniMap.spriteFrame=e;var i=this.content.getComponent(u),n=this.miniMap.getComponent(u),o=d.getVisibleSize();t.width>t.height?(n.width=i.width-4,n.height=t.height*(n.width/t.width)):(n.height=i.height-4,n.width=t.width*(n.height/t.height));var r=this.miniMap.node.position;r.x=-n.width/2,r.y=-n.height/2,this.miniMap.node.position=r,this.viewRect.position=r,null!=m.instance&&(this.fogMask.node.position=r,this.fogMask.getComponent(u).setContentSize(new h(n.width,n.height)),this.fogMask.node.active=!0,this.fogMask.spriteFrame.texture=m.instance.maskTex);var s=y.instance.mapWidth;y.instance.mapHeight,this._mapScale=n.width/s,this._rectSize.width=o.width*this._mapScale,this._rectSize.height=o.height*this._mapScale,this.refreshViewRect(0,0)},r.refreshViewRect=function(t,e){var i=this.viewRect.getComponent(p);i||(i=this.viewRect.addComponent(p));var n=d.getVisibleSize(),o=y.instance.mapWidth,r=y.instance.mapHeight,s=e;(l=t)<0?l=0:l>o-n.width&&(l=o-n.width),s<0?s=0:s>r-n.height&&(s=r-n.height);var a,l=l*this._mapScale;s*=this._mapScale,i.clear(),i.rect(l,s,this._rectSize.width,this._rectSize.height),i.lineWidth=2.5,i.strokeColor.fromHEX("#ffffff"),i.stroke(),P.instance.gameMap.myPlayer&&(a=P.instance.gameMap.myPlayer.node.position,this.drawCircleFlag(i,a,"#ffff00aa",5));for(var h=P.instance.gameMap.npcList,c=h.length,u=0;u<c;u++)a=h[u].node.position,this.drawCircleFlag(i,a,"#00ff00aa",4);var f=P.instance.gameMap.monsterList;for(c=f.length,u=0;u<c;u++)a=f[u].node.position,this.drawCircleFlag(i,a,"#ff0000aa",3);var g=P.instance.gameMap.transferDoorList;for(c=g.length,u=0;u<c;u++)a=g[u].node.position,this.drawCircleFlag(i,a,"#0000ffaa",7)},r.drawCircleFlag=function(t,e,i,n){t.fillColor.fromHEX(i),t.circle(e.x*this._mapScale,e.y*this._mapScale,n),t.fill()},r.onClickMiniMap=function(t){var e=this.miniMap.getComponent(u).convertToNodeSpaceAR(new f(t.getUILocation().x,t.getUILocation().y));e.x=e.x/this._mapScale,e.y=e.y/this._mapScale,P.instance.gameMap.myPlayer.navTo(e.x,e.y)},r.update=function(t){if(this._isInit){var e=v.instance.getCameraPos();this.refreshViewRect(e.x,e.y),null!=m.instance&&(this.fogMask.node.active=m.instance.node.active)}},e}(g)).prototype,"content",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=e(S.prototype,"miniMap",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=e(S.prototype,"fogMask",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),A=e(S.prototype,"viewRect",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=S))||M)),r._RF.pop()}}})),System.register("chunks:///_virtual/Monster.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Actor2.ts","./GameWorld.ts"],(function(t){var e,i,n,o,r,s,a,l,h,c,u,d,p;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){r=t.cclegacy,s=t._decorator,a=t.CCInteger,l=t.Node,h=t.Vec3,c=t.resources,u=t.Texture2D},function(t){d=t.default},function(t){p=t.default}],execute:function(){var f,g,y,m,v;r._RF.push({},"9689aoZBnNBd45BX8DHD4qp","Monster",void 0);var _=s.ccclass,b=s.property;t("default",(f=_("Monster"),g=b(a),f((v=e((m=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,n(e,"monsterId",v,o(e)),e.editData=null,e}i(e,t);var r=e.prototype;return r.start=function(){t.prototype.start.call(this),this.node.on(l.EventType.TOUCH_START,this.onTouchStart,this)},r.init=function(){this.width=100,this.height=100,this.direction=this.defaultDir,this.loadRes()},r.initEditData=function(t){this.editData=t,this.objName=t.objName,this.monsterId=Number(t.objId),this.node.position=new h(t.x,t.y),this.defaultDir=t.direction,this.isPatrol=t.isPatrol},r.loadRes=function(){var t=this;if(0!=this.monsterId){var e="game/monster/"+this.monsterId+"/texture";c.load(e,u,(function(i,n){if(null!=i)return console.log("\n"),console.error("加载怪物资源失败 filePath：",e),console.error("错误原因",i),void console.log("\n");t.movieClip.init(n,5,8),t.width=t.movieClip.uiTransform.width,t.height=t.movieClip.uiTransform.height}))}},r.onTouchStart=function(t){p.instance.gameMap.myPlayer.trackTarget(this.node,(function(t){}))},e}(d)).prototype,"monsterId",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),y=m))||y)),r._RF.pop()}}})),System.register("chunks:///_virtual/MonsterManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Monster.ts"],(function(t){var e,i,n,o,r,s,a,l,h,c,u;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){r=t.cclegacy,s=t._decorator,a=t.Prefab,l=t.instantiate,h=t.Vec3,c=t.Component},function(t){u=t.default}],execute:function(){var d,p,f,g,y;r._RF.push({},"9e094IZHjVKlZIUHAK9I3nq","MonsterManager",void 0);var m=s.ccclass,v=s.property;t("default",(d=m("MonsterManager"),p=v(a),d((y=e((g=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,n(e,"monsterPrefab",y,o(e)),e}i(e,t);var r=e.prototype;return r.start=function(){},r.getMonster=function(){var t=l(this.monsterPrefab).getComponent(u);return t.node.active=!0,t.node.position=new h(0,0,0),t},e}(c)).prototype,"monsterPrefab",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),f=g))||f)),r._RF.pop()}}})),System.register("chunks:///_virtual/MouseCursorController.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,i,n,o,r,s,a,l,h,c,u,d,p;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){r=t.cclegacy,s=t._decorator,a=t.Enum,l=t.Node,h=t.Vec3,c=t.view,u=t.game,d=t.Vec2,p=t.Component}],execute:function(){var f,g,y,m,v,_,b,P,x;t("MouseCursorStyle",void 0),r._RF.push({},"772fcd/jyVOOI/deHGBAMyH","MouseCursorController",void 0);var T,C=s.ccclass,N=s.property;!function(t){t[t.normal=0]="normal",t[t.custom=1]="custom"}(T||(T=t("MouseCursorStyle",{}))),t("default",(f=C("MouseCursorController"),g=N({type:a(T),tooltip:"默认鼠标光标样式 "}),y=N(l),m=N(l),f((b=e((_=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,n(e,"defaultCursorStyle",b,o(e)),n(e,"touchPlane",P,o(e)),n(e,"mouseCursor",x,o(e)),e.mousePos=new h(0,0,0),e.currMousePos=new h(0,0,0),e.cursorStyle=T.custom,e}i(e,t);var r=e.prototype;return r.start=function(){var t=c.getVisibleSize();this.mousePos.x=-t.width,this.mousePos.y=-t.height,this.setCursorStyle(this.defaultCursorStyle),this.touchPlane.on(l.EventType.MOUSE_MOVE,this.onTouchMove,this)},r.setCursorStyle=function(t){this.cursorStyle=t,this.cursorStyle==T.custom?(u.canvas.style.cursor="None",this.mouseCursor.active=!0,this.mouseCursor.position=this.mousePos):(u.canvas.style.cursor="default",this.mouseCursor.active=!1)},r.onTouchMove=function(t){var e=c.getVisibleSize(),i=t.getUILocation().subtract(new d(e.width/2,e.height/2));this.mousePos.x=i.x,this.mousePos.y=i.y},r.update=function(t){this.mousePos=this.mouseCursor.position.lerp(this.mousePos,40*t),this.mouseCursor.position=this.mousePos},e}(p)).prototype,"defaultCursorStyle",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return T.custom}}),P=e(_.prototype,"touchPlane",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=e(_.prototype,"mouseCursor",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=_))||v)),r._RF.pop()}}})),System.register("chunks:///_virtual/MovieClip.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,i,n,o,r,s,a,l,h,c,u,d,p,f,g,y,m,v;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized,r=t.createClass},function(t){s=t.cclegacy,a=t._decorator,l=t.CCFloat,h=t.Texture2D,c=t.CCInteger,u=t.CCBoolean,d=t.Sprite,p=t.SpriteFrame,f=t.Rect,g=t.Vec2,y=t.Size,m=t.UITransform,v=t.Component}],execute:function(){var _,b,P,x,T,C,N,w,M,S,k,D,R,A,I,L,B,O,z,F,E,H,U,V,W;s._RF.push({},"cb924t7AD1JlaIj9BYSsdh8","MovieClip",void 0);var j=a.ccclass,G=a.property;t("default",(_=j("MovieClip"),b=G(l),P=G({type:h}),x=G({type:c}),T=G(c),C=G(c),N=G(c),w=G(u),M=G(u),S=G(u),k=G(c),D=G(c),_((I=e((A=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))||this).m_sprite=null,e.timer=.1,n(e,"interval",I,o(e)),n(e,"texture",L,o(e)),n(e,"playTimes",B,o(e)),n(e,"row",O,o(e)),n(e,"col",z,o(e)),n(e,"rowIndex",F,o(e)),n(e,"isAll",E,o(e)),n(e,"autoPlayOnLoad",H,o(e)),n(e,"autoDestroy",U,o(e)),n(e,"begin",V,o(e)),n(e,"end",W,o(e)),e.totalFrame=8,e.currentFrame=0,e.currentTimes=0,e.running=!0,e._playIndex=0,e._pieceWidth=0,e._pieceHeight=0,e._bitmapArr=[],e._isInit=!1,e._uiTransform=null,e}i(e,t);var s=e.prototype;return s.onLoad=function(){this.running=this.autoPlayOnLoad,this._isInit||this.init(this.texture,this.row,this.col,this.playTimes)},s.init=function(t,e,i,n){if(void 0===n&&(n=0),null!=t){this.reset(),this._isInit=!0,this.texture=t,this.row=e,this.col=i,this.playTimes=n,0==this.end&&(this.end=this.col),this.rowIndex=this.clamp(this.rowIndex,0,this.row-1),this._pieceWidth=this.texture.width/this.col,this._pieceHeight=this.texture.height/this.row,this.m_sprite||(this.m_sprite=this.getComponent(d),this.m_sprite||(this.m_sprite=this.addComponent(d))),this._bitmapArr.length=0;for(var o=0;o<this.row;o++){this._bitmapArr[o]=[];for(var r=0;r<this.col;r++){var s=new p;s.texture=this.texture,s.rect=new f(r*this._pieceWidth,o*this._pieceHeight,this._pieceWidth,this._pieceHeight),s.rotated=!1,s.offset=new g(0,0),s.originalSize=new y(this._pieceWidth,this._pieceHeight),this._bitmapArr[o][r]=s}}this.m_sprite.spriteFrame=this._bitmapArr[this.rowIndex][0],this.uiTransform.width=this._pieceWidth,this.uiTransform.height=this._pieceHeight,this.timer=0,this.playAction()}},s.reset=function(){this.timer=0,this.playIndex=0,this.currentTimes=0,this.currentFrame=0},s.update=function(t){null!=this.texture&&this.running&&(0==this.playTimes||this.currentTimes!=this.playTimes?(this.timer-=t,this.timer<=0&&(this.isAll&&(this.begin=0,this.end=this.col),this.timer=this.interval,this.currentFrame=this.currentFrame%this.col,this.playAction(),this.currentFrame++,this.currentFrame==this.col&&(this.isAll?(this.rowIndex++,this.rowIndex==this.row&&(this.currentTimes++,this.node.emit("completeTimes"),0!=this.playTimes&&this.currentTimes==this.playTimes&&(this.node.emit("complete"),this.autoDestroy&&this.node.destroy())),this.rowIndex%=this.row):(this.currentTimes++,this.node.emit("completeTimes"),0!=this.playTimes&&this.currentTimes==this.playTimes&&(this.node.emit("complete"),this.autoDestroy&&this.node.destroy()))))):this.running=!1)},s.playAction=function(){this.end!=this.begin&&(this.rowIndex=this.clamp(this.rowIndex,0,this.row-1),this._playIndex=this._playIndex%(this.end-this.begin)+this.begin,this.m_sprite.spriteFrame=this._bitmapArr[this.rowIndex][this._playIndex],this._playIndex++)},s.play=function(){this.running=!0,this.playAction()},s.stop=function(){this.running=!1},s.gotoAndPlay=function(t){this.running=!0,this._playIndex=t,this._playIndex=this.clamp(this._playIndex,0,this.col-1)},s.gotoAndStop=function(t){this.running=!1,this._playIndex=t,this._playIndex=this.clamp(this._playIndex,0,this.col-1),this.m_sprite.spriteFrame=this._bitmapArr[this.rowIndex][this._playIndex]},s.clamp=function(t,e,i){return t<e?e:t>i?i:t},r(e,[{key:"playIndex",get:function(){return this._playIndex},set:function(t){this._playIndex=t}},{key:"uiTransform",get:function(){return this._uiTransform||(this._uiTransform=this.node.getComponent(m)),this._uiTransform}}]),e}(v)).prototype,"interval",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),L=e(A.prototype,"texture",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=e(A.prototype,"playTimes",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),O=e(A.prototype,"row",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 4}}),z=e(A.prototype,"col",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 4}}),F=e(A.prototype,"rowIndex",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),E=e(A.prototype,"isAll",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),H=e(A.prototype,"autoPlayOnLoad",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),U=e(A.prototype,"autoDestroy",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),V=e(A.prototype,"begin",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),W=e(A.prototype,"end",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),R=A))||R)),s._RF.pop()}}})),System.register("chunks:///_virtual/NavAgent.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ControlMode.ts","./PathFindingAgent.ts","./NavJoystick.ts","./NavPath.ts","./NavRVO.ts","./NavUnit.ts"],(function(t){var e,i,n,o,r,s,a,l,h,c,u,d,p,f,g,y;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized,r=t.createClass},function(t){s=t.cclegacy,a=t._decorator,l=t.Enum,h=t.Vec3,c=t.Component},function(t){u=t.ControlMode},function(t){d=t.default},function(t){p=t.default},function(t){f=t.default},function(t){g=t.default},function(t){y=t.default}],execute:function(){var m,v,_,b,P;s._RF.push({},"1ed0bz2hFFN/oJlNEnAPikg","NavAgent",void 0);var x=a.ccclass,T=a.property;t("default",(m=x("NavAgent"),v=T({type:l(u),tooltip:"控制模式:\ntouch  点击行走 \njoystick 摇杆操作 "}),m((P=e((b=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))||this)._navUnit=null,n(e,"ctrMode",P,o(e)),e._joystick=null,e._navPath=null,e._navRVO=null,e._direction=0,e._moveSpeed=100,e._moveDir=new h(0,0,0),e._radius=25,e.isInit=!1,e}i(e,t);var s=e.prototype;return s.onLoad=function(){this.init()},s.start=function(){},s.init=function(){this.isInit||(this.isInit=!0,null==this._navUnit&&(this._navUnit=this.node.getComponent(y)),this.joystick.init(),this.navPath.init(),this.navRVO.init())},s.setPosition=function(t){null!=this.navUnit?this.navUnit.node.position=t:this.node.position=t},s.setPos=function(t,e,i){void 0===i&&(i=0),null!=this.navUnit?this.navUnit.node.position=new h(t,e,i):this.node.position=new h(t,e,i)},s.getPos=function(){return null!=this.navUnit?this.navUnit.node.position:this.node.position},s.setX=function(t){var e;null!=this.navUnit?((e=this.navUnit.node.position).x=t,this.navUnit.node.position=e):((e=this.node.position).x=t,this.node.position=e)},s.getX=function(){return null!=this.navUnit?this.navUnit.node.position.x:this.node.position.x},s.setY=function(t){var e;null!=this.navUnit?((e=this.navUnit.node.position).y=t,this.navUnit.node.position=e):((e=this.node.position).y=t,this.node.position=e)},s.getY=function(){return null!=this.navUnit?this.navUnit.node.position.y:this.node.position.y},s.setZ=function(t){var e;null!=this.navUnit?((e=this.navUnit.node.position).z=t,this.navUnit.node.position=e):((e=this.node.position).z=t,this.node.position=e)},s.getZ=function(){return null!=this.navUnit?this.navUnit.node.position.z:this.node.position.z},s.navTo=function(t,e){this.navPath.navTo(t,e)},s.setMoveDir=function(t,e,i){void 0===i&&(i=0),this.moveDir.x=t,this.moveDir.y=e,this.moveDir.z=i},s.onMove=function(){if(null!=this.navUnit)return this.navUnit.onMove()},s.onStop=function(){if(null!=this.navUnit)return this.navUnit.onStop()},s.setFaceDir=function(t){if(null!=this.navUnit)return this.navUnit.setFaceDir(t)},s.walkCompleteOneRoadNode=function(t){if(null!=this.navUnit)return this.navUnit.walkCompleteOneRoadNode(t)},s.walkCompleteThePath=function(t){if(null!=this.navUnit)return this.navUnit.walkCompleteThePath(t)},r(e,[{key:"navUnit",get:function(){return this._navUnit}},{key:"controlMode",get:function(){return null!=this.navUnit?this.navUnit.controlMode:this.ctrMode},set:function(t){null!=this.navUnit&&(this.navUnit.controlMode=t),this.ctrMode=t}},{key:"joystick",get:function(){return null==this._joystick&&(this._joystick=this.node.getComponent(p),null==this._joystick&&(this._joystick=this.node.addComponent(p))),this._joystick}},{key:"navPath",get:function(){return null==this._navPath&&(this._navPath=this.node.getComponent(f),null==this._navPath&&(this._navPath=this.node.addComponent(f))),this._navPath}},{key:"navRVO",get:function(){return null==this._navRVO&&(this._navRVO=this.node.getComponent(g),null==this._navRVO&&(this._navRVO=this.node.addComponent(g))),this._navRVO}},{key:"roadNode",get:function(){return d.instance.getRoadNodeByPixel(this.getX(),this.getY())}},{key:"direction",get:function(){return null!=this.navUnit?this.navUnit.direction:this._direction},set:function(t){null!=this.navUnit&&(this.navUnit.direction=t),this._direction=t}},{key:"moveSpeed",get:function(){return null!=this.navUnit?this.navUnit.moveSpeed:this._moveSpeed},set:function(t){null!=this.navUnit&&(this.navUnit.moveSpeed=t),this._moveSpeed=t}},{key:"moveDir",get:function(){return null!=this.navUnit?this.navUnit.moveDir:this._moveDir},set:function(t){null!=this.navUnit&&(this.navUnit.moveDir=t),this._moveDir=t}},{key:"radius",get:function(){return null!=this.navUnit?this.navUnit.radius:this._radius},set:function(t){null!=this.navUnit&&(this.navUnit.radius=t),this._radius=t}}]),e}(c)).prototype,"ctrMode",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return u.touch}}),_=b))||_)),s._RF.pop()}}})),System.register("chunks:///_virtual/NavJoystick.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ControlMode.ts","./PathFindingAgent.ts","./RVOSystem.ts","./NavAgent.ts"],(function(t){var e,i,n,o,r,s,a,l,h,c;return{setters:[function(t){e=t.inheritsLoose,i=t.createClass},function(t){n=t.cclegacy,o=t._decorator,r=t.Vec3,s=t.Component},function(t){a=t.ControlMode},function(t){l=t.default},function(t){h=t.default},function(t){c=t.default}],execute:function(){var u;n._RF.push({},"1aa63ho/ppFtqe2/wx0vckg","NavJoystick",void 0);var d=o.ccclass;o.property,t("default",d("NavJoystick")(u=function(t){function n(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this)._navAgent=null,e.targetPos=new r(0,0,0),e}e(n,t);var o=n.prototype;return o.start=function(){},o.init=function(){},o.update=function(t){null!=this.navAgent&&this.navAgent.controlMode==a.joystick&&(h.instance.runing&&this.navAgent.navRVO.isUse&&!this.navAgent.navRVO.isObstacle?this.onJoyStickControll_RVO(t):this.onJoyStickControll_Normal(t))},o.onJoyStickControll_Normal=function(t){if(0!=this.navAgent.moveDir.x||0!=this.navAgent.moveDir.y){this.navAgent.setFaceDir(this.navAgent.moveDir);var e=this.navAgent.moveSpeed*t,i=this.navAgent.getPos().clone().add(this.navAgent.moveDir.clone().multiplyScalar(e)),n=l.instance.getRoadNodeByPixel(i.x,i.y);if(n)if(1!=n.value)this.targetPos=i;else{for(var o=l.instance.getRoundRoadNodes(this.navAgent.roadNode),s=null,a=0;a<o.length;a++)if(o[a]&&1!=o[a].value&&o[a]!=n)if(o[a].h=10*(Math.abs(n.cx-o[a].cx)+Math.abs(n.cy-o[a].cy)),s){if(o[a].h<s.h)s=o[a];else if(o[a].h==s.h){var h=new r(o[a].px,o[a].py).subtract(this.navAgent.getPos()).normalize(),c=new r(s.px,s.py).subtract(this.navAgent.getPos()).normalize();h.add(this.navAgent.moveDir).length()>c.add(this.navAgent.moveDir).length()&&(s=o[a])}}else s=o[a];s&&(h=new r(n.px,n.py).subtract(this.navAgent.getPos()).normalize(),c=new r(s.px,s.py).subtract(this.navAgent.getPos()).normalize(),h.add(this.navAgent.moveDir).length()/2>c.add(this.navAgent.moveDir).length()?this.targetPos=this.navAgent.getPos():this.targetPos=new r(s.px,s.py))}else this.targetPos=this.navAgent.getPos();var u=this.targetPos.clone().subtract(this.navAgent.getPos()),d=u.length();u=u.normalize(),d>=e&&(this.targetPos=this.navAgent.getPos().clone().add(u.multiplyScalar(e))),this.navAgent.setPosition(this.targetPos),this.navAgent.onMove()}else this.navAgent.onStop()},o.onJoyStickControll_RVO=function(t){0!=this.navAgent.moveDir.x||0!=this.navAgent.moveDir.y?(this.navAgent.setFaceDir(this.navAgent.moveDir),this.targetPos=this.navAgent.getPos().clone().add(this.navAgent.moveDir.clone().multiplyScalar(this.navAgent.moveSpeed)),this.navAgent.onMove()):(this.targetPos=this.navAgent.getPos(),this.navAgent.onStop()),this.navAgent.navRVO.moveSpeed=this.navAgent.moveSpeed,this.navAgent.navRVO.targetPos.x=this.targetPos.x,this.navAgent.navRVO.targetPos.y=this.targetPos.y},i(n,[{key:"navAgent",get:function(){return this._navAgent||(this._navAgent=this.node.getComponent(c)),this._navAgent}}]),n}(s))||u),n._RF.pop()}}})),System.register("chunks:///_virtual/NavPath.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ControlMode.ts","./PathFindingAgent.ts","./RVOSystem.ts","./NavAgent.ts"],(function(t){var e,i,n,o,r,s,a,l,h;return{setters:[function(t){e=t.inheritsLoose,i=t.createClass},function(t){n=t.cclegacy,o=t._decorator,r=t.Component},function(t){s=t.ControlMode},function(t){a=t.default},function(t){l=t.default},function(t){h=t.default}],execute:function(){var c;n._RF.push({},"2d3d61QDtBIIIM2ZvwWiNnJ","NavPath",void 0);var u=o.ccclass;o.property,t("default",u("NavPath")(c=function(t){function n(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).naving=!1,e._moveAngle=0,e._roadNodeArr=[],e._nodeIndex=0,e._navAgent=null,e}e(n,t);var o=n.prototype;return o.start=function(){},o.init=function(){},o.update=function(t){if(null!=this.navAgent&&this.navAgent.controlMode==s.touch&&this.naving){if(l.instance.runing&&this.navAgent.navRVO.isUse&&this.navAgent.navRVO.isObstacle)return void this.stop();if(0==this.navAgent.moveSpeed)return void this.stop();var e=this._roadNodeArr[this._nodeIndex],i=e.px-this.navAgent.getX(),n=e.py-this.navAgent.getY(),o=this.navAgent.moveSpeed*t;if(i*i+n*n>o*o){if(0==this._moveAngle){this._moveAngle=Math.atan2(n,i);var r=Math.round((-this._moveAngle+Math.PI)/(Math.PI/4));this.navAgent.direction=r>5?r-6:r+2}var a=Math.cos(this._moveAngle)*o,h=Math.sin(this._moveAngle)*o;l.instance.runing&&this.navAgent.navRVO.isUse?(this.navAgent.navRVO.moveSpeed=this.navAgent.moveSpeed,this.navAgent.navRVO.targetPos.x=e.px,this.navAgent.navRVO.targetPos.y=e.py):(this.navAgent.setX(this.navAgent.getX()+a),this.navAgent.setY(this.navAgent.getY()+h))}else this.navAgent.walkCompleteOneRoadNode(e),this._moveAngle=0,this._nodeIndex==this._roadNodeArr.length-1?(this.navAgent.setPos(e.px,e.py),this.stop(),this.navAgent.walkCompleteThePath(e)):this.walk()}},o.navTo=function(t,e){if(null!=this.navAgent){var i=a.instance.seekPath2(this.navAgent.getX(),this.navAgent.getY(),t,e,this.navAgent.radius);i.length>0&&this.walkByRoad(i)}},o.walkByRoad=function(t){this._roadNodeArr=t,this._nodeIndex=0,this._moveAngle=0,this.walk(),this.move()},o.walk=function(){this._nodeIndex<this._roadNodeArr.length-1&&this._nodeIndex++},o.move=function(){0!=this._roadNodeArr.length?(this.naving=!0,this._moveAngle=0,null!=this.navAgent&&this.navAgent.onMove()):this.stop()},o.stop=function(){this.naving=!1,null!=this.navAgent&&(this.navAgent.navRVO.stop(),this.navAgent.onStop())},i(n,[{key:"navAgent",get:function(){return this._navAgent||(this._navAgent=this.node.getComponent(h)),this._navAgent}}]),n}(r))||c),n._RF.pop()}}})),System.register("chunks:///_virtual/NavRVO.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Common.ts","./Simulator.ts","./RVOSystem.ts","./NavAgent.ts"],(function(t){var e,i,n,o,r,s,a,l,h,c;return{setters:[function(t){e=t.inheritsLoose,i=t.createClass},function(t){n=t.cclegacy,o=t._decorator,r=t.Component},function(t){s=t.Vector2,a=t.RVOMath},function(t){l=t.Simulator},function(t){h=t.default},function(t){c=t.default}],execute:function(){var u;n._RF.push({},"7d4c69vFjxA972tNH0LOj72","NavRVO",void 0);var d=o.ccclass;o.property,t("default",d("NavRVO")(u=function(t){function n(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this)._navAgent=null,e.rvoTag=0,e.rvoAgentId=-1,e.targetPos=new s(0,0),e.moveSpeed=200,e.isUse=!1,e._isObstacle=!1,e.isDestroy=!1,e}e(n,t);var o=n.prototype;return o.start=function(){},o.init=function(){},o.initRVO=function(){-1!=this.rvoAgentId&&l.instance.removeAgent(this.rvoAgentId),this.rvoTag=h.instance.rvoTag,l.instance.setAgentDefaults(80,10,100,.01,this.navAgent.radius,this.navAgent.moveSpeed,new s(0,0));var t=new s(this.node.position.x,this.node.position.y),e=l.instance.addAgent(t);this.rvoAgentId=e,this.targetPos=t,this.isUse=!0,this.isObstacle=this.isObstacle},o.removeRVO=function(){-1!=this.rvoAgentId&&l.instance.removeAgent(this.rvoAgentId),this.rvoAgentId=-1,this.targetPos=new s(0,0),this.isUse=!1},o.update=function(t){if(l.instance.hasAgent(this.rvoAgentId)){null!=this.targetPos&&this.setPreferredVelocities(t);var e=l.instance.getAgentPosition(this.rvoAgentId);this.navAgent.setX(e.x),this.navAgent.setY(e.y)}},o.setPreferredVelocities=function(t){if(!this.isObstacle){var e=this.targetPos.minus(l.instance.getAgentPosition(this.rvoAgentId)),i=a.absSq(e),n=this.navAgent.moveSpeed*t,o=this.moveSpeed;i<n*n&&(o=this.lerp(0,Math.sqrt(i),.5)),a.absSq(e)>1&&(e=a.normalize(e).scale(o)),l.instance.setAgentPrefVelocity(this.rvoAgentId,e);var r=2*Math.random()*Math.PI,h=1*Math.random();l.instance.setAgentPrefVelocity(this.rvoAgentId,l.instance.getAgentPrefVelocity(this.rvoAgentId).plus(new s(Math.cos(r),Math.sin(r)).scale(h)))}},o.lerp=function(t,e,i){return i>1?i=1:i<0&&(i=0),t*(1-i)+e*i},o.stop=function(){null!=this.targetPos&&(this.targetPos.x=this.navAgent.getX(),this.targetPos.y=this.navAgent.getY())},o.isReachedTargetPos=function(){return!(a.absSq(l.instance.getAgentPosition(this.rvoAgentId).minus(this.targetPos))>l.instance.getAgentRadius(this.rvoAgentId)*l.instance.getAgentRadius(this.rvoAgentId))},o.destroySelf=function(){this.isDestroy=!0,this.rvoTag==h.instance.rvoTag&&l.instance.removeAgent(this.rvoAgentId)},o.onDestroy=function(){this.isDestroy||(this.isDestroy=!0,this.rvoTag==h.instance.rvoTag&&l.instance.removeAgent(this.rvoAgentId))},i(n,[{key:"navAgent",get:function(){return this._navAgent||(this._navAgent=this.node.getComponent(c)),this._navAgent}},{key:"isObstacle",get:function(){return this._isObstacle},set:function(t){this._isObstacle=t,-1!=this.rvoAgentId&&(this._isObstacle?l.instance.setAgentMass(this.rvoAgentId,10):l.instance.setAgentMass(this.rvoAgentId,1))}}]),n}(r))||u),n._RF.pop()}}})),System.register("chunks:///_virtual/NavUnit.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ControlMode.ts","./MapRoadUtils.ts","./PathFindingAgent.ts","./NavAgent.ts","./Unit.ts"],(function(t){var e,i,n,o,r,s,a,l,h,c,u,d,p,f,g;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized,r=t.createClass},function(t){s=t.cclegacy,a=t._decorator,l=t.Vec3,h=t.Enum},function(t){c=t.ControlMode},function(t){u=t.default},function(t){d=t.default},function(t){p=t.default},function(t){f=t.UnitState,g=t.default}],execute:function(){var y,m,v,_,b;s._RF.push({},"c8c9aADnAtFnKIKwoeBQYmx","NavUnit",void 0);var P=a.ccclass,x=a.property,T=t("TrackLogic",function(){function t(){this.navUnit=null,this.target=void 0,this.arriveTargetCallback=void 0,this.stopTrackCallback=void 0,this.lockedArrive=!1,this.lastTrackPos=new l(0,0,0),this.notTrackDist=3,this.notSeakDist=3}var e=t.prototype;return e.trackTarget=function(t,e,i,n,o,r){void 0===i&&(i=null),void 0===n&&(n=null),void 0===o&&(o=3),void 0===r&&(r=3),null!=t&&null!=e&&(this.target!=e&&(this.lastTrackPos=new l(0,0,0)),this.navUnit=t,this.target=e,this.arriveTargetCallback=i,this.stopTrackCallback=n,this.notTrackDist=o,this.notSeakDist=r,this.lockedArrive=!1)},e.stopTrack=function(){this.arriveTargetCallback=null,null!=this.stopTrackCallback&&(this.stopTrackCallback(this.target),this.stopTrackCallback=null),this.target=null},e.isNeedTrack=function(){var t=u.instance.getWorldPointByPixel(this.navUnit.node.position.x,this.navUnit.node.position.y),e=u.instance.getWorldPointByPixel(this.target.position.x,this.target.position.y);return!(Math.abs(t.x-e.x)+Math.abs(t.y-e.y)<this.notTrackDist)},e.isNeedSeekRoad=function(){if(null==this.target)return!1;var t=u.instance.getWorldPointByPixel(this.target.position.x,this.target.position.y),e=u.instance.getWorldPointByPixel(this.lastTrackPos.x,this.lastTrackPos.y);return!(Math.abs(t.x-e.x)+Math.abs(t.y-e.y)<this.notSeakDist)},e.trackTo=function(t,e){null!=this.navUnit&&(this.lastTrackPos.x=t,this.lastTrackPos.y=e,this.navUnit.navAgent.navTo(t,e))},e.update=function(t){if(null!=this.navUnit&&null!=this.target){if(!this.isNeedTrack())return this.navUnit.navAgent.navPath.stop(),this.navUnit.lookAtTarget(this.target),void(this.lockedArrive||(this.lockedArrive=!0,null!=this.arriveTargetCallback&&this.arriveTargetCallback(this.target)));this.lockedArrive=!1,this.navUnit.navAgent.navPath.naving?this.isNeedSeekRoad()&&this.trackTo(this.target.position.x,this.target.position.y):this.trackTo(this.target.position.x,this.target.position.y)}},t}());t("default",(y=P("NavUnit"),m=x({type:h(c),tooltip:"控制模式:\ntouch  点击行走 \njoystick 摇杆操作 "}),y((b=e((_=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,n(e,"ctrMode",b,o(e)),e._navAgent=null,e.trackLogic=new T,e.moveDir=new l(0,0,0),e.radius=10,e.walkRoadNodeCallback=null,e.walkCompletePathCallback=null,e}i(e,t);var s=e.prototype;return s.onLoad=function(){t.prototype.onLoad.call(this),this.navAgent.init()},s.start=function(){t.prototype.start.call(this)},s.update=function(e){t.prototype.update.call(this,e),this.trackLogic.update(e)},s.initRVO=function(){this.setDefaultRadius(),this.navAgent.navRVO.initRVO()},s.setDefaultRadius=function(){if(d.instance.mapData){var t=Math.min(u.instance.halfNodeWidth,u.instance.halfNodeHeight);this.radius=Math.floor(.8*t)}},s.navTo=function(t,e){null!=this.trackLogic.target&&this.trackLogic.stopTrack(),this.navAgent.navTo(t,e)},s.trackTarget=function(t,e,i,n,o){void 0===e&&(e=null),void 0===i&&(i=null),void 0===n&&(n=3),void 0===o&&(o=3),null!=this.trackLogic.target&&this.trackLogic.target!=t&&this.trackLogic.stopTrack(),this.trackLogic.trackTarget(this,t,e,i,n,o)},s.stopTrack=function(){this.trackLogic.stopTrack()},s.onMove=function(){this.state=f.walk},s.onStop=function(){this.state=f.idle},s.walkCompleteOneRoadNode=function(t){null!=this.walkRoadNodeCallback&&this.walkRoadNodeCallback()},s.walkCompleteThePath=function(t){null!=this.walkCompletePathCallback&&this.walkCompletePathCallback()},s.destroySelf=function(){this.navAgent.navRVO.destroySelf(),t.prototype.destroySelf.call(this)},r(e,[{key:"controlMode",get:function(){return this.ctrMode},set:function(t){this.ctrMode=t}},{key:"navAgent",get:function(){return null==this._navAgent&&(this._navAgent=this.node.getComponent(p),null==this._navAgent&&(this._navAgent=this.node.addComponent(p))),this._navAgent}}]),e}(g)).prototype,"ctrMode",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return c.touch}}),v=_))||v)),s._RF.pop()}}})),System.register("chunks:///_virtual/NPC.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Actor2.ts","./UIManager.ts","./DataConfig.ts","./NPCTalkBoard.ts","./GameWorld.ts"],(function(t){var e,i,n,o,r,s,a,l,h,c,u,d,p,f,g,y,m;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized,r=t.createClass},function(t){s=t.cclegacy,a=t._decorator,l=t.CCInteger,h=t.Node,c=t.Vec3,u=t.resources,d=t.Texture2D},function(t){p=t.default},function(t){f=t.default},function(t){g=t.DataConfig},function(t){y=t.NPCTalkBoard},function(t){m=t.default}],execute:function(){var v,_,b,P,x,T,C;s._RF.push({},"d21e4Sn7TpPb6hQIKrDjDRB","NPC",void 0);var N=a.ccclass,w=a.property;t("default",(v=N("NPC"),_=w(l),b=w(h),v((T=e((x=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,n(e,"npcId",T,o(e)),n(e,"skin",C,o(e)),e._talkBoard=null,e.editData=null,e}i(e,t);var s=e.prototype;return s.start=function(){t.prototype.start.call(this),this.skin.on(h.EventType.TOUCH_START,this.onTouchStart,this)},s.init=function(){this.width=100,this.height=100,this.direction=this.defaultDir,this.isPatrol||(this.navAgent.navRVO.isObstacle=!0),this.loadRes()},s.initEditData=function(t){this.editData=t,this.objName=t.objName,this.npcId=Number(t.objId),this.node.position=new c(t.x,t.y),this.defaultDir=t.direction,this.isPatrol=t.isPatrol},s.loadRes=function(){var t=this;if(0!=this.npcId){var e="game/npc/"+this.npcId+"/texture";u.load(e,d,(function(i,n){if(null!=i)return console.log("\n"),console.error("加载NPC资源失败 filePath：",e),console.error("错误原因",i),void console.log("\n");t.movieClip.init(n,5,12),t.width=t.movieClip.uiTransform.width,t.height=t.movieClip.uiTransform.height}))}},s.onTouchStart=function(t){var e=this;m.instance.gameMap.myPlayer.trackTarget(this.node,(function(t){e.isStopPatrol=!0,e.navAgent.navPath.stop(),e.lookAtTarget(m.instance.gameMap.myPlayer.node),e.say(g.getNpcTalkData(e.editData.dialogueId),(function(){1==e.editData.funcId&&f.instance.equipShopView.open()}))}),(function(){e.isStopPatrol=!1,e.navAgent.navPath.move()}))},s.say=function(t,e){void 0===e&&(e=null),null!=this.talkBoard&&this.talkBoard.showTalkContent(t,e)},s.stopSay=function(){this.talkBoard.close()},r(e,[{key:"talkBoard",get:function(){return this._talkBoard||(this._talkBoard=this.node.getComponentInChildren(y)),this._talkBoard}}]),e}(p)).prototype,"npcId",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),C=e(x.prototype,"skin",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=x))||P)),s._RF.pop()}}})),System.register("chunks:///_virtual/NpcManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./NPC.ts"],(function(t){var e,i,n,o,r,s,a,l,h,c,u;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){r=t.cclegacy,s=t._decorator,a=t.Prefab,l=t.instantiate,h=t.Vec3,c=t.Component},function(t){u=t.default}],execute:function(){var d,p,f,g,y;r._RF.push({},"846b4EYS5xKg7zPEfdwdoQJ","NpcManager",void 0);var m=s.ccclass,v=s.property;t("default",(d=m("NpcManager"),p=v(a),d((y=e((g=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,n(e,"npcPrefab",y,o(e)),e}i(e,t);var r=e.prototype;return r.start=function(){},r.getNPC=function(){var t=l(this.npcPrefab).getComponent(u);return t.node.active=!0,t.node.position=new h(0,0,0),t},e}(c)).prototype,"npcPrefab",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),f=g))||f)),r._RF.pop()}}})),System.register("chunks:///_virtual/NPCTalkBoard.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,i,n,o,r,s,a,l,h;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){r=t.cclegacy,s=t._decorator,a=t.Node,l=t.Label,h=t.Component}],execute:function(){var c,u,d,p,f,g,y;r._RF.push({},"e37486U2MlKTpObuoBppaL8","NPCTalkBoard",void 0);var m=s.ccclass,v=s.property;t("NPCTalkBoard",(c=m("NPCTalkBoard"),u=v(a),d=v(l),c((g=e((f=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,n(e,"board",g,o(e)),n(e,"talkContentTxt",y,o(e)),e.talkCompCallback=null,e.talkMsg="",e.talkIndex=0,e.talkTime=0,e}i(e,t);var r=e.prototype;return r.start=function(){},r.update=function(t){var e=this;if(this.talkIndex!=this.talkMsg.length&&(this.talkTime-=t,this.talkTime<=0&&(this.talkTime=.065,this.talkIndex<this.talkMsg.length))){var i=this.talkMsg.substring(0,this.talkIndex+1);this.talkContentTxt.string=i,this.talkIndex++,this.talkIndex==this.talkMsg.length&&this.scheduleOnce((function(){null!=e.talkCompCallback&&(e.talkCompCallback(),e.talkCompCallback=null),e.close()}),1.5)}},r.showTalkContent=function(t,e){void 0===e&&(e=null),this.talkCompCallback=e,this.talkContentTxt.string="",this.talkMsg=t,this.talkIndex=1,this.talkTime=.25,this.unscheduleAllCallbacks(),this.open()},r.open=function(){this.node.active=!0},r.close=function(){this.node.active=!1},e}(h)).prototype,"board",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=e(f.prototype,"talkContentTxt",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),p=f))||p)),r._RF.pop()}}})),System.register("chunks:///_virtual/ObstacleEdgeUtils.ts",["./rollupPluginModLoBabelHelpers.js","cc","./MapType.ts","./MapRoadUtils.ts","./PathFindingAgent.ts"],(function(t){var e,i,n,o,r;return{setters:[function(t){e=t.createClass},function(t){i=t.cclegacy},function(t){n=t.MapType},function(t){o=t.default},function(t){r=t.default}],execute:function(){i._RF.push({},"5b2fbo8M9VKx5RhQXncu8vy","ObstacleEdgeUtils",void 0),t("default",function(){function t(){}var i=t.prototype;return i.showObstacleEdge=function(e){var i=t.instance.getEdge();t.instance.optimizeEdge(i);var r=t.instance.getObstacleEdge();e.clear(),e.lineWidth=2.4,e.strokeColor.fromHEX("#ffff00"),e.fillColor.fromHEX("#ff0000");var s=o.instance.nodeWidth/2,a=o.instance.nodeHeight/2,l=o.instance.mapType;for(var h in i)if(null!=i[h]){var c=o.instance.getNodeByWorldPoint(i[h].x+.5,i[h].y+.5);l==n.angle45?(e.circle(c.px,c.py-a,5),e.fill()):l==n.angle90&&(e.circle(c.px-s,c.py-a,5),e.fill())}for(var u=r.length,d=0;d<u;d++)e.moveTo(r[d].startX,r[d].startY),e.lineTo(r[d].endX,r[d].endY),e.stroke()},i.getObstacleEdge=function(){var t=this.getEdge();return this.optimizeEdge(t),this.getEdgeLine(t)},i.optimizeEdge=function(t){var e=[];for(var i in t){var n=t[i],o=null!=n.left&&null!=n.right,r=null!=n.up&&null!=n.down;o&&!r&&(n.left.right=n.right,n.right.left=n.left,n.left=null,n.right=null,e.push(i)),!o&&r&&(n.up.down=n.down,n.down.up=n.up,n.up=null,n.down=null,e.push(i))}for(var s=e.length,a=0;a<s;a++)t[i=e[a]]=null,delete t[i]},i.getEdgeLine=function(t){var e=o.instance.nodeWidth/2,i=o.instance.nodeHeight/2,r=o.instance.mapType,a=null,l=null,h=null,c=0,u=0,d=0,p=0,f=[];for(var g in t){var y;a=t[g],l=o.instance.getNodeByWorldPoint(a.x+.5,a.y+.5),r==n.angle45?c=l.px:r==n.angle90&&(c=l.px-e),u=l.py-i,null==a.left||a.connectLeft||(h=o.instance.getNodeByWorldPoint(a.left.x+.5,a.left.y+.5),r==n.angle45?d=h.px:r==n.angle90&&(d=h.px-e),p=h.py-i,(y=new s).moveTo(c,u),y.lineTo(d,p),f.push(y),a.connectLeft=!0,a.left.connectRight=!0),null==a.up||a.connectUp||(h=o.instance.getNodeByWorldPoint(a.up.x+.5,a.up.y+.5),r==n.angle45?d=h.px:r==n.angle90&&(d=h.px-e),p=h.py-i,(y=new s).moveTo(c,u),y.lineTo(d,p),f.push(y),a.connectUp=!0,a.up.connectDown=!0),null==a.right||a.connectRight||(h=o.instance.getNodeByWorldPoint(a.right.x+.5,a.right.y+.5),r==n.angle45?d=h.px:r==n.angle90&&(d=h.px-e),p=h.py-i,(y=new s).moveTo(c,u),y.lineTo(d,p),f.push(y),a.connectRight=!0,a.right.connectLeft=!0),null==a.down||a.connectDown||(h=o.instance.getNodeByWorldPoint(a.down.x+.5,a.down.y+.5),r==n.angle45?d=h.px:r==n.angle90&&(d=h.px-e),p=h.py-i,(y=new s).moveTo(c,u),y.lineTo(d,p),f.push(y),a.connectDown=!0,a.down.connectUp=!0)}return f},i.getEdge=function(){var t=o.instance.mapType;return t==n.angle45?this.getEdge45Angle():t==n.angle90?this.getEdge90Angle():{}},i.getEdge45Angle=function(){for(var t=o.instance.row,e=o.instance.col,i=0,n=0,s={},l=0;l<=t;l++)for(var h=0;h<=e;h++){var c,u=o.instance.getNodeByDerect(h,l);if(i=u.cx,n=u.cy,0==u.dx&&u.dy%2==0&&(s[(c=new a(i-.5,n+.5)).x+"_"+c.y]=c),u.dx<e&&u.dy==t&&(s[(c=new a(i+.5,n-.5)).x+"_"+c.y]=c),u.dx==e&&u.dy%2==0||u.dy==t)this.saveLeftDownCornerQuadData(i,n,s);else{var d=r.instance.getRoadNode(i,n);if(null==d)continue;var p=r.instance.getRoadNode(i-1,n),f=r.instance.getRoadNode(i-1,n-1),g=r.instance.getRoadNode(i,n-1);this.isEnableValue(d.value)?(this.isOutEdgeNode(p)||this.isOutEdgeNode(f)||this.isOutEdgeNode(g))&&this.saveLeftDownCornerQuadData(i,n,s):this.isDisableValue(d.value)&&(this.isOutEdgeNode(p)&&this.isOutEdgeNode(f)&&this.isOutEdgeNode(g)||this.saveLeftDownCornerQuadData(i,n,s))}}return s},i.getEdge90Angle=function(){for(var t=o.instance.row,e=o.instance.col,i=0,n=0,s={},a=0;a<=t;a++)for(var l=0;l<=e;l++)if(n=a,(i=l)==e||n==t)this.saveLeftDownCornerQuadData(i,n,s);else{var h=r.instance.getRoadNode(i,n),c=r.instance.getRoadNode(i-1,n),u=r.instance.getRoadNode(i-1,n-1),d=r.instance.getRoadNode(i,n-1);this.isEnableValue(h.value)?(this.isOutEdgeNode(c)||this.isOutEdgeNode(u)||this.isOutEdgeNode(d))&&this.saveLeftDownCornerQuadData(i,n,s):this.isDisableValue(h.value)&&(this.isOutEdgeNode(c)&&this.isOutEdgeNode(u)&&this.isOutEdgeNode(d)||this.saveLeftDownCornerQuadData(i,n,s))}return s},i.saveLeftDownCornerQuadData=function(t,e,i){var n=new a(t-.5,e-.5);i[n.x+"_"+n.y]=n;var o=r.instance.getRoadNode(n.x-.5,n.y+.5),s=r.instance.getRoadNode(n.x+.5,n.y+.5),l=r.instance.getRoadNode(n.x+.5,n.y-.5),h=r.instance.getRoadNode(n.x-.5,n.y-.5),c=i[n.x-1+"_"+n.y];null!=c&&(!this.isOutEdgeNode(o)&&this.isOutEdgeNode(h)||this.isOutEdgeNode(o)&&!this.isOutEdgeNode(h))&&(n.left=c,c.right=n);var u=i[n.x+"_"+(n.y+1)];null!=u&&(!this.isOutEdgeNode(o)&&this.isOutEdgeNode(s)||this.isOutEdgeNode(o)&&!this.isOutEdgeNode(s))&&(n.up=u,u.down=n);var d=i[n.x+1+"_"+n.y];null!=d&&(!this.isOutEdgeNode(s)&&this.isOutEdgeNode(l)||this.isOutEdgeNode(s)&&!this.isOutEdgeNode(l))&&(n.right=d,d.left=n);var p=i[n.x+"_"+(n.y-1)];null!=p&&(!this.isOutEdgeNode(h)&&this.isOutEdgeNode(l)||this.isOutEdgeNode(h)&&!this.isOutEdgeNode(l))&&(n.down=p,p.up=n)},i.isEnableValue=function(t){if(1!=t)return!0},i.isDisableValue=function(t){if(1==t)return!0},i.isOutEdgeNode=function(t){return!(null!=t&&!this.isDisableValue(t.value))},e(t,null,[{key:"instance",get:function(){return null==this._instance&&(this._instance=new t),this._instance}}]),t}())._instance=void 0;var s=t("ObstacleLine",function(){function t(){this.startX=0,this.startY=0,this.endX=0,this.endY=0}var e=t.prototype;return e.moveTo=function(t,e){this.startX=t,this.startY=e},e.lineTo=function(t,e){this.endX=t,this.endY=e},t}()),a=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=0,this.y=0,this.left=null,this.up=null,this.right=null,this.down=null,this.connectLeft=!1,this.connectUp=!1,this.connectRight=!1,this.connectDown=!1,this.x=t,this.y=e};i._RF.pop()}}})),System.register("chunks:///_virtual/OtherManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./TransferDoor.ts","./RoadSign.ts","./SpawnPoint.ts"],(function(t){var e,i,n,o,r,s,a,l,h,c,u,d,p;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){r=t.cclegacy,s=t._decorator,a=t.Prefab,l=t.instantiate,h=t.Vec3,c=t.Component},function(t){u=t.default},function(t){d=t.default},function(t){p=t.default}],execute:function(){var f,g,y,m,v,_,b,P,x;r._RF.push({},"4392frP6NxKxKaBQkz8zd5H","OtherManager",void 0);var T=s.ccclass,C=s.property;t("default",(f=T("OtherManager"),g=C(a),y=C(a),m=C(a),f((b=e((_=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,n(e,"roadSignPrefab",b,o(e)),n(e,"spawnPointPrefab",P,o(e)),n(e,"transferDoorPrefabs",x,o(e)),e}i(e,t);var r=e.prototype;return r.start=function(){},r.getRoadSign=function(){var t=l(this.roadSignPrefab).getComponent(d);return t.node.active=!0,t.node.position=new h(0,0,0),t},r.getSpawnPoint=function(){var t=l(this.spawnPointPrefab).getComponent(p);return t.node.active=!0,t.node.position=new h(0,0,0),t},r.getTransferDoor=function(t){var e=0;t<this.transferDoorPrefabs.length&&(e=t);var i=l(this.transferDoorPrefabs[e]).getComponent(u);return i.node.active=!0,i.node.position=new h(0,0,0),i},e}(c)).prototype,"roadSignPrefab",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=e(_.prototype,"spawnPointPrefab",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=e(_.prototype,"transferDoorPrefabs",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),v=_))||v)),r._RF.pop()}}})),System.register("chunks:///_virtual/PathFindingAgent.ts",["./rollupPluginModLoBabelHelpers.js","cc","./MapType.ts","./MapRoadUtils.ts","./AstarHoneycombRoadSeeker.ts","./AStarRoadSeeker.ts"],(function(t){var e,i,n,o,r,s;return{setters:[function(t){e=t.createClass},function(t){i=t.cclegacy},function(t){n=t.MapType},function(t){o=t.default},function(t){r=t.default},function(t){s=t.default}],execute:function(){i._RF.push({},"2713cxFI+NMQJ7BOBfOraHy","PathFindingAgent",void 0),t("default",function(){function t(){this._roadDic={},this._roadSeeker=void 0,this._mapData=null,this._mapType=n.angle45,this._round=[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]],this._round1=[[0,-1],[1,-1],[1,0],[0,1],[-1,0],[-1,-1]],this._round2=[[0,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0]]}var i=t.prototype;return i.init=function(t){this._mapData=t,this._mapType=t.type,o.instance.updateMapInfo(this._mapData.mapWidth,this._mapData.mapHeight,this._mapData.nodeWidth,this._mapData.nodeHeight,this._mapData.type);for(var e=this._mapData.roadDataArr.length,i=this._mapData.roadDataArr[0].length,a=0,l=0,h=0,c=0,u=0,d=0;d<e;d++)for(var p=0;p<i;p++){a=this._mapData.roadDataArr[d][p],l=p,h=d;var f=o.instance.getNodeByDerect(l,h);f.value=a,this._mapType==n.honeycomb2&&(c=f.cx,u=f.cy,f.cx=u,f.cy=c),this._roadDic[f.cx+"_"+f.cy]=f}this._mapType==n.honeycomb||this._mapType==n.honeycomb2?this._roadSeeker=new r(this._roadDic):this._roadSeeker=new s(this._roadDic)},i.seekPath=function(t,e,i,n,o){void 0===o&&(o=0);var r=this.getRoadNodeByPixel(t,e),s=this.getRoadNodeByPixel(i,n),a=this.getSeakRadius(o);return this._roadSeeker.seekPath(r,s,a)},i.seekPath2=function(t,e,i,n,o){void 0===o&&(o=0);var r=this.getRoadNodeByPixel(t,e),s=this.getRoadNodeByPixel(i,n),a=this.getSeakRadius(o);return this._roadSeeker.seekPath2(r,s,a)},i.testSeekRoad=function(t,e,i,n,o,r,s,a){var l=this.getRoadNodeByPixel(t,e),h=this.getRoadNodeByPixel(i,n),c=this.getSeakRadius(o);this._roadSeeker.testSeekPathStep(l,h,c,r,s,a)},i.getSeakRadius=function(t){void 0===t&&(t=0);var e=Math.min(o.instance.halfNodeWidth,o.instance.halfNodeHeight),i=Math.ceil((t-e)/(2*e));return i>0?i:0},i.isArriveBetweenTwoNodes=function(t,e){return null!=t&&null!=e&&this._roadSeeker.isArriveBetweenTwoNodes(t,e)},i.isArriveBetweenTwoPos=function(t,e,i,n){var o=this.getRoadNodeByPixel(t,e),r=this.getRoadNodeByPixel(i,n);return this._roadSeeker.isArriveBetweenTwoNodes(o,r)},i.getRoadNodeByPixel=function(t,e){var i=o.instance.getWorldPointByPixel(t,e);return this._mapType==n.honeycomb2?this.getRoadNode(i.y,i.x):this.getRoadNode(i.x,i.y)},i.getRoadNode=function(t,e){return this._roadSeeker.getRoadNode(t,e)},i.getRoundRoadNodes=function(t,e){if(void 0===e&&(e=!1),null==t)return[];var i,o=[];e&&o.push(t),i=this.mapType==n.honeycomb||this.mapType==n.honeycomb2?t.cx%2==0?this._round1:this._round2:this._round;for(var r=0;r<i.length;r++){var s=t.cx+i[r][0],a=t.cy+i[r][1];o.push(this.getRoadNode(s,a))}return o},i.setMaxSeekStep=function(t){this._roadSeeker.setMaxSeekStep(t)},i.setPathOptimize=function(t){this._roadSeeker.setPathOptimize(t)},i.setPathQuadSeek=function(t){this._roadSeeker.setPathQuadSeek(t)},i.setRoadNodePassCondition=function(t){this._roadSeeker.setRoadNodePassCondition(t)},e(t,[{key:"mapData",get:function(){return this._mapData}},{key:"mapType",get:function(){return this._mapType}},{key:"roadSeeker",get:function(){return this._roadSeeker}}],[{key:"instance",get:function(){return null==this._instance&&(this._instance=new t),this._instance}}]),t}())._instance=void 0,i._RF.pop()}}})),System.register("chunks:///_virtual/PathLog.ts",["cc"],(function(t){var e;return{setters:[function(t){e=t.cclegacy}],execute:function(){e._RF.push({},"90201mzAshCGZOJXgifi2Sv","PathLog",void 0),t("default",function(){function t(){}return t.setLogEnable=function(t){this.log=t?console.log:function(){}},t}()).log=console.log,e._RF.pop()}}})),System.register("chunks:///_virtual/PathOptimize.ts",["cc"],(function(t){var e;return{setters:[function(t){e=t.cclegacy}],execute:function(){var i;t("PathOptimize",void 0),e._RF.push({},"a9cd52F3d9EwKcKajKjkZkz","PathOptimize",void 0),function(t){t[t.none=0]="none",t[t.better=1]="better",t[t.best=2]="best"}(i||(i=t("PathOptimize",{}))),e._RF.pop()}}})),System.register("chunks:///_virtual/PathQuadSeek.ts",["cc"],(function(t){var e;return{setters:[function(t){e=t.cclegacy}],execute:function(){var i;t("PathQuadSeek",void 0),e._RF.push({},"9f4b4XouzRKZ43Hs0ARXbeT","PathQuadSeek",void 0),function(t){t[t.path_dire_4=0]="path_dire_4",t[t.path_dire_8=1]="path_dire_8"}(i||(i=t("PathQuadSeek",{}))),e._RF.pop()}}})),System.register("chunks:///_virtual/Pet.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Actor.ts"],(function(t){var e,i,n,o;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,n=t._decorator},function(t){o=t.default}],execute:function(){var r;i._RF.push({},"2ef83PN8rVDlp7+ymFHLAci","Pet",void 0);var s=n.ccclass;n.property,t("default",s("Pet")(r=function(t){function i(){return t.apply(this,arguments)||this}e(i,t);var n=i.prototype;return n.start=function(){},n.init=function(){},i}(o))||r),i._RF.pop()}}})),System.register("chunks:///_virtual/PetManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Pet.ts"],(function(t){var e,i,n,o,r,s,a,l,h,c,u;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){r=t.cclegacy,s=t._decorator,a=t.Prefab,l=t.instantiate,h=t.Vec3,c=t.Component},function(t){u=t.default}],execute:function(){var d,p,f,g,y;r._RF.push({},"92250RiPGdDOaC8E3uCZT2L","PetManager",void 0);var m=s.ccclass,v=s.property;t("default",(d=m("PetManager"),p=v(a),d((y=e((g=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,n(e,"petPrefab",y,o(e)),e}i(e,t);var r=e.prototype;return r.start=function(){},r.getpet=function(t){var e=l(this.petPrefab).getComponent(u);return e.node.active=!0,e.node.position=new h(0,0,0),e},e}(c)).prototype,"petPrefab",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),f=g))||f)),r._RF.pop()}}})),System.register("chunks:///_virtual/Player.ts",["./rollupPluginModLoBabelHelpers.js","cc","./MovieClip.ts","./Unit.ts","./Actor.ts","./Body.ts"],(function(t){var e,i,n,o,r,s,a,l,h,c,u,d,p;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized,r=t.createClass},function(t){s=t.cclegacy,a=t._decorator,l=t.Enum,h=t.CCInteger},function(t){c=t.default},function(t){u=t.UnitState},function(t){d=t.default},function(t){p=t.default}],execute:function(){var f,g,y,m,v,_,b;t({PlayerControlType:void 0,PlayerType:void 0}),s._RF.push({},"f6123H0uppA2Zmo5qpWWxKq","Player",void 0);var P,x,T=a.ccclass,C=a.property;!function(t){t[t.none=0]="none",t[t.my=1]="my",t[t.other=1]="other"}(P||(P=t("PlayerType",{}))),function(t){t[t.none=0]="none",t[t.user=1]="user",t[t.ai=2]="ai",t[t.net=3]="net"}(x||(x=t("PlayerControlType",{}))),t("default",(f=T("Player"),g=C({type:l(x),tooltip:"玩家控制类型:\nnone  无控制 \nuser 用户操作 \nai ai操作 \nnet 网络玩家操作"}),y=C(h),f((_=e((v=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,n(e,"controlType",_,o(e)),n(e,"roleId",b,o(e)),e.body=null,e.playerType=P.none,e._state=u.none,e}i(e,t);var s=e.prototype;return s.onLoad=function(){this.body=this.getComponentInChildren(p),t.prototype.onLoad.call(this)},s.start=function(){t.prototype.start.call(this),this.state=u.idle},s.update=function(e){t.prototype.update.call(this,e)},r(e,[{key:"direction",set:function(t){switch(this._direction=t,this._direction){case 0:this.movieClip.rowIndex=0;break;case 1:this.movieClip.rowIndex=4;break;case 2:this.movieClip.rowIndex=1;break;case 3:this.movieClip.rowIndex=6;break;case 4:this.movieClip.rowIndex=3;break;case 5:this.movieClip.rowIndex=7;break;case 6:this.movieClip.rowIndex=2;break;case 7:this.movieClip.rowIndex=5}}},{key:"state",set:function(t){if(this._state!=t){switch(this._state=t,this._movieClip&&(this._movieClip.node.active=!1),this._state){case u.idle:this._movieClip=this.node.getChildByName("Body").getChildByName("Skin_Idle").getComponent(c);break;case u.walk:this._movieClip=this.node.getChildByName("Body").getChildByName("Skin_Walk").getComponent(c);break;case u.attack:this._movieClip=this.node.getChildByName("Body").getChildByName("Skin_Idle").getComponent(c)}this.direction=this._direction,this._movieClip.node.active=!0,this._movieClip.playIndex=0,this._movieClip.playAction()}}}]),e}(d)).prototype,"controlType",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return x.none}}),b=e(v.prototype,"roleId",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),m=v))||m)),s._RF.pop()}}})),System.register("chunks:///_virtual/PlayerManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Player.ts"],(function(t){var e,i,n,o,r,s,a,l,h,c,u;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){r=t.cclegacy,s=t._decorator,a=t.Prefab,l=t.instantiate,h=t.Vec3,c=t.Component},function(t){u=t.default}],execute:function(){var d,p,f,g,y,m;r._RF.push({},"0afddzPh/5MHKC8hwiZAfAa","PlayerManager",void 0);var v=s.ccclass,_=s.property;t("default",(d=v("PlayerManager"),p=_(a),d((y=e((g=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,n(e,"playerPrefabArr",y,o(e)),n(e,"selectRoleId",m,o(e)),e}i(e,t);var r=e.prototype;return r.start=function(){},r.getPlayer=function(t){var e=l(this.playerPrefabArr[t-1]).getComponent(u);return e.node.position=new h(0,0,0),e.roleId=t,e.node.active=!0,e},e}(c)).prototype,"playerPrefabArr",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),m=e(g.prototype,"selectRoleId",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),f=g))||f)),r._RF.pop()}}})),System.register("chunks:///_virtual/Point.ts",["cc"],(function(t){var e;return{setters:[function(t){e=t.cclegacy}],execute:function(){e._RF.push({},"520e4cLiBBPLYREzSRGlltJ","Point",void 0),t("default",(function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=0,this.y=0,this.x=t,this.y=e})),e._RF.pop()}}})),System.register("chunks:///_virtual/RoadNode.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,i;return{setters:[function(t){e=t.createClass},function(t){i=t.cclegacy}],execute:function(){i._RF.push({},"a5569a7KTRDiKGvGCqxNAHv","RoadNode",void 0),t("default",function(){function t(){this._px=void 0,this._py=void 0,this._cx=void 0,this._cy=void 0,this._dx=void 0,this._dy=void 0,this._value=0,this._f=0,this._g=0,this._h=0,this._parent=null,this._treeParent=null,this._left=null,this._right=null,this._openTag=0,this._closeTag=0}var i=t.prototype;return i.resetTree=function(){this._treeParent=null,this._left=null,this._right=null},i.toString=function(){return"路点像素坐标：（"+this._px+","+this._py+"),  路点世界坐标：（"+this._cx+","+this._cy+"),  路点平面直角坐标：（"+this._dx+","+this._dy+")"},e(t,[{key:"px",get:function(){return this._px},set:function(t){this._px=t}},{key:"py",get:function(){return this._py},set:function(t){this._py=t}},{key:"cx",get:function(){return this._cx},set:function(t){this._cx=t}},{key:"cy",get:function(){return this._cy},set:function(t){this._cy=t}},{key:"dx",get:function(){return this._dx},set:function(t){this._dx=t}},{key:"dy",get:function(){return this._dy},set:function(t){this._dy=t}},{key:"value",get:function(){return this._value},set:function(t){this._value=t}},{key:"f",get:function(){return this._f},set:function(t){this._f=t}},{key:"g",get:function(){return this._g},set:function(t){this._g=t}},{key:"h",get:function(){return this._h},set:function(t){this._h=t}},{key:"parent",get:function(){return this._parent},set:function(t){this._parent=t}},{key:"treeParent",get:function(){return this._treeParent},set:function(t){this._treeParent=t}},{key:"left",get:function(){return this._left},set:function(t){this._left=t}},{key:"right",get:function(){return this._right},set:function(t){this._right=t}},{key:"openTag",get:function(){return this._openTag},set:function(t){this._openTag=t}},{key:"closeTag",get:function(){return this._closeTag},set:function(t){this._closeTag=t}}]),t}()),i._RF.pop()}}})),System.register("chunks:///_virtual/RoadSign.ts",["./rollupPluginModLoBabelHelpers.js","cc","./MovieClip.ts"],(function(t){var e,i,n,o,r,s,a,l;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){r=t.cclegacy,s=t._decorator,a=t.Component},function(t){l=t.default}],execute:function(){var h,c,u,d,p;r._RF.push({},"99ab1Uqzh9PPJeZ3hD/Yq+h","RoadSign",void 0);var f=s.ccclass,g=s.property;t("default",(h=f("RoadSign"),c=g(l),h((p=e((d=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,n(e,"signMc",p,o(e)),e}i(e,t);var r=e.prototype;return r.start=function(){var t=this;this.signMc.node.on("complete",(function(){t.node.active=!1}),this)},r.play=function(){this.node.active=!0,this.signMc.reset(),this.signMc.play()},e}(a)).prototype,"signMc",[c],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),u=d))||u)),r._RF.pop()}}})),System.register("chunks:///_virtual/RVOSystem.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Simulator.ts"],(function(t){var e,i,n,o,r,s,a,l;return{setters:[function(t){e=t.inheritsLoose,i=t.createClass},function(t){n=t.cclegacy,o=t._decorator,r=t.Node,s=t.game,a=t.Component},function(t){l=t.Simulator}],execute:function(){var h,c;n._RF.push({},"980b5DltKBEPJkcHAmFWzn3","RVOSystem",void 0);var u=o.ccclass;o.property,t("default",u("RVOSystem")(((c=function(t){function n(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).rvoTag=0,e.runing=!1,e}e(n,t);var o=n.prototype;return o.init=function(){},o.startup=function(){console.log("RVOSystem 启动RVO系统"),this.runing=!0},o.stop=function(){console.log("RVOSystem 停止RVO系统"),this.runing=!1},o.refresh=function(){this.rvoTag++,l.instance.clear()},o.start=function(){},o.update=function(t){this.runing&&l.instance.run(t)},i(n,null,[{key:"instance",get:function(){if(null==this._instance){var t=new r("RVOSystem");s.addPersistRootNode(t),this._instance=t.addComponent(n),this._instance.init()}return this._instance}}]),n}(a))._instance=void 0,h=c))||h),n._RF.pop()}}})),System.register("chunks:///_virtual/SceneManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./MapLoadModel.ts"],(function(t){var e,i,n,o,r,s,a,l,h,c,u;return{setters:[function(t){e=t.inheritsLoose,i=t.createClass},function(t){n=t.cclegacy,o=t._decorator,r=t.resources,s=t.JsonAsset,a=t.Texture2D,l=t.Node,h=t.game,c=t.Component},function(t){u=t.MapLoadModel}],execute:function(){var d,p;t("SceneLoadStatus",void 0),n._RF.push({},"7796aT7xMBLFJJC7npZJ4FM","SceneManager",void 0);var f,g=o.ccclass,y=(o.property,t("SceneEventType",(function(){})));y.LOAD_COMPLETE="LOAD_COMPLETE",y.Map_INIT_COMPLETE="MAP_INIT_COMPLETE",function(t){t[t.none=0]="none",t[t.loading=1]="loading",t[t.loaded=2]="loaded"}(f||(f=t("SceneLoadStatus",{})));var m=t("SceneData",(function(){this.currentMapId="",this.enterSpawnId=0,this.mapLoadModel=u.single,this.mapData=null,this.bgTex=null}));t("default",g("SceneManager")(((p=function(t){function n(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).loadStatus=f.none,e.sceneData=new m,e}e(n,t);var o=n.prototype;return o.start=function(){},o.init=function(){},o.on=function(t,e,i,n){this.node.on(t,e,i,n)},o.emit=function(t,e,i,n,o,r){this.node.emit(t,e,i,n,o,r)},o.loadMap=function(t,e,i){void 0===i&&(i=u.single),this.loadStatus!=f.loading&&(this.loadStatus=f.loading,this.sceneData.currentMapId=t,this.sceneData.enterSpawnId=e,this.sceneData.mapLoadModel=i,i==u.single?this.loadSingleMap():this.loadSlicesMap())},o.reloadMap=function(){this.loadStatus=f.none,this.loadMap(this.sceneData.currentMapId,this.sceneData.enterSpawnId,this.sceneData.mapLoadModel)},o.loadSingleMap=function(){var t=this,e="map/data/"+this.sceneData.currentMapId;r.load(e,s,(function(i,n){if(null==i){t.sceneData.mapData=n.json;var o="map/bg/"+t.sceneData.mapData.bgName+"/texture";r.load(o,a,(function(e,i){null==e?(t.loadStatus=f.loaded,t.sceneData.bgTex=i,t.emit(y.LOAD_COMPLETE,t.sceneData),t.emit(y.Map_INIT_COMPLETE,t.sceneData)):console.error("地图背景加载失败 mapBgPath = "+o,e)}))}else console.error("地图数据加载失败 mapFilePath = "+e,i)}))},o.loadSlicesMap=function(){var t=this,e="map/data/"+this.sceneData.currentMapId;r.load(e,s,(function(i,n){if(null==i){t.sceneData.mapData=n.json;var o="map/bg/"+t.sceneData.mapData.bgName+"/miniMap/texture";r.load(o,a,(function(e,i){null==e?(t.loadStatus=f.loaded,t.sceneData.bgTex=i,t.emit(y.LOAD_COMPLETE,t.sceneData),t.emit(y.Map_INIT_COMPLETE,t.sceneData)):console.error("小地图背景加载失败 miniMapBgPath = "+o,e)}))}else console.error("地图数据加载失败 mapFilePath = "+e,i)}))},i(n,null,[{key:"instance",get:function(){if(null==this._instance){var t=new l("SceneManager");h.addPersistRootNode(t),this._instance=t.addComponent(n),this._instance.init()}return this._instance}}]),n}(c))._instance=null,d=p))||d),n._RF.pop()}}})),System.register("chunks:///_virtual/Simulator.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Common.ts","./Agent.ts","./kdtree.ts"],(function(t){var e,i,n,o,r,s;return{setters:[function(t){e=t.createClass},function(t){i=t.cclegacy},function(t){n=t.RVOMath,o=t.Obstacle},function(t){r=t.Agent},function(t){s=t.KdTree}],execute:function(){i._RF.push({},"c9717VhLl5EHrHeGzym7lQ/","Simulator",void 0),t("Simulator",function(){function t(){this.agentId=0,this.agentIdLst=[],this.aid2agent=Object.create(null),this.hasAgentChange=!1,this.obstacles=[],this.kdTree=new s,this.defaultAgent=void 0,this.time=0}var i=t.prototype;return i.getAgent=function(t){return this.aid2agent[this.agentIdLst[t]]},i.getAgentByAid=function(t){return this.aid2agent[t]},i.getGlobalTime=function(){return this.time},i.getNumAgents=function(){return this.agentIdLst.length},i.setAgentPrefVelocity=function(t,e){this.aid2agent[t].prefVelocity_.copy(e)},i.getAgentPosition=function(t){return this.aid2agent[t].position_},i.getAgentPrefVelocity=function(t){return this.aid2agent[t].prefVelocity_},i.getAgentVelocity=function(t){return this.aid2agent[t].velocity_},i.getAgentRadius=function(t){return this.aid2agent[t].radius_},i.getAgentOrcaLines=function(t){return this.aid2agent[t].orcaLines_},i.addAgent=function(t){if(!this.defaultAgent)throw new Error("no default agent");var e=new r;return e.position_.copy(t),e.maxNeighbors_=this.defaultAgent.maxNeighbors_,e.maxSpeed_=this.defaultAgent.maxSpeed_,e.neighborDist=this.defaultAgent.neighborDist,e.radius_=this.defaultAgent.radius_,e.timeHorizon=this.defaultAgent.timeHorizon,e.timeHorizonObst=this.defaultAgent.timeHorizonObst,e.velocity_.copy(this.defaultAgent.velocity_),e.id=this.agentId++,this.aid2agent[e.id]=e,this.agentIdLst.push(e.id),this.hasAgentChange=!0,e.id},i.removeAgent=function(t){if(this.hasAgent(t)){delete this.aid2agent[t];var e=this.agentIdLst.indexOf(t);this.agentIdLst[e]=this.agentIdLst[this.agentIdLst.length-1],this.agentIdLst.length--,this.hasAgentChange=!0}},i.hasAgent=function(t){return!!this.aid2agent[t]},i.setAgentMass=function(t,e){this.aid2agent[t].mass=e},i.getAgentMass=function(t){return this.aid2agent[t].mass},i.setAgentRadius=function(t,e){this.aid2agent[t].radius_=e},i.setAgentDefaults=function(t,e,i,n,o,s,a){this.defaultAgent||(this.defaultAgent=new r),this.defaultAgent.maxNeighbors_=e,this.defaultAgent.maxSpeed_=s,this.defaultAgent.neighborDist=t,this.defaultAgent.radius_=o,this.defaultAgent.timeHorizon=i,this.defaultAgent.timeHorizonObst=n,this.defaultAgent.velocity_=a},i.run=function(t){this.kdTree.buildAgentTree(this.getNumAgents());for(var e=this.agentIdLst.length,i=0;i<e;i++)this.aid2agent[this.agentIdLst[i]].computeNeighbors(this),this.aid2agent[this.agentIdLst[i]].computeNewVelocity(t);for(var n=0;n<e;n++)this.aid2agent[this.agentIdLst[n]].update(t);this.time+=t},i.addObstacle=function(t){if(t.length<2)return-1;for(var e=this.obstacles.length,i=0;i<t.length;++i){var r=new o;r.point=t[i],0!=i&&(r.previous=this.obstacles[this.obstacles.length-1],r.previous.next=r),i==t.length-1&&(r.next=this.obstacles[e],r.next.previous=r),r.direction=n.normalize(t[i==t.length-1?0:i+1].minus(t[i])),2==t.length?r.convex=!0:r.convex=n.leftOf(t[0==i?t.length-1:i-1],t[i],t[i==t.length-1?0:i+1])>=0,r.id=this.obstacles.length,this.obstacles.push(r)}return e},i.processObstacles=function(){this.kdTree.buildObstacleTree()},i.queryVisibility=function(t,e,i){return this.kdTree.queryVisibility(t,e,i)},i.getObstacles=function(){return this.obstacles},i.clear=function(){this.agentIdLst.length=0,this.agentId=0,this.aid2agent=Object.create(null),this.defaultAgent=null,this.kdTree=new s,this.obstacles.length=0},e(t,null,[{key:"instance",get:function(){return t._inst||(t._inst=new t),t._inst}}]),t}())._inst=void 0,i._RF.pop()}}})),System.register("chunks:///_virtual/SoundManager.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,i,n,o,r,s,a,l,h,c,u,d,p,f,g;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.initializerDefineProperty,n=t.inheritsLoose,o=t.assertThisInitialized,r=t.createClass},function(t){s=t.cclegacy,a=t._decorator,l=t.CCString,h=t.Enum,c=t.AudioClip,u=t.AudioSource,d=t.game,p=t.resources,f=t.log,g=t.Component}],execute:function(){var y,m,v,_,b,P,x,T,C,N,w,M,S,k,D,R,A,I,L,B,O,z,F,E,H,U,V,W,j,G;t({BGSound:void 0,OtherSound:void 0}),s._RF.push({},"6dcacfNQmNPAYlxRNlqToAU","SoundManager",void 0);var q,Y=a.ccclass,K=a.property;!function(t){t[t.none=0]="none",t[t.bgm1=1]="bgm1",t[t.bgm2=2]="bgm2",t[t.bgm3=3]="bgm3",t[t.bgm4=4]="bgm4",t[t.bgm5=5]="bgm5"}(q||(q=t("BGSound",{})));var X,J=t("BGSoundClip",(y=Y("BGSoundClip"),m=K(l),v=K(l),_=K({type:h(q)}),b=K(c),y((T=e((x=function(){i(this,"name",T,this),i(this,"srcName",C,this),i(this,"type",N,this),i(this,"clip",w,this)}).prototype,"name",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),C=e(x.prototype,"srcName",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),N=e(x.prototype,"type",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return q.none}}),w=e(x.prototype,"clip",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=x))||P));!function(t){t[t.none=0]="none",t[t.click=1]="click",t[t.bonus=2]="bonus"}(X||(X=t("OtherSound",{})));var Z=t("OtherSoundClip",(M=Y("OtherSoundClip"),S=K(l),k=K({type:h(X)}),D=K(c),M((I=e((A=function(){i(this,"name",I,this),i(this,"type",L,this),i(this,"clip",B,this)}).prototype,"name",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),L=e(A.prototype,"type",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return X.none}}),B=e(A.prototype,"clip",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=A))||R));t("SoundManager",(O=Y("SoundManager"),z=K(u),F=K(J),E=K(Z),O(((G=function(t){function e(){for(var e,n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,i(e,"bgAS",V,o(e)),i(e,"bgSoundClips",W,o(e)),e.bgSoundDic={},i(e,"otherSoundClips",j,o(e)),e.otherSoundDic={},e.lastBgSound=q.none,e}n(e,t);var s=e.prototype;return s.onLoad=function(){if(e._instance)this.node.destroy();else{e._instance=this,d.addPersistRootNode(this.node),this.node.parent=null;for(var t=0;t<this.bgSoundClips.length;t++)this.bgSoundDic[this.bgSoundClips[t].type]=this.bgSoundClips[t];for(t=0;t<this.otherSoundClips.length;t++)this.otherSoundDic[this.otherSoundClips[t].type]=this.otherSoundClips[t]}},s.start=function(){},s.playBGSound=function(t,e){var i=this;void 0===e&&(e=!0),this.lastBgSound==q.none&&(this.lastBgSound=t),this.getBGSoundClip(t,(function(t){i.bgAS.stop(),i.bgAS.clip=t,i.bgAS.loop=e,i.bgAS.pause(),i.bgAS.play()}))},s.stopBGSound=function(){this.bgAS.stop()},s.playLastBGSound=function(){this.lastBgSound!=q.none&&this.playBGSound(this.lastBgSound)},s.playOtherSound=function(t,e){void 0===e&&(e=1);var i=this.getOtherSoundClip(t);i?this.bgAS.playOneShot(i,e):console.log("找不到资源id为 "+t+" PlayOtherSound声音配置")},s.getBGSoundClip=function(t,e){var i=this;if(null!=this.bgSoundDic[t])if(null!=this.bgSoundDic[t].clip)e(this.bgSoundDic[t].clip);else{var n="sound/bgm/"+this.bgSoundDic[t].srcName;p.load(n,c,(function(o,r){null==o?(i.bgSoundDic[t].clip=r,e&&e(r)):console.error(q[t],"背景音乐加载失败 path = "+n,o)}))}else console.log("没配置背景音乐数据 type = ",q[t])},s.getOtherSoundClip=function(t){return this.otherSoundDic[t]?this.otherSoundDic[t].clip:(f("不存在该种声音源 type = ",X[t]),null)},r(e,null,[{key:"instance",get:function(){return this._instance,e._instance}}]),e}(g))._instance=void 0,V=e((U=G).prototype,"bgAS",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=e(U.prototype,"bgSoundClips",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),j=e(U.prototype,"otherSoundClips",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),H=U))||H)),s._RF.pop()}}})),System.register("chunks:///_virtual/SpawnPoint.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,i,n,o,r,s,a,l,h;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){r=t.cclegacy,s=t._decorator,a=t.CCInteger,l=t.Vec3,h=t.Component}],execute:function(){var c,u,d,p,f,g,y;r._RF.push({},"44005HVhJdDmrOpOby1TSdB","SpawnPoint",void 0);var m=s.ccclass,v=s.property;t("default",(c=m("SpawnPoint"),u=v(a),d=v(a),c((g=e((f=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,n(e,"spawnId",g,o(e)),n(e,"defaultSpawn",y,o(e)),e.editData=null,e}i(e,t);var r=e.prototype;return r.start=function(){},r.init=function(){},r.initEditData=function(t){this.editData=t,this.node.position=new l(t.x,t.y),this.spawnId=t.spawnId,this.defaultSpawn=t.defaultSpawn},e}(h)).prototype,"spawnId",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),y=e(f.prototype,"defaultSpawn",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),p=f))||p)),r._RF.pop()}}})),System.register("chunks:///_virtual/SystemManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./InputManager.ts"],(function(t){var e,i,n,o,r,s,a,l,h;return{setters:[function(t){e=t.inheritsLoose,i=t.createClass},function(t){n=t.cclegacy,o=t._decorator,r=t.Node,s=t.game,a=t.Component},function(t){l=t.UInput,h=t.UKeyCode}],execute:function(){var c,u;n._RF.push({},"68f6b6MmC1BXaz+HsIjta0Z","SystemManager",void 0);var d=o.ccclass,p=(o.property,t("default",d("SystemManager")(((u=function(t){function n(){return t.apply(this,arguments)||this}e(n,t);var o=n.prototype;return o.init=function(){},o.startup=function(){console.log("SystemManager 启动系统管理")},o.onLoad=function(){},o.start=function(){},o.update=function(t){(CC_EDITOR||CC_PREVIEW)&&l.getKeyDown(h.Space)},o.RegisterSystems=function(){},i(n,null,[{key:"instance",get:function(){if(null==this._instance){var t=new r("SystemManager");t.setSiblingIndex(1e3),s.addPersistRootNode(t),this._instance=t.addComponent(n),this._instance.init()}return this._instance}}]),n}(a))._instance=void 0,c=u))||c));CC_EDITOR||p.instance.startup(),n._RF.pop()}}})),System.register("chunks:///_virtual/TextureUtils.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,i,n;return{setters:[function(t){e=t.createClass},function(t){i=t.cclegacy,n=t.Color}],execute:function(){i._RF.push({},"f0f4dShZFtC56JLwT3LoDyM","TextureUtils",void 0),t("TextureUtils",function(){function t(){this._texture2d=void 0,this.width=100,this.height=100,this.buffer=void 0,this.pixelColor=void 0,this.colorCount=void 0,this.pointColor=void 0}var i=t.prototype;return i.init=function(t){this._texture2d=t,this.width=this._texture2d.width,this.height=this._texture2d.height,this.initPixelColor()},i.initPixelColor=function(){this.buffer=new ArrayBuffer(this.width*this.height*4),this.pixelColor=new Uint8Array(this.buffer),this.pixelColor.fill(0)},i.resetPixelColor=function(){this.pixelColor.fill(0)},i.setData=function(t){var e=new Uint8Array(t);e.length==this.width*this.height*4?(this.setPixelColorByRGBA(e),this.setPointColorByRGBA(e)):console.warn("数据格式不对")},i.getData=function(){return this.pixelColor},i.copyData=function(t){void 0===t&&(t=[]);for(var e=0,i=this.pixelColor.length;e<i;++e)t[e]=this.pixelColor[e];return t},i.getBuffer=function(){return this.buffer},i.getPointData=function(){return this.pointColor},i.getColorCount=function(t,e,i,n){void 0===n&&(n=255);var o=this.convertToNumber(t,e,i,n);return this.colorCount[o]},i.setPixelColorByRGBA=function(t){this.pixelColor.set(t)},i.setPointColorByRGBA=function(t){this.colorCount={};for(var e=0;e<this.height;++e)for(var i=e*this.height,n=0;n<this.width;++n){var o=this.convertToNumber(t[i++],t[i++],t[i++],t[i++]);this.pointColor[n][e]=o,this.colorCount[o]?this.colorCount[o]+=1:this.colorCount[o]=1}},i.convertToNumber=function(t,e,i,n){return void 0===n&&(n=255),(254&t)<<23|e<<16|i<<8|n},i.setPixel=function(t,e,i){if(!(t<0||t>=this.width||e<0||e>this.height)){t=Math.round(t);var n=4*((e=Math.round(e))*this.width+t);this.pixelColor[n]=i.r,this.pixelColor[n+1]=i.g,this.pixelColor[n+2]=i.b,this.pixelColor[n+3]=i.a}},i.setPixels=function(t){for(var e=t.length,i=this.width*this.height,n=0;n<i;n++){var o=n;if(o<e){var r=t[n];this.pixelColor[o]=r.r,this.pixelColor[o+1]=r.g,this.pixelColor[o+2]=r.b,this.pixelColor[o+3]=r.a}else this.pixelColor[o]=0,this.pixelColor[o+1]=0,this.pixelColor[o+2]=0,this.pixelColor[o+3]=255}},i.setBlockPixels=function(t,e,i,n,o){for(var r=0,s=o.length,a=e;a<e+n;a++)for(var l=t;l<t+i;l++){var h=l,c=a;if(!(h<0||h>=this.width||c<0||c>this.height)){var u=4*(c*this.width+h),d=o[r];r<s?(this.pixelColor[u]=d.r,this.pixelColor[u+1]=d.g,this.pixelColor[u+2]=d.b,this.pixelColor[u+3]=d.a):(this.pixelColor[u]=0,this.pixelColor[u+1]=0,this.pixelColor[u+2]=0,this.pixelColor[u+3]=255),r++}}},i.getPixel=function(t,e){if(t<0||t>=this.width||e<0||e>this.height)return new n(0,0,0,255);t=Math.round(t);var i=4*((e=Math.round(e))*this.width+t),o=new n;return o.r=this.pixelColor[i],o.g=this.pixelColor[i+1],o.b=this.pixelColor[i+2],o.a=this.pixelColor[i+3],o},i.getPixels=function(){for(var t=[],e=this.pixelColor.length,i=0;i<e;i+=4){var o=i,r=new n;r.r=this.pixelColor[o],r.g=this.pixelColor[o+1],r.b=this.pixelColor[o+2],r.a=this.pixelColor[o+3],t.push(r)}return t},i.getBlockPixels=function(t,e,i,o){for(var r=[],s=e;s<e+o;s++)for(var a=t;a<t+i;a++){var l=a,h=s,c=new n;if(l<0||l>=this.width||h<0||h>this.height)c.r=0,c.g=0,c.b=0,c.a=255;else{var u=4*(h*this.width+l);c.r=this.pixelColor[u],c.g=this.pixelColor[u+1],c.b=this.pixelColor[u+2],c.a=this.pixelColor[u+3]}r.push(c)}return r},e(t,[{key:"texture2d",get:function(){return this._texture2d},set:function(t){this._texture2d=t}}]),t}()),i._RF.pop()}}})),System.register("chunks:///_virtual/TopToolBar.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ControlMode.ts","./RVOSystem.ts","./FogOfWar.ts","./SoundManager.ts","./SceneManager.ts","./GameManager.ts","./GameMap.ts","./GameWorld.ts","./GameController.ts","./MouseCursorController.ts"],(function(t){var e,i,n,o,r,s,a,l,h,c,u,d,p,f,g,y,m,v,_,b,P,x,T;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){r=t.cclegacy,s=t._decorator,a=t.Button,l=t.Node,h=t.director,c=t.Label,u=t.Component},function(t){d=t.ControlMode},function(t){p=t.default},function(t){f=t.FogOfWar},function(t){g=t.SoundManager},function(t){y=t.default,m=t.SceneEventType},function(t){v=t.default},function(t){_=t.default},function(t){b=t.default},function(t){P=t.default},function(t){x=t.default,T=t.MouseCursorStyle}],execute:function(){var C,N,w,M,S,k,D,R,A,I,L,B,O,z,F,E,H,U,V;r._RF.push({},"81eebhSt91OzaL3r+eBmHhk","TopToolBar",void 0);var W=s.ccclass,j=s.property;t("default",(C=W("TopToolBar"),N=j(a),w=j(a),M=j(a),S=j(a),k=j(a),D=j(a),R=j(a),A=j(l),C((B=e((L=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,n(e,"controllBtn",B,o(e)),n(e,"swBtn",O,o(e)),n(e,"roadBtn",z,o(e)),n(e,"mouseStyleBtn",F,o(e)),n(e,"miniMapBtn",E,o(e)),n(e,"fogOfWarBtn",H,o(e)),n(e,"loginBtn",U,o(e)),n(e,"miniMapNode",V,o(e)),e}i(e,t);var r=e.prototype;return r.start=function(){var t=this;this.refreshControlMode(),this.refreshRoadInfo(),this.controllBtn.node.on(l.EventType.TOUCH_START,(function(e){P.instance.controlMode==d.touch?P.instance.controlMode=d.joystick:P.instance.controlMode=d.touch,b.instance.gameMap.myPlayer.controlMode=P.instance.controlMode,t.refreshControlMode()}),this),this.swBtn.node.on(l.EventType.TOUCH_START,(function(t){var e=v.instance.playerMgr.selectRoleId+1;e>11&&(e=1),v.instance.playerMgr.selectRoleId=e,b.instance.gameMap.switchPlayer(e)}),this),this.roadBtn.node.on(l.EventType.TOUCH_START,(function(e){_.isDrawRoadLayer=!_.isDrawRoadLayer,b.instance.gameMap.roadLayer.active=_.isDrawRoadLayer,t.refreshRoadInfo()}),this),this.mouseStyleBtn.node.on(l.EventType.TOUCH_START,(function(e){var i=P.instance.getComponent(x);i.cursorStyle==T.custom?i.setCursorStyle(T.normal):i.setCursorStyle(T.custom),t.refreshMouseStyleInfo()}),this),this.miniMapBtn.node.on(l.EventType.TOUCH_START,(function(e){t.miniMapNode.active=!t.miniMapNode.active,t.refreshMiniMapInfo()}),this),this.fogOfWarBtn.node.on(l.EventType.TOUCH_START,(function(e){null!=f.instance&&(f.instance.node.active=!f.instance.node.active,t.refreshFogOfWarInfo())}),this),this.loginBtn.node.on(l.EventType.TOUCH_START,(function(t){P.instance.getComponent(x).setCursorStyle(T.normal),g.instance.stopBGSound(),h.loadScene("Login")}),this),y.instance.on(m.Map_INIT_COMPLETE,this.onMapInitComp,this)},r.onMapInitComp=function(t){this.refreshRoadInfo()},r.refreshControlMode=function(){null!=P.instance&&(P.instance.controlMode==d.touch?this.controllBtn.getComponentInChildren(c).string="切换摇杆导航":this.controllBtn.getComponentInChildren(c).string="切换寻路导航")},r.refreshRoadInfo=function(){null!=b.instance.gameMap&&(this.roadBtn.node.active,p.instance.runing,b.instance.gameMap.roadLayer.active?this.roadBtn.getComponentInChildren(c).string="隐藏路点辅助线":this.roadBtn.getComponentInChildren(c).string="显示路点辅助线")},r.refreshMouseStyleInfo=function(){null!=P.instance&&(P.instance.getComponent(x).cursorStyle==T.custom?this.mouseStyleBtn.getComponentInChildren(c).string="切换普通光标":this.mouseStyleBtn.getComponentInChildren(c).string="切换自定义光标")},r.refreshMiniMapInfo=function(){null!=b.instance.gameMap&&(this.miniMapNode.active?this.miniMapBtn.getComponentInChildren(c).string="隐藏小地图":this.miniMapBtn.getComponentInChildren(c).string="显示小地图")},r.refreshFogOfWarInfo=function(){null!=f.instance&&(f.instance.node.active?this.fogOfWarBtn.getComponentInChildren(c).string="关闭战争迷雾":this.fogOfWarBtn.getComponentInChildren(c).string="打开战争迷雾")},e}(u)).prototype,"controllBtn",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=e(L.prototype,"swBtn",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=e(L.prototype,"roadBtn",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=e(L.prototype,"mouseStyleBtn",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=e(L.prototype,"miniMapBtn",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=e(L.prototype,"fogOfWarBtn",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),U=e(L.prototype,"loginBtn",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=e(L.prototype,"miniMapNode",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=L))||I)),r._RF.pop()}}})),System.register("chunks:///_virtual/TouchController.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ControlMode.ts","./CameraController.ts","./SceneManager.ts","./GameWorld.ts","./GameController.ts"],(function(t){var e,i,n,o,r,s,a,l,h,c,u,d;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,n=t._decorator,o=t.Node,r=t.Vec3,s=t.Component},function(t){a=t.ControlMode},function(t){l=t.default},function(t){h=t.default,c=t.SceneEventType},function(t){u=t.default},function(t){d=t.default}],execute:function(){var p;i._RF.push({},"3dc9cupI5hGBLjW84Y26nVc","TouchController",void 0);var f=n.ccclass;n.property,t("default",f("TouchController")(p=function(t){function i(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).gameController=null,e}e(i,t);var n=i.prototype;return n.onLoad=function(){this.gameController=this.getComponent(d)},n.start=function(){h.instance.on(c.Map_INIT_COMPLETE,this.onMapInitComp,this)},n.onMapInitComp=function(t){u.instance.gameMap.mapLayer.node.on(o.EventType.TOUCH_START,this.onTouchMap,this)},n.onTouchMap=function(t){if(this.gameController.controlMode==a.touch){if(!this.gameController.isCanControlPlayer())return;var e=t.getUILocation(),i=l.instance.getCameraPos().add(new r(e.x,e.y));u.instance.gameMap.showRoadSign(i),u.instance.gameMap.myPlayer.navTo(i.x,i.y)}},n.update=function(t){},i}(s))||p),i._RF.pop()}}})),System.register("chunks:///_virtual/TransferDoor.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Player.ts","./MapLoadModel.ts","./SceneManager.ts"],(function(t){var e,i,n,o,r,s,a,l,h,c,u,d,p,f,g;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized,r=t.createClass},function(t){s=t.cclegacy,a=t._decorator,l=t.CCString,h=t.CCInteger,c=t.Label,u=t.Vec3,d=t.Component},function(t){p=t.PlayerType},function(t){f=t.MapLoadModel},function(t){g=t.default}],execute:function(){var y,m,v,_,b,P,x,T,C;s._RF.push({},"80009haV6NEw6EaKESh1p83","TransferDoor",void 0);var N=a.ccclass,w=a.property;t("default",(y=N("TransferDoor"),m=w(l),v=w(h),_=w(c),y((x=e((P=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,n(e,"targetMapId",x,o(e)),n(e,"targetMapSpawnId",T,o(e)),n(e,"nameTxt",C,o(e)),e._objName="",e.editData=null,e}i(e,t);var s=e.prototype;return s.start=function(){},s.init=function(){},s.initEditData=function(t){this.editData=t,this.objName=t.objName,this.node.position=new u(t.x,t.y),this.targetMapId=t.targetMapId,this.targetMapSpawnId=t.targetMapSpawnId},s.toString=function(){return this.targetMapId+","+this.targetMapSpawnId},s.onTriggerEnter=function(t){null!=t&&t.playerType==p.my&&g.instance.loadMap(this.targetMapId,this.targetMapSpawnId,f.slices)},s.onTriggerExit=function(t){},r(e,[{key:"objName",get:function(){return this._objName},set:function(t){var e;this._objName=t,null==this.nameTxt&&(this.nameTxt=null==(e=this.node.getChildByName("NameTxt"))?void 0:e.getComponent(c)),this.nameTxt&&(this.nameTxt.string=this._objName)}}]),e}(d)).prototype,"targetMapId",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),T=e(P.prototype,"targetMapSpawnId",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),C=e(P.prototype,"nameTxt",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),b=P))||b)),s._RF.pop()}}})),System.register("chunks:///_virtual/Transform.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,i,n,o,r,s,a;return{setters:[function(t){e=t.inheritsLoose,i=t.createClass},function(t){n=t.cclegacy,o=t._decorator,r=t.Vec3,s=t.Quat,a=t.Node}],execute:function(){var l;n._RF.push({},"ac61eQO709OhbPj4R/fyOnz","Transform",void 0);var h=o.ccclass,c=(o.property,t("Transform",h("Transform")(l=function(t){function n(){return t.apply(this,arguments)||this}e(n,t);var o=n.prototype;return o.lookAtZ=function(t,e){var i=new r;r.subtract(i,t,this.worldPosition),i.normalize();var n=new s;s.fromViewUp(n,i.normalize(),e),this.rotation=n},o.find=function(t){return this.getChildByPath(t)},o.getComponentInParent=function(t){var e=t,i=this.getComponent(e);return i||(i=this.searchParentComponent(this,e)),i},o.searchParentComponent=function(t,e){var i=e,n=null;if(t.parent){if(n=t.parent.getComponent(i))return n;if(n=this.searchParentComponent(t.parent,e))return n}return n},i(n,[{key:"transform",get:function(){return this}},{key:"gameObject",get:function(){return this}}]),n}(a))||l));a.prototype.lookAtZ=c.prototype.lookAtZ,a.prototype.find=c.prototype.find,a.prototype.getComponentInParent=c.prototype.getComponentInParent,a.prototype.searchParentComponent=c.prototype.searchParentComponent,n._RF.pop()}}})),System.register("chunks:///_virtual/UIManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseView.ts"],(function(t){var e,i,n,o,r,s,a,l,h;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized,r=t.createClass},function(t){s=t.cclegacy,a=t._decorator,l=t.Component},function(t){h=t.default}],execute:function(){var c,u,d,p,f,g,y,m,v,_,b,P;s._RF.push({},"982bbK3WGNJDYkotH4k9yAT","UIManager",void 0);var x=a.ccclass,T=a.property;t("default",(c=x("UIManager"),u=T(h),d=T(h),p=T(h),f=T(h),c(((P=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,n(e,"introduceView",m,o(e)),n(e,"helpView",v,o(e)),n(e,"equipShopView",_,o(e)),n(e,"getPrjView",b,o(e)),e}i(e,t);var s=e.prototype;return s.onLoad=function(){e._instance=this},s.start=function(){},s.init=function(){},s.update=function(t){},r(e,null,[{key:"instance",get:function(){return this._instance}}]),e}(l))._instance=void 0,m=e((y=P).prototype,"introduceView",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=e(y.prototype,"helpView",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=e(y.prototype,"equipShopView",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),b=e(y.prototype,"getPrjView",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),g=y))||g)),s._RF.pop()}}})),System.register("chunks:///_virtual/Unit.ts",["./rollupPluginModLoBabelHelpers.js","cc","./PathFindingAgent.ts","./Behaviour.ts","./MovieClip.ts","./FogOfWar.ts"],(function(t){var e,i,n,o,r,s,a,l,h,c,u,d,p,f,g;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized,r=t.createClass},function(t){s=t.cclegacy,a=t._decorator,l=t.Label,h=t.CCInteger,c=t.CCFloat,u=t.Vec3},function(t){d=t.default},function(t){p=t.Behaviour},function(t){f=t.default},function(t){g=t.FogOfWar}],execute:function(){var y,m,v,_,b,P,x,T,C,N,w,M,S,k,D;t("UnitState",void 0),s._RF.push({},"a08d9zbMORNCbXaFHT6BlYT","Unit",void 0);var R,A=a.ccclass,I=a.property;!function(t){t[t.none=0]="none",t[t.idle=1]="idle",t[t.walk=2]="walk",t[t.attack=3]="attack",t[t.death=4]="death"}(R||(R=t("UnitState",{}))),t("default",(y=A("Unit"),m=I(l),v=I(h),_=I(h),b=I(c),P=I(h),x=I(h),y((N=e((C=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))||this)._movieClip=null,n(e,"nameTxt",N,o(e)),n(e,"id",w,o(e)),n(e,"type",M,o(e)),n(e,"moveSpeed",S,o(e)),n(e,"hp",k,o(e)),n(e,"mp",D,o(e)),e._direction=0,e._state=R.none,e._objName="",e._lastPos=null,e._mapPos=null,e}i(e,t);var s=e.prototype;return s.onLoad=function(){t.prototype.onLoad.call(this)},s.start=function(){this.state=R.idle},s.update=function(t){var e=this.mapPos;(null==this._lastPos||Math.abs(e.x-this._lastPos.x)>1||Math.abs(e.y-this._lastPos.y)>1)&&(null==this._lastPos&&(this._lastPos=new u),this._lastPos.x=e.x,this._lastPos.y=e.y,this.onPosChange())},s.onPosChange=function(){null!=g.instance&&g.instance.drawOval(this.x,this.y+35,80,120)},s.rotateToPos=function(t,e){var i=t-this.node.position.x,n=e-this.node.position.y,o=Math.atan2(n,i),r=Math.round((-o+Math.PI)/(Math.PI/4));this.direction=r>5?r-6:r+2},s.setFaceDir=function(t){var e=Math.atan2(t.y,t.x),i=Math.round((-e+Math.PI)/(Math.PI/4));this.direction=i>5?i-6:i+2},s.lookAtTarget=function(t){var e=t.position.clone().subtract(this.node.position);this.setFaceDir(e)},s.getRoundRoadNodes=function(){return d.instance.getRoundRoadNodes(this.roadNode)},s.destroySelf=function(){this.node.destroy()},r(e,[{key:"movieClip",get:function(){return this._movieClip||(this._movieClip=this.node.getComponentInChildren(f)),this._movieClip}},{key:"direction",get:function(){return this._direction},set:function(t){this._direction=t}},{key:"state",get:function(){return this._state},set:function(t){this._state=t}},{key:"objName",get:function(){return this._objName},set:function(t){var e;this._objName=t,null==this.nameTxt&&(this.nameTxt=null==(e=this.node.getChildByName("NameTxt"))?void 0:e.getComponent(l)),this.nameTxt&&(this.nameTxt.string=this._objName)}},{key:"roadNode",get:function(){return d.instance.getRoadNodeByPixel(this.node.position.x,this.node.position.y)}},{key:"mapPos",get:function(){return null==this._mapPos&&(this._mapPos=this.node.position.clone()),this._mapPos.x=Math.floor(this.node.position.x),this._mapPos.y=Math.floor(this.node.position.y),this._mapPos}}]),e}(p)).prototype,"nameTxt",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=e(C.prototype,"id",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),M=e(C.prototype,"type",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),S=e(C.prototype,"moveSpeed",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 200}}),k=e(C.prototype,"hp",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),D=e(C.prototype,"mp",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),T=C))||T)),s._RF.pop()}}})),s="virtual:///prerequisite-imports/main",a="chunks:///_virtual/main",System.register(s,[a],(function(t,e){return{setters:[function(e){var i={};for(var n in e)"default"!==n&&"__esModule"!==n&&(i[n]=e[n]);t(i)}],execute:function(){}}})),t("default",n.exports)}),{})}}}));

System.register("chunks:///_virtual/rodeTest.mjs_cjs=&original=.js",["./rodeTest.js","./cjs-loader.mjs"],(function(e,t){var r,s;return{setters:[function(t){r=t.__cjsMetaURL;var s={};s.__cjsMetaURL=t.__cjsMetaURL,s.default=t.default,e(s)},function(e){s=e.default}],execute:function(){r||s.throwInvalidWrapper("./rodeTest.js",t.meta.url),s.require(r)}}}));

System.register("chunks:///_virtual/RunDemoCtrl.ts",["./rollupPluginModLoBabelHelpers.js","cc","./EntityCtrl.ts","./CameraCtrl.ts","./TickMgr.ts"],(function(t){var n,e,r,i,a,c;return{setters:[function(t){n=t.createClass},function(t){e=t.cclegacy,r=t._decorator},function(t){i=t.EntityCtrl},function(t){a=t.CameraCtrl},function(t){c=t.TickMgr}],execute:function(){var u,s;e._RF.push({},"a04f8Lhpr9PNYNPrdGCrSWe","RunDemoCtrl",void 0);var o=r.ccclass;r.property,t("RunDemoCtrl",o("RunDemoCtrl")(((s=function(){function t(){this.entity=void 0,this.camera=void 0}var e=t.prototype;return e.init=function(t,n,e){var r=this;r.entity||(r.entity=new i(n)),r.camera||(r.camera=new a(t,e)),r.camera.focusTarget(r.entity.player.node),c.inst.addTick(r.update,r)},e.update=function(t){this.entity.update(t),this.camera.update(t)},e.clear=function(){var t=this;c.inst.rmTick(t.update),t.camera.clear(),t.camera=null,t.entity.clear(),t.entity=null},n(t,null,[{key:"inst",get:function(){return this._inst||(this._inst=new t),this._inst}}]),t}())._inst=void 0,u=s))||u);e._RF.pop()}}}));

System.register("chunks:///_virtual/ScaleMode.ts",["cc"],(function(e){var i;return{setters:[function(e){i=e.cclegacy}],execute:function(){i._RF.push({},"3eb9bycP2VO67rQpBpccgLK","ScaleMode",void 0);var t=e("ScaleMode",(function(){this.designWidth=void 0,this.designHeight=void 0,this.designWidth_min=void 0,this.designWidth_max=void 0}));e("scaleMode",new t);i._RF.pop()}}}));

System.register("chunks:///_virtual/SceneMgr.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseUtil.ts","./ModuleMgr.ts","./ResMgr.ts"],(function(e){var n,t,s,c,i,r,a;return{setters:[function(e){n=e.createClass},function(e){t=e.cclegacy,s=e.director,c=e.js},function(e){i=e.BaseUT},function(e){r=e.moduleInfoMap},function(e){a=e.ResMgr}],execute:function(){t._RF.push({},"a941dXizqpFVaFQ7laZBP4g","SceneMgr",void 0),e("SceneMgr",function(){function e(){this.curScene=void 0,this.curSceneName=void 0,this.mainScene=void 0,this._popArr=void 0,this._canvas=void 0}var t=e.prototype;return t.getCanvas=function(){return this._canvas||(this._canvas=s.getScene().getChildByName("Canvas")),this._canvas},t.getUCamera=function(){return this._canvas||(this._canvas=s.getScene().getChildByName("Canvas")),this.getCanvas().getChildByName("UICamera")},t.run=function(e,n){this.showScene(e,n)},t.push=function(e,n){this.showScene(e,n,!0)},t.showScene=function(e,n,t){var s="string"==typeof e?e:c.getClassName(e);if(!this.curScene||this.curScene.className!=s){var i=r[s];i?(a.inst.curSceneName=this.curSceneName=s,i.preResList&&i.preResList.length>0?a.inst.loadTo(s,i.preResList,this.onUILoaded.bind(this,i,n,t)):this.onUILoaded(i,n,t)):console.error("未注册模块："+s)}},t.onUILoaded=function(e,n,t){t&&this.curScene?(this._popArr.push(this.curScene),this.curScene.removeFromParent()):this.checkDestoryLastScene(!t);var s=e.name,c=i.newUINode(s),r=this.curScene=c.addComponent(s);r.setData(n),r.addToGRoot()},t.checkDestoryLastScene=function(e){if(this.curScene){e&&this.curScene.destory();var n=r[this.curScene.className];e&&!n.cacheEnabled&&a.inst.releaseResModule(this.curScene.className)}},t.pop=function(){var e=this;e._popArr.length<=0?console.error("已经pop到底了!!!!!"):(e.checkDestoryLastScene(!0),e.curScene=e._popArr.pop(),a.inst.curSceneName=e.curSceneName=e.curScene.className,e.curScene.addToGRoot())},n(e,null,[{key:"inst",get:function(){return this._inst||(this._inst=new e,this._inst._popArr=[]),this._inst}}]),e}())._inst=void 0,t._RF.pop()}}}));

System.register("chunks:///_virtual/SoundMgr.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ResMgr.ts","./SceneMgr.ts"],(function(i){var t,u,o,n,s,e;return{setters:[function(i){t=i.createClass},function(i){u=i.cclegacy,o=i.director,n=i.AudioSource},function(i){s=i.ResMgr},function(i){e=i.SceneMgr}],execute:function(){u._RF.push({},"02b44GWMgJC0r9GQeJaiosG","SoundMgr",void 0),i("SoundMgr",function(){function i(){this.buttonSound=void 0,this.bgVolume=1,this.musicCacheMaxCount=5,this.musicCachePool=[],this._bgMusicEnable=!0,this._soundEffEnable=!0,this._defaultBgMusic=void 0,this.curBgMusic=void 0,this._isStopBg=void 0,this._audioSource=void 0}var u=i.prototype;return u.playMainBg=function(){this.defaultBgMusic&&this.playBg(this.defaultBgMusic)},u.playBg=function(i){var t=this;if(i&&t.bgMusicEnable&&t.curBgMusic!=i){t._isStopBg=!1,t.curBgMusic=i;var u=this.bgAudioSource;s.inst.loadToWithoutJuHua("global",i,(function(){var o=s.inst.get(i);t.curBgMusic==i&&o&&(u.stop(),u.clip=o,u.loop=!0,u.volume=t.bgVolume,t._isStopBg||u.play(),-1==t.musicCachePool.indexOf(i)&&t.musicCachePool.push(i),t.checkRealseMusic())}),t)}},u.stopBg=function(){this._isStopBg=!0,this.bgAudioSource.stop()},u.pauseBg=function(){this.bgMusicEnable&&(this._isStopBg=!0,this.bgAudioSource.pause())},u.recoverBg=function(){this.bgMusicEnable&&(this._isStopBg=!1,this.bgAudioSource.play())},u.playSound=function(i,t){var u=this;if(u.soundEffEnable){var o=u.soundAudioSource;s.inst.loadWithoutJuHua(i,(function(){var n=s.inst.get(i);if(!n)throw"音效资源不存在: "+i;o.loop=t,o.clip=n,t?o.play():o.playOneShot(n),-1==u.musicCachePool.indexOf(i)&&u.musicCachePool.push(i),u.checkRealseMusic()}),u)}},u.checkRealseMusic=function(){var i=this;if(i.musicCachePool.length>i.musicCacheMaxCount){var t=i.musicCachePool.shift();s.inst.releaseRes(t)}},u.playClickSound=function(){this.soundEffEnable&&(this.buttonSound?this.playSound(this.buttonSound):console.warn("请先设置buttonSound点击音效资源路径"))},u.playSoundByAudioClip=function(i,t){if(this.soundEffEnable)if(i){var u=this.soundAudioSource;u.clip=i,t?u.play():u.playOneShot(i)}else console.warn("音频资源为空！！")},t(i,[{key:"bgMusicEnable",get:function(){return this._bgMusicEnable},set:function(i){var t=this;if(t._bgMusicEnable=i,i){var u=t.curBgMusic;t.curBgMusic=null,t.playBg(u)}else t.stopBg()}},{key:"soundEffEnable",get:function(){return this._soundEffEnable},set:function(i){this._soundEffEnable=i}},{key:"defaultBgMusic",get:function(){return this._defaultBgMusic},set:function(i){this._defaultBgMusic=i}},{key:"bgAudioSource",get:function(){if(!this._audioSource){var i=o.getScene().getChildByName("Main");this._audioSource=i.getComponent(n)}return this._audioSource}},{key:"soundAudioSource",get:function(){var i=e.inst.getCanvas(),t=i.getComponent(n);return i.getComponent(n)||(t=i.addComponent(n)),t}}],[{key:"inst",get:function(){return this._inst||(this._inst=new i),this._inst}}]),i}())._inst=void 0,u._RF.pop()}}}));

System.register("chunks:///_virtual/Sp.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseEnum.ts","./ResMgr.ts"],(function(t){var e,r,n,a,i,o,l,u,p,s,c;return{setters:[function(t){e=t.applyDecoratedDescriptor,r=t.inheritsLoose,n=t.initializerDefineProperty,a=t.assertThisInitialized},function(t){i=t.cclegacy,o=t._decorator,l=t.CCInteger,u=t.Sprite,p=t.Component},function(t){s=t.BaseEnum},function(t){c=t.ResMgr}],execute:function(){var m,_,f,y,v,d,C,b,h,F,g,I,S,P,w;i._RF.push({},"23b5fG1JTNG37FwQDevRbsf","Sp",void 0);var z=o.ccclass,R=o.property;t("Sp",(m=z("Sp"),_=R({tooltip:"是否自动播放"}),f=R({tooltip:"播放帧频",type:l}),y=R({tooltip:"播放次数,-1表示循环播放",type:l}),v=R({tooltip:"资源路径"}),d=R({tooltip:"开始帧"}),C=R({tooltip:"结束帧"}),m((F=e((h=function(t){function e(){for(var e,r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i))||this,n(e,"autoPlay",F,a(e)),n(e,"frameRate",g,a(e)),n(e,"playCount",I,a(e)),n(e,"url",S,a(e)),n(e,"startFrame",P,a(e)),n(e,"endFrame",w,a(e)),e._sprite=void 0,e._url=void 0,e._spriteFrames=void 0,e._curPlayFrame=0,e._playCount=0,e._isStop=void 0,e._loadCompleted=void 0,e._intervalTime=void 0,e}r(e,t);var i=e.prototype;return i.onLoad=function(){var t=this;t._sprite=t.node.getComponent(u),t._sprite||(t._sprite=t.node.addComponent(u)),""!=t.url&&(t.setUrl(t.url),t.autoPlay&&t.play(t.playCount))},i.setUrl=function(t){this._url!=t&&(this._url=t)},i.play=function(t){void 0===t&&(t=-1);var e=this;e._url?(e._playCount=0,e._curPlayFrame=e.startFrame,e.playCount=t,e._isStop=!1,c.inst.get(e._url)?r():c.inst.loadWithoutJuHua(e._url,(function(){r()}),e)):console.error("请先设置资源路径！！！");function r(){var t=c.inst.get(e._url);e._spriteFrames=t.getSpriteFrames(),e._loadCompleted=!0,e.doInterval()}},i.stop=function(){this._isStop=!0},i.doInterval=function(){var t=this;if(clearInterval(t._intervalTime),!t.checkClearInterval()){var e=1e3/t.frameRate;r(),t._intervalTime=setInterval((function(){r()}),e)}function r(){if(!t.checkClearInterval()){var e=t.endFrame?t.endFrame:t._spriteFrames.length,r=t._curPlayFrame;r==e-1&&(t._curPlayFrame=t.startFrame-1,-1!=t.playCount&&(t._playCount++,t._playCount==t.playCount&&(t.node.emit(s.Game.onSpPlayEnd),t._isStop=!0))),t._sprite&&(t._sprite.spriteFrame=t._spriteFrames[r]),t._curPlayFrame++}}},i.checkClearInterval=function(){var t=this;return!(t.node&&!t._isStop&&t._loadCompleted&&(-1==t.playCount||t.playCount!=t._playCount))&&(clearInterval(t._intervalTime),!0)},i.onEnable=function(){this.doInterval()},i.onDisable=function(){clearInterval(this._intervalTime)},i.onDestroy=function(){clearInterval(this._intervalTime)},e}(p)).prototype,"autoPlay",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),g=e(h.prototype,"frameRate",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 24}}),I=e(h.prototype,"playCount",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),S=e(h.prototype,"url",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),P=e(h.prototype,"startFrame",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),w=e(h.prototype,"endFrame",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),b=h))||b));i._RF.pop()}}}));

System.register("chunks:///_virtual/SubLayerMgr.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(r){var e,s,t,a;return{setters:[function(r){e=r.asyncToGenerator,s=r.regeneratorRuntime},function(r){t=r.cclegacy,a=r.js}],execute:function(){t._RF.push({},"5f31br6NPZC2o9Ho5D4TRCD","SubLayerMgr",void 0);r("SubLayerMgr",function(){function r(){this._classMap=void 0,this.curLayer=void 0,this._popArr=void 0,this._classMap={},this._popArr=[]}var t=r.prototype;return t.register=function(r,e){var s=r.__className;this._classMap[s]=r},t.run=function(r,e){this._show(r,e)},t.push=function(r,e){this._show(r,e,!0)},t._show=function(){var r=e(s().mark((function r(e,t,c){var i,o,n,u;return s().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(i="string"==typeof e?a.getClassByName(e):e,o=a.getClassName(i),!this.curLayer||this.curLayer.scriptName!=o){r.next=4;break}return r.abrupt("return");case 4:if(n=this._classMap[o],u=!n&&!c,this.checkDestoryLastLayer(u),this.curLayer&&(c&&this._popArr.push(this.curLayer),!c&&u||this.curLayer.removeSelf()),!n||!n.node){r.next=12;break}return this.curLayer=n,this.curLayer.addSelf(),r.abrupt("return");case 12:return r.next=14,i.show(t);case 14:this.curLayer=r.sent,this._classMap[o]&&(this._classMap[o]=this.curLayer);case 16:case"end":return r.stop()}}),r,this)})));return function(e,s,t){return r.apply(this,arguments)}}(),t.checkDestoryLastLayer=function(r){r&&this.curLayer&&!this.curLayer.isDestory&&this.curLayer.close()},t.pop=function(){var r=this;r._popArr.length<=0?console.error("已经pop到底了!"):(r.checkDestoryLastLayer(!0),r.curLayer=r._popArr.pop(),r.curLayer.addSelf())},t.releaseAllLayer=function(){this.checkDestoryLastLayer(!0);for(var r=0;r<this._popArr.length;r++){var e=this._popArr[r];e.isDestory||e.close()}for(var s in this._classMap){var t=this._classMap[s];t.node&&!t.hasDestory&&t.close()}this._popArr=[]},t.dispose=function(){var r=this;r.releaseAllLayer(),r._classMap=null,r._popArr=null},r}());t._RF.pop()}}}));

System.register("chunks:///_virtual/TestAStar.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseUtil.ts","./TickMgr.ts","./UIComp.ts","./Sp.ts","./MessageTip.ts","./AStar.ts","./Grid.ts"],(function(e){var i,t,r,o,a,l,n,c,s,p,g,h,_,d,f,u,y,v,S,z,P,b,m;return{setters:[function(e){i=e.applyDecoratedDescriptor,t=e.inheritsLoose,r=e.initializerDefineProperty,o=e.assertThisInitialized,a=e.createClass},function(e){l=e.cclegacy,n=e._decorator,c=e.Node,s=e.Graphics,p=e.Label,g=e.Prefab,h=e.Widget,_=e.instantiate,d=e.Vec3,f=e.Vec2,u=e.UITransform},function(e){y=e.BaseUT},function(e){v=e.TickMgr},function(e){S=e.UIComp},function(e){z=e.Sp},function(e){P=e.MessageTip},function(e){b=e.AStar},function(e){m=e.Grid}],execute:function(){var w,x,M,k,T,C,L,I,G,B,D,U,A,N,E,R,W,H,V,X,F,q,K,j,J;l._RF.push({},"8b043nbxsBM36mMcsp/GyKK","TestAStar",void 0);var O=n.ccclass,Q=n.property;e("TestAStar",(w=O("TestAStar"),x=Q({type:c}),M=Q({type:s}),k=Q({type:s}),T=Q({type:s}),C=Q({type:s}),L=Q({type:z}),I=Q({type:p}),G=Q({type:c}),B=Q({type:g}),D=Q({type:c}),U=Q({type:g}),w((E=i((N=function(e){function i(){for(var i,t=arguments.length,a=new Array(t),l=0;l<t;l++)a[l]=arguments[l];return i=e.call.apply(e,[this].concat(a))||this,r(i,"grp_container",E,o(i)),r(i,"graphicsGrid",R,o(i)),r(i,"graphicsBlock",W,o(i)),r(i,"graphicsPath",H,o(i)),r(i,"graphicsPlayer",V,o(i)),r(i,"sp_player",X,o(i)),r(i,"lbl_cost",F,o(i)),r(i,"groundParent",q,o(i)),r(i,"ground",K,o(i)),r(i,"wallParent",j,o(i)),r(i,"wall",J,o(i)),i._widget=void 0,i._cellSize=void 0,i._grid=void 0,i._index=void 0,i._path=void 0,i._speed=void 0,i._prePos=void 0,i._toDistance=void 0,i._moveDir=void 0,i}t(i,e);var l=i.prototype;return l.onFirstEnter=function(){var e=this;e._cellSize=40,e._speed=300,e._widget=e.getComponent(h),v.inst.nextTick((function(){e.initGrid(),e.onReset()}),this)},l.initGrid=function(){var e=this,i=e.screenWh,t=i[0],r=i[1],o=Math.floor(t/e._cellSize),a=Math.floor(r/e._cellSize);e._grid=new m,e._grid.init(o,a);var l=e.graphicsGrid;l.clear(),l.lineWidth=3;for(var n=0;n<o+1;n++)l.moveTo(n*e._cellSize,0),l.lineTo(n*e._cellSize,a*e._cellSize);for(var c=0;c<a+1;c++)l.moveTo(0,c*e._cellSize),l.lineTo(o*e._cellSize,c*e._cellSize);l.stroke();for(var s=o*a,p=0;p<s;p++){var g=_(this.ground);this.groundParent.addChild(g)}},l.makeBlock=function(){var e=this,i=e.graphicsBlock;i.clear();var t=this.wallParent;t.removeAllChildren();for(var r=Math.floor(e._grid.numCols*e._grid.numRows/4),o=0;o<r;o++){var a=Math.floor(Math.random()*e._grid.numCols),l=Math.floor(Math.random()*e._grid.numRows);e._grid.setWalkable(a,l,!1);var n=e._grid.getNode(a,l);i.fillColor.fromHEX(e.getColor(n)),i.rect(a*e._cellSize,l*e._cellSize,e._cellSize,e._cellSize),i.fill();var c=_(this.wall);t.addChild(c),c.setPosition(new d(a*e._cellSize,l*e._cellSize))}},l.makePlayer=function(){var e=this;e.graphicsPlayer.clear(),e.graphicsPlayer.fillColor.fromHEX("#ff0000"),e.graphicsPlayer.circle(0,0,13),e.graphicsPlayer.fill();var i=e._grid.getRanDomStartPos(),t=i.x*e._cellSize+e._cellSize/2,r=i.y*e._cellSize+e._cellSize/2;e.graphicsPlayer.node.setPosition(t,r),e.sp_player.node.setPosition(e.graphicsPlayer.node.position)},l._tap_grp_container=function(e){var i=this,t=e.getUILocation();console.log("getUILocation: "+e.getUILocation()),console.log("getLocationInView: "+e.getLocationInView()),console.log("getLocation: "+e.getLocation()),console.log("getPreviousLocation: "+e.getPreviousLocation()),console.log("getStartLocation: "+e.getStartLocation()),console.log("getUIStartLocation: "+e.getUIStartLocation()),t.y-=(y.getStageSize().height-y.getLayerScaleSize().height)/2+i._widget.bottom,i.graphicsPath.clear();var r=Math.floor(t.x/i._cellSize),o=Math.floor(t.y/i._cellSize);if(i._grid.getNode(r,o)){i._grid.setEndNode(r,o);var a=i._grid.endNode;a.walkable&&(i.graphicsPath.fillColor.fromHEX(i.getColor(a)),i.graphicsPath.rect(r*i._cellSize,o*i._cellSize,i._cellSize,i._cellSize),i.graphicsPath.fill());var l=i.graphicsPlayer.node.position;r=Math.floor(l.x/i._cellSize),o=Math.floor(l.y/i._cellSize),i._grid.setStartNode(r,o),i.findPath()}},l.findPath=function(){var e=this,i=new b;if(i.findPath(e._grid)){e.lbl_cost.string="本次寻路总耗时: "+i.costTotTime+"ms",e._path=i.path,e._index=0;for(var t=e._path.length-1,r=0;r<t;r++){var o=e._path[r];e.graphicsPath.fillColor.fromHEX("#ffff00"),e.graphicsPath.rect(o.x*e._cellSize,o.y*e._cellSize,e._cellSize,e._cellSize),e.graphicsPath.fill()}e.refMoveInfo()}else P.show({msg:"没找到最佳节点，无路可走!"})},l.update=function(e){var i=this;if(i._path&&i._path.length&&!(i._index>=i._path.length)){var t=i.sp_player.node.position,r=t.x-i._prePos.x,o=t.y-i._prePos.y;if(Math.sqrt(r*r+o*o)>=i._toDistance)i._index++,i._index<i._path.length&&i.refMoveInfo();else{var a=new d(t.x,t.y),l=new d(t.x+e*i._speed*i._moveDir.x,t.y+e*i._speed*i._moveDir.y);if(i.graphicsPlayer.node.setPosition(l),i.sp_player.node.setPosition(l),l.x!=a.x&&Math.abs(l.x-a.x)>.5){var n=l.x>a.x?1:-1;i.sp_player.node.setScale(Math.abs(i.sp_player.node.scale.x)*n,i.sp_player.node.scale.y)}}}},l.refMoveInfo=function(){var e=this,i=e.sp_player.node.position;e._prePos=new f(i.x,i.y);var t=e._path[e._index],r=new f(t.x*e._cellSize+e._cellSize/2,t.y*e._cellSize+e._cellSize/2),o=r.x-e._prePos.x,a=r.y-e._prePos.y;e._toDistance=Math.sqrt(o*o+a*a),e._moveDir=new f(o,a).normalize()},l.onReset=function(){var e=this;e._path=null,e.graphicsPath.clear(),e._grid.resetWalkable(),e.makeBlock(),e.makePlayer()},l.showGrid=function(){var e=this;e.graphicsGrid.node.active=!e.graphicsGrid.node.active,e.graphicsBlock.node.active=!e.graphicsBlock.node.active,e.graphicsPlayer.node.active=!e.graphicsPlayer.node.active,e.graphicsPath.node.active=!e.graphicsPath.node.active},l.getColor=function(e){return e.walkable?e==this._grid.startNode?"#cccccc":e==this._grid.endNode?"#ff0000":"#ffffff":"#000000"},l.onExit=function(){},a(i,[{key:"screenWh",get:function(){var e=this.grp_container.getComponent(u);return[e.contentSize.width,e.contentSize.height]}}]),i}(S)).prototype,"grp_container",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),R=i(N.prototype,"graphicsGrid",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),W=i(N.prototype,"graphicsBlock",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H=i(N.prototype,"graphicsPath",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),V=i(N.prototype,"graphicsPlayer",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),X=i(N.prototype,"sp_player",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),F=i(N.prototype,"lbl_cost",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),q=i(N.prototype,"groundParent",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),K=i(N.prototype,"ground",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),j=i(N.prototype,"wallParent",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),J=i(N.prototype,"wall",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),A=N))||A));l._RF.pop()}}}));

System.register("chunks:///_virtual/TestAstarDlg.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIDlg.ts","./MessageTip.ts","./PathFindingAgent.ts","./CONST.ts"],(function(t){var e,i,r,n,a,s,l,u,o,p,c,b;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,r=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){a=t.cclegacy,s=t._decorator,l=t.EditBox,u=t.Button},function(t){o=t.UIDlg},function(t){p=t.MessageTip},function(t){c=t.default},function(t){b=t.CONST}],execute:function(){var g,_,f,d,y,m,h,w,T,A,z,D,v,N,X,Y,E,U,k,P;a._RF.push({},"bf64cyhUH1ET6i96LImuPCW","TestAstarDlg",void 0);var x=s.ccclass,G=s.property;t("TestAstarDlg",(g=x("TestAstarDlg"),_=G({type:l}),f=G({type:l}),d=G({type:l}),y=G({type:l}),m=G({type:l}),h=G({type:u}),w=G({type:u}),T=G({type:u}),g(((P=function(t){function e(){for(var e,i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return e=t.call.apply(t,[this].concat(a))||this,r(e,"input_startX",D,n(e)),r(e,"input_startY",v,n(e)),r(e,"input_endX",N,n(e)),r(e,"input_endY",X,n(e)),r(e,"input_radius",Y,n(e)),r(e,"btn_ok",E,n(e)),r(e,"btn_clear",U,n(e)),r(e,"btn_close",k,n(e)),e}i(e,t);var a=e.prototype;return a.onEnter=function(){this.input_startX.string="1920",this.input_startY.string="5280"},a._tap_btn_ok=function(){var t=this;if(""!=t.input_startX.string)if(""!=t.input_startY.string)if(""!=t.input_endX.string)if(""!=t.input_endY.string){var e=Number(t.input_radius.string||25),i=c.inst.seekPath(Number(t.input_startX.string),Number(t.input_startY.string),Number(t.input_endX.string),Number(t.input_endY.string),e);i&&i.length?t.emit(b.GEVT.UpdateAstarGrid,{roadNodeArr:i}):p.show({msg:"未找到最佳路线"})}else p.show({msg:"终点y不能为空"});else p.show({msg:"终点x不能为空"});else p.show({msg:"起始y不能为空"});else p.show({msg:"起始x不能为空"})},a._tap_btn_clear=function(){this.emit(b.GEVT.UpdateAstarGrid,{roadNodeArr:[]})},e}(o)).prefabUrl="prefab/mapEditor/dlg/TestAstarDlg",D=e((z=P).prototype,"input_startX",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),v=e(z.prototype,"input_startY",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N=e(z.prototype,"input_endX",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),X=e(z.prototype,"input_endY",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Y=e(z.prototype,"input_radius",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),E=e(z.prototype,"btn_ok",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),U=e(z.prototype,"btn_clear",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k=e(z.prototype,"btn_close",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),A=z))||A));a._RF.pop()}}}));

System.register("chunks:///_virtual/TickMgr.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(i){var t,c;return{setters:[function(i){t=i.createClass},function(i){c=i.cclegacy}],execute:function(){c._RF.push({},"cdf37IWqL9E65bcFUDCbVgL","TickMgr",void 0),i("TickMgr",function(){function i(){this.mainNode=void 0,this._tickIndex=void 0,this._tickMap=void 0}var c=i.prototype;return c.onTick=function(i){if(this._tickMap)for(var t in this._tickMap){var c=this._tickMap[t];c.cb.call(c.ctx,i)}},c.addTick=function(i,t){this._tickMap||(this._tickIndex=0,this._tickMap={});var c=i.__tickIndex__;if(!c||!this._tickMap[c]){var n=++this._tickIndex;i.__tickIndex__=n,this._tickMap[n]={cb:i,ctx:t}}},c.rmTick=function(i){var t=i.__tickIndex__;this._tickMap&&this._tickMap[t]&&(delete i.__tickIndex__,delete this._tickMap[t])},c.nextTick=function(i,t){this.mainNode.scheduleOnce((function(){i&&i.call(t)}))},t(i,null,[{key:"inst",get:function(){return this._inst||(this._inst=new i),this._inst}}]),i}())._inst=void 0,c._RF.pop()}}}));

System.register("chunks:///_virtual/UIComp.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Emmiter.ts","./List.ts","./ListItem.ts"],(function(t){var e,n,r,i,o,a,s,c,u,l,f,d,_,p;return{setters:[function(t){e=t.inheritsLoose,n=t.createClass},function(t){r=t.cclegacy,i=t._decorator,o=t.js,a=t.Component,s=t.Node,c=t.tween,u=t.Tween},function(t){l=t.emmiter},function(t){f=t.List,d=t.SelectedType_List,_=t.SlideType},function(t){p=t.ListItem}],execute:function(){var v,h;r._RF.push({},"81dafeqZrRPbL2Eqic192xt","UIComp",void 0);var m=i.ccclass;i.property,t("UIComp",m("UIComp")(((h=function(t){function r(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))||this)._emmitMap=void 0,e._objTapMap=void 0,e._tweenTargetList=void 0,e.data=void 0,e.isFirstEnter=!0,e.scriptName=void 0,e.isEnter=void 0,e.isDestory=void 0,e.needRefreshListOnEnter=!0,e.timeoutIdArr=void 0,e.intervalIdArr=void 0,e}e(r,t);var i=r.prototype;return i.__preload=function(){var t=this;t.ctor_b(),t.ctor(),t.ctor_a()},i.onLoad=function(){this.scriptName=o.getClassName(this)},i.onEnable=function(){this.__doEnter()},i.onDisable=function(){this.__dispose()},i.onDestroy=function(){this.isDestory=!0},i.update=function(t){},i.ctor_b=function(){},i.ctor=function(){},i.ctor_a=function(){},i.onEnter_b=function(){},i.onEnter=function(){},i.onFirstEnter=function(){},i.onEnter_a=function(){},i.dchg_b=function(){},i.dchg=function(){},i.dchg_a=function(){},i.onExit_b=function(){},i.onExit=function(){},i.onExit_a=function(){},i.onEmitter=function(t,e){var n=this;l.on(t,e,n),n._emmitMap||(n._emmitMap={}),n._emmitMap[t]=e},i.unEmitter=function(t,e){l.off(t,e,this)},i.emit=function(t,e){l.emit(t,e)},i.setData=function(t){var e=this;e.data!=t&&(e.data=t,e.dchg_b(),e.dchg(),e.dchg_a())},i.__doEnter=function(){var t=this;t.isEnter||(t.isEnter=!0,t.addListener(),console.log("进入："+t.scriptName),t.onEnter_b(),t.onEnter(),t.isFirstEnter&&(t.isFirstEnter=!1,t.onFirstEnter()),t.onEnter_a(),t.refreshAllList())},i.addListener=function(){var t=this;for(var e in t._objTapMap={},t){var n=t[e];if(n){var r="_tap_"+e;if(t[r]&&(n instanceof a||n instanceof s)){var i=s.EventType.TOUCH_END,o=n instanceof a?n.node:n;o.on(i,t.onNodeClick,t),t._objTapMap[r+"&"+i]=o}}}},i.onNodeClick=function(t){this["_tap_"+t.currentTarget.name](t)},i.refreshAllList=function(){var t=this;if(t.needRefreshListOnEnter)for(var e in t){if(t[e])t["_data_"+e]&&t.refreshList(e)}},i.refreshList=function(t){var e=this,n=e[t];if(!n)return console.warn("找不到id为"+t+"的列表");var r=n.getComponent(f);if(!r)return console.warn("列表"+t+"没有绑定List脚本");r.nodeName=t,r.renderEvent.target=e.node,r.renderEvent.component=e.scriptName,r.renderEvent.handler="__onListRender",r.selectedMode!=d.NONE&&(r.selectedEvent.target=e.node,r.selectedEvent.component=e.scriptName,r.selectedEvent.handler="__onSelectEvent"),r.slideMode==_.PAGE&&(r.pageChangeEvent.target=e.node,r.pageChangeEvent.component=e.scriptName,r.pageChangeEvent.handler="__onPageChangeEvent");var i=e["_data_"+t]();r.dataList=i||[]},i.__onListRender=function(t,e){var n=t.getComponent(p),r=n.list.dataList[e];n.setData(r)},i.__onSelectEvent=function(t,e,n,r){var i=t.getComponent(p),o=i.list.nodeName;this["_select_"+o]&&this["_select_"+o](i.data,e,n)},i.__onPageChangeEvent=function(t,e){var n=t.nodeName;this["_pageChange_"+n]&&this["_pageChange_"+n](e)},i.getTween=function(t){return this._tweenTargetList||(this._tweenTargetList=[]),-1==this._tweenTargetList.indexOf(t)&&this._tweenTargetList.push(t),c(t)},i.rmTween=function(t){u.stopAllByTarget(t)},i.rmAllTweens=function(){if(this._tweenTargetList)for(var t=0;t<this._tweenTargetList.length;t++)this.rmTween(this._tweenTargetList[t]);this._tweenTargetList=null},i.setTimeout=function(t){function e(e,n){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(t,e){var n=this;this.timeoutIdArr||(this.timeoutIdArr=[]);var r=setTimeout((function(){t.call(n)}),e);return this.timeoutIdArr.push(r),r})),i.clearTimeout=function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(t){var e=this;if(e.timeoutIdArr){var n=e.timeoutIdArr.indexOf(t);n>-1&&(clearTimeout(t),e.timeoutIdArr.splice(n,1))}})),i.setInterval=function(t){function e(e,n){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(t,e){var n=this;this.intervalIdArr||(this.intervalIdArr=[]);var r=setInterval((function(){t.call(n)}),e);return this.intervalIdArr.push(r),r})),i.clearInterval=function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(t){var e=this;if(e.intervalIdArr){var n=e.intervalIdArr.indexOf(t);n>-1&&(clearInterval(t),e.intervalIdArr.splice(n,1))}})),i.clearAllTimeoutOrInterval=function(){var t=this;if(t.timeoutIdArr){for(var e=0;e<t.timeoutIdArr.length;e++)clearTimeout(t.timeoutIdArr[e]);t.timeoutIdArr=null,console.log("清除timeoutIdArr: "+t.scriptName)}if(t.intervalIdArr){for(var n=0;n<t.intervalIdArr.length;n++)clearInterval(t.intervalIdArr[n]);t.intervalIdArr=null,console.log("清除intervalIdArr: "+t.scriptName)}},i.destory=function(){var t=this;t.isDestory||(t.node.destroy(),t.isDestory=!0)},i.__dispose=function(){var t=this;if(t.isEnter){if(t.isEnter=!1,t._emmitMap){for(var e in t._emmitMap)t.unEmitter(e,t._emmitMap[e]);t._emmitMap=null}if(t._objTapMap){for(var n in t._objTapMap){var r=n.split("&"),i=(r[0],r[1]);t._objTapMap[n].off(i,t.onNodeClick,t)}t._objTapMap=null}t.offBgMaskClick&&t.offBgMaskClick(),t.clearAllTimeoutOrInterval(),t.rmAllTweens(),console.log("退出："+t.scriptName),t.onExit_b(),t.onExit(),t.onExit_a()}},n(r,null,[{key:"__className",get:function(){return o.getClassName(this)}}]),r}(a)).prefabUrl="",v=h))||v);r._RF.pop()}}}));

System.register("chunks:///_virtual/UIDlg.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseUtil.ts","./SceneMgr.ts","./UILayer.ts"],(function(e){var t,n,a,o,s,i,r,c,l,d,g,k;return{setters:[function(e){t=e.inheritsLoose,n=e.createClass},function(e){a=e.cclegacy,o=e._decorator,s=e.BlockInputEvents,i=e.Vec3,r=e.Node,c=e.Graphics,l=e.Color},function(e){d=e.BaseUT},function(e){g=e.SceneMgr},function(e){k=e.UILayer}],execute:function(){var u;a._RF.push({},"fd0a9W7//VLi4SGBIYOSe34","UIDlg",void 0);var f=o.ccclass;o.property,e("UIDlg",f("UIDlg")(u=function(e){function a(){for(var t,n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return(t=e.call.apply(e,[this].concat(a))||this).dlgMaskName="__bgMask",t._clickBgMask=void 0,t._maskEnabled=void 0,t._penetrable=void 0,t._bgMaskNode=void 0,t}t(a,e);var o=a.prototype;return o.addToLayer=function(){var e=this,t=e._bgMaskNode=d.newUINode(e.dlgMaskName),n=d.getStageSize(),a=g.inst.curScene.dlg;e.maskEnabled=!0,d.setSize(t,n.width,n.height),t.setParent(a),d.setPivot(e.node,.5,.5),e.node.setParent(a),e.onOpenAnimation()},o.resetParent=function(){var e=this;e._bgMaskNode&&(e._penetrable||e._bgMaskNode.addComponent(s),e.node.insertChild(e._bgMaskNode,0))},o.onOpenAnimation=function(){var e=this;e.getTween(e.node).to(.1,{scale:new i(1.1,1.1,1)}).to(.1,{scale:new i(1,1,1)}).call((function(){e.resetParent()})).start()},o.onCloseAnimation=function(e){e.call(this)},o.offBgMaskClick=function(){var e=this;e._bgMaskNode&&e._bgMaskNode.off(r.EventType.TOUCH_END,e.close,e)},n(a,[{key:"outSideClosed",set:function(e){var t=this;t._clickBgMask!=e&&(t._clickBgMask=e,e?t._bgMaskNode.on(r.EventType.TOUCH_END,t.close,t):t.offBgMaskClick())}},{key:"maskEnabled",set:function(e){var t=this;if(t._maskEnabled!=e){t._maskEnabled=e;var n=d.getStageSize(),a=t._bgMaskNode.getComponent(c);a||(a=t._bgMaskNode.addComponent(c));var o=new l(0,0,0,255*(e?.4:0));a.clear(),a.fillColor=o,a.rect(-n.width/2,-n.height/2,n.width,n.height),a.fill()}}},{key:"penetrable",set:function(e){this._penetrable!=e&&(this._penetrable=e)}}]),a}(k))||u);a._RF.pop()}}}));

System.register("chunks:///_virtual/UILayer.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseUtil.ts","./ResMgr.ts","./SceneMgr.ts","./UIComp.ts"],(function(n){var t,e,r,o,a,s,i,c,u,l;return{setters:[function(n){t=n.inheritsLoose,e=n.asyncToGenerator,r=n.regeneratorRuntime},function(n){o=n.cclegacy,a=n._decorator,s=n.instantiate},function(n){i=n.BaseUT},function(n){c=n.ResMgr},function(n){u=n.SceneMgr},function(n){l=n.UIComp}],execute:function(){var f;o._RF.push({},"8571a4LASpMRbsNSiK965zF","UILayer",void 0);var d=a.ccclass;a.property,n("UILayer",d("UILayer")(f=function(n){function o(){for(var t,e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];return(t=n.call.apply(n,[this].concat(r))||this)._oldParent=void 0,t}t(o,n),o.show=function(){var n=e(r().mark((function n(t){var e,o,a;return r().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,c.inst.loadPrefab(this.prefabUrl);case 2:return e=n.sent,o=s(e),(a=o.getComponent(this.__className))||(a=o.addComponent(this.__className)),i.setFitSize(a.node),a.setData(t),a.addToLayer(),a.onAddToLayer(),n.abrupt("return",a);case 11:case"end":return n.stop()}}),n,this)})));return function(t){return n.apply(this,arguments)}}();var a=o.prototype;return a.addToLayer=function(){this.node.setParent(u.inst.curScene.layer)},a.onAddToLayer=function(){this._oldParent=this.node.parent},a.onOpenAnimation=function(){},a.onCloseAnimation=function(n){n&&n.call(this)},a.addSelf=function(){this.node.setParent(this._oldParent)},a.removeSelf=function(){this.node.removeFromParent()},a.close=function(){var n=this;n.onCloseAnimation((function(){n.destory()}))},a._tap_btn_close=function(){this.close()},o}(l))||f);o._RF.pop()}}}));

System.register("chunks:///_virtual/UIMenu.ts",["./rollupPluginModLoBabelHelpers.js","cc","./SceneMgr.ts","./UILayer.ts"],(function(e){var n,t,r,c,u;return{setters:[function(e){n=e.inheritsLoose},function(e){t=e.cclegacy,r=e._decorator},function(e){c=e.SceneMgr},function(e){u=e.UILayer}],execute:function(){var o;t._RF.push({},"6cf72LMPeVJMJBMVbsaRH19","UIMenu",void 0);var s=r.ccclass;r.property,e("UIMenu",s("UIMenu")(o=function(e){function t(){return e.apply(this,arguments)||this}return n(t,e),t.prototype.addToLayer=function(){this.node.setParent(c.inst.curScene.menuLayer)},t}(u))||o);t._RF.pop()}}}));

System.register("chunks:///_virtual/UIMsg.ts",["./rollupPluginModLoBabelHelpers.js","cc","./SceneMgr.ts","./UILayer.ts"],(function(t){var e,n,r,s,o;return{setters:[function(t){e=t.inheritsLoose},function(t){n=t.cclegacy,r=t._decorator},function(t){s=t.SceneMgr},function(t){o=t.UILayer}],execute:function(){var c;n._RF.push({},"fa77352ts5LoJAz3oE2bfgD","UIMsg",void 0);var i=r.ccclass;r.property,t("UIMsg",i("UIMsg")(c=function(t){function n(){return t.apply(this,arguments)||this}return e(n,t),n.prototype.addToLayer=function(){this.node.setParent(s.inst.curScene.msg)},n}(o))||c);n._RF.pop()}}}));

System.register("chunks:///_virtual/UIScene.ts",["./rollupPluginModLoBabelHelpers.js","cc","./SubLayerMgr.ts","./Emmiter.ts","./BaseUtil.ts","./SceneMgr.ts"],(function(t){var n,e,i,o,r,s,a,u,c,m,l;return{setters:[function(t){n=t.inheritsLoose,e=t.createClass},function(t){i=t.cclegacy,o=t._decorator,r=t.js,s=t.UITransform,a=t.Component},function(t){u=t.SubLayerMgr},function(t){c=t.emmiter},function(t){m=t.BaseUT},function(t){l=t.SceneMgr}],execute:function(){var f;i._RF.push({},"2c248rANetBSrUzidcvuUr9","UIScene",void 0);var d=o.ccclass;t("UIScene",d("UIScene")(f=function(t){function i(){for(var n,e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return(n=t.call.apply(t,[this].concat(i))||this).mainClassLayer=void 0,n.subLayerMgr=void 0,n.layer=void 0,n.dlg=void 0,n.msg=void 0,n.menuLayer=void 0,n.isEnter=void 0,n.isDestory=void 0,n._moduleParam=void 0,n._isFirstEnter=!0,n._emmitMap=void 0,n}n(i,t);var o=i.prototype;return o.__preload=function(){var t=this;t.subLayerMgr=new u,t.ctor_b(),t.ctor(),t.ctor_a(),m.setFitSize(this.node)},o.ctor_b=function(){},o.ctor=function(){},o.ctor_a=function(){},o.onEnter_b=function(){},o.onEnter=function(){},o.onFirstEnter=function(){},o.onEnter_a=function(){},o.onExit_b=function(){},o.onExit=function(){},o.onExit_a=function(){},o.onEmitter=function(t,n){var e=this;c.on(t,n,e),e._emmitMap||(e._emmitMap={}),e._emmitMap[t]=n},o.unEmitter=function(t,n){c.off(t,n,this)},o.emit=function(t,n){c.emit(t,n)},o.onLoad=function(){var t=this;t.initLayer(),t.mainClassLayer&&(t.subLayerMgr.register(t.mainClassLayer),t.push(t.mainClassLayer,{str:"我叫"+t.mainClassLayer.__className}))},o.initLayer=function(){var t=this;t.layer=t.addGCom2GRoot("UILayer"),t.menuLayer=t.addGCom2GRoot("UIMenuLayer"),t.dlg=t.addGCom2GRoot("UIDlg"),t.msg=t.addGCom2GRoot("UIMsg")},o.addGCom2GRoot=function(t,n){var e=m.newUINode(t);return e.setParent(this.node),m.setFitSize(e),e},o.__doEnter=function(){var t=this;t.isEnter||(t.isEnter=!0,console.log("进入场景："+t.className),t.onEnter_b(),t.onEnter(),t._isFirstEnter&&(t._isFirstEnter=!1,t.onFirstEnter()),t.onEnter_a())},o.setData=function(t){this._moduleParam=t},o.onEnable=function(){this.__doEnter()},o.onDisable=function(){this.__dispose()},o.resetToMain=function(){var t=this;t.releaseAllLayer(),t.push(t.mainClassLayer,{})},o.run=function(t,n){this.subLayerMgr.run(t,n)},o.push=function(t,n){this.subLayerMgr.push(t,n)},o.pop=function(){this.subLayerMgr.pop()},o.addToGRoot=function(){l.inst.getCanvas().insertChild(this.node,1)},o.removeFromParent=function(){this.node.removeFromParent()},o.releaseAllLayer=function(){this.subLayerMgr.releaseAllLayer()},o.disposeSubLayerMgr=function(){this.subLayerMgr.dispose(),this.subLayerMgr=null},o.__dispose=function(){var t=this;if(t.isEnter){if(t.isEnter=!1,t._emmitMap){for(var n in t._emmitMap)t.unEmitter(n,t._emmitMap[n]);t._emmitMap=null}console.log("退出场景："+t.className),this.onExit_b(),t.onExit(),this.onExit_a()}},o.destory=function(){this.__dispose(),this.subLayerMgr.dispose(),this.subLayerMgr=null,this.node.destroy()},o.onDestroy=function(){this.isDestory=!0},e(i,[{key:"className",get:function(){return r.getClassName(this)}},{key:"uiTransform",get:function(){return this.getComponent(s)}}]),i}(a))||f);i._RF.pop()}}}));

System.register("chunks:///_virtual/UT.ts",["cc","./SceneMgr.ts"],(function(e){var n,c;return{setters:[function(e){n=e.cclegacy},function(e){c=e.SceneMgr}],execute:function(){var t;e("UT",void 0),n._RF.push({},"4c33a903N1LMpNR97mU5R0e","UT",void 0),(t||(t=e("UT",{}))).closeDlgByName=function(e){for(var n=c.inst.curScene.dlg.children||[],t=n.length-1;t>=0;t--){var r=n[t],o=r.name;e.indexOf(o)>-1&&r.getComponent(o).close()}},n._RF.pop()}}}));

System.register("chunks:///_virtual/WebFileHandler.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,i,n,l,o,c;return{setters:[function(e){t=e.createClass},function(e){i=e.cclegacy,n=e.assetManager,l=e.SpriteFrame,o=e.Texture2D,c=e.sys}],execute:function(){i._RF.push({},"99ebcdQE0FN979/KPPboPrj","WebFileHandler",void 0),e("default",function(){function e(){this._fileInput=void 0,this.loadComplete=void 0,this.fileType=void 0,this.file=void 0,this.loadComplete=null,this.file=null,this.fileType=0}var i=e.prototype;return i.init=function(){var e=this;e._fileInput=document.createElement("input"),e._fileInput.id="finput",e._fileInput.style.opacity="0",e._fileInput.style.position="absolute",e._fileInput.setAttribute("left","-999px"),document.body.insertBefore(e._fileInput,document.body.firstChild),e._fileInput.onchange=function(t){e.onSelectFile(t),e.rmFileInput()},e._fileInput.oncancel=function(t){console.log(t),alert("用户取消了操作！"),e.rmFileInput()}},i.rmFileInput=function(){var e=this;e._fileInput&&(document.body.removeChild(e._fileInput),e._fileInput=null)},i.openImageWin=function(e){var t=this;t.init(),t.fileType=0,t._fileInput.type="file",t._fileInput.accept="image/png,image/jpeg",t.loadComplete=e,t._fileInput.click()},i.openTextWin=function(e){var t=this;t.init(),t.fileType=1,t._fileInput.type="file",t._fileInput.accept="application/json",t.loadComplete=e,t._fileInput.click()},i.openDirectoryWin=function(e){var t=this;t.init(),t.fileType=3,t._fileInput.type="file",t._fileInput.accept=".*",t.loadComplete=e,t._fileInput.click()},i.onSelectFile=function(e){var t=this;if(t.file=e.target.files[0],0==t.fileType){var i=t.createObjectURL(t.file);i&&t.loadLocalImg(i)}else 1==t.fileType&&t.loadLocalText(t.file)},i.loadLocalImg=function(e){var t=this;n.loadRemote(e,{ext:".png"},(function(e,i){var n=new l,c=new o;c.image=i,n.texture=c,t.loadComplete&&t.loadComplete(n,t.file)}))},i.loadLocalText=function(e){var t=this;if(e){var i=new FileReader;i.readAsText(e,"utf-8"),i.onprogress=function(e){console.log("pg =",e.loaded)},i.onload=function(){t.loadComplete&&t.loadComplete(i.result,t.file)}}},i.saveForBrowser=function(e,t){if(c.isBrowser){console.log("浏览器");var i=new Blob([e],{type:"application/json"}),n=document.createElement("a");n.download=t,n.innerHTML="Download File";var l=this.createObjectURL(i);n.href=l,n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n),l&&URL.revokeObjectURL(l)}},i.createObjectURL=function(e){return e?null!=window.URL?window.URL.createObjectURL(e):window.webkitURL.createObjectURL(e):null},t(e,null,[{key:"inst",get:function(){return this._inst||(this._inst=new e),this._inst}}]),e}())._inst=void 0,i._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});